import{f as Ne,a as he,t as uo,c as ws}from"../chunks/Dxr1Ij_4.js";import{i as si}from"../chunks/jxJGgJgQ.js";import{c as lf,o as Ju}from"../chunks/CrpsGFMf.js";import{P as $i,h as nt,a4 as hf,e as Zu,I as df,H as ff,t as P,U as pf,K as mf,M as gf,O as Ic,Q as zi,i as Sr,aa as _f,aF as yf,f as lo,s as vf,c as On,aD as el,z as Ef,aI as pe,af as wc,ao as Tf,r as tl,p as If,aM as wf,aN as Hi,d as nl,aO as Af,aP as Rf,ab as Sf,aQ as bf,aC as Pf,aR as Cf,Y as kf,aS as Df,aK as Vf,l as Ie,ag as Nf,aT as Of,A as ii,G as Z,E as se,F as ne,C as Ye,D as oi,W as K,aU as As,aV as rl,B as At,v as ot,aW as Mf,ap as Ac}from"../chunks/Bxsz-vti.js";import{s as et,e as je,d as Lf}from"../chunks/BL4KWbMy.js";import{i as Xe,p as Kt}from"../chunks/BVnwWrB1.js";import{r as ho,s as sl}from"../chunks/BFr2TMnw.js";function il(n,e){return e}function xf(n,e,t){for(var r=n.items,s=[],a=e.length,c=0;c<a;c++)bf(e[c].e,s,!0);var l=a>0&&s.length===0&&t!==null;if(l){var h=t.parentNode;Pf(h),h.append(t),r.clear(),dt(n,e[0].prev,e[a-1].next)}Cf(s,()=>{for(var f=0;f<a;f++){var m=e[f];l||(r.delete(m.k),dt(n,m.prev,m.next)),nl(m.e,!l)}})}function ol(n,e,t,r,s,a=null){var c=n,l={flags:e,items:new Map,first:null};{var h=n;c=nt?$i(hf(h)):h.appendChild(Zu())}nt&&df();var f=null,m=!1,T=new Map,I=pf(()=>{var k=t();return Ef(k)?k:k==null?[]:el(k)}),b,D;function N(){Ff(D,b,l,T,c,s,e,r,t),a!==null&&(b.length===0?f?tl(f):f=lo(()=>a(c)):f!==null&&If(f,()=>{f=null}))}ff(()=>{D??=kf,b=P(I);var k=b.length;if(m&&k===0)return;m=k===0;let B=!1;if(nt){var F=mf(c)===gf;F!==(k===0)&&(c=Ic(),$i(c),zi(!1),B=!0)}if(nt){for(var L=null,U,z=0;z<k;z++){if(Sr.nodeType===_f&&Sr.data===yf){c=Sr,B=!0,zi(!1);break}var G=b[z],w=r(G,z);U=fo(Sr,l,L,null,G,w,z,s,e,t),l.items.set(w,U),L=U}k>0&&$i(Ic())}if(nt)k===0&&a&&(f=lo(()=>a(c)));else if(vf()){var _=new Set,g=On;for(z=0;z<k;z+=1){G=b[z],w=r(G,z);var E=l.items.get(w)??T.get(w);E?al(E,G,z):(U=fo(null,l,null,null,G,w,z,s,e,t,!0),T.set(w,U)),_.add(w)}for(const[y,A]of l.items)_.has(y)||g.skipped_effects.add(A.e);g.oncommit(N)}else N();B&&zi(!0),P(I)}),nt&&(c=Sr)}function Ff(n,e,t,r,s,a,c,l,h){var f=e.length,m=t.items,T=t.first,I=T,b,D=null,N=[],k=[],B,F,L,U;for(U=0;U<f;U+=1){if(B=e[U],F=l(B,U),L=m.get(F),L===void 0){var z=r.get(F);if(z!==void 0){r.delete(F),m.set(F,z);var G=D?D.next:I;dt(t,D,z),dt(t,z,G),Wi(z,G,s),D=z}else{var w=I?I.e.nodes_start:s;D=fo(w,t,D,D===null?t.first:D.next,B,F,U,a,c,h)}m.set(F,D),N=[],k=[],I=D.next;continue}if(al(L,B,U),(L.e.f&Hi)!==0&&tl(L.e),L!==I){if(b!==void 0&&b.has(L)){if(N.length<k.length){var _=k[0],g;D=_.prev;var E=N[0],y=N[N.length-1];for(g=0;g<N.length;g+=1)Wi(N[g],_,s);for(g=0;g<k.length;g+=1)b.delete(k[g]);dt(t,E.prev,y.next),dt(t,D,E),dt(t,y,_),I=_,D=y,U-=1,N=[],k=[]}else b.delete(L),Wi(L,I,s),dt(t,L.prev,L.next),dt(t,L,D===null?t.first:D.next),dt(t,D,L),D=L;continue}for(N=[],k=[];I!==null&&I.k!==F;)(I.e.f&Hi)===0&&(b??=new Set).add(I),k.push(I),I=I.next;if(I===null)continue;L=I}N.push(L),D=L,I=L.next}if(I!==null||b!==void 0){for(var A=b===void 0?[]:el(b);I!==null;)(I.e.f&Hi)===0&&A.push(I),I=I.next;var v=A.length;if(v>0){var re=f===0?s:null;xf(t,A,re)}}n.first=t.first&&t.first.e,n.last=D&&D.e;for(var ve of r.values())nl(ve.e);r.clear()}function al(n,e,t,r){Tf(n.v,e),n.i=t}function fo(n,e,t,r,s,a,c,l,h,f,m){var T=(h&Af)!==0,I=(h&Rf)===0,b=T?I?pe(s,!1,!1):wc(s):s,D=(h&wf)===0?c:wc(c),N={i:D,v:b,k:a,a:null,e:null,prev:t,next:r};try{if(n===null){var k=document.createDocumentFragment();k.append(n=Zu())}return N.e=lo(()=>l(n,b,D,f),nt),N.e.prev=t&&t.e,N.e.next=r&&r.e,t===null?m||(e.first=N):(t.next=N,t.e.next=N.e),r!==null&&(r.prev=N,r.e.prev=N.e),N}finally{}}function Wi(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,a=n.e.nodes_start;a!==null&&a!==r;){var c=Sf(a);s.before(a),a=c}}function dt(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function cl(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=cl(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Uf(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=cl(n))&&(r&&(r+=" "),r+=e);return r}function Bf(n){return typeof n=="object"?Uf(n):n??""}function jf(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Rc(n,e=!1){var t=e?" !important;":";",r="";for(var s in n){var a=n[s];a!=null&&a!==""&&(r+=" "+s+": "+a+t)}return r}function Gi(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function qf(n,e){if(e){var t="",r,s;if(Array.isArray(e)?(r=e[0],s=e[1]):r=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var a=!1,c=0,l=!1,h=[];r&&h.push(...Object.keys(r).map(Gi)),s&&h.push(...Object.keys(s).map(Gi));var f=0,m=-1;const N=n.length;for(var T=0;T<N;T++){var I=n[T];if(l?I==="/"&&n[T-1]==="*"&&(l=!1):a?a===I&&(a=!1):I==="/"&&n[T+1]==="*"?l=!0:I==='"'||I==="'"?a=I:I==="("?c++:I===")"&&c--,!l&&a===!1&&c===0){if(I===":"&&m===-1)m=T;else if(I===";"||T===N-1){if(m!==-1){var b=Gi(n.substring(f,m).trim());if(!h.includes(b)){I!==";"&&T++;var D=n.substring(f,T).trim();t+=" "+D+";"}}f=T+1,m=-1}}}}return r&&(t+=Rc(r)),s&&(t+=Rc(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function $f(n,e,t,r,s,a){var c=n.__className;if(nt||c!==t||c===void 0){var l=jf(t,r);(!nt||l!==n.getAttribute("class"))&&(l==null?n.removeAttribute("class"):n.className=l),n.__className=t}return a}function Ki(n,e={},t,r){for(var s in t){var a=t[s];e[s]!==a&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,a,r))}}function bt(n,e,t,r){var s=n.__style;if(nt||s!==e){var a=qf(e,r);(!nt||a!==n.getAttribute("style"))&&(a==null?n.removeAttribute("style"):n.style.cssText=a),n.__style=e}else r&&(Array.isArray(r)?(Ki(n,t?.[0],r[0]),Ki(n,t?.[1],r[1],"important")):Ki(n,t,r));return r}function Ms(n,e,t=e){var r=new WeakSet;Df(n,"input",async s=>{var a=s?n.defaultValue:n.value;if(a=Qi(n)?Yi(a):a,t(a),On!==null&&r.add(On),await Vf(),a!==(a=e())){var c=n.selectionStart,l=n.selectionEnd,h=n.value.length;if(n.value=a??"",l!==null){var f=n.value.length;c===l&&l===h&&f>h?(n.selectionStart=f,n.selectionEnd=f):(n.selectionStart=c,n.selectionEnd=Math.min(l,f))}}}),(nt&&n.defaultValue!==n.value||Ie(e)==null&&n.value)&&(t(Qi(n)?Yi(n.value):n.value),On!==null&&r.add(On)),Nf(()=>{var s=e();if(n===document.activeElement){var a=Of??On;if(r.has(a))return}Qi(n)&&s===Yi(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Qi(n){var e=n.type;return e==="number"||e==="range"}function Yi(n){return n===""?null:+n}const zf=()=>{};var Sc={};const ul=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Hf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const a=n[t++];e[r++]=String.fromCharCode((s&31)<<6|a&63)}else if(s>239&&s<365){const a=n[t++],c=n[t++],l=n[t++],h=((s&7)<<18|(a&63)<<12|(c&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const a=n[t++],c=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(a&63)<<6|c&63)}}return e.join("")},ll={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const a=n[s],c=s+1<n.length,l=c?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,m=a>>2,T=(a&3)<<4|l>>4;let I=(l&15)<<2|f>>6,b=f&63;h||(b=64,c||(I=64)),r.push(t[m],t[T],t[I],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ul(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Hf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const a=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const f=s<n.length?t[n.charAt(s)]:64;++s;const T=s<n.length?t[n.charAt(s)]:64;if(++s,a==null||l==null||f==null||T==null)throw new Wf;const I=a<<2|l>>4;if(r.push(I),f!==64){const b=l<<4&240|f>>2;if(r.push(b),T!==64){const D=f<<6&192|T;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Wf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Gf=function(n){const e=ul(n);return ll.encodeByteArray(e,!0)},Ls=function(n){return Gf(n).replace(/\./g,"")},hl=function(n){try{return ll.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Kf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Qf=()=>Kf().__FIREBASE_DEFAULTS__,Yf=()=>{if(typeof process>"u"||typeof Sc>"u")return;const n=Sc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Xf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&hl(n[1]);return e&&JSON.parse(e)},ai=()=>{try{return zf()||Qf()||Yf()||Xf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},dl=n=>ai()?.emulatorHosts?.[n],Jf=n=>{const e=dl(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},fl=()=>ai()?.config,pl=n=>ai()?.[`_${n}`];class Zf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Jn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ml(n){return(await fetch(n,{credentials:"include"})).ok}function ep(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,a=n.sub||n.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ls(JSON.stringify(t)),Ls(JSON.stringify(c)),""].join(".")}const Nr={};function tp(){const n={prod:[],emulator:[]};for(const e of Object.keys(Nr))Nr[e]?n.emulator.push(e):n.prod.push(e);return n}function np(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let bc=!1;function gl(n,e){if(typeof window>"u"||typeof document>"u"||!Jn(window.location.host)||Nr[n]===e||Nr[n]||bc)return;Nr[n]=e;function t(I){return`__firebase__banner__${I}`}const r="__firebase__banner",a=tp().prod.length>0;function c(){const I=document.getElementById(r);I&&I.remove()}function l(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function h(I,b){I.setAttribute("width","24"),I.setAttribute("id",b),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function f(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{bc=!0,c()},I}function m(I,b){I.setAttribute("id",b),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function T(){const I=np(r),b=t("text"),D=document.getElementById(b)||document.createElement("span"),N=t("learnmore"),k=document.getElementById(N)||document.createElement("a"),B=t("preprendIcon"),F=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const L=I.element;l(L),m(k,N);const U=f();h(F,B),L.append(F,D,k,U),document.body.appendChild(L)}a?(D.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",T):T()}function ze(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ze())}function sp(){const n=ai()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ip(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function op(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ap(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cp(){const n=ze();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function up(){return!sp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lp(){try{return typeof indexedDB=="object"}catch{return!1}}function hp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const dp="FirebaseError";class Mt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=dp,Object.setPrototypeOf(this,Mt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Kr.prototype.create)}}class Kr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],c=a?fp(a,r):"Error",l=`${this.serviceName}: ${c} (${s}).`;return new Mt(s,l,r)}}function fp(n,e){return n.replace(pp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const pp=/\{\$([^}]+)}/g;function mp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function vn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const a=n[s],c=e[s];if(Pc(a)&&Pc(c)){if(!vn(a,c))return!1}else if(a!==c)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Pc(n){return n!==null&&typeof n=="object"}function Qr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function br(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,a]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(a)}}),e}function Pr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function gp(n,e){const t=new _p(n,e);return t.subscribe.bind(t)}class _p{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");yp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Xi),s.error===void 0&&(s.error=Xi),s.complete===void 0&&(s.complete=Xi);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Xi(){}function Je(n){return n&&n._delegate?n._delegate:n}class En{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const gn="[DEFAULT]";class vp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Zf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Tp(e))try{this.getOrInitializeService({instanceIdentifier:gn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:s});r.resolve(a)}catch{}}}}clearInstance(e=gn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gn){return this.instances.has(e)}getOptions(e=gn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[a,c]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);r===l&&c.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const a=this.instances.get(r);return a&&e(a,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ep(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=gn){return this.component?this.component.multipleInstances?e:gn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ep(n){return n===gn?void 0:n}function Tp(n){return n.instantiationMode==="EAGER"}class Ip{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new vp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Y;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Y||(Y={}));const wp={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},Ap=Y.INFO,Rp={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},Sp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Rp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class jo{constructor(e){this.name=e,this._logLevel=Ap,this._logHandler=Sp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const bp=(n,e)=>e.some(t=>n instanceof t);let Cc,kc;function Pp(){return Cc||(Cc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Cp(){return kc||(kc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _l=new WeakMap,po=new WeakMap,yl=new WeakMap,Ji=new WeakMap,qo=new WeakMap;function kp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",a),n.removeEventListener("error",c)},a=()=>{t(Yt(n.result)),s()},c=()=>{r(n.error),s()};n.addEventListener("success",a),n.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&_l.set(t,n)}).catch(()=>{}),qo.set(e,n),e}function Dp(n){if(po.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",c),n.removeEventListener("abort",c)},a=()=>{t(),s()},c=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",a),n.addEventListener("error",c),n.addEventListener("abort",c)});po.set(n,e)}let mo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return po.get(n);if(e==="objectStoreNames")return n.objectStoreNames||yl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Yt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Vp(n){mo=n(mo)}function Np(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Zi(this),e,...t);return yl.set(r,e.sort?e.sort():[e]),Yt(r)}:Cp().includes(n)?function(...e){return n.apply(Zi(this),e),Yt(_l.get(this))}:function(...e){return Yt(n.apply(Zi(this),e))}}function Op(n){return typeof n=="function"?Np(n):(n instanceof IDBTransaction&&Dp(n),bp(n,Pp())?new Proxy(n,mo):n)}function Yt(n){if(n instanceof IDBRequest)return kp(n);if(Ji.has(n))return Ji.get(n);const e=Op(n);return e!==n&&(Ji.set(n,e),qo.set(e,n)),e}const Zi=n=>qo.get(n);function Mp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:a}={}){const c=indexedDB.open(n,e),l=Yt(c);return r&&c.addEventListener("upgradeneeded",h=>{r(Yt(c.result),h.oldVersion,h.newVersion,Yt(c.transaction),h)}),t&&c.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{a&&h.addEventListener("close",()=>a()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const Lp=["get","getKey","getAll","getAllKeys","count"],xp=["put","add","delete","clear"],eo=new Map;function Dc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(eo.get(e))return eo.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=xp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Lp.includes(t)))return;const a=async function(c,...l){const h=this.transaction(c,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(l.shift())),(await Promise.all([f[t](...l),s&&h.done]))[0]};return eo.set(e,a),a}Vp(n=>({...n,get:(e,t,r)=>Dc(e,t)||n.get(e,t,r),has:(e,t)=>!!Dc(e,t)||n.has(e,t)}));class Fp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Up(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Up(n){return n.getComponent()?.type==="VERSION"}const go="@firebase/app",Vc="0.14.5";const Dt=new jo("@firebase/app"),Bp="@firebase/app-compat",jp="@firebase/analytics-compat",qp="@firebase/analytics",$p="@firebase/app-check-compat",zp="@firebase/app-check",Hp="@firebase/auth",Wp="@firebase/auth-compat",Gp="@firebase/database",Kp="@firebase/data-connect",Qp="@firebase/database-compat",Yp="@firebase/functions",Xp="@firebase/functions-compat",Jp="@firebase/installations",Zp="@firebase/installations-compat",em="@firebase/messaging",tm="@firebase/messaging-compat",nm="@firebase/performance",rm="@firebase/performance-compat",sm="@firebase/remote-config",im="@firebase/remote-config-compat",om="@firebase/storage",am="@firebase/storage-compat",cm="@firebase/firestore",um="@firebase/ai",lm="@firebase/firestore-compat",hm="firebase",dm="12.5.0";const _o="[DEFAULT]",fm={[go]:"fire-core",[Bp]:"fire-core-compat",[qp]:"fire-analytics",[jp]:"fire-analytics-compat",[zp]:"fire-app-check",[$p]:"fire-app-check-compat",[Hp]:"fire-auth",[Wp]:"fire-auth-compat",[Gp]:"fire-rtdb",[Kp]:"fire-data-connect",[Qp]:"fire-rtdb-compat",[Yp]:"fire-fn",[Xp]:"fire-fn-compat",[Jp]:"fire-iid",[Zp]:"fire-iid-compat",[em]:"fire-fcm",[tm]:"fire-fcm-compat",[nm]:"fire-perf",[rm]:"fire-perf-compat",[sm]:"fire-rc",[im]:"fire-rc-compat",[om]:"fire-gcs",[am]:"fire-gcs-compat",[cm]:"fire-fst",[lm]:"fire-fst-compat",[um]:"fire-vertex","fire-js":"fire-js",[hm]:"fire-js-all"};const xs=new Map,pm=new Map,yo=new Map;function Nc(n,e){try{n.container.addComponent(e)}catch(t){Dt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Hn(n){const e=n.name;if(yo.has(e))return Dt.debug(`There were multiple attempts to register component ${e}.`),!1;yo.set(e,n);for(const t of xs.values())Nc(t,n);for(const t of pm.values())Nc(t,n);return!0}function $o(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function rt(n){return n==null?!1:n.settings!==void 0}const mm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Xt=new Kr("app","Firebase",mm);class gm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new En("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xt.create("app-deleted",{appName:this._name})}}const Zn=dm;function vl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:_o,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Xt.create("bad-app-name",{appName:String(s)});if(t||(t=fl()),!t)throw Xt.create("no-options");const a=xs.get(s);if(a){if(vn(t,a.options)&&vn(r,a.config))return a;throw Xt.create("duplicate-app",{appName:s})}const c=new Ip(s);for(const h of yo.values())c.addComponent(h);const l=new gm(t,r,c);return xs.set(s,l),l}function El(n=_o){const e=xs.get(n);if(!e&&n===_o&&fl())return vl();if(!e)throw Xt.create("no-app",{appName:n});return e}function Jt(n,e,t){let r=fm[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const c=[`Unable to register library "${r}" with version "${e}":`];s&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Dt.warn(c.join(" "));return}Hn(new En(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const _m="firebase-heartbeat-database",ym=1,Ur="firebase-heartbeat-store";let to=null;function Tl(){return to||(to=Mp(_m,ym,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ur)}catch(t){console.warn(t)}}}}).catch(n=>{throw Xt.create("idb-open",{originalErrorMessage:n.message})})),to}async function vm(n){try{const t=(await Tl()).transaction(Ur),r=await t.objectStore(Ur).get(Il(n));return await t.done,r}catch(e){if(e instanceof Mt)Dt.warn(e.message);else{const t=Xt.create("idb-get",{originalErrorMessage:e?.message});Dt.warn(t.message)}}}async function Oc(n,e){try{const r=(await Tl()).transaction(Ur,"readwrite");await r.objectStore(Ur).put(e,Il(n)),await r.done}catch(t){if(t instanceof Mt)Dt.warn(t.message);else{const r=Xt.create("idb-set",{originalErrorMessage:t?.message});Dt.warn(r.message)}}}function Il(n){return`${n.name}!${n.options.appId}`}const Em=1024,Tm=30;class Im{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Am(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Mc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Tm){const s=Rm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Dt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Mc(),{heartbeatsToSend:t,unsentEntries:r}=wm(this._heartbeatsCache.heartbeats),s=Ls(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Dt.warn(e),""}}}function Mc(){return new Date().toISOString().substring(0,10)}function wm(n,e=Em){const t=[];let r=n.slice();for(const s of n){const a=t.find(c=>c.agent===s.agent);if(a){if(a.dates.push(s.date),Lc(t)>e){a.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Lc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Am{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lp()?hp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await vm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Oc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Oc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Lc(n){return Ls(JSON.stringify({version:2,heartbeats:n})).length}function Rm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Sm(n){Hn(new En("platform-logger",e=>new Fp(e),"PRIVATE")),Hn(new En("heartbeat",e=>new Im(e),"PRIVATE")),Jt(go,Vc,n),Jt(go,Vc,"esm2020"),Jt("fire-js","")}Sm("");var bm="firebase",Pm="12.5.0";Jt(bm,Pm,"app");function wl(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Cm=wl,Al=new Kr("auth","Firebase",wl());const Fs=new jo("@firebase/auth");function km(n,...e){Fs.logLevel<=Y.WARN&&Fs.warn(`Auth (${Zn}): ${n}`,...e)}function Rs(n,...e){Fs.logLevel<=Y.ERROR&&Fs.error(`Auth (${Zn}): ${n}`,...e)}function ut(n,...e){throw zo(n,...e)}function pt(n,...e){return zo(n,...e)}function Rl(n,e,t){const r={...Cm(),[e]:t};return new Kr("auth","Firebase",r).create(e,{appName:n.name})}function Pt(n){return Rl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function zo(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Al.create(n,...e)}function q(n,e,...t){if(!n)throw zo(e,...t)}function Rt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Rs(e),new Error(e)}function Vt(n,e){n||Rt(e)}function vo(){return typeof self<"u"&&self.location?.href||""}function Dm(){return xc()==="http:"||xc()==="https:"}function xc(){return typeof self<"u"&&self.location?.protocol||null}function Vm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Dm()||op()||"connection"in navigator)?navigator.onLine:!0}function Nm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Yr{constructor(e,t){this.shortDelay=e,this.longDelay=t,Vt(t>e,"Short delay should be less than long delay!"),this.isMobile=rp()||ap()}get(){return Vm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Ho(n,e){Vt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Sl{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Om={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Mm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Lm=new Yr(3e4,6e4);function cn(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function un(n,e,t,r,s={}){return bl(n,s,async()=>{let a={},c={};r&&(e==="GET"?c=r:a={body:JSON.stringify(r)});const l=Qr({key:n.config.apiKey,...c}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const f={method:e,headers:h,...a};return ip()||(f.referrerPolicy="no-referrer"),n.emulatorConfig&&Jn(n.emulatorConfig.host)&&(f.credentials="include"),Sl.fetch()(await Pl(n,n.config.apiHost,t,l),f)})}async function bl(n,e,t){n._canInitEmulator=!1;const r={...Om,...e};try{const s=new Fm(n),a=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const c=await a.json();if("needConfirmation"in c)throw _s(n,"account-exists-with-different-credential",c);if(a.ok&&!("errorMessage"in c))return c;{const l=a.ok?c.errorMessage:c.error.message,[h,f]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw _s(n,"credential-already-in-use",c);if(h==="EMAIL_EXISTS")throw _s(n,"email-already-in-use",c);if(h==="USER_DISABLED")throw _s(n,"user-disabled",c);const m=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw Rl(n,m,f);ut(n,m)}}catch(s){if(s instanceof Mt)throw s;ut(n,"network-request-failed",{message:String(s)})}}async function Xr(n,e,t,r,s={}){const a=await un(n,e,t,r,s);return"mfaPendingCredential"in a&&ut(n,"multi-factor-auth-required",{_serverResponse:a}),a}async function Pl(n,e,t,r){const s=`${e}${t}?${r}`,a=n,c=a.config.emulator?Ho(n.config,s):`${n.config.apiScheme}://${s}`;return Mm.includes(t)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(c).toString():c}function xm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Fm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(pt(this.auth,"network-request-failed")),Lm.get())})}}function _s(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=pt(n,e,r);return s.customData._tokenResponse=t,s}function Fc(n){return n!==void 0&&n.enterprise!==void 0}class Um{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Bm(n,e){return un(n,"GET","/v2/recaptchaConfig",cn(n,e))}async function jm(n,e){return un(n,"POST","/v1/accounts:delete",e)}async function Us(n,e){return un(n,"POST","/v1/accounts:lookup",e)}function Or(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function qm(n,e=!1){const t=Je(n),r=await t.getIdToken(e),s=Wo(r);q(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const a=typeof s.firebase=="object"?s.firebase:void 0,c=a?.sign_in_provider;return{claims:s,token:r,authTime:Or(no(s.auth_time)),issuedAtTime:Or(no(s.iat)),expirationTime:Or(no(s.exp)),signInProvider:c||null,signInSecondFactor:a?.sign_in_second_factor||null}}function no(n){return Number(n)*1e3}function Wo(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Rs("JWT malformed, contained fewer than 3 sections"),null;try{const s=hl(t);return s?JSON.parse(s):(Rs("Failed to decode base64 JWT payload"),null)}catch(s){return Rs("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Uc(n){const e=Wo(n);return q(e,"internal-error"),q(typeof e.exp<"u","internal-error"),q(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Br(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Mt&&$m(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function $m({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class zm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Eo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Or(this.lastLoginAt),this.creationTime=Or(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Bs(n){const e=n.auth,t=await n.getIdToken(),r=await Br(n,Us(e,{idToken:t}));q(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const a=s.providerUserInfo?.length?Cl(s.providerUserInfo):[],c=Wm(n.providerData,a),l=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!c?.length,f=l?h:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new Eo(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,m)}async function Hm(n){const e=Je(n);await Bs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Wm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Cl(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Gm(n,e){const t=await bl(n,{},async()=>{const r=Qr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:a}=n.config,c=await Pl(n,s,"/v1/token",`key=${a}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:l,body:r};return n.emulatorConfig&&Jn(n.emulatorConfig.host)&&(h.credentials="include"),Sl.fetch()(c,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Km(n,e){return un(n,"POST","/v2/accounts:revokeToken",cn(n,e))}class Bn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){q(e.idToken,"internal-error"),q(typeof e.idToken<"u","internal-error"),q(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Uc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){q(e.length!==0,"internal-error");const t=Uc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(q(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:a}=await Gm(e,t);this.updateTokensAndExpiration(r,s,Number(a))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:a}=t,c=new Bn;return r&&(q(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),s&&(q(typeof s=="string","internal-error",{appName:e}),c.accessToken=s),a&&(q(typeof a=="number","internal-error",{appName:e}),c.expirationTime=a),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Bn,this.toJSON())}_performRefresh(){return Rt("not implemented")}}function $t(n,e){q(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class at{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new zm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Eo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Br(this,this.stsTokenManager.getToken(this.auth,e));return q(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qm(this,e)}reload(){return Hm(this)}_assign(e){this!==e&&(q(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new at({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){q(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Bs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rt(this.auth.app))return Promise.reject(Pt(this.auth));const e=await this.getIdToken();return await Br(this,jm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,a=t.phoneNumber??void 0,c=t.photoURL??void 0,l=t.tenantId??void 0,h=t._redirectEventId??void 0,f=t.createdAt??void 0,m=t.lastLoginAt??void 0,{uid:T,emailVerified:I,isAnonymous:b,providerData:D,stsTokenManager:N}=t;q(T&&N,e,"internal-error");const k=Bn.fromJSON(this.name,N);q(typeof T=="string",e,"internal-error"),$t(r,e.name),$t(s,e.name),q(typeof I=="boolean",e,"internal-error"),q(typeof b=="boolean",e,"internal-error"),$t(a,e.name),$t(c,e.name),$t(l,e.name),$t(h,e.name),$t(f,e.name),$t(m,e.name);const B=new at({uid:T,auth:e,email:s,emailVerified:I,displayName:r,isAnonymous:b,photoURL:c,phoneNumber:a,tenantId:l,stsTokenManager:k,createdAt:f,lastLoginAt:m});return D&&Array.isArray(D)&&(B.providerData=D.map(F=>({...F}))),h&&(B._redirectEventId=h),B}static async _fromIdTokenResponse(e,t,r=!1){const s=new Bn;s.updateFromServerResponse(t);const a=new at({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Bs(a),a}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];q(s.localId!==void 0,"internal-error");const a=s.providerUserInfo!==void 0?Cl(s.providerUserInfo):[],c=!(s.email&&s.passwordHash)&&!a?.length,l=new Bn;l.updateFromIdToken(r);const h=new at({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:c}),f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Eo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!a?.length};return Object.assign(h,f),h}}const Bc=new Map;function St(n){Vt(n instanceof Function,"Expected a class definition");let e=Bc.get(n);return e?(Vt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Bc.set(n,e),e)}class kl{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}kl.type="NONE";const jc=kl;function Ss(n,e,t){return`firebase:${n}:${e}:${t}`}class jn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:a}=this.auth;this.fullUserKey=Ss(this.userKey,s.apiKey,a),this.fullPersistenceKey=Ss("persistence",s.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Us(this.auth,{idToken:e}).catch(()=>{});return t?at._fromGetAccountInfoResponse(this.auth,t,e):null}return at._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new jn(St(jc),e,r);const s=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let a=s[0]||St(jc);const c=Ss(r,e.config.apiKey,e.name);let l=null;for(const f of t)try{const m=await f._get(c);if(m){let T;if(typeof m=="string"){const I=await Us(e,{idToken:m}).catch(()=>{});if(!I)break;T=await at._fromGetAccountInfoResponse(e,I,m)}else T=at._fromJSON(e,m);f!==a&&(l=T),a=f;break}}catch{}const h=s.filter(f=>f._shouldAllowMigration);return!a._shouldAllowMigration||!h.length?new jn(a,e,r):(a=h[0],l&&await a._set(c,l.toJSON()),await Promise.all(t.map(async f=>{if(f!==a)try{await f._remove(c)}catch{}})),new jn(a,e,r))}}function qc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ol(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Dl(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ll(e))return"Blackberry";if(xl(e))return"Webos";if(Vl(e))return"Safari";if((e.includes("chrome/")||Nl(e))&&!e.includes("edge/"))return"Chrome";if(Ml(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Dl(n=ze()){return/firefox\//i.test(n)}function Vl(n=ze()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Nl(n=ze()){return/crios\//i.test(n)}function Ol(n=ze()){return/iemobile/i.test(n)}function Ml(n=ze()){return/android/i.test(n)}function Ll(n=ze()){return/blackberry/i.test(n)}function xl(n=ze()){return/webos/i.test(n)}function Go(n=ze()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Qm(n=ze()){return Go(n)&&!!window.navigator?.standalone}function Ym(){return cp()&&document.documentMode===10}function Fl(n=ze()){return Go(n)||Ml(n)||xl(n)||Ll(n)||/windows phone/i.test(n)||Ol(n)}function Ul(n,e=[]){let t;switch(n){case"Browser":t=qc(ze());break;case"Worker":t=`${qc(ze())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Zn}/${r}`}class Xm{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=a=>new Promise((c,l)=>{try{const h=e(a);c(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Jm(n,e={}){return un(n,"GET","/v2/passwordPolicy",cn(n,e))}const Zm=6;class eg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Zm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}class tg{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $c(this),this.idTokenSubscription=new $c(this),this.beforeStateQueue=new Xm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Al,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=St(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await jn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Us(this,{idToken:e}),r=await at._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(rt(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=this.redirectUser?._redirectEventId,c=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===c)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return q(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Nm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rt(this.app))return Promise.reject(Pt(this));const t=e?Je(e):null;return t&&q(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&q(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return rt(this.app)?Promise.reject(Pt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rt(this.app)?Promise.reject(Pt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(St(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Jm(this),t=new eg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Kr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Km(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&St(e)||this._popupRedirectResolver;q(t,this,"argument-error"),this.redirectPersistenceManager=await jn.create(this,[St(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let c=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(q(l,this,"internal-error"),l.then(()=>{c||a(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{c=!0,h()}}else{const h=e.addObserver(t);return()=>{c=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return q(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ul(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(rt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&km(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Sn(n){return Je(n)}class $c{constructor(e){this.auth=e,this.observer=null,this.addObserver=gp(t=>this.observer=t)}get next(){return q(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ci={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ng(n){ci=n}function Bl(n){return ci.loadJS(n)}function rg(){return ci.recaptchaEnterpriseScript}function sg(){return ci.gapiScript}function ig(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class og{constructor(){this.enterprise=new ag}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ag{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const cg="recaptcha-enterprise",jl="NO_RECAPTCHA";class ug{constructor(e){this.type=cg,this.auth=Sn(e)}async verify(e="verify",t=!1){async function r(a){if(!t){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(c,l)=>{Bm(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const f=new Um(h);return a.tenantId==null?a._agentRecaptchaConfig=f:a._tenantRecaptchaConfigs[a.tenantId]=f,c(f.siteKey)}}).catch(h=>{l(h)})})}function s(a,c,l){const h=window.grecaptcha;Fc(h)?h.enterprise.ready(()=>{h.enterprise.execute(a,{action:e}).then(f=>{c(f)}).catch(()=>{c(jl)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new og().execute("siteKey",{action:"verify"}):new Promise((a,c)=>{r(this.auth).then(l=>{if(!t&&Fc(window.grecaptcha))s(l,a,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let h=rg();h.length!==0&&(h+=l),Bl(h).then(()=>{s(l,a,c)}).catch(f=>{c(f)})}}).catch(l=>{c(l)})})}}async function zc(n,e,t,r=!1,s=!1){const a=new ug(n);let c;if(s)c=jl;else try{c=await a.verify(t)}catch{c=await a.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const h=l.phoneEnrollmentInfo.phoneNumber,f=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const h=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:c}):Object.assign(l,{captchaResponse:c}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function To(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await zc(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await zc(n,e,t,t==="getOobCode");return r(n,c)}else return Promise.reject(a)})}function lg(n,e){const t=$o(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),a=t.getOptions();if(vn(a,e??{}))return s;ut(s,"already-initialized")}return t.initialize({options:e})}function hg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(St);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function dg(n,e,t){const r=Sn(n);q(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,a=ql(e),{host:c,port:l}=fg(e),h=l===null?"":`:${l}`,f={url:`${a}//${c}${h}/`},m=Object.freeze({host:c,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){q(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),q(vn(f,r.config.emulator)&&vn(m,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=m,r.settings.appVerificationDisabledForTesting=!0,Jn(c)?(ml(`${a}//${c}${h}`),gl("Auth",!0)):pg()}function ql(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function fg(n){const e=ql(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const a=s[1];return{host:a,port:Hc(r.substr(a.length+1))}}else{const[a,c]=r.split(":");return{host:a,port:Hc(c)}}}function Hc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function pg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Ko{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rt("not implemented")}_getIdTokenResponse(e){return Rt("not implemented")}_linkToIdToken(e,t){return Rt("not implemented")}_getReauthenticationResolver(e){return Rt("not implemented")}}async function mg(n,e){return un(n,"POST","/v1/accounts:signUp",e)}async function gg(n,e){return Xr(n,"POST","/v1/accounts:signInWithPassword",cn(n,e))}async function _g(n,e){return Xr(n,"POST","/v1/accounts:signInWithEmailLink",cn(n,e))}async function yg(n,e){return Xr(n,"POST","/v1/accounts:signInWithEmailLink",cn(n,e))}class jr extends Ko{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new jr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new jr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return To(e,t,"signInWithPassword",gg);case"emailLink":return _g(e,{email:this._email,oobCode:this._password});default:ut(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return To(e,r,"signUpPassword",mg);case"emailLink":return yg(e,{idToken:t,email:this._email,oobCode:this._password});default:ut(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function qn(n,e){return Xr(n,"POST","/v1/accounts:signInWithIdp",cn(n,e))}const vg="http://localhost";class Tn extends Ko{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Tn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ut("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...a}=t;if(!r||!s)return null;const c=new Tn(r,s);return c.idToken=a.idToken||void 0,c.accessToken=a.accessToken||void 0,c.secret=a.secret,c.nonce=a.nonce,c.pendingToken=a.pendingToken||null,c}_getIdTokenResponse(e){const t=this.buildRequest();return qn(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,qn(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,qn(e,t)}buildRequest(){const e={requestUri:vg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Qr(t)}return e}}function Eg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Tg(n){const e=br(Pr(n)).link,t=e?br(Pr(e)).deep_link_id:null,r=br(Pr(n)).deep_link_id;return(r?br(Pr(r)).link:null)||r||t||e||n}class Qo{constructor(e){const t=br(Pr(e)),r=t.apiKey??null,s=t.oobCode??null,a=Eg(t.mode??null);q(r&&s&&a,"argument-error"),this.apiKey=r,this.operation=a,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Tg(e);try{return new Qo(t)}catch{return null}}}class er{constructor(){this.providerId=er.PROVIDER_ID}static credential(e,t){return jr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Qo.parseLink(t);return q(r,"argument-error"),jr._fromEmailAndCode(e,r.code,r.tenantId)}}er.PROVIDER_ID="password";er.EMAIL_PASSWORD_SIGN_IN_METHOD="password";er.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class $l{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Jr extends $l{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class zt extends Jr{constructor(){super("facebook.com")}static credential(e){return Tn._fromParams({providerId:zt.PROVIDER_ID,signInMethod:zt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zt.credentialFromTaggedObject(e)}static credentialFromError(e){return zt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zt.credential(e.oauthAccessToken)}catch{return null}}}zt.FACEBOOK_SIGN_IN_METHOD="facebook.com";zt.PROVIDER_ID="facebook.com";class Ht extends Jr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Tn._fromParams({providerId:Ht.PROVIDER_ID,signInMethod:Ht.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ht.credentialFromTaggedObject(e)}static credentialFromError(e){return Ht.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ht.credential(t,r)}catch{return null}}}Ht.GOOGLE_SIGN_IN_METHOD="google.com";Ht.PROVIDER_ID="google.com";class Wt extends Jr{constructor(){super("github.com")}static credential(e){return Tn._fromParams({providerId:Wt.PROVIDER_ID,signInMethod:Wt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wt.credentialFromTaggedObject(e)}static credentialFromError(e){return Wt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wt.credential(e.oauthAccessToken)}catch{return null}}}Wt.GITHUB_SIGN_IN_METHOD="github.com";Wt.PROVIDER_ID="github.com";class Gt extends Jr{constructor(){super("twitter.com")}static credential(e,t){return Tn._fromParams({providerId:Gt.PROVIDER_ID,signInMethod:Gt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Gt.credentialFromTaggedObject(e)}static credentialFromError(e){return Gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Gt.credential(t,r)}catch{return null}}}Gt.TWITTER_SIGN_IN_METHOD="twitter.com";Gt.PROVIDER_ID="twitter.com";async function Ig(n,e){return Xr(n,"POST","/v1/accounts:signUp",cn(n,e))}class In{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const a=await at._fromIdTokenResponse(e,r,s),c=Wc(r);return new In({user:a,providerId:c,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Wc(r);return new In({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Wc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class js extends Mt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,js.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new js(e,t,r,s)}}function zl(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?js._fromErrorAndOperation(n,a,e,r):a})}async function wg(n,e,t=!1){const r=await Br(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return In._forOperation(n,"link",r)}async function Ag(n,e,t=!1){const{auth:r}=n;if(rt(r.app))return Promise.reject(Pt(r));const s="reauthenticate";try{const a=await Br(n,zl(r,s,e,n),t);q(a.idToken,r,"internal-error");const c=Wo(a.idToken);q(c,r,"internal-error");const{sub:l}=c;return q(n.uid===l,r,"user-mismatch"),In._forOperation(n,s,a)}catch(a){throw a?.code==="auth/user-not-found"&&ut(r,"user-mismatch"),a}}async function Hl(n,e,t=!1){if(rt(n.app))return Promise.reject(Pt(n));const r="signIn",s=await zl(n,r,e),a=await In._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(a.user),a}async function Rg(n,e){return Hl(Sn(n),e)}async function Wl(n){const e=Sn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Sg(n,e,t){if(rt(n.app))return Promise.reject(Pt(n));const r=Sn(n),c=await To(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ig).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&Wl(n),h}),l=await In._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(l.user),l}function bg(n,e,t){return rt(n.app)?Promise.reject(Pt(n)):Rg(Je(n),er.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Wl(n),r})}function Pg(n,e,t,r){return Je(n).onIdTokenChanged(e,t,r)}function Cg(n,e,t){return Je(n).beforeAuthStateChanged(e,t)}function kg(n,e,t,r){return Je(n).onAuthStateChanged(e,t,r)}function Dg(n){return Je(n).signOut()}const qs="__sak";class Gl{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(qs,"1"),this.storage.removeItem(qs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Vg=1e3,Ng=10;class Kl extends Gl{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Fl(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((c,l,h)=>{this.notifyListeners(c,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const c=this.storage.getItem(r);!t&&this.localCache[r]===c||this.notifyListeners(r,c)},a=this.storage.getItem(r);Ym()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Ng):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Vg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Kl.type="LOCAL";const Og=Kl;class Ql extends Gl{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ql.type="SESSION";const Yl=Ql;function Mg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ui{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ui(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:a}=t.data,c=this.handlersMap[s];if(!c?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(c).map(async f=>f(t.origin,a)),h=await Mg(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ui.receivers=[];function Yo(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Lg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let a,c;return new Promise((l,h)=>{const f=Yo("",20);s.port1.start();const m=setTimeout(()=>{h(new Error("unsupported_event"))},r);c={messageChannel:s,onMessage(T){const I=T;if(I.data.eventId===f)switch(I.data.status){case"ack":clearTimeout(m),a=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(I.data.response);break;default:clearTimeout(m),clearTimeout(a),h(new Error("invalid_response"));break}}},this.handlers.add(c),s.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[s.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}function mt(){return window}function xg(n){mt().location.href=n}function Xl(){return typeof mt().WorkerGlobalScope<"u"&&typeof mt().importScripts=="function"}async function Fg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ug(){return navigator?.serviceWorker?.controller||null}function Bg(){return Xl()?self:null}const Jl="firebaseLocalStorageDb",jg=1,$s="firebaseLocalStorage",Zl="fbase_key";class Zr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function li(n,e){return n.transaction([$s],e?"readwrite":"readonly").objectStore($s)}function qg(){const n=indexedDB.deleteDatabase(Jl);return new Zr(n).toPromise()}function Io(){const n=indexedDB.open(Jl,jg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore($s,{keyPath:Zl})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains($s)?e(r):(r.close(),await qg(),e(await Io()))})})}async function Gc(n,e,t){const r=li(n,!0).put({[Zl]:e,value:t});return new Zr(r).toPromise()}async function $g(n,e){const t=li(n,!1).get(e),r=await new Zr(t).toPromise();return r===void 0?null:r.value}function Kc(n,e){const t=li(n,!0).delete(e);return new Zr(t).toPromise()}const zg=800,Hg=3;class eh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Io(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Hg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Xl()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ui._getInstance(Bg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Fg(),!this.activeServiceWorker)return;this.sender=new Lg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ug()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Io();return await Gc(e,qs,"1"),await Kc(e,qs),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Gc(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>$g(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Kc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const a=li(s,!1).getAll();return new Zr(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:a}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),zg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}eh.type="LOCAL";const Wg=eh;new Yr(3e4,6e4);function Gg(n,e){return e?St(e):(q(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Xo extends Ko{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return qn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return qn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return qn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Kg(n){return Hl(n.auth,new Xo(n),n.bypassAuthState)}function Qg(n){const{auth:e,user:t}=n;return q(t,e,"internal-error"),Ag(t,new Xo(n),n.bypassAuthState)}async function Yg(n){const{auth:e,user:t}=n;return q(t,e,"internal-error"),wg(t,new Xo(n),n.bypassAuthState)}class th{constructor(e,t,r,s,a=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:a,error:c,type:l}=e;if(c){this.reject(c);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:a||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Kg;case"linkViaPopup":case"linkViaRedirect":return Yg;case"reauthViaPopup":case"reauthViaRedirect":return Qg;default:ut(this.auth,"internal-error")}}resolve(e){Vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xg=new Yr(2e3,1e4);class Un extends th{constructor(e,t,r,s,a){super(e,t,s,a),this.provider=r,this.authWindow=null,this.pollId=null,Un.currentPopupAction&&Un.currentPopupAction.cancel(),Un.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return q(e,this.auth,"internal-error"),e}async onExecution(){Vt(this.filter.length===1,"Popup operations only handle one event");const e=Yo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(pt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(pt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Un.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(pt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xg.get())};e()}}Un.currentPopupAction=null;const Jg="pendingRedirect",bs=new Map;class Zg extends th{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=bs.get(this.auth._key());if(!e){try{const r=await e_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}bs.set(this.auth._key(),e)}return this.bypassAuthState||bs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function e_(n,e){const t=r_(e),r=n_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function t_(n,e){bs.set(n._key(),e)}function n_(n){return St(n._redirectPersistence)}function r_(n){return Ss(Jg,n.config.apiKey,n.name)}async function s_(n,e,t=!1){if(rt(n.app))return Promise.reject(Pt(n));const r=Sn(n),s=Gg(r,e),c=await new Zg(r,s,t).execute();return c&&!t&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}const i_=600*1e3;class o_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!a_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!nh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(pt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=i_&&this.cachedEventUids.clear(),this.cachedEventUids.has(Qc(e))}saveEventToCache(e){this.cachedEventUids.add(Qc(e)),this.lastProcessedEventTime=Date.now()}}function Qc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function nh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function a_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nh(n);default:return!1}}async function c_(n,e={}){return un(n,"GET","/v1/projects",e)}const u_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,l_=/^https?/;async function h_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await c_(n);for(const t of e)try{if(d_(t))return}catch{}ut(n,"unauthorized-domain")}function d_(n){const e=vo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const c=new URL(n);return c.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&c.hostname===r}if(!l_.test(t))return!1;if(u_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const f_=new Yr(3e4,6e4);function Yc(){const n=mt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function p_(n){return new Promise((e,t)=>{function r(){Yc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Yc(),t(pt(n,"network-request-failed"))},timeout:f_.get()})}if(mt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(mt().gapi?.load)r();else{const s=ig("iframefcb");return mt()[s]=()=>{gapi.load?r():t(pt(n,"network-request-failed"))},Bl(`${sg()}?onload=${s}`).catch(a=>t(a))}}).catch(e=>{throw Ps=null,e})}let Ps=null;function m_(n){return Ps=Ps||p_(n),Ps}const g_=new Yr(5e3,15e3),__="__/auth/iframe",y_="emulator/auth/iframe",v_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},E_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function T_(n){const e=n.config;q(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Ho(e,y_):`https://${n.config.authDomain}/${__}`,r={apiKey:e.apiKey,appName:n.name,v:Zn},s=E_.get(n.config.apiHost);s&&(r.eid=s);const a=n._getFrameworks();return a.length&&(r.fw=a.join(",")),`${t}?${Qr(r).slice(1)}`}async function I_(n){const e=await m_(n),t=mt().gapi;return q(t,n,"internal-error"),e.open({where:document.body,url:T_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:v_,dontclear:!0},r=>new Promise(async(s,a)=>{await r.restyle({setHideOnLeave:!1});const c=pt(n,"network-request-failed"),l=mt().setTimeout(()=>{a(c)},g_.get());function h(){mt().clearTimeout(l),s(r)}r.ping(h).then(h,()=>{a(c)})}))}const w_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},A_=500,R_=600,S_="_blank",b_="http://localhost";class Xc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function P_(n,e,t,r=A_,s=R_){const a=Math.max((window.screen.availHeight-s)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h={...w_,width:r.toString(),height:s.toString(),top:a,left:c},f=ze().toLowerCase();t&&(l=Nl(f)?S_:t),Dl(f)&&(e=e||b_,h.scrollbars="yes");const m=Object.entries(h).reduce((I,[b,D])=>`${I}${b}=${D},`,"");if(Qm(f)&&l!=="_self")return C_(e||"",l),new Xc(null);const T=window.open(e||"",l,m);q(T,n,"popup-blocked");try{T.focus()}catch{}return new Xc(T)}function C_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const k_="__/auth/handler",D_="emulator/auth/handler",V_=encodeURIComponent("fac");async function Jc(n,e,t,r,s,a){q(n.config.authDomain,n,"auth-domain-config-required"),q(n.config.apiKey,n,"invalid-api-key");const c={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Zn,eventId:s};if(e instanceof $l){e.setDefaultLanguage(n.languageCode),c.providerId=e.providerId||"",mp(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,T]of Object.entries({}))c[m]=T}if(e instanceof Jr){const m=e.getScopes().filter(T=>T!=="");m.length>0&&(c.scopes=m.join(","))}n.tenantId&&(c.tid=n.tenantId);const l=c;for(const m of Object.keys(l))l[m]===void 0&&delete l[m];const h=await n._getAppCheckToken(),f=h?`#${V_}=${encodeURIComponent(h)}`:"";return`${N_(n)}?${Qr(l).slice(1)}${f}`}function N_({config:n}){return n.emulator?Ho(n,D_):`https://${n.authDomain}/${k_}`}const ro="webStorageSupport";class O_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Yl,this._completeRedirectFn=s_,this._overrideRedirectResult=t_}async _openPopup(e,t,r,s){Vt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const a=await Jc(e,t,r,vo(),s);return P_(e,a,Yo())}async _openRedirect(e,t,r,s){await this._originValidation(e);const a=await Jc(e,t,r,vo(),s);return xg(a),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:a}=this.eventManagers[t];return s?Promise.resolve(s):(Vt(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await I_(e),r=new o_(e);return t.register("authEvent",s=>(q(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ro,{type:ro},s=>{const a=s?.[0]?.[ro];a!==void 0&&t(!!a),ut(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=h_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Fl()||Vl()||Go()}}const M_=O_;var Zc="@firebase/auth",eu="1.11.1";class L_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){q(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function x_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function F_(n){Hn(new En("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:c,authDomain:l}=r.options;q(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:c,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ul(n)},f=new tg(r,s,a,h);return hg(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Hn(new En("auth-internal",e=>{const t=Sn(e.getProvider("auth").getImmediate());return(r=>new L_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Jt(Zc,eu,x_(n)),Jt(Zc,eu,"esm2020")}const U_=300,B_=pl("authIdTokenMaxAge")||U_;let tu=null;const j_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>B_)return;const s=t?.token;tu!==s&&(tu=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function q_(n=El()){const e=$o(n,"auth");if(e.isInitialized())return e.getImmediate();const t=lg(n,{popupRedirectResolver:M_,persistence:[Wg,Og,Yl]}),r=pl("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(r,location.origin);if(location.origin===a.origin){const c=j_(a.toString());Cg(t,c,()=>c(t.currentUser)),Pg(t,l=>c(l))}}const s=dl("auth");return s&&dg(t,`http://${s}`),t}function $_(){return document.getElementsByTagName("head")?.[0]??document}ng({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const a=pt("internal-error");a.customData=s,t(a)},r.type="text/javascript",r.charset="UTF-8",$_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});F_("Browser");var nu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Zt,rh;(function(){var n;function e(w,_){function g(){}g.prototype=_.prototype,w.F=_.prototype,w.prototype=new g,w.prototype.constructor=w,w.D=function(E,y,A){for(var v=Array(arguments.length-2),re=2;re<arguments.length;re++)v[re-2]=arguments[re];return _.prototype[y].apply(E,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,_,g){g||(g=0);const E=Array(16);if(typeof _=="string")for(var y=0;y<16;++y)E[y]=_.charCodeAt(g++)|_.charCodeAt(g++)<<8|_.charCodeAt(g++)<<16|_.charCodeAt(g++)<<24;else for(y=0;y<16;++y)E[y]=_[g++]|_[g++]<<8|_[g++]<<16|_[g++]<<24;_=w.g[0],g=w.g[1],y=w.g[2];let A=w.g[3],v;v=_+(A^g&(y^A))+E[0]+3614090360&4294967295,_=g+(v<<7&4294967295|v>>>25),v=A+(y^_&(g^y))+E[1]+3905402710&4294967295,A=_+(v<<12&4294967295|v>>>20),v=y+(g^A&(_^g))+E[2]+606105819&4294967295,y=A+(v<<17&4294967295|v>>>15),v=g+(_^y&(A^_))+E[3]+3250441966&4294967295,g=y+(v<<22&4294967295|v>>>10),v=_+(A^g&(y^A))+E[4]+4118548399&4294967295,_=g+(v<<7&4294967295|v>>>25),v=A+(y^_&(g^y))+E[5]+1200080426&4294967295,A=_+(v<<12&4294967295|v>>>20),v=y+(g^A&(_^g))+E[6]+2821735955&4294967295,y=A+(v<<17&4294967295|v>>>15),v=g+(_^y&(A^_))+E[7]+4249261313&4294967295,g=y+(v<<22&4294967295|v>>>10),v=_+(A^g&(y^A))+E[8]+1770035416&4294967295,_=g+(v<<7&4294967295|v>>>25),v=A+(y^_&(g^y))+E[9]+2336552879&4294967295,A=_+(v<<12&4294967295|v>>>20),v=y+(g^A&(_^g))+E[10]+4294925233&4294967295,y=A+(v<<17&4294967295|v>>>15),v=g+(_^y&(A^_))+E[11]+2304563134&4294967295,g=y+(v<<22&4294967295|v>>>10),v=_+(A^g&(y^A))+E[12]+1804603682&4294967295,_=g+(v<<7&4294967295|v>>>25),v=A+(y^_&(g^y))+E[13]+4254626195&4294967295,A=_+(v<<12&4294967295|v>>>20),v=y+(g^A&(_^g))+E[14]+2792965006&4294967295,y=A+(v<<17&4294967295|v>>>15),v=g+(_^y&(A^_))+E[15]+1236535329&4294967295,g=y+(v<<22&4294967295|v>>>10),v=_+(y^A&(g^y))+E[1]+4129170786&4294967295,_=g+(v<<5&4294967295|v>>>27),v=A+(g^y&(_^g))+E[6]+3225465664&4294967295,A=_+(v<<9&4294967295|v>>>23),v=y+(_^g&(A^_))+E[11]+643717713&4294967295,y=A+(v<<14&4294967295|v>>>18),v=g+(A^_&(y^A))+E[0]+3921069994&4294967295,g=y+(v<<20&4294967295|v>>>12),v=_+(y^A&(g^y))+E[5]+3593408605&4294967295,_=g+(v<<5&4294967295|v>>>27),v=A+(g^y&(_^g))+E[10]+38016083&4294967295,A=_+(v<<9&4294967295|v>>>23),v=y+(_^g&(A^_))+E[15]+3634488961&4294967295,y=A+(v<<14&4294967295|v>>>18),v=g+(A^_&(y^A))+E[4]+3889429448&4294967295,g=y+(v<<20&4294967295|v>>>12),v=_+(y^A&(g^y))+E[9]+568446438&4294967295,_=g+(v<<5&4294967295|v>>>27),v=A+(g^y&(_^g))+E[14]+3275163606&4294967295,A=_+(v<<9&4294967295|v>>>23),v=y+(_^g&(A^_))+E[3]+4107603335&4294967295,y=A+(v<<14&4294967295|v>>>18),v=g+(A^_&(y^A))+E[8]+1163531501&4294967295,g=y+(v<<20&4294967295|v>>>12),v=_+(y^A&(g^y))+E[13]+2850285829&4294967295,_=g+(v<<5&4294967295|v>>>27),v=A+(g^y&(_^g))+E[2]+4243563512&4294967295,A=_+(v<<9&4294967295|v>>>23),v=y+(_^g&(A^_))+E[7]+1735328473&4294967295,y=A+(v<<14&4294967295|v>>>18),v=g+(A^_&(y^A))+E[12]+2368359562&4294967295,g=y+(v<<20&4294967295|v>>>12),v=_+(g^y^A)+E[5]+4294588738&4294967295,_=g+(v<<4&4294967295|v>>>28),v=A+(_^g^y)+E[8]+2272392833&4294967295,A=_+(v<<11&4294967295|v>>>21),v=y+(A^_^g)+E[11]+1839030562&4294967295,y=A+(v<<16&4294967295|v>>>16),v=g+(y^A^_)+E[14]+4259657740&4294967295,g=y+(v<<23&4294967295|v>>>9),v=_+(g^y^A)+E[1]+2763975236&4294967295,_=g+(v<<4&4294967295|v>>>28),v=A+(_^g^y)+E[4]+1272893353&4294967295,A=_+(v<<11&4294967295|v>>>21),v=y+(A^_^g)+E[7]+4139469664&4294967295,y=A+(v<<16&4294967295|v>>>16),v=g+(y^A^_)+E[10]+3200236656&4294967295,g=y+(v<<23&4294967295|v>>>9),v=_+(g^y^A)+E[13]+681279174&4294967295,_=g+(v<<4&4294967295|v>>>28),v=A+(_^g^y)+E[0]+3936430074&4294967295,A=_+(v<<11&4294967295|v>>>21),v=y+(A^_^g)+E[3]+3572445317&4294967295,y=A+(v<<16&4294967295|v>>>16),v=g+(y^A^_)+E[6]+76029189&4294967295,g=y+(v<<23&4294967295|v>>>9),v=_+(g^y^A)+E[9]+3654602809&4294967295,_=g+(v<<4&4294967295|v>>>28),v=A+(_^g^y)+E[12]+3873151461&4294967295,A=_+(v<<11&4294967295|v>>>21),v=y+(A^_^g)+E[15]+530742520&4294967295,y=A+(v<<16&4294967295|v>>>16),v=g+(y^A^_)+E[2]+3299628645&4294967295,g=y+(v<<23&4294967295|v>>>9),v=_+(y^(g|~A))+E[0]+4096336452&4294967295,_=g+(v<<6&4294967295|v>>>26),v=A+(g^(_|~y))+E[7]+1126891415&4294967295,A=_+(v<<10&4294967295|v>>>22),v=y+(_^(A|~g))+E[14]+2878612391&4294967295,y=A+(v<<15&4294967295|v>>>17),v=g+(A^(y|~_))+E[5]+4237533241&4294967295,g=y+(v<<21&4294967295|v>>>11),v=_+(y^(g|~A))+E[12]+1700485571&4294967295,_=g+(v<<6&4294967295|v>>>26),v=A+(g^(_|~y))+E[3]+2399980690&4294967295,A=_+(v<<10&4294967295|v>>>22),v=y+(_^(A|~g))+E[10]+4293915773&4294967295,y=A+(v<<15&4294967295|v>>>17),v=g+(A^(y|~_))+E[1]+2240044497&4294967295,g=y+(v<<21&4294967295|v>>>11),v=_+(y^(g|~A))+E[8]+1873313359&4294967295,_=g+(v<<6&4294967295|v>>>26),v=A+(g^(_|~y))+E[15]+4264355552&4294967295,A=_+(v<<10&4294967295|v>>>22),v=y+(_^(A|~g))+E[6]+2734768916&4294967295,y=A+(v<<15&4294967295|v>>>17),v=g+(A^(y|~_))+E[13]+1309151649&4294967295,g=y+(v<<21&4294967295|v>>>11),v=_+(y^(g|~A))+E[4]+4149444226&4294967295,_=g+(v<<6&4294967295|v>>>26),v=A+(g^(_|~y))+E[11]+3174756917&4294967295,A=_+(v<<10&4294967295|v>>>22),v=y+(_^(A|~g))+E[2]+718787259&4294967295,y=A+(v<<15&4294967295|v>>>17),v=g+(A^(y|~_))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+_&4294967295,w.g[1]=w.g[1]+(y+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+y&4294967295,w.g[3]=w.g[3]+A&4294967295}r.prototype.v=function(w,_){_===void 0&&(_=w.length);const g=_-this.blockSize,E=this.C;let y=this.h,A=0;for(;A<_;){if(y==0)for(;A<=g;)s(this,w,A),A+=this.blockSize;if(typeof w=="string"){for(;A<_;)if(E[y++]=w.charCodeAt(A++),y==this.blockSize){s(this,E),y=0;break}}else for(;A<_;)if(E[y++]=w[A++],y==this.blockSize){s(this,E),y=0;break}}this.h=y,this.o+=_},r.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var _=1;_<w.length-8;++_)w[_]=0;_=this.o*8;for(var g=w.length-8;g<w.length;++g)w[g]=_&255,_/=256;for(this.v(w),w=Array(16),_=0,g=0;g<4;++g)for(let E=0;E<32;E+=8)w[_++]=this.g[g]>>>E&255;return w};function a(w,_){var g=l;return Object.prototype.hasOwnProperty.call(g,w)?g[w]:g[w]=_(w)}function c(w,_){this.h=_;const g=[];let E=!0;for(let y=w.length-1;y>=0;y--){const A=w[y]|0;E&&A==_||(g[y]=A,E=!1)}this.g=g}var l={};function h(w){return-128<=w&&w<128?a(w,function(_){return new c([_|0],_<0?-1:0)}):new c([w|0],w<0?-1:0)}function f(w){if(isNaN(w)||!isFinite(w))return T;if(w<0)return k(f(-w));const _=[];let g=1;for(let E=0;w>=g;E++)_[E]=w/g|0,g*=4294967296;return new c(_,0)}function m(w,_){if(w.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(w.charAt(0)=="-")return k(m(w.substring(1),_));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const g=f(Math.pow(_,8));let E=T;for(let A=0;A<w.length;A+=8){var y=Math.min(8,w.length-A);const v=parseInt(w.substring(A,A+y),_);y<8?(y=f(Math.pow(_,y)),E=E.j(y).add(f(v))):(E=E.j(g),E=E.add(f(v)))}return E}var T=h(0),I=h(1),b=h(16777216);n=c.prototype,n.m=function(){if(N(this))return-k(this).m();let w=0,_=1;for(let g=0;g<this.g.length;g++){const E=this.i(g);w+=(E>=0?E:4294967296+E)*_,_*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(D(this))return"0";if(N(this))return"-"+k(this).toString(w);const _=f(Math.pow(w,6));var g=this;let E="";for(;;){const y=U(g,_).g;g=B(g,y.j(_));let A=((g.g.length>0?g.g[0]:g.h)>>>0).toString(w);if(g=y,D(g))return A+E;for(;A.length<6;)A="0"+A;E=A+E}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function D(w){if(w.h!=0)return!1;for(let _=0;_<w.g.length;_++)if(w.g[_]!=0)return!1;return!0}function N(w){return w.h==-1}n.l=function(w){return w=B(this,w),N(w)?-1:D(w)?0:1};function k(w){const _=w.g.length,g=[];for(let E=0;E<_;E++)g[E]=~w.g[E];return new c(g,~w.h).add(I)}n.abs=function(){return N(this)?k(this):this},n.add=function(w){const _=Math.max(this.g.length,w.g.length),g=[];let E=0;for(let y=0;y<=_;y++){let A=E+(this.i(y)&65535)+(w.i(y)&65535),v=(A>>>16)+(this.i(y)>>>16)+(w.i(y)>>>16);E=v>>>16,A&=65535,v&=65535,g[y]=v<<16|A}return new c(g,g[g.length-1]&-2147483648?-1:0)};function B(w,_){return w.add(k(_))}n.j=function(w){if(D(this)||D(w))return T;if(N(this))return N(w)?k(this).j(k(w)):k(k(this).j(w));if(N(w))return k(this.j(k(w)));if(this.l(b)<0&&w.l(b)<0)return f(this.m()*w.m());const _=this.g.length+w.g.length,g=[];for(var E=0;E<2*_;E++)g[E]=0;for(E=0;E<this.g.length;E++)for(let y=0;y<w.g.length;y++){const A=this.i(E)>>>16,v=this.i(E)&65535,re=w.i(y)>>>16,ve=w.i(y)&65535;g[2*E+2*y]+=v*ve,F(g,2*E+2*y),g[2*E+2*y+1]+=A*ve,F(g,2*E+2*y+1),g[2*E+2*y+1]+=v*re,F(g,2*E+2*y+1),g[2*E+2*y+2]+=A*re,F(g,2*E+2*y+2)}for(w=0;w<_;w++)g[w]=g[2*w+1]<<16|g[2*w];for(w=_;w<2*_;w++)g[w]=0;return new c(g,0)};function F(w,_){for(;(w[_]&65535)!=w[_];)w[_+1]+=w[_]>>>16,w[_]&=65535,_++}function L(w,_){this.g=w,this.h=_}function U(w,_){if(D(_))throw Error("division by zero");if(D(w))return new L(T,T);if(N(w))return _=U(k(w),_),new L(k(_.g),k(_.h));if(N(_))return _=U(w,k(_)),new L(k(_.g),_.h);if(w.g.length>30){if(N(w)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var g=I,E=_;E.l(w)<=0;)g=z(g),E=z(E);var y=G(g,1),A=G(E,1);for(E=G(E,2),g=G(g,2);!D(E);){var v=A.add(E);v.l(w)<=0&&(y=y.add(g),A=v),E=G(E,1),g=G(g,1)}return _=B(w,y.j(_)),new L(y,_)}for(y=T;w.l(_)>=0;){for(g=Math.max(1,Math.floor(w.m()/_.m())),E=Math.ceil(Math.log(g)/Math.LN2),E=E<=48?1:Math.pow(2,E-48),A=f(g),v=A.j(_);N(v)||v.l(w)>0;)g-=E,A=f(g),v=A.j(_);D(A)&&(A=I),y=y.add(A),w=B(w,v)}return new L(y,w)}n.B=function(w){return U(this,w).h},n.and=function(w){const _=Math.max(this.g.length,w.g.length),g=[];for(let E=0;E<_;E++)g[E]=this.i(E)&w.i(E);return new c(g,this.h&w.h)},n.or=function(w){const _=Math.max(this.g.length,w.g.length),g=[];for(let E=0;E<_;E++)g[E]=this.i(E)|w.i(E);return new c(g,this.h|w.h)},n.xor=function(w){const _=Math.max(this.g.length,w.g.length),g=[];for(let E=0;E<_;E++)g[E]=this.i(E)^w.i(E);return new c(g,this.h^w.h)};function z(w){const _=w.g.length+1,g=[];for(let E=0;E<_;E++)g[E]=w.i(E)<<1|w.i(E-1)>>>31;return new c(g,w.h)}function G(w,_){const g=_>>5;_%=32;const E=w.g.length-g,y=[];for(let A=0;A<E;A++)y[A]=_>0?w.i(A+g)>>>_|w.i(A+g+1)<<32-_:w.i(A+g);return new c(y,w.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,rh=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=f,c.fromString=m,Zt=c}).apply(typeof nu<"u"?nu:typeof self<"u"?self:typeof window<"u"?window:{});var ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var sh,Cr,ih,Cs,wo,oh,ah,ch;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ys=="object"&&ys];for(var u=0;u<o.length;++u){var d=o[u];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(o,u){if(u)e:{var d=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var R=o[p];if(!(R in d))break e;d=d[R]}o=o[o.length-1],p=d[o],u=u(p),u!=p&&u!=null&&e(d,o,{configurable:!0,writable:!0,value:u})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(u){var d=[],p;for(p in u)Object.prototype.hasOwnProperty.call(u,p)&&d.push([p,u[p]]);return d}});var a=a||{},c=this||self;function l(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function h(o,u,d){return o.call.apply(o.bind,arguments)}function f(o,u,d){return f=h,f.apply(null,arguments)}function m(o,u){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function T(o,u){function d(){}d.prototype=u.prototype,o.Z=u.prototype,o.prototype=new d,o.prototype.constructor=o,o.Ob=function(p,R,S){for(var O=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)O[Q-2]=arguments[Q];return u.prototype[R].apply(p,O)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function b(o){const u=o.length;if(u>0){const d=Array(u);for(let p=0;p<u;p++)d[p]=o[p];return d}return[]}function D(o,u){for(let p=1;p<arguments.length;p++){const R=arguments[p];var d=typeof R;if(d=d!="object"?d:R?Array.isArray(R)?"array":d:"null",d=="array"||d=="object"&&typeof R.length=="number"){d=o.length||0;const S=R.length||0;o.length=d+S;for(let O=0;O<S;O++)o[d+O]=R[O]}else o.push(R)}}class N{constructor(u,d){this.i=u,this.j=d,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function k(o){c.setTimeout(()=>{throw o},0)}function B(){var o=w;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class F{constructor(){this.h=this.g=null}add(u,d){const p=L.get();p.set(u,d),this.h?this.h.next=p:this.g=p,this.h=p}}var L=new N(()=>new U,o=>o.reset());class U{constructor(){this.next=this.g=this.h=null}set(u,d){this.h=u,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let z,G=!1,w=new F,_=()=>{const o=Promise.resolve(void 0);z=()=>{o.then(g)}};function g(){for(var o;o=B();){try{o.h.call(o.g)}catch(d){k(d)}var u=L;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}G=!1}function E(){this.u=this.u,this.C=this.C}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};c.addEventListener("test",d,u),c.removeEventListener("test",d,u)}catch{}return o})();function v(o){return/^[\s\xa0]*$/.test(o)}function re(o,u){y.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}T(re,y),re.prototype.init=function(o,u){const d=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(d=="mouseover"?u=o.fromElement:d=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&re.Z.h.call(this)},re.prototype.h=function(){re.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ve="closure_listenable_"+(Math.random()*1e6|0),tt=0;function me(o,u,d,p,R){this.listener=o,this.proxy=null,this.src=u,this.type=d,this.capture=!!p,this.ha=R,this.key=++tt,this.da=this.fa=!1}function ie(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ue(o,u,d){for(const p in o)u.call(d,o[p],p,o)}function Fe(o,u){for(const d in o)u.call(void 0,o[d],d,o)}function ge(o){const u={};for(const d in o)u[d]=o[d];return u}const Ee="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(o,u){let d,p;for(let R=1;R<arguments.length;R++){p=arguments[R];for(d in p)o[d]=p[d];for(let S=0;S<Ee.length;S++)d=Ee[S],Object.prototype.hasOwnProperty.call(p,d)&&(o[d]=p[d])}}function ae(o){this.src=o,this.g={},this.h=0}ae.prototype.add=function(o,u,d,p,R){const S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);const O=Ge(o,u,p,R);return O>-1?(u=o[O],d||(u.fa=!1)):(u=new me(u,this.src,S,!!p,R),u.fa=d,o.push(u)),u};function Te(o,u){const d=u.type;if(d in o.g){var p=o.g[d],R=Array.prototype.indexOf.call(p,u,void 0),S;(S=R>=0)&&Array.prototype.splice.call(p,R,1),S&&(ie(u),o.g[d].length==0&&(delete o.g[d],o.h--))}}function Ge(o,u,d,p){for(let R=0;R<o.length;++R){const S=o[R];if(!S.da&&S.listener==u&&S.capture==!!d&&S.ha==p)return R}return-1}var ke="closure_lm_"+(Math.random()*1e6|0),Oe={};function Ke(o,u,d,p,R){if(Array.isArray(u)){for(let S=0;S<u.length;S++)Ke(o,u[S],d,p,R);return null}return d=ba(d),o&&o[ve]?o.J(u,d,l(p)?!!p.capture:!1,R):ir(o,u,d,!1,p,R)}function ir(o,u,d,p,R,S){if(!u)throw Error("Invalid event type");const O=l(R)?!!R.capture:!!R;let Q=cr(o);if(Q||(o[ke]=Q=new ae(o)),d=Q.add(u,d,p,O,S),d.proxy)return d;if(p=It(),d.proxy=p,p.src=o,p.listener=d,o.addEventListener)A||(R=O),R===void 0&&(R=!1),o.addEventListener(u.toString(),p,R);else if(o.attachEvent)o.attachEvent(ar(u.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function It(){function o(d){return u.call(o.src,o.listener,d)}const u=ln;return o}function Lt(o,u,d,p,R){if(Array.isArray(u))for(var S=0;S<u.length;S++)Lt(o,u[S],d,p,R);else p=l(p)?!!p.capture:!!p,d=ba(d),o&&o[ve]?(o=o.i,S=String(u).toString(),S in o.g&&(u=o.g[S],d=Ge(u,d,p,R),d>-1&&(ie(u[d]),Array.prototype.splice.call(u,d,1),u.length==0&&(delete o.g[S],o.h--)))):o&&(o=cr(o))&&(u=o.g[u.toString()],o=-1,u&&(o=Ge(u,d,p,R)),(d=o>-1?u[o]:null)&&or(d))}function or(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[ve])Te(u.i,o);else{var d=o.type,p=o.proxy;u.removeEventListener?u.removeEventListener(d,p,o.capture):u.detachEvent?u.detachEvent(ar(d),p):u.addListener&&u.removeListener&&u.removeListener(p),(d=cr(u))?(Te(d,o),d.h==0&&(d.src=null,u[ke]=null)):ie(o)}}}function ar(o){return o in Oe?Oe[o]:Oe[o]="on"+o}function ln(o,u){if(o.da)o=!0;else{u=new re(u,this);const d=o.listener,p=o.ha||o.src;o.fa&&or(o),o=d.call(p,u)}return o}function cr(o){return o=o[ke],o instanceof ae?o:null}var ur="__closure_events_fn_"+(Math.random()*1e9>>>0);function ba(o){return typeof o=="function"?o:(o[ur]||(o[ur]=function(u){return o.handleEvent(u)}),o[ur])}function Ue(){E.call(this),this.i=new ae(this),this.M=this,this.G=null}T(Ue,E),Ue.prototype[ve]=!0,Ue.prototype.removeEventListener=function(o,u,d,p){Lt(this,o,u,d,p)};function He(o,u){var d,p=o.G;if(p)for(d=[];p;p=p.G)d.push(p);if(o=o.M,p=u.type||u,typeof u=="string")u=new y(u,o);else if(u instanceof y)u.target=u.target||o;else{var R=u;u=new y(p,o),ee(u,R)}R=!0;let S,O;if(d)for(O=d.length-1;O>=0;O--)S=u.g=d[O],R=is(S,p,!0,u)&&R;if(S=u.g=o,R=is(S,p,!0,u)&&R,R=is(S,p,!1,u)&&R,d)for(O=0;O<d.length;O++)S=u.g=d[O],R=is(S,p,!1,u)&&R}Ue.prototype.N=function(){if(Ue.Z.N.call(this),this.i){var o=this.i;for(const u in o.g){const d=o.g[u];for(let p=0;p<d.length;p++)ie(d[p]);delete o.g[u],o.h--}}this.G=null},Ue.prototype.J=function(o,u,d,p){return this.i.add(String(o),u,!1,d,p)},Ue.prototype.K=function(o,u,d,p){return this.i.add(String(o),u,!0,d,p)};function is(o,u,d,p){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let R=!0;for(let S=0;S<u.length;++S){const O=u[S];if(O&&!O.da&&O.capture==d){const Q=O.listener,Se=O.ha||O.src;O.fa&&Te(o.i,O),R=Q.call(Se,p)!==!1&&R}}return R&&!p.defaultPrevented}function xd(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=f(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:c.setTimeout(o,u||0)}function Pa(o){o.g=xd(()=>{o.g=null,o.i&&(o.i=!1,Pa(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class Fd extends E{constructor(u,d){super(),this.m=u,this.l=d,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Pa(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function lr(o){E.call(this),this.h=o,this.g={}}T(lr,E);var Ca=[];function ka(o){ue(o.g,function(u,d){this.g.hasOwnProperty(d)&&or(u)},o),o.g={}}lr.prototype.N=function(){lr.Z.N.call(this),ka(this)},lr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Si=c.JSON.stringify,Ud=c.JSON.parse,Bd=class{stringify(o){return c.JSON.stringify(o,void 0)}parse(o){return c.JSON.parse(o,void 0)}};function Da(){}function Va(){}var hr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function bi(){y.call(this,"d")}T(bi,y);function Pi(){y.call(this,"c")}T(Pi,y);var hn={},Na=null;function os(){return Na=Na||new Ue}hn.Ia="serverreachability";function Oa(o){y.call(this,hn.Ia,o)}T(Oa,y);function dr(o){const u=os();He(u,new Oa(u))}hn.STAT_EVENT="statevent";function Ma(o,u){y.call(this,hn.STAT_EVENT,o),this.stat=u}T(Ma,y);function We(o){const u=os();He(u,new Ma(u,o))}hn.Ja="timingevent";function La(o,u){y.call(this,hn.Ja,o),this.size=u}T(La,y);function fr(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){o()},u)}function pr(){this.g=!0}pr.prototype.ua=function(){this.g=!1};function jd(o,u,d,p,R,S){o.info(function(){if(o.g)if(S){var O="",Q=S.split("&");for(let ce=0;ce<Q.length;ce++){var Se=Q[ce].split("=");if(Se.length>1){const De=Se[0];Se=Se[1];const ht=De.split("_");O=ht.length>=2&&ht[1]=="type"?O+(De+"="+Se+"&"):O+(De+"=redacted&")}}}else O=null;else O=S;return"XMLHTTP REQ ("+p+") [attempt "+R+"]: "+u+`
`+d+`
`+O})}function qd(o,u,d,p,R,S,O){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+R+"]: "+u+`
`+d+`
`+S+" "+O})}function Dn(o,u,d,p){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+zd(o,d)+(p?" "+p:"")})}function $d(o,u){o.info(function(){return"TIMEOUT: "+u})}pr.prototype.info=function(){};function zd(o,u){if(!o.g)return u;if(!u)return null;try{const S=JSON.parse(u);if(S){for(o=0;o<S.length;o++)if(Array.isArray(S[o])){var d=S[o];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var R=p[0];if(R!="noop"&&R!="stop"&&R!="close")for(let O=1;O<p.length;O++)p[O]=""}}}}return Si(S)}catch{return u}}var as={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},xa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Fa;function Ci(){}T(Ci,Da),Ci.prototype.g=function(){return new XMLHttpRequest},Fa=new Ci;function mr(o){return encodeURIComponent(String(o))}function Hd(o){var u=1;o=o.split(":");const d=[];for(;u>0&&o.length;)d.push(o.shift()),u--;return o.length&&d.push(o.join(":")),d}function xt(o,u,d,p){this.j=o,this.i=u,this.l=d,this.S=p||1,this.V=new lr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ua}function Ua(){this.i=null,this.g="",this.h=!1}var Ba={},ki={};function Di(o,u,d){o.M=1,o.A=us(lt(u)),o.u=d,o.R=!0,ja(o,null)}function ja(o,u){o.F=Date.now(),cs(o),o.B=lt(o.A);var d=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),ec(d.i,"t",p),o.C=0,d=o.j.L,o.h=new Ua,o.g=yc(o.j,d?u:null,!o.u),o.P>0&&(o.O=new Fd(f(o.Y,o,o.g),o.P)),u=o.V,d=o.g,p=o.ba;var R="readystatechange";Array.isArray(R)||(R&&(Ca[0]=R.toString()),R=Ca);for(let S=0;S<R.length;S++){const O=Ke(d,R[S],p||u.handleEvent,!1,u.h||u);if(!O)break;u.g[O.key]=O}u=o.J?ge(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),dr(),jd(o.i,o.v,o.B,o.l,o.S,o.u)}xt.prototype.ba=function(o){o=o.target;const u=this.O;u&&Bt(o)==3?u.j():this.Y(o)},xt.prototype.Y=function(o){try{if(o==this.g)e:{const Q=Bt(this.g),Se=this.g.ya(),ce=this.g.ca();if(!(Q<3)&&(Q!=3||this.g&&(this.h.h||this.g.la()||ac(this.g)))){this.K||Q!=4||Se==7||(Se==8||ce<=0?dr(3):dr(2)),Vi(this);var u=this.g.ca();this.X=u;var d=Wd(this);if(this.o=u==200,qd(this.i,this.v,this.B,this.l,this.S,Q,u),this.o){if(this.U&&!this.L){t:{if(this.g){var p,R=this.g;if((p=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(p)){var S=p;break t}}S=null}if(o=S)Dn(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ni(this,o);else{this.o=!1,this.m=3,We(12),dn(this),gr(this);break e}}if(this.R){o=!0;let De;for(;!this.K&&this.C<d.length;)if(De=Gd(this,d),De==ki){Q==4&&(this.m=4,We(14),o=!1),Dn(this.i,this.l,null,"[Incomplete Response]");break}else if(De==Ba){this.m=4,We(15),Dn(this.i,this.l,d,"[Invalid Chunk]"),o=!1;break}else Dn(this.i,this.l,De,null),Ni(this,De);if(qa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Q!=4||d.length!=0||this.h.h||(this.m=1,We(16),o=!1),this.o=this.o&&o,!o)Dn(this.i,this.l,d,"[Invalid Chunked Response]"),dn(this),gr(this);else if(d.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),ji(O),O.P=!0,We(11))}}else Dn(this.i,this.l,d,null),Ni(this,d);Q==4&&dn(this),this.o&&!this.K&&(Q==4?pc(this.j,this):(this.o=!1,cs(this)))}else cf(this.g),u==400&&d.indexOf("Unknown SID")>0?(this.m=3,We(12)):(this.m=0,We(13)),dn(this),gr(this)}}}catch{}finally{}};function Wd(o){if(!qa(o))return o.g.la();const u=ac(o.g);if(u==="")return"";let d="";const p=u.length,R=Bt(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return dn(o),gr(o),"";o.h.i=new c.TextDecoder}for(let S=0;S<p;S++)o.h.h=!0,d+=o.h.i.decode(u[S],{stream:!(R&&S==p-1)});return u.length=0,o.h.g+=d,o.C=0,o.h.g}function qa(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Gd(o,u){var d=o.C,p=u.indexOf(`
`,d);return p==-1?ki:(d=Number(u.substring(d,p)),isNaN(d)?Ba:(p+=1,p+d>u.length?ki:(u=u.slice(p,p+d),o.C=p+d,u)))}xt.prototype.cancel=function(){this.K=!0,dn(this)};function cs(o){o.T=Date.now()+o.H,$a(o,o.H)}function $a(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=fr(f(o.aa,o),u)}function Vi(o){o.D&&(c.clearTimeout(o.D),o.D=null)}xt.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?($d(this.i,this.B),this.M!=2&&(dr(),We(17)),dn(this),this.m=2,gr(this)):$a(this,this.T-o)};function gr(o){o.j.I==0||o.K||pc(o.j,o)}function dn(o){Vi(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,ka(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function Ni(o,u){try{var d=o.j;if(d.I!=0&&(d.g==o||Oi(d.h,o))){if(!o.L&&Oi(d.h,o)&&d.I==3){try{var p=d.Ba.g.parse(u)}catch{p=null}if(Array.isArray(p)&&p.length==3){var R=p;if(R[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<o.F)ps(d),ds(d);else break e;Bi(d),We(18)}}else d.xa=R[1],0<d.xa-d.K&&R[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=fr(f(d.Va,d),6e3));Wa(d.h)<=1&&d.ta&&(d.ta=void 0)}else pn(d,11)}else if((o.L||d.g==o)&&ps(d),!v(u))for(R=d.Ba.g.parse(u),u=0;u<R.length;u++){let ce=R[u];const De=ce[0];if(!(De<=d.K))if(d.K=De,ce=ce[1],d.I==2)if(ce[0]=="c"){d.M=ce[1],d.ba=ce[2];const ht=ce[3];ht!=null&&(d.ka=ht,d.j.info("VER="+d.ka));const mn=ce[4];mn!=null&&(d.za=mn,d.j.info("SVER="+d.za));const jt=ce[5];jt!=null&&typeof jt=="number"&&jt>0&&(p=1.5*jt,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const qt=o.g;if(qt){const gs=qt.g?qt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gs){var S=p.h;S.g||gs.indexOf("spdy")==-1&&gs.indexOf("quic")==-1&&gs.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Mi(S,S.h),S.h=null))}if(p.G){const qi=qt.g?qt.g.getResponseHeader("X-HTTP-Session-Id"):null;qi&&(p.wa=qi,le(p.J,p.G,qi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-o.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var O=o;if(p.na=_c(p,p.L?p.ba:null,p.W),O.L){Ga(p.h,O);var Q=O,Se=p.O;Se&&(Q.H=Se),Q.D&&(Vi(Q),cs(Q)),p.g=O}else dc(p);d.i.length>0&&fs(d)}else ce[0]!="stop"&&ce[0]!="close"||pn(d,7);else d.I==3&&(ce[0]=="stop"||ce[0]=="close"?ce[0]=="stop"?pn(d,7):Ui(d):ce[0]!="noop"&&d.l&&d.l.qa(ce),d.A=0)}}dr(4)}catch{}}var Kd=class{constructor(o,u){this.g=o,this.map=u}};function za(o){this.l=o||10,c.PerformanceNavigationTiming?(o=c.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ha(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Wa(o){return o.h?1:o.g?o.g.size:0}function Oi(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function Mi(o,u){o.g?o.g.add(u):o.h=u}function Ga(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}za.prototype.cancel=function(){if(this.i=Ka(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Ka(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const d of o.g.values())u=u.concat(d.G);return u}return b(o.i)}var Qa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qd(o,u){if(o){o=o.split("&");for(let d=0;d<o.length;d++){const p=o[d].indexOf("=");let R,S=null;p>=0?(R=o[d].substring(0,p),S=o[d].substring(p+1)):R=o[d],u(R,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Ft(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof Ft?(this.l=o.l,_r(this,o.j),this.o=o.o,this.g=o.g,yr(this,o.u),this.h=o.h,Li(this,tc(o.i)),this.m=o.m):o&&(u=String(o).match(Qa))?(this.l=!1,_r(this,u[1]||"",!0),this.o=vr(u[2]||""),this.g=vr(u[3]||"",!0),yr(this,u[4]),this.h=vr(u[5]||"",!0),Li(this,u[6]||"",!0),this.m=vr(u[7]||"")):(this.l=!1,this.i=new Tr(null,this.l))}Ft.prototype.toString=function(){const o=[];var u=this.j;u&&o.push(Er(u,Ya,!0),":");var d=this.g;return(d||u=="file")&&(o.push("//"),(u=this.o)&&o.push(Er(u,Ya,!0),"@"),o.push(mr(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&o.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(Er(d,d.charAt(0)=="/"?Jd:Xd,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Er(d,ef)),o.join("")},Ft.prototype.resolve=function(o){const u=lt(this);let d=!!o.j;d?_r(u,o.j):d=!!o.o,d?u.o=o.o:d=!!o.g,d?u.g=o.g:d=o.u!=null;var p=o.h;if(d)yr(u,o.u);else if(d=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var R=u.h.lastIndexOf("/");R!=-1&&(p=u.h.slice(0,R+1)+p)}if(R=p,R==".."||R==".")p="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){p=R.lastIndexOf("/",0)==0,R=R.split("/");const S=[];for(let O=0;O<R.length;){const Q=R[O++];Q=="."?p&&O==R.length&&S.push(""):Q==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),p&&O==R.length&&S.push("")):(S.push(Q),p=!0)}p=S.join("/")}else p=R}return d?u.h=p:d=o.i.toString()!=="",d?Li(u,tc(o.i)):d=!!o.m,d&&(u.m=o.m),u};function lt(o){return new Ft(o)}function _r(o,u,d){o.j=d?vr(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function yr(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function Li(o,u,d){u instanceof Tr?(o.i=u,tf(o.i,o.l)):(d||(u=Er(u,Zd)),o.i=new Tr(u,o.l))}function le(o,u,d){o.i.set(u,d)}function us(o){return le(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function vr(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Er(o,u,d){return typeof o=="string"?(o=encodeURI(o).replace(u,Yd),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Yd(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Ya=/[#\/\?@]/g,Xd=/[#\?:]/g,Jd=/[#\?]/g,Zd=/[#\?@]/g,ef=/#/g;function Tr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function fn(o){o.g||(o.g=new Map,o.h=0,o.i&&Qd(o.i,function(u,d){o.add(decodeURIComponent(u.replace(/\+/g," ")),d)}))}n=Tr.prototype,n.add=function(o,u){fn(this),this.i=null,o=Vn(this,o);let d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(u),this.h+=1,this};function Xa(o,u){fn(o),u=Vn(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Ja(o,u){return fn(o),u=Vn(o,u),o.g.has(u)}n.forEach=function(o,u){fn(this),this.g.forEach(function(d,p){d.forEach(function(R){o.call(u,R,p,this)},this)},this)};function Za(o,u){fn(o);let d=[];if(typeof u=="string")Ja(o,u)&&(d=d.concat(o.g.get(Vn(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)d=d.concat(o[u]);return d}n.set=function(o,u){return fn(this),this.i=null,o=Vn(this,o),Ja(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},n.get=function(o,u){return o?(o=Za(this,o),o.length>0?String(o[0]):u):u};function ec(o,u,d){Xa(o,u),d.length>0&&(o.i=null,o.g.set(Vn(o,u),b(d)),o.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(let p=0;p<u.length;p++){var d=u[p];const R=mr(d);d=Za(this,d);for(let S=0;S<d.length;S++){let O=R;d[S]!==""&&(O+="="+mr(d[S])),o.push(O)}}return this.i=o.join("&")};function tc(o){const u=new Tr;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function Vn(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function tf(o,u){u&&!o.j&&(fn(o),o.i=null,o.g.forEach(function(d,p){const R=p.toLowerCase();p!=R&&(Xa(this,p),ec(this,R,d))},o)),o.j=u}function nf(o,u){const d=new pr;if(c.Image){const p=new Image;p.onload=m(Ut,d,"TestLoadImage: loaded",!0,u,p),p.onerror=m(Ut,d,"TestLoadImage: error",!1,u,p),p.onabort=m(Ut,d,"TestLoadImage: abort",!1,u,p),p.ontimeout=m(Ut,d,"TestLoadImage: timeout",!1,u,p),c.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else u(!1)}function rf(o,u){const d=new pr,p=new AbortController,R=setTimeout(()=>{p.abort(),Ut(d,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:p.signal}).then(S=>{clearTimeout(R),S.ok?Ut(d,"TestPingServer: ok",!0,u):Ut(d,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(R),Ut(d,"TestPingServer: error",!1,u)})}function Ut(o,u,d,p,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),p(d)}catch{}}function sf(){this.g=new Bd}function xi(o){this.i=o.Sb||null,this.h=o.ab||!1}T(xi,Da),xi.prototype.g=function(){return new ls(this.i,this.h)};function ls(o,u){Ue.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}T(ls,Ue),n=ls.prototype,n.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,wr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||c).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Ir(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,wr(this)),this.g&&(this.readyState=3,wr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;nc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function nc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?Ir(this):wr(this),this.readyState==3&&nc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Ir(this))},n.Na=function(o){this.g&&(this.response=o,Ir(this))},n.ga=function(){this.g&&Ir(this)};function Ir(o){o.readyState=4,o.l=null,o.j=null,o.B=null,wr(o)}n.setRequestHeader=function(o,u){this.A.append(o,u)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var d=u.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=u.next();return o.join(`\r
`)};function wr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ls.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function rc(o){let u="";return ue(o,function(d,p){u+=p,u+=":",u+=d,u+=`\r
`}),u}function Fi(o,u,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=rc(d),typeof o=="string"?d!=null&&mr(d):le(o,u,d))}function ye(o){Ue.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}T(ye,Ue);var of=/^https?$/i,af=["POST","PUT"];n=ye.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,u,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Fa.g(),this.g.onreadystatechange=I(f(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(S){sc(this,S);return}if(o=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var R in p)d.set(R,p[R]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const S of p.keys())d.set(S,p.get(S));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),R=c.FormData&&o instanceof c.FormData,!(Array.prototype.indexOf.call(af,u,void 0)>=0)||p||R||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,O]of d)this.g.setRequestHeader(S,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(S){sc(this,S)}};function sc(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,ic(o),hs(o)}function ic(o){o.A||(o.A=!0,He(o,"complete"),He(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,He(this,"complete"),He(this,"abort"),hs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),hs(this,!0)),ye.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?oc(this):this.Xa())},n.Xa=function(){oc(this)};function oc(o){if(o.h&&typeof a<"u"){if(o.v&&Bt(o)==4)setTimeout(o.Ca.bind(o),0);else if(He(o,"readystatechange"),Bt(o)==4){o.h=!1;try{const S=o.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break e;default:u=!1}var d;if(!(d=u)){var p;if(p=S===0){let O=String(o.D).match(Qa)[1]||null;!O&&c.self&&c.self.location&&(O=c.self.location.protocol.slice(0,-1)),p=!of.test(O?O.toLowerCase():"")}d=p}if(d)He(o,"complete"),He(o,"success");else{o.o=6;try{var R=Bt(o)>2?o.g.statusText:""}catch{R=""}o.l=R+" ["+o.ca()+"]",ic(o)}}finally{hs(o)}}}}function hs(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const d=o.g;o.g=null,u||He(o,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Bt(o){return o.g?o.g.readyState:0}n.ca=function(){try{return Bt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),Ud(u)}};function ac(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function cf(o){const u={};o=(o.g&&Bt(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(v(o[p]))continue;var d=Hd(o[p]);const R=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const S=u[R]||[];u[R]=S,S.push(d)}Fe(u,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ar(o,u,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||u}function cc(o){this.za=0,this.i=[],this.j=new pr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ar("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ar("baseRetryDelayMs",5e3,o),this.Za=Ar("retryDelaySeedMs",1e4,o),this.Ta=Ar("forwardChannelMaxRetries",2,o),this.va=Ar("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new za(o&&o.concurrentRequestLimit),this.Ba=new sf,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=cc.prototype,n.ka=8,n.I=1,n.connect=function(o,u,d,p){We(0),this.W=o,this.H=u||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=_c(this,null,this.W),fs(this)};function Ui(o){if(uc(o),o.I==3){var u=o.V++,d=lt(o.J);if(le(d,"SID",o.M),le(d,"RID",u),le(d,"TYPE","terminate"),Rr(o,d),u=new xt(o,o.j,u),u.M=2,u.A=us(lt(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(u.A.toString(),"")}catch{}!d&&c.Image&&(new Image().src=u.A,d=!0),d||(u.g=yc(u.j,null),u.g.ea(u.A)),u.F=Date.now(),cs(u)}gc(o)}function ds(o){o.g&&(ji(o),o.g.cancel(),o.g=null)}function uc(o){ds(o),o.v&&(c.clearTimeout(o.v),o.v=null),ps(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&c.clearTimeout(o.m),o.m=null)}function fs(o){if(!Ha(o.h)&&!o.m){o.m=!0;var u=o.Ea;z||_(),G||(z(),G=!0),w.add(u,o),o.D=0}}function uf(o,u){return Wa(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=fr(f(o.Ea,o,u),mc(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const R=new xt(this,this.j,o);let S=this.o;if(this.U&&(S?(S=ge(S),ee(S,this.U)):S=this.U),this.u!==null||this.R||(R.J=S,S=null),this.S)e:{for(var u=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(u+=p,u>4096){u=d;break e}if(u===4096||d===this.i.length-1){u=d+1;break e}}u=1e3}else u=1e3;u=hc(this,R,u),d=lt(this.J),le(d,"RID",o),le(d,"CVER",22),this.G&&le(d,"X-HTTP-Session-Id",this.G),Rr(this,d),S&&(this.R?u="headers="+mr(rc(S))+"&"+u:this.u&&Fi(d,this.u,S)),Mi(this.h,R),this.Ra&&le(d,"TYPE","init"),this.S?(le(d,"$req",u),le(d,"SID","null"),R.U=!0,Di(R,d,null)):Di(R,d,u),this.I=2}}else this.I==3&&(o?lc(this,o):this.i.length==0||Ha(this.h)||lc(this))};function lc(o,u){var d;u?d=u.l:d=o.V++;const p=lt(o.J);le(p,"SID",o.M),le(p,"RID",d),le(p,"AID",o.K),Rr(o,p),o.u&&o.o&&Fi(p,o.u,o.o),d=new xt(o,o.j,d,o.D+1),o.u===null&&(d.J=o.o),u&&(o.i=u.G.concat(o.i)),u=hc(o,d,1e3),d.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Mi(o.h,d),Di(d,p,u)}function Rr(o,u){o.H&&ue(o.H,function(d,p){le(u,p,d)}),o.l&&ue({},function(d,p){le(u,p,d)})}function hc(o,u,d){d=Math.min(o.i.length,d);const p=o.l?f(o.l.Ka,o.l,o):null;e:{var R=o.i;let Q=-1;for(;;){const Se=["count="+d];Q==-1?d>0?(Q=R[0].g,Se.push("ofs="+Q)):Q=0:Se.push("ofs="+Q);let ce=!0;for(let De=0;De<d;De++){var S=R[De].g;const ht=R[De].map;if(S-=Q,S<0)Q=Math.max(0,R[De].g-100),ce=!1;else try{S="req"+S+"_"||"";try{var O=ht instanceof Map?ht:Object.entries(ht);for(const[mn,jt]of O){let qt=jt;l(jt)&&(qt=Si(jt)),Se.push(S+mn+"="+encodeURIComponent(qt))}}catch(mn){throw Se.push(S+"type="+encodeURIComponent("_badmap")),mn}}catch{p&&p(ht)}}if(ce){O=Se.join("&");break e}}O=void 0}return o=o.i.splice(0,d),u.G=o,O}function dc(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;z||_(),G||(z(),G=!0),w.add(u,o),o.A=0}}function Bi(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=fr(f(o.Da,o),mc(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,fc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=fr(f(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,We(10),ds(this),fc(this))};function ji(o){o.B!=null&&(c.clearTimeout(o.B),o.B=null)}function fc(o){o.g=new xt(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=lt(o.na);le(u,"RID","rpc"),le(u,"SID",o.M),le(u,"AID",o.K),le(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&le(u,"TO",o.ia),le(u,"TYPE","xmlhttp"),Rr(o,u),o.u&&o.o&&Fi(u,o.u,o.o),o.O&&(o.g.H=o.O);var d=o.g;o=o.ba,d.M=1,d.A=us(lt(u)),d.u=null,d.R=!0,ja(d,o)}n.Va=function(){this.C!=null&&(this.C=null,ds(this),Bi(this),We(19))};function ps(o){o.C!=null&&(c.clearTimeout(o.C),o.C=null)}function pc(o,u){var d=null;if(o.g==u){ps(o),ji(o),o.g=null;var p=2}else if(Oi(o.h,u))d=u.G,Ga(o.h,u),p=1;else return;if(o.I!=0){if(u.o)if(p==1){d=u.u?u.u.length:0,u=Date.now()-u.F;var R=o.D;p=os(),He(p,new La(p,d)),fs(o)}else dc(o);else if(R=u.m,R==3||R==0&&u.X>0||!(p==1&&uf(o,u)||p==2&&Bi(o)))switch(d&&d.length>0&&(u=o.h,u.i=u.i.concat(d)),R){case 1:pn(o,5);break;case 4:pn(o,10);break;case 3:pn(o,6);break;default:pn(o,2)}}}function mc(o,u){let d=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(d*=2),d*u}function pn(o,u){if(o.j.info("Error code "+u),u==2){var d=f(o.bb,o),p=o.Ua;const R=!p;p=new Ft(p||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||_r(p,"https"),us(p),R?nf(p.toString(),d):rf(p.toString(),d)}else We(2);o.I=0,o.l&&o.l.pa(u),gc(o),uc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),We(2)):(this.j.info("Failed to ping google.com"),We(1))};function gc(o){if(o.I=0,o.ja=[],o.l){const u=Ka(o.h);(u.length!=0||o.i.length!=0)&&(D(o.ja,u),D(o.ja,o.i),o.h.i.length=0,b(o.i),o.i.length=0),o.l.oa()}}function _c(o,u,d){var p=d instanceof Ft?lt(d):new Ft(d);if(p.g!="")u&&(p.g=u+"."+p.g),yr(p,p.u);else{var R=c.location;p=R.protocol,u=u?u+"."+R.hostname:R.hostname,R=+R.port;const S=new Ft(null);p&&_r(S,p),u&&(S.g=u),R&&yr(S,R),d&&(S.h=d),p=S}return d=o.G,u=o.wa,d&&u&&le(p,d,u),le(p,"VER",o.ka),Rr(o,p),p}function yc(o,u,d){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new ye(new xi({ab:d})):new ye(o.ma),u.Fa(o.L),u}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function vc(){}n=vc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ms(){}ms.prototype.g=function(o,u){return new Ze(o,u)};function Ze(o,u){Ue.call(this),this.g=new cc(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!v(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!v(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new Nn(this)}T(Ze,Ue),Ze.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ze.prototype.close=function(){Ui(this.g)},Ze.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.v&&(d={},d.__data__=Si(o),o=d);u.i.push(new Kd(u.Ya++,o)),u.I==3&&fs(u)},Ze.prototype.N=function(){this.g.l=null,delete this.j,Ui(this.g),delete this.g,Ze.Z.N.call(this)};function Ec(o){bi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){e:{for(const d in u){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}T(Ec,bi);function Tc(){Pi.call(this),this.status=1}T(Tc,Pi);function Nn(o){this.g=o}T(Nn,vc),Nn.prototype.ra=function(){He(this.g,"a")},Nn.prototype.qa=function(o){He(this.g,new Ec(o))},Nn.prototype.pa=function(o){He(this.g,new Tc)},Nn.prototype.oa=function(){He(this.g,"b")},ms.prototype.createWebChannel=ms.prototype.g,Ze.prototype.send=Ze.prototype.o,Ze.prototype.open=Ze.prototype.m,Ze.prototype.close=Ze.prototype.close,ch=function(){return new ms},ah=function(){return os()},oh=hn,wo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},as.NO_ERROR=0,as.TIMEOUT=8,as.HTTP_ERROR=6,Cs=as,xa.COMPLETE="complete",ih=xa,Va.EventType=hr,hr.OPEN="a",hr.CLOSE="b",hr.ERROR="c",hr.MESSAGE="d",Ue.prototype.listen=Ue.prototype.J,Cr=Va,ye.prototype.listenOnce=ye.prototype.K,ye.prototype.getLastError=ye.prototype.Ha,ye.prototype.getLastErrorCode=ye.prototype.ya,ye.prototype.getStatus=ye.prototype.ca,ye.prototype.getResponseJson=ye.prototype.La,ye.prototype.getResponseText=ye.prototype.la,ye.prototype.send=ye.prototype.ea,ye.prototype.setWithCredentials=ye.prototype.Fa,sh=ye}).apply(typeof ys<"u"?ys:typeof self<"u"?self:typeof window<"u"?window:{});const ru="@firebase/firestore",su="4.9.2";class qe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}qe.UNAUTHENTICATED=new qe(null),qe.GOOGLE_CREDENTIALS=new qe("google-credentials-uid"),qe.FIRST_PARTY=new qe("first-party-uid"),qe.MOCK_USER=new qe("mock-user");let tr="12.3.0";const wn=new jo("@firebase/firestore");function Mn(){return wn.logLevel}function M(n,...e){if(wn.logLevel<=Y.DEBUG){const t=e.map(Jo);wn.debug(`Firestore (${tr}): ${n}`,...t)}}function Nt(n,...e){if(wn.logLevel<=Y.ERROR){const t=e.map(Jo);wn.error(`Firestore (${tr}): ${n}`,...t)}}function Wn(n,...e){if(wn.logLevel<=Y.WARN){const t=e.map(Jo);wn.warn(`Firestore (${tr}): ${n}`,...t)}}function Jo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,uh(n,r,t)}function uh(n,e,t){let r=`FIRESTORE (${tr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Nt(r),new Error(r)}function oe(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||uh(e,s,r)}function W(n,e){return n}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends Mt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ct{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class lh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class z_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(qe.UNAUTHENTICATED)))}shutdown(){}}class H_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class W_{constructor(e){this.t=e,this.currentUser=qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){oe(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let a=new Ct;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ct,e.enqueueRetryable((()=>s(this.currentUser)))};const c=()=>{const h=a;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(M("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ct)}}),0),c()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(oe(typeof r.accessToken=="string",31837,{l:r}),new lh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return oe(e===null||typeof e=="string",2055,{h:e}),new qe(e)}}class G_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=qe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class K_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new G_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(qe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class iu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Q_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,rt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){oe(this.o===void 0,3512);const r=a=>{a.error!=null&&M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const c=a.token!==this.m;return this.m=a.token,M("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable((()=>r(a)))};const s=a=>{M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((a=>s(a))),setTimeout((()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?s(a):M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new iu(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(oe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new iu(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Y_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Zo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Y_(40);for(let a=0;a<s.length;++a)r.length<20&&s[a]<t&&(r+=e.charAt(s[a]%62))}return r}}function X(n,e){return n<e?-1:n>e?1:0}function Ao(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),a=e.charAt(r);if(s!==a)return so(s)===so(a)?X(s,a):so(s)?1:-1}return X(n.length,e.length)}const X_=55296,J_=57343;function so(n){const e=n.charCodeAt(0);return e>=X_&&e<=J_}function Gn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const ou="__name__";class ft{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ft.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ft?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const a=ft.compareSegments(e.get(s),t.get(s));if(a!==0)return a}return X(e.length,t.length)}static compareSegments(e,t){const r=ft.isNumericId(e),s=ft.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?ft.extractNumericId(e).compare(ft.extractNumericId(t)):Ao(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Zt.fromString(e.substring(4,e.length-2))}}class de extends ft{construct(e,t,r){return new de(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new x(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new de(t)}static emptyPath(){return new de([])}}const Z_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Le extends ft{construct(e,t,r){return new Le(e,t,r)}static isValidIdentifier(e){return Z_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Le.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ou}static keyField(){return new Le([ou])}static fromServerFormat(e){const t=[];let r="",s=0;const a=()=>{if(r.length===0)throw new x(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let c=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new x(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new x(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else l==="`"?(c=!c,s++):l!=="."||c?(r+=l,s++):(a(),s++)}if(a(),c)throw new x(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Le(t)}static emptyPath(){return new Le([])}}class j{constructor(e){this.path=e}static fromPath(e){return new j(de.fromString(e))}static fromName(e){return new j(de.fromString(e).popFirst(5))}static empty(){return new j(de.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&de.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return de.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new j(new de(e.slice()))}}function hh(n,e,t){if(!t)throw new x(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ey(n,e,t,r){if(e===!0&&r===!0)throw new x(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function au(n){if(!j.isDocumentKey(n))throw new x(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function cu(n){if(j.isDocumentKey(n))throw new x(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function dh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ea(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function An(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ea(n);throw new x(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Re(n,e){const t={typeString:n};return e&&(t.value=e),t}function es(n,e){if(!dh(n))throw new x(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,a="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const c=n[r];if(s&&typeof c!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(a!==void 0&&c!==a.value){t=`Expected '${r}' field to equal '${a.value}'`;break}}if(t)throw new x(V.INVALID_ARGUMENT,t);return!0}const uu=-62135596800,lu=1e6;class fe{static now(){return fe.fromMillis(Date.now())}static fromDate(e){return fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*lu);return new fe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<uu)throw new x(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/lu}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:fe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(es(e,fe._jsonSchema))return new fe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-uu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}fe._jsonSchemaVersion="firestore/timestamp/1.0",fe._jsonSchema={type:Re("string",fe._jsonSchemaVersion),seconds:Re("number"),nanoseconds:Re("number")};class H{static fromTimestamp(e){return new H(e)}static min(){return new H(new fe(0,0))}static max(){return new H(new fe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const qr=-1;function ty(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=H.fromTimestamp(r===1e9?new fe(t+1,0):new fe(t,r));return new tn(s,j.empty(),e)}function ny(n){return new tn(n.readTime,n.key,qr)}class tn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new tn(H.min(),j.empty(),qr)}static max(){return new tn(H.max(),j.empty(),qr)}}function ry(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=j.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}const sy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function nr(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==sy)throw n;M("LocalStore","Unexpectedly lost primary lease")}class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new C(((r,s)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,s)},this.catchCallback=a=>{this.wrapFailure(t,a).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof C?t:C.resolve(t)}catch(t){return C.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):C.reject(t)}static resolve(e){return new C(((t,r)=>{t(e)}))}static reject(e){return new C(((t,r)=>{r(e)}))}static waitFor(e){return new C(((t,r)=>{let s=0,a=0,c=!1;e.forEach((l=>{++s,l.next((()=>{++a,c&&a===s&&t()}),(h=>r(h)))})),c=!0,a===s&&t()}))}static or(e){let t=C.resolve(!1);for(const r of e)t=t.next((s=>s?C.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,a)=>{r.push(t.call(this,s,a))})),this.waitFor(r)}static mapArray(e,t){return new C(((r,s)=>{const a=e.length,c=new Array(a);let l=0;for(let h=0;h<a;h++){const f=h;t(e[f]).next((m=>{c[f]=m,++l,l===a&&r(c)}),(m=>s(m)))}}))}static doWhile(e,t){return new C(((r,s)=>{const a=()=>{e()===!0?t().next((()=>{a()}),s):r()};a()}))}}function oy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function rr(n){return n.name==="IndexedDbTransactionError"}class hi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}hi.ce=-1;const ta=-1;function di(n){return n==null}function zs(n){return n===0&&1/n==-1/0}function ay(n){return typeof n=="number"&&Number.isInteger(n)&&!zs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const fh="";function cy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=hu(e)),e=uy(n.get(t),e);return hu(e)}function uy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const a=n.charAt(s);switch(a){case"\0":t+="";break;case fh:t+="";break;default:t+=a}}return t}function hu(n){return n+fh+""}function du(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function bn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ph(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class _e{constructor(e,t){this.comparator=e,this.root=t||Me.EMPTY}insert(e,t){return new _e(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Me.BLACK,null,null))}remove(e){return new _e(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Me.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vs(this.root,e,this.comparator,!1)}getReverseIterator(){return new vs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vs(this.root,e,this.comparator,!0)}}class vs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=t?r(e.key,t):1,t&&s&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Me{constructor(e,t,r,s,a){this.key=e,this.value=t,this.color=r??Me.RED,this.left=s??Me.EMPTY,this.right=a??Me.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,a){return new Me(e??this.key,t??this.value,r??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const a=r(e,s.key);return s=a<0?s.copy(null,null,null,s.left.insert(e,t,r),null):a===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Me.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Me.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Me.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Me.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Me.EMPTY=null,Me.RED=!0,Me.BLACK=!1;Me.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,a){return this}insert(e,t,r){return new Me(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ce{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fu(this.data.getIterator())}getIteratorFrom(e){return new fu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Ce)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,a=r.getNext().key;if(this.comparator(s,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ce(this.comparator);return t.data=e,t}}class fu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ct{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new ct([])}unionWith(e){let t=new Ce(Le.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ct(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Gn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class mh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new mh("Invalid base64 string: "+a):a}})(e);return new xe(t)}static fromUint8Array(e){const t=(function(s){let a="";for(let c=0;c<s.length;++c)a+=String.fromCharCode(s[c]);return a})(e);return new xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xe.EMPTY_BYTE_STRING=new xe("");const ly=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nn(n){if(oe(!!n,39018),typeof n=="string"){let e=0;const t=ly.exec(n);if(oe(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function rn(n){return typeof n=="string"?xe.fromBase64String(n):xe.fromUint8Array(n)}const gh="server_timestamp",_h="__type__",yh="__previous_value__",vh="__local_write_time__";function na(n){return(n?.mapValue?.fields||{})[_h]?.stringValue===gh}function fi(n){const e=n.mapValue.fields[yh];return na(e)?fi(e):e}function $r(n){const e=nn(n.mapValue.fields[vh].timestampValue);return new fe(e.seconds,e.nanos)}class hy{constructor(e,t,r,s,a,c,l,h,f,m){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=a,this.forceLongPolling=c,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m}}const Hs="(default)";class zr{constructor(e,t){this.projectId=e,this.database=t||Hs}static empty(){return new zr("","")}get isDefaultDatabase(){return this.database===Hs}isEqual(e){return e instanceof zr&&e.projectId===this.projectId&&e.database===this.database}}const Eh="__type__",dy="__max__",Es={mapValue:{}},Th="__vector__",Ws="value";function sn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?na(n)?4:py(n)?9007199254740991:fy(n)?10:11:$(28295,{value:n})}function Et(n,e){if(n===e)return!0;const t=sn(n);if(t!==sn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return $r(n).isEqual($r(e));case 3:return(function(s,a){if(typeof s.timestampValue=="string"&&typeof a.timestampValue=="string"&&s.timestampValue.length===a.timestampValue.length)return s.timestampValue===a.timestampValue;const c=nn(s.timestampValue),l=nn(a.timestampValue);return c.seconds===l.seconds&&c.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,a){return rn(s.bytesValue).isEqual(rn(a.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,a){return we(s.geoPointValue.latitude)===we(a.geoPointValue.latitude)&&we(s.geoPointValue.longitude)===we(a.geoPointValue.longitude)})(n,e);case 2:return(function(s,a){if("integerValue"in s&&"integerValue"in a)return we(s.integerValue)===we(a.integerValue);if("doubleValue"in s&&"doubleValue"in a){const c=we(s.doubleValue),l=we(a.doubleValue);return c===l?zs(c)===zs(l):isNaN(c)&&isNaN(l)}return!1})(n,e);case 9:return Gn(n.arrayValue.values||[],e.arrayValue.values||[],Et);case 10:case 11:return(function(s,a){const c=s.mapValue.fields||{},l=a.mapValue.fields||{};if(du(c)!==du(l))return!1;for(const h in c)if(c.hasOwnProperty(h)&&(l[h]===void 0||!Et(c[h],l[h])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function Hr(n,e){return(n.values||[]).find((t=>Et(t,e)))!==void 0}function Kn(n,e){if(n===e)return 0;const t=sn(n),r=sn(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(a,c){const l=we(a.integerValue||a.doubleValue),h=we(c.integerValue||c.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,e);case 3:return pu(n.timestampValue,e.timestampValue);case 4:return pu($r(n),$r(e));case 5:return Ao(n.stringValue,e.stringValue);case 6:return(function(a,c){const l=rn(a),h=rn(c);return l.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(a,c){const l=a.split("/"),h=c.split("/");for(let f=0;f<l.length&&f<h.length;f++){const m=X(l[f],h[f]);if(m!==0)return m}return X(l.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(a,c){const l=X(we(a.latitude),we(c.latitude));return l!==0?l:X(we(a.longitude),we(c.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return mu(n.arrayValue,e.arrayValue);case 10:return(function(a,c){const l=a.fields||{},h=c.fields||{},f=l[Ws]?.arrayValue,m=h[Ws]?.arrayValue,T=X(f?.values?.length||0,m?.values?.length||0);return T!==0?T:mu(f,m)})(n.mapValue,e.mapValue);case 11:return(function(a,c){if(a===Es.mapValue&&c===Es.mapValue)return 0;if(a===Es.mapValue)return 1;if(c===Es.mapValue)return-1;const l=a.fields||{},h=Object.keys(l),f=c.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let T=0;T<h.length&&T<m.length;++T){const I=Ao(h[T],m[T]);if(I!==0)return I;const b=Kn(l[h[T]],f[m[T]]);if(b!==0)return b}return X(h.length,m.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function pu(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=nn(n),r=nn(e),s=X(t.seconds,r.seconds);return s!==0?s:X(t.nanos,r.nanos)}function mu(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const a=Kn(t[s],r[s]);if(a)return a}return X(t.length,r.length)}function Qn(n){return Ro(n)}function Ro(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=nn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return rn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return j.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const a of t.values||[])s?s=!1:r+=",",r+=Ro(a);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",a=!0;for(const c of r)a?a=!1:s+=",",s+=`${c}:${Ro(t.fields[c])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function ks(n){switch(sn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fi(n);return e?16+ks(e):16;case 5:return 2*n.stringValue.length;case 6:return rn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,a)=>s+ks(a)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return bn(r.fields,((a,c)=>{s+=a.length+ks(c)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function So(n){return!!n&&"integerValue"in n}function ra(n){return!!n&&"arrayValue"in n}function gu(n){return!!n&&"nullValue"in n}function _u(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ds(n){return!!n&&"mapValue"in n}function fy(n){return(n?.mapValue?.fields||{})[Eh]?.stringValue===Th}function Mr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return bn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Mr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Mr(n.arrayValue.values[t]);return e}return{...n}}function py(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===dy}class st{constructor(e){this.value=e}static empty(){return new st({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ds(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Mr(t)}setAll(e){let t=Le.emptyPath(),r={},s=[];e.forEach(((c,l)=>{if(!t.isImmediateParentOf(l)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=l.popLast()}c?r[l.lastSegment()]=Mr(c):s.push(l.lastSegment())}));const a=this.getFieldsMap(t);this.applyChanges(a,r,s)}delete(e){const t=this.field(e.popLast());Ds(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ds(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){bn(t,((s,a)=>e[s]=a));for(const s of r)delete e[s]}clone(){return new st(Mr(this.value))}}function Ih(n){const e=[];return bn(n.fields,((t,r)=>{const s=new Le([t]);if(Ds(r)){const a=Ih(r.mapValue).fields;if(a.length===0)e.push(s);else for(const c of a)e.push(s.child(c))}else e.push(s)})),new ct(e)}class $e{constructor(e,t,r,s,a,c,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=a,this.data=c,this.documentState=l}static newInvalidDocument(e){return new $e(e,0,H.min(),H.min(),H.min(),st.empty(),0)}static newFoundDocument(e,t,r,s){return new $e(e,1,t,H.min(),r,s,0)}static newNoDocument(e,t){return new $e(e,2,t,H.min(),H.min(),st.empty(),0)}static newUnknownDocument(e,t){return new $e(e,3,t,H.min(),H.min(),st.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(H.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=st.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=st.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=H.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $e&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gs{constructor(e,t){this.position=e,this.inclusive=t}}function yu(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const a=e[s],c=n.position[s];if(a.field.isKeyField()?r=j.comparator(j.fromName(c.referenceValue),t.key):r=Kn(c,t.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function vu(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Et(n.position[t],e.position[t]))return!1;return!0}class Ks{constructor(e,t="asc"){this.field=e,this.dir=t}}function my(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class wh{}class be extends wh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new _y(e,t,r):t==="array-contains"?new Ey(e,r):t==="in"?new Ty(e,r):t==="not-in"?new Iy(e,r):t==="array-contains-any"?new wy(e,r):new be(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new yy(e,r):new vy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Kn(t,this.value)):t!==null&&sn(this.value)===sn(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Tt extends wh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Tt(e,t)}matches(e){return Ah(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ah(n){return n.op==="and"}function Rh(n){return gy(n)&&Ah(n)}function gy(n){for(const e of n.filters)if(e instanceof Tt)return!1;return!0}function bo(n){if(n instanceof be)return n.field.canonicalString()+n.op.toString()+Qn(n.value);if(Rh(n))return n.filters.map((e=>bo(e))).join(",");{const e=n.filters.map((t=>bo(t))).join(",");return`${n.op}(${e})`}}function Sh(n,e){return n instanceof be?(function(r,s){return s instanceof be&&r.op===s.op&&r.field.isEqual(s.field)&&Et(r.value,s.value)})(n,e):n instanceof Tt?(function(r,s){return s instanceof Tt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((a,c,l)=>a&&Sh(c,s.filters[l])),!0):!1})(n,e):void $(19439)}function bh(n){return n instanceof be?(function(t){return`${t.field.canonicalString()} ${t.op} ${Qn(t.value)}`})(n):n instanceof Tt?(function(t){return t.op.toString()+" {"+t.getFilters().map(bh).join(" ,")+"}"})(n):"Filter"}class _y extends be{constructor(e,t,r){super(e,t,r),this.key=j.fromName(r.referenceValue)}matches(e){const t=j.comparator(e.key,this.key);return this.matchesComparison(t)}}class yy extends be{constructor(e,t){super(e,"in",t),this.keys=Ph("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class vy extends be{constructor(e,t){super(e,"not-in",t),this.keys=Ph("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ph(n,e){return(e.arrayValue?.values||[]).map((t=>j.fromName(t.referenceValue)))}class Ey extends be{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ra(t)&&Hr(t.arrayValue,this.value)}}class Ty extends be{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Hr(this.value.arrayValue,t)}}class Iy extends be{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Hr(this.value.arrayValue,t)}}class wy extends be{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ra(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Hr(this.value.arrayValue,r)))}}class Ay{constructor(e,t=null,r=[],s=[],a=null,c=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=a,this.startAt=c,this.endAt=l,this.Te=null}}function Eu(n,e=null,t=[],r=[],s=null,a=null,c=null){return new Ay(n,e,t,r,s,a,c)}function sa(n){const e=W(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>bo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(a){return a.field.canonicalString()+a.dir})(r))).join(","),di(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Qn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Qn(r))).join(",")),e.Te=t}return e.Te}function ia(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!my(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Sh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!vu(n.startAt,e.startAt)&&vu(n.endAt,e.endAt)}function Po(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class pi{constructor(e,t=null,r=[],s=[],a=null,c="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=a,this.limitType=c,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ry(n,e,t,r,s,a,c,l){return new pi(n,e,t,r,s,a,c,l)}function oa(n){return new pi(n)}function Tu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sy(n){return n.collectionGroup!==null}function Lr(n){const e=W(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const a of e.explicitOrderBy)e.Ie.push(a),t.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let l=new Ce(Le.comparator);return c.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(l=l.add(f.field))}))})),l})(e).forEach((a=>{t.has(a.canonicalString())||a.isKeyField()||e.Ie.push(new Ks(a,r))})),t.has(Le.keyField().canonicalString())||e.Ie.push(new Ks(Le.keyField(),r))}return e.Ie}function gt(n){const e=W(n);return e.Ee||(e.Ee=by(e,Lr(n))),e.Ee}function by(n,e){if(n.limitType==="F")return Eu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const a=s.dir==="desc"?"asc":"desc";return new Ks(s.field,a)}));const t=n.endAt?new Gs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Gs(n.startAt.position,n.startAt.inclusive):null;return Eu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Co(n,e,t){return new pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function mi(n,e){return ia(gt(n),gt(e))&&n.limitType===e.limitType}function Ch(n){return`${sa(gt(n))}|lt:${n.limitType}`}function Ln(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>bh(s))).join(", ")}]`),di(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Qn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Qn(s))).join(",")),`Target(${r})`})(gt(n))}; limitType=${n.limitType})`}function gi(n,e){return e.isFoundDocument()&&(function(r,s){const a=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):j.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)})(n,e)&&(function(r,s){for(const a of Lr(r))if(!a.field.isKeyField()&&s.data.field(a.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const a of r.filters)if(!a.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(c,l,h){const f=yu(c,l,h);return c.inclusive?f<=0:f<0})(r.startAt,Lr(r),s)||r.endAt&&!(function(c,l,h){const f=yu(c,l,h);return c.inclusive?f>=0:f>0})(r.endAt,Lr(r),s))})(n,e)}function Py(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function kh(n){return(e,t)=>{let r=!1;for(const s of Lr(n)){const a=Cy(s,e,t);if(a!==0)return a;r=r||s.field.isKeyField()}return 0}}function Cy(n,e,t){const r=n.field.isKeyField()?j.comparator(e.key,t.key):(function(a,c,l){const h=c.data.field(a),f=l.data.field(a);return h!==null&&f!==null?Kn(h,f):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}class Pn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,a]of r)if(this.equalsFn(s,e))return a}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],e))return void(s[a]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){bn(this.inner,((t,r)=>{for(const[s,a]of r)e(s,a)}))}isEmpty(){return ph(this.inner)}size(){return this.innerSize}}const ky=new _e(j.comparator);function Ot(){return ky}const Dh=new _e(j.comparator);function kr(...n){let e=Dh;for(const t of n)e=e.insert(t.key,t);return e}function Vh(n){let e=Dh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function _n(){return xr()}function Nh(){return xr()}function xr(){return new Pn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Dy=new _e(j.comparator),Vy=new Ce(j.comparator);function J(...n){let e=Vy;for(const t of n)e=e.add(t);return e}const Ny=new Ce(X);function Oy(){return Ny}function aa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function Oh(n){return{integerValue:""+n}}function My(n,e){return ay(e)?Oh(e):aa(n,e)}class _i{constructor(){this._=void 0}}function Ly(n,e,t){return n instanceof Qs?(function(s,a){const c={fields:{[_h]:{stringValue:gh},[vh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return a&&na(a)&&(a=fi(a)),a&&(c.fields[yh]=a),{mapValue:c}})(t,e):n instanceof Wr?Lh(n,e):n instanceof Gr?xh(n,e):(function(s,a){const c=Mh(s,a),l=Iu(c)+Iu(s.Ae);return So(c)&&So(s.Ae)?Oh(l):aa(s.serializer,l)})(n,e)}function xy(n,e,t){return n instanceof Wr?Lh(n,e):n instanceof Gr?xh(n,e):t}function Mh(n,e){return n instanceof Ys?(function(r){return So(r)||(function(a){return!!a&&"doubleValue"in a})(r)})(e)?e:{integerValue:0}:null}class Qs extends _i{}class Wr extends _i{constructor(e){super(),this.elements=e}}function Lh(n,e){const t=Fh(e);for(const r of n.elements)t.some((s=>Et(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Gr extends _i{constructor(e){super(),this.elements=e}}function xh(n,e){let t=Fh(e);for(const r of n.elements)t=t.filter((s=>!Et(s,r)));return{arrayValue:{values:t}}}class Ys extends _i{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Iu(n){return we(n.integerValue||n.doubleValue)}function Fh(n){return ra(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Fy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Wr&&s instanceof Wr||r instanceof Gr&&s instanceof Gr?Gn(r.elements,s.elements,Et):r instanceof Ys&&s instanceof Ys?Et(r.Ae,s.Ae):r instanceof Qs&&s instanceof Qs})(n.transform,e.transform)}class Uy{constructor(e,t){this.version=e,this.transformResults=t}}class kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new kt}static exists(e){return new kt(void 0,e)}static updateTime(e){return new kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Vs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yi{}function Uh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jh(n.key,kt.none()):new ts(n.key,n.data,kt.none());{const t=n.data,r=st.empty();let s=new Ce(Le.comparator);for(let a of e.fields)if(!s.has(a)){let c=t.field(a);c===null&&a.length>1&&(a=a.popLast(),c=t.field(a)),c===null?r.delete(a):r.set(a,c),s=s.add(a)}return new Cn(n.key,r,new ct(s.toArray()),kt.none())}}function By(n,e,t){n instanceof ts?(function(s,a,c){const l=s.value.clone(),h=Au(s.fieldTransforms,a,c.transformResults);l.setAll(h),a.convertToFoundDocument(c.version,l).setHasCommittedMutations()})(n,e,t):n instanceof Cn?(function(s,a,c){if(!Vs(s.precondition,a))return void a.convertToUnknownDocument(c.version);const l=Au(s.fieldTransforms,a,c.transformResults),h=a.data;h.setAll(Bh(s)),h.setAll(l),a.convertToFoundDocument(c.version,h).setHasCommittedMutations()})(n,e,t):(function(s,a,c){a.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function Fr(n,e,t,r){return n instanceof ts?(function(a,c,l,h){if(!Vs(a.precondition,c))return l;const f=a.value.clone(),m=Ru(a.fieldTransforms,h,c);return f.setAll(m),c.convertToFoundDocument(c.version,f).setHasLocalMutations(),null})(n,e,t,r):n instanceof Cn?(function(a,c,l,h){if(!Vs(a.precondition,c))return l;const f=Ru(a.fieldTransforms,h,c),m=c.data;return m.setAll(Bh(a)),m.setAll(f),c.convertToFoundDocument(c.version,m).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map((T=>T.field)))})(n,e,t,r):(function(a,c,l){return Vs(a.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):l})(n,e,t)}function jy(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),a=Mh(r.transform,s||null);a!=null&&(t===null&&(t=st.empty()),t.set(r.field,a))}return t||null}function wu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Gn(r,s,((a,c)=>Fy(a,c)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ts extends yi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Cn extends yi{constructor(e,t,r,s,a=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function Bh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Au(n,e,t){const r=new Map;oe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const a=n[s],c=a.transform,l=e.data.field(a.field);r.set(a.field,xy(c,l,t[s]))}return r}function Ru(n,e,t){const r=new Map;for(const s of n){const a=s.transform,c=t.data.field(s.field);r.set(s.field,Ly(a,c,e))}return r}class jh extends yi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qy extends yi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $y{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const a=this.mutations[s];a.key.isEqual(e.key)&&By(a,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Fr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Fr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Nh();return this.mutations.forEach((s=>{const a=e.get(s.key),c=a.overlayedDocument;let l=this.applyToLocalView(c,a.mutatedFields);l=t.has(s.key)?null:l;const h=Uh(c,l);h!==null&&r.set(s.key,h),c.isValidDocument()||c.convertToNoDocument(H.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),J())}isEqual(e){return this.batchId===e.batchId&&Gn(this.mutations,e.mutations,((t,r)=>wu(t,r)))&&Gn(this.baseMutations,e.baseMutations,((t,r)=>wu(t,r)))}}class ca{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){oe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Dy})();const a=e.mutations;for(let c=0;c<a.length;c++)s=s.insert(a[c].key,r[c].version);return new ca(e,t,r,s)}}class zy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Hy{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ae,te;function Wy(n){switch(n){case V.OK:return $(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function qh(n){if(n===void 0)return Nt("GRPC error has no .code"),V.UNKNOWN;switch(n){case Ae.OK:return V.OK;case Ae.CANCELLED:return V.CANCELLED;case Ae.UNKNOWN:return V.UNKNOWN;case Ae.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Ae.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Ae.INTERNAL:return V.INTERNAL;case Ae.UNAVAILABLE:return V.UNAVAILABLE;case Ae.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Ae.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Ae.NOT_FOUND:return V.NOT_FOUND;case Ae.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Ae.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Ae.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Ae.ABORTED:return V.ABORTED;case Ae.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Ae.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Ae.DATA_LOSS:return V.DATA_LOSS;default:return $(39323,{code:n})}}(te=Ae||(Ae={}))[te.OK=0]="OK",te[te.CANCELLED=1]="CANCELLED",te[te.UNKNOWN=2]="UNKNOWN",te[te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",te[te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",te[te.NOT_FOUND=5]="NOT_FOUND",te[te.ALREADY_EXISTS=6]="ALREADY_EXISTS",te[te.PERMISSION_DENIED=7]="PERMISSION_DENIED",te[te.UNAUTHENTICATED=16]="UNAUTHENTICATED",te[te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",te[te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",te[te.ABORTED=10]="ABORTED",te[te.OUT_OF_RANGE=11]="OUT_OF_RANGE",te[te.UNIMPLEMENTED=12]="UNIMPLEMENTED",te[te.INTERNAL=13]="INTERNAL",te[te.UNAVAILABLE=14]="UNAVAILABLE",te[te.DATA_LOSS=15]="DATA_LOSS";function Gy(){return new TextEncoder}const Ky=new Zt([4294967295,4294967295],0);function Su(n){const e=Gy().encode(n),t=new rh;return t.update(e),new Uint8Array(t.digest())}function bu(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new Zt([t,r],0),new Zt([s,a],0)]}class ua{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Dr(`Invalid padding: ${t}`);if(r<0)throw new Dr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Dr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Dr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Zt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Zt.fromNumber(r)));return s.compare(Ky)===1&&(s=new Zt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Su(e),[r,s]=bu(t);for(let a=0;a<this.hashCount;a++){const c=this.ye(r,s,a);if(!this.we(c))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),c=new ua(a,s,t);return r.forEach((l=>c.insert(l))),c}insert(e){if(this.ge===0)return;const t=Su(e),[r,s]=bu(t);for(let a=0;a<this.hashCount;a++){const c=this.ye(r,s,a);this.Se(c)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Dr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class vi{constructor(e,t,r,s,a){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ns.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new vi(H.min(),s,new _e(X),Ot(),J())}}class ns{constructor(e,t,r,s,a){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ns(r,t,J(),J(),J())}}class Ns{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class $h{constructor(e,t){this.targetId=e,this.Ce=t}}class zh{constructor(e,t,r=xe.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Pu{constructor(){this.ve=0,this.Fe=Cu(),this.Me=xe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=J(),t=J(),r=J();return this.Fe.forEach(((s,a)=>{switch(a){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:a})}})),new ns(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Cu()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,oe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Qy{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ot(),this.Je=Ts(),this.He=Ts(),this.Ye=new _e(X)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const a=s.target;if(Po(a))if(r===0){const c=new j(a.path);this.et(t,c,$e.newNoDocument(c,H.min()))}else oe(r===1,20013,{expectedCount:r});else{const c=this._t(t);if(c!==r){const l=this.ut(e),h=l?this.ct(l,e,c):1;if(h!==0){this.it(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:a=0}=t;let c,l;try{c=rn(r).toUint8Array()}catch(h){if(h instanceof mh)return Wn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new ua(c,s,a)}catch(h){return Wn(h instanceof Dr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((a=>{const c=this.Ge.ht(),l=`projects/${c.projectId}/databases/${c.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.et(t,a,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((a,c)=>{const l=this.ot(c);if(l){if(a.current&&Po(l.target)){const h=new j(l.target.path);this.It(h).has(c)||this.Et(c,h)||this.et(c,h,$e.newNoDocument(h,e))}a.Be&&(t.set(c,a.ke()),a.qe())}}));let r=J();this.He.forEach(((a,c)=>{let l=!0;c.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(a))})),this.je.forEach(((a,c)=>c.setReadTime(e)));const s=new vi(e,t,this.Ye,this.je,r);return this.je=Ot(),this.Je=Ts(),this.He=Ts(),this.Ye=new _e(X),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Pu,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Ce(X),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Ce(X),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||M("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Pu),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ts(){return new _e(j.comparator)}function Cu(){return new _e(j.comparator)}const Yy={asc:"ASCENDING",desc:"DESCENDING"},Xy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Jy={and:"AND",or:"OR"};class Zy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ko(n,e){return n.useProto3Json||di(e)?e:{value:e}}function Xs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ev(n,e){return Xs(n,e.toTimestamp())}function _t(n){return oe(!!n,49232),H.fromTimestamp((function(t){const r=nn(t);return new fe(r.seconds,r.nanos)})(n))}function la(n,e){return Do(n,e).canonicalString()}function Do(n,e){const t=(function(s){return new de(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Wh(n){const e=de.fromString(n);return oe(Xh(e),10190,{key:e.toString()}),e}function Vo(n,e){return la(n.databaseId,e.path)}function io(n,e){const t=Wh(e);if(t.get(1)!==n.databaseId.projectId)throw new x(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new j(Kh(t))}function Gh(n,e){return la(n.databaseId,e)}function tv(n){const e=Wh(n);return e.length===4?de.emptyPath():Kh(e)}function No(n){return new de(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Kh(n){return oe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ku(n,e,t){return{name:Vo(n,e),fields:t.value.mapValue.fields}}function nv(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:$(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],a=(function(f,m){return f.useProto3Json?(oe(m===void 0||typeof m=="string",58123),xe.fromBase64String(m||"")):(oe(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),xe.fromUint8Array(m||new Uint8Array))})(n,e.targetChange.resumeToken),c=e.targetChange.cause,l=c&&(function(f){const m=f.code===void 0?V.UNKNOWN:qh(f.code);return new x(m,f.message||"")})(c);t=new zh(r,s,a,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=io(n,r.document.name),a=_t(r.document.updateTime),c=r.document.createTime?_t(r.document.createTime):H.min(),l=new st({mapValue:{fields:r.document.fields}}),h=$e.newFoundDocument(s,a,c,l),f=r.targetIds||[],m=r.removedTargetIds||[];t=new Ns(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=io(n,r.document),a=r.readTime?_t(r.readTime):H.min(),c=$e.newNoDocument(s,a),l=r.removedTargetIds||[];t=new Ns([],l,c.key,c)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=io(n,r.document),a=r.removedTargetIds||[];t=new Ns([],a,s,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:a}=r,c=new Hy(s,a),l=r.targetId;t=new $h(l,c)}}return t}function rv(n,e){let t;if(e instanceof ts)t={update:ku(n,e.key,e.value)};else if(e instanceof jh)t={delete:Vo(n,e.key)};else if(e instanceof Cn)t={update:ku(n,e.key,e.data),updateMask:dv(e.fieldMask)};else{if(!(e instanceof qy))return $(16599,{Vt:e.type});t={verify:Vo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(a,c){const l=c.transform;if(l instanceof Qs)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Wr)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Gr)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ys)return{fieldPath:c.field.canonicalString(),increment:l.Ae};throw $(20930,{transform:c.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,a){return a.updateTime!==void 0?{updateTime:ev(s,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:$(27497)})(n,e.precondition)),t}function sv(n,e){return n&&n.length>0?(oe(e!==void 0,14353),n.map((t=>(function(s,a){let c=s.updateTime?_t(s.updateTime):_t(a);return c.isEqual(H.min())&&(c=_t(a)),new Uy(c,s.transformResults||[])})(t,e)))):[]}function iv(n,e){return{documents:[Gh(n,e.path)]}}function ov(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Gh(n,s);const a=(function(f){if(f.length!==0)return Yh(Tt.create(f,"and"))})(e.filters);a&&(t.structuredQuery.where=a);const c=(function(f){if(f.length!==0)return f.map((m=>(function(I){return{field:xn(I.field),direction:uv(I.dir)}})(m)))})(e.orderBy);c&&(t.structuredQuery.orderBy=c);const l=ko(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:t,parent:s}}function av(n){let e=tv(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){oe(r===1,65062);const m=t.from[0];m.allDescendants?s=m.collectionId:e=e.child(m.collectionId)}let a=[];t.where&&(a=(function(T){const I=Qh(T);return I instanceof Tt&&Rh(I)?I.getFilters():[I]})(t.where));let c=[];t.orderBy&&(c=(function(T){return T.map((I=>(function(D){return new Ks(Fn(D.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(I)))})(t.orderBy));let l=null;t.limit&&(l=(function(T){let I;return I=typeof T=="object"?T.value:T,di(I)?null:I})(t.limit));let h=null;t.startAt&&(h=(function(T){const I=!!T.before,b=T.values||[];return new Gs(b,I)})(t.startAt));let f=null;return t.endAt&&(f=(function(T){const I=!T.before,b=T.values||[];return new Gs(b,I)})(t.endAt)),Ry(e,s,c,a,l,"F",h,f)}function cv(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Qh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Fn(t.unaryFilter.field);return be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Fn(t.unaryFilter.field);return be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Fn(t.unaryFilter.field);return be.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=Fn(t.unaryFilter.field);return be.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return be.create(Fn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Tt.create(t.compositeFilter.filters.map((r=>Qh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function uv(n){return Yy[n]}function lv(n){return Xy[n]}function hv(n){return Jy[n]}function xn(n){return{fieldPath:n.canonicalString()}}function Fn(n){return Le.fromServerFormat(n.fieldPath)}function Yh(n){return n instanceof be?(function(t){if(t.op==="=="){if(_u(t.value))return{unaryFilter:{field:xn(t.field),op:"IS_NAN"}};if(gu(t.value))return{unaryFilter:{field:xn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(_u(t.value))return{unaryFilter:{field:xn(t.field),op:"IS_NOT_NAN"}};if(gu(t.value))return{unaryFilter:{field:xn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xn(t.field),op:lv(t.op),value:t.value}}})(n):n instanceof Tt?(function(t){const r=t.getFilters().map((s=>Yh(s)));return r.length===1?r[0]:{compositeFilter:{op:hv(t.op),filters:r}}})(n):$(54877,{filter:n})}function dv(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Xh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Qt{constructor(e,t,r,s,a=H.min(),c=H.min(),l=xe.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new Qt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Qt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Qt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Qt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fv{constructor(e){this.yt=e}}function pv(n){const e=av({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Co(e,e.limit,"L"):e}class mv{constructor(){this.Cn=new gv}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(tn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(tn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class gv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Ce(de.comparator),a=!s.has(r);return this.index[t]=s.add(r),a}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ce(de.comparator)).toArray()}}const Du={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Jh=41943040;class Qe{static withCacheSize(e){return new Qe(e,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Qe.DEFAULT_COLLECTION_PERCENTILE=10,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qe.DEFAULT=new Qe(Jh,Qe.DEFAULT_COLLECTION_PERCENTILE,Qe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qe.DISABLED=new Qe(-1,0,0);class Yn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Yn(0)}static cr(){return new Yn(-1)}}const Vu="LruGarbageCollector",_v=1048576;function Nu([n,e],[t,r]){const s=X(n,t);return s===0?X(e,r):s}class yv{constructor(e){this.Ir=e,this.buffer=new Ce(Nu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Nu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class vv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){M(Vu,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){rr(t)?M(Vu,"Ignoring IndexedDB error during garbage collection: ",t):await nr(t)}await this.Vr(3e5)}))}}class Ev{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return C.resolve(hi.ce);const r=new yv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(M("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Du)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(M("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Du):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,a,c,l,h,f;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((T=>(T>this.params.maximumSequenceNumbersToCollect?(M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),s=this.params.maximumSequenceNumbersToCollect):s=T,c=Date.now(),this.nthSequenceNumber(e,s)))).next((T=>(r=T,l=Date.now(),this.removeTargets(e,r,t)))).next((T=>(a=T,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((T=>(f=Date.now(),Mn()<=Y.DEBUG&&M("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-m}ms
	Determined least recently used ${s} in `+(l-c)+`ms
	Removed ${a} targets in `+(h-l)+`ms
	Removed ${T} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:a,documentsRemoved:T}))))}}function Tv(n,e){return new Ev(n,e)}class Iv{constructor(){this.changes=new Pn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$e.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class wv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Av{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Fr(r.mutation,s,ct.empty(),fe.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,J()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=J()){const s=_n();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((a=>{let c=kr();return a.forEach(((l,h)=>{c=c.insert(l,h.overlayedDocument)})),c}))))}getOverlayedDocuments(e,t){const r=_n();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,J())))}populateOverlays(e,t,r){const s=[];return r.forEach((a=>{t.has(a)||s.push(a)})),this.documentOverlayCache.getOverlays(e,s).next((a=>{a.forEach(((c,l)=>{t.set(c,l)}))}))}computeViews(e,t,r,s){let a=Ot();const c=xr(),l=(function(){return xr()})();return t.forEach(((h,f)=>{const m=r.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof Cn)?a=a.insert(f.key,f):m!==void 0?(c.set(f.key,m.mutation.getFieldMask()),Fr(m.mutation,f,m.mutation.getFieldMask(),fe.now())):c.set(f.key,ct.empty())})),this.recalculateAndSaveOverlays(e,a).next((h=>(h.forEach(((f,m)=>c.set(f,m))),t.forEach(((f,m)=>l.set(f,new wv(m,c.get(f)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=xr();let s=new _e(((c,l)=>c-l)),a=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((c=>{for(const l of c)l.keys().forEach((h=>{const f=t.get(h);if(f===null)return;let m=r.get(h)||ct.empty();m=l.applyToLocalView(f,m),r.set(h,m);const T=(s.get(l.batchId)||J()).add(h);s=s.insert(l.batchId,T)}))})).next((()=>{const c=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),f=h.key,m=h.value,T=Nh();m.forEach((I=>{if(!a.has(I)){const b=Uh(t.get(I),r.get(I));b!==null&&T.set(I,b),a=a.add(I)}})),c.push(this.documentOverlayCache.saveOverlays(e,f,T))}return C.waitFor(c)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(c){return j.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((a=>{const c=s-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-a.size):C.resolve(_n());let l=qr,h=a;return c.next((f=>C.forEach(f,((m,T)=>(l<T.largestBatchId&&(l=T.largestBatchId),a.get(m)?C.resolve():this.remoteDocumentCache.getEntry(e,m).next((I=>{h=h.insert(m,I)}))))).next((()=>this.populateOverlays(e,f,a))).next((()=>this.computeViews(e,h,f,J()))).next((m=>({batchId:l,changes:Vh(m)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next((r=>{let s=kr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const a=t.collectionGroup;let c=kr();return this.indexManager.getCollectionParents(e,a).next((l=>C.forEach(l,(h=>{const f=(function(T,I){return new pi(I,null,T.explicitOrderBy.slice(),T.filters.slice(),T.limit,T.limitType,T.startAt,T.endAt)})(t,h.child(a));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next((m=>{m.forEach(((T,I)=>{c=c.insert(T,I)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let a;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((c=>(a=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,a,s)))).next((c=>{a.forEach(((h,f)=>{const m=f.getKey();c.get(m)===null&&(c=c.insert(m,$e.newInvalidDocument(m)))}));let l=kr();return c.forEach(((h,f)=>{const m=a.get(h);m!==void 0&&Fr(m.mutation,f,ct.empty(),fe.now()),gi(t,f)&&(l=l.insert(h,f))})),l}))}}class Rv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:_t(s.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:pv(s.bundledQuery),readTime:_t(s.readTime)}})(t)),C.resolve()}}class Sv{constructor(){this.overlays=new _e(j.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){const r=_n();return C.forEach(t,(s=>this.getOverlay(e,s).next((a=>{a!==null&&r.set(s,a)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,a)=>{this.St(e,t,a)})),C.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((a=>this.overlays=this.overlays.remove(a))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){const s=_n(),a=t.length+1,c=new j(t.child("")),l=this.overlays.getIteratorFrom(c);for(;l.hasNext();){const h=l.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===a&&h.largestBatchId>r&&s.set(h.getKey(),h)}return C.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let a=new _e(((f,m)=>f-m));const c=this.overlays.getIterator();for(;c.hasNext();){const f=c.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=a.get(f.largestBatchId);m===null&&(m=_n(),a=a.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const l=_n(),h=a.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,m)=>l.set(f,m))),!(l.size()>=s)););return C.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const c=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new zy(t,r));let a=this.qr.get(t);a===void 0&&(a=J(),this.qr.set(t,a)),this.qr.set(t,a.add(r.key))}}class bv{constructor(){this.sessionToken=xe.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}class ha{constructor(){this.Qr=new Ce(Ve.$r),this.Ur=new Ce(Ve.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Ve(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Ve(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new j(new de([])),r=new Ve(t,e),s=new Ve(t,e+1),a=[];return this.Ur.forEachInRange([r,s],(c=>{this.Gr(c),a.push(c.key)})),a}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new j(new de([])),r=new Ve(t,e),s=new Ve(t,e+1);let a=J();return this.Ur.forEachInRange([r,s],(c=>{a=a.add(c.key)})),a}containsKey(e){const t=new Ve(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ve{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return j.comparator(e.key,t.key)||X(e.Yr,t.Yr)}static Kr(e,t){return X(e.Yr,t.Yr)||j.comparator(e.key,t.key)}}class Pv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Ce(Ve.$r)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const a=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new $y(a,t,r,s);this.mutationQueue.push(c);for(const l of s)this.Zr=this.Zr.add(new Ve(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return C.resolve(c)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),a=s<0?0:s;return C.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?ta:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ve(t,0),s=new Ve(t,Number.POSITIVE_INFINITY),a=[];return this.Zr.forEachInRange([r,s],(c=>{const l=this.Xr(c.Yr);a.push(l)})),C.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ce(X);return t.forEach((s=>{const a=new Ve(s,0),c=new Ve(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([a,c],(l=>{r=r.add(l.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let a=r;j.isDocumentKey(a)||(a=a.child(""));const c=new Ve(new j(a),0);let l=new Ce(X);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.Yr)),!0)}),c),C.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){oe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(t.mutations,(s=>{const a=new Ve(s.key,t.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Ve(t,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Cv{constructor(e){this.ri=e,this.docs=(function(){return new _e(j.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),a=s?s.size:0,c=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:c}),this.size+=c-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():$e.newInvalidDocument(t))}getEntries(e,t){let r=Ot();return t.forEach((s=>{const a=this.docs.get(s);r=r.insert(s,a?a.document.mutableCopy():$e.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let a=Ot();const c=t.path,l=new j(c.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!c.isPrefixOf(f.path))break;f.path.length>c.length+1||ry(ny(m),r)<=0||(s.has(m.key)||gi(t,m))&&(a=a.insert(m.key,m.mutableCopy()))}return C.resolve(a)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ii(e,t){return C.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new kv(this)}getSize(e){return C.resolve(this.size)}}class kv extends Iv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),C.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Dv{constructor(e){this.persistence=e,this.si=new Pn((t=>sa(t)),ia),this.lastRemoteSnapshotVersion=H.min(),this.highestTargetId=0,this.oi=0,this._i=new ha,this.targetCount=0,this.ai=Yn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Yn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let s=0;const a=[];return this.si.forEach(((c,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(c),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),C.waitFor(a).next((()=>s))}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,a=[];return s&&t.forEach((c=>{a.push(s.markPotentiallyOrphaned(e,c))})),C.waitFor(a)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}}class Zh{constructor(e,t){this.ui={},this.overlays={},this.ci=new hi(0),this.li=!1,this.li=!0,this.hi=new bv,this.referenceDelegate=e(this),this.Pi=new Dv(this),this.indexManager=new mv,this.remoteDocumentCache=(function(s){return new Cv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new fv(t),this.Ii=new Rv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Sv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Pv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){M("MemoryPersistence","Starting transaction:",e);const s=new Vv(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((a=>this.referenceDelegate.di(s).next((()=>a)))).toPromise().then((a=>(s.raiseOnCommittedEvent(),a)))}Ai(e,t){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class Vv extends iy{constructor(e){super(),this.currentSequenceNumber=e}}class da{constructor(e){this.persistence=e,this.Ri=new ha,this.Vi=null}static mi(e){return new da(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((a=>this.fi.add(a.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=j.fromPath(r);return this.gi(e,s).next((a=>{a||t.removeEntry(s,H.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Js{constructor(e,t){this.persistence=e,this.pi=new Pn((r=>cy(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Tv(this,t)}static mi(e,t){return new Js(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return C.forEach(this.pi,((r,s)=>this.br(e,r,s).next((a=>a?C.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),a=s.newChangeBuffer();return s.ii(e,(c=>this.br(e,c,t).next((l=>{l||(r++,a.removeEntry(c,H.min()))})))).next((()=>a.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ks(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fa{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=J(),s=J();for(const a of t.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:s=s.add(a.doc.key)}return new fa(e,t.fromCache,r,s)}}class Nv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ov{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return up()?8:oy(ze())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const a={result:null};return this.ys(e,t).next((c=>{a.result=c})).next((()=>{if(!a.result)return this.ws(e,t,s,r).next((c=>{a.result=c}))})).next((()=>{if(a.result)return;const c=new Nv;return this.Ss(e,t,c).next((l=>{if(a.result=l,this.Vs)return this.bs(e,t,c,l.size)}))})).next((()=>a.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Mn()<=Y.DEBUG&&M("QueryEngine","SDK will not create cache indexes for query:",Ln(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(Mn()<=Y.DEBUG&&M("QueryEngine","Query:",Ln(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Mn()<=Y.DEBUG&&M("QueryEngine","The SDK decides to create cache indexes for query:",Ln(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gt(t))):C.resolve())}ys(e,t){if(Tu(t))return C.resolve(null);let r=gt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Co(t,null,"F"),r=gt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((a=>{const c=J(...a);return this.ps.getDocuments(e,c).next((l=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(t,l);return this.Cs(t,f,c,h.readTime)?this.ys(e,Co(t,null,"F")):this.vs(e,f,t,h)}))))})))))}ws(e,t,r,s){return Tu(t)||s.isEqual(H.min())?C.resolve(null):this.ps.getDocuments(e,r).next((a=>{const c=this.Ds(t,a);return this.Cs(t,c,r,s)?C.resolve(null):(Mn()<=Y.DEBUG&&M("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ln(t)),this.vs(e,c,t,ty(s,qr)).next((l=>l)))}))}Ds(e,t){let r=new Ce(kh(e));return t.forEach(((s,a)=>{gi(e,a)&&(r=r.add(a))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const a=e.limitType==="F"?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(s)>0)}Ss(e,t,r){return Mn()<=Y.DEBUG&&M("QueryEngine","Using full collection scan to execute query:",Ln(t)),this.ps.getDocumentsMatchingQuery(e,t,tn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((a=>(t.forEach((c=>{a=a.insert(c.key,c)})),a)))}}const pa="LocalStore",Mv=3e8;class Lv{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new _e(X),this.xs=new Pn((a=>sa(a)),ia),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Av(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function xv(n,e,t,r){return new Lv(n,e,t,r)}async function ed(n,e){const t=W(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((a=>(s=a,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((a=>{const c=[],l=[];let h=J();for(const f of s){c.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of a){l.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:c,addedBatchIds:l})))}))}))}function Fv(n,e){const t=W(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),a=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,f,m){const T=f.batch,I=T.keys();let b=C.resolve();return I.forEach((D=>{b=b.next((()=>m.getEntry(h,D))).next((N=>{const k=f.docVersions.get(D);oe(k!==null,48541),N.version.compareTo(k)<0&&(T.applyToRemoteDocument(N,f),N.isValidDocument()&&(N.setReadTime(f.commitVersion),m.addEntry(N)))}))})),b.next((()=>l.mutationQueue.removeMutationBatch(h,T)))})(t,r,e,a).next((()=>a.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=J();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function td(n){const e=W(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Uv(n,e){const t=W(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(a=>{const c=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((m,T)=>{const I=s.get(T);if(!I)return;l.push(t.Pi.removeMatchingKeys(a,m.removedDocuments,T).next((()=>t.Pi.addMatchingKeys(a,m.addedDocuments,T))));let b=I.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(T)!==null?b=b.withResumeToken(xe.EMPTY_BYTE_STRING,H.min()).withLastLimboFreeSnapshotVersion(H.min()):m.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(m.resumeToken,r)),s=s.insert(T,b),(function(N,k,B){return N.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=Mv?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0})(I,b,m)&&l.push(t.Pi.updateTargetData(a,b))}));let h=Ot(),f=J();if(e.documentUpdates.forEach((m=>{e.resolvedLimboDocuments.has(m)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(a,m))})),l.push(Bv(a,c,e.documentUpdates).next((m=>{h=m.ks,f=m.qs}))),!r.isEqual(H.min())){const m=t.Pi.getLastRemoteSnapshotVersion(a).next((T=>t.Pi.setTargetsMetadata(a,a.currentSequenceNumber,r)));l.push(m)}return C.waitFor(l).next((()=>c.apply(a))).next((()=>t.localDocuments.getLocalViewOfDocuments(a,h,f))).next((()=>h))})).then((a=>(t.Ms=s,a)))}function Bv(n,e,t){let r=J(),s=J();return t.forEach((a=>r=r.add(a))),e.getEntries(n,r).next((a=>{let c=Ot();return t.forEach(((l,h)=>{const f=a.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(H.min())?(e.removeEntry(l,h.readTime),c=c.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),c=c.insert(l,h)):M(pa,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)})),{ks:c,qs:s}}))}function jv(n,e){const t=W(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=ta),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function qv(n,e){const t=W(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((a=>a?(s=a,C.resolve(s)):t.Pi.allocateTargetId(r).next((c=>(s=new Qt(e,c,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Oo(n,e,t){const r=W(n),s=r.Ms.get(e),a=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",a,(c=>r.persistence.referenceDelegate.removeTarget(c,s)))}catch(c){if(!rr(c))throw c;M(pa,`Failed to update sequence numbers for target ${e}: ${c}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Ou(n,e,t){const r=W(n);let s=H.min(),a=J();return r.persistence.runTransaction("Execute query","readwrite",(c=>(function(h,f,m){const T=W(h),I=T.xs.get(m);return I!==void 0?C.resolve(T.Ms.get(I)):T.Pi.getTargetData(f,m)})(r,c,gt(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(c,l.targetId).next((h=>{a=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(c,e,t?s:H.min(),t?a:J()))).next((l=>($v(r,Py(e),l),{documents:l,Qs:a})))))}function $v(n,e,t){let r=n.Os.get(e)||H.min();t.forEach(((s,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)})),n.Os.set(e,r)}class Mu{constructor(){this.activeTargetIds=Oy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zv{constructor(){this.Mo=new Mu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Mu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Hv{Oo(e){}shutdown(){}}const Lu="ConnectivityMonitor";class xu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){M(Lu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){M(Lu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Is=null;function Mo(){return Is===null?Is=(function(){return 268435456+Math.round(2147483648*Math.random())})():Is++,"0x"+Is.toString(16)}const oo="RestConnection",Wv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Gv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Hs?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,a){const c=Mo(),l=this.zo(e,t.toUriEncodedString());M(oo,`Sending RPC '${e}' ${c}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,a);const{host:f}=new URL(l),m=Jn(f);return this.Jo(e,l,h,r,m).then((T=>(M(oo,`Received RPC '${e}' ${c}: `,T),T)),(T=>{throw Wn(oo,`RPC '${e}' ${c} failed with error: `,T,"url: ",l,"request:",r),T}))}Ho(e,t,r,s,a,c){return this.Go(e,t,r,s,a)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+tr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,a)=>e[a]=s)),r&&r.headers.forEach(((s,a)=>e[a]=s))}zo(e,t){const r=Wv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class Kv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Be="WebChannelConnection";class Qv extends Gv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,a){const c=Mo();return new Promise(((l,h)=>{const f=new sh;f.setWithCredentials(!0),f.listenOnce(ih.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case Cs.NO_ERROR:const T=f.getResponseJson();M(Be,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(T)),l(T);break;case Cs.TIMEOUT:M(Be,`RPC '${e}' ${c} timed out`),h(new x(V.DEADLINE_EXCEEDED,"Request time out"));break;case Cs.HTTP_ERROR:const I=f.getStatus();if(M(Be,`RPC '${e}' ${c} failed with status:`,I,"response text:",f.getResponseText()),I>0){let b=f.getResponseJson();Array.isArray(b)&&(b=b[0]);const D=b?.error;if(D&&D.status&&D.message){const N=(function(B){const F=B.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(F)>=0?F:V.UNKNOWN})(D.status);h(new x(N,D.message))}else h(new x(V.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new x(V.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:c,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{M(Be,`RPC '${e}' ${c} completed.`)}}));const m=JSON.stringify(s);M(Be,`RPC '${e}' ${c} sending request:`,s),f.send(t,"POST",m,r,15)}))}T_(e,t,r){const s=Mo(),a=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=ch(),l=ah(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const m=a.join("");M(Be,`Creating RPC '${e}' stream ${s}: ${m}`,h);const T=c.createWebChannel(m,h);this.I_(T);let I=!1,b=!1;const D=new Kv({Yo:k=>{b?M(Be,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(I||(M(Be,`Opening RPC '${e}' stream ${s} transport.`),T.open(),I=!0),M(Be,`RPC '${e}' stream ${s} sending:`,k),T.send(k))},Zo:()=>T.close()}),N=(k,B,F)=>{k.listen(B,(L=>{try{F(L)}catch(U){setTimeout((()=>{throw U}),0)}}))};return N(T,Cr.EventType.OPEN,(()=>{b||(M(Be,`RPC '${e}' stream ${s} transport opened.`),D.o_())})),N(T,Cr.EventType.CLOSE,(()=>{b||(b=!0,M(Be,`RPC '${e}' stream ${s} transport closed`),D.a_(),this.E_(T))})),N(T,Cr.EventType.ERROR,(k=>{b||(b=!0,Wn(Be,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),D.a_(new x(V.UNAVAILABLE,"The operation could not be completed")))})),N(T,Cr.EventType.MESSAGE,(k=>{if(!b){const B=k.data[0];oe(!!B,16349);const F=B,L=F?.error||F[0]?.error;if(L){M(Be,`RPC '${e}' stream ${s} received error:`,L);const U=L.status;let z=(function(_){const g=Ae[_];if(g!==void 0)return qh(g)})(U),G=L.message;z===void 0&&(z=V.INTERNAL,G="Unknown error status: "+U+" with message "+L.message),b=!0,D.a_(new x(z,G)),T.close()}else M(Be,`RPC '${e}' stream ${s} received:`,B),D.u_(B)}})),N(l,oh.STAT_EVENT,(k=>{k.stat===wo.PROXY?M(Be,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===wo.NOPROXY&&M(Be,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{D.__()}),0),D}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function ao(){return typeof document<"u"?document:null}function Ei(n){return new Zy(n,!0)}class nd{constructor(e,t,r=1e3,s=1.5,a=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=a,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&M("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Fu="PersistentStream";class rd{constructor(e,t,r,s,a,c,l,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=a,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new nd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(Nt(t.toString()),Nt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new x(V.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return M(Fu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(M(Fu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Yv extends rd{constructor(e,t,r,s,a,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,c),this.serializer=a}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=nv(this.serializer,e),r=(function(a){if(!("targetChange"in a))return H.min();const c=a.targetChange;return c.targetIds&&c.targetIds.length?H.min():c.readTime?_t(c.readTime):H.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=No(this.serializer),t.addTarget=(function(a,c){let l;const h=c.target;if(l=Po(h)?{documents:iv(a,h)}:{query:ov(a,h).ft},l.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){l.resumeToken=Hh(a,c.resumeToken);const f=ko(a,c.expectedCount);f!==null&&(l.expectedCount=f)}else if(c.snapshotVersion.compareTo(H.min())>0){l.readTime=Xs(a,c.snapshotVersion.toTimestamp());const f=ko(a,c.expectedCount);f!==null&&(l.expectedCount=f)}return l})(this.serializer,e);const r=cv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=No(this.serializer),t.removeTarget=e,this.q_(t)}}class Xv extends rd{constructor(e,t,r,s,a,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,c),this.serializer=a}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return oe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,oe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){oe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=sv(e.writeResults,e.commitTime),r=_t(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=No(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>rv(this.serializer,r)))};this.q_(t)}}class Jv{}class Zv extends Jv{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new x(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Go(e,Do(t,r),s,a,c))).catch((a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(V.UNKNOWN,a.toString())}))}Ho(e,t,r,s,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,l])=>this.connection.Ho(e,Do(t,r),s,c,l,a))).catch((c=>{throw c.name==="FirebaseError"?(c.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new x(V.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class eE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Nt(t),this.aa=!1):M("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Rn="RemoteStore";class tE{constructor(e,t,r,s,a){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=a,this.Aa.Oo((c=>{r.enqueueAndForget((async()=>{kn(this)&&(M(Rn,"Restarting streams for network reachability change."),await(async function(h){const f=W(h);f.Ea.add(4),await rs(f),f.Ra.set("Unknown"),f.Ea.delete(4),await Ti(f)})(this))}))})),this.Ra=new eE(r,s)}}async function Ti(n){if(kn(n))for(const e of n.da)await e(!0)}async function rs(n){for(const e of n.da)await e(!1)}function sd(n,e){const t=W(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ya(t)?_a(t):sr(t).O_()&&ga(t,e))}function ma(n,e){const t=W(n),r=sr(t);t.Ia.delete(e),r.O_()&&id(t,e),t.Ia.size===0&&(r.O_()?r.L_():kn(t)&&t.Ra.set("Unknown"))}function ga(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(H.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}sr(n).Y_(e)}function id(n,e){n.Va.Ue(e),sr(n).Z_(e)}function _a(n){n.Va=new Qy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),sr(n).start(),n.Ra.ua()}function ya(n){return kn(n)&&!sr(n).x_()&&n.Ia.size>0}function kn(n){return W(n).Ea.size===0}function od(n){n.Va=void 0}async function nE(n){n.Ra.set("Online")}async function rE(n){n.Ia.forEach(((e,t)=>{ga(n,e)}))}async function sE(n,e){od(n),ya(n)?(n.Ra.ha(e),_a(n)):n.Ra.set("Unknown")}async function iE(n,e,t){if(n.Ra.set("Online"),e instanceof zh&&e.state===2&&e.cause)try{await(async function(s,a){const c=a.cause;for(const l of a.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,c),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){M(Rn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Zs(n,r)}else if(e instanceof Ns?n.Va.Ze(e):e instanceof $h?n.Va.st(e):n.Va.tt(e),!t.isEqual(H.min()))try{const r=await td(n.localStore);t.compareTo(r)>=0&&await(function(a,c){const l=a.Va.Tt(c);return l.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=a.Ia.get(f);m&&a.Ia.set(f,m.withResumeToken(h.resumeToken,c))}})),l.targetMismatches.forEach(((h,f)=>{const m=a.Ia.get(h);if(!m)return;a.Ia.set(h,m.withResumeToken(xe.EMPTY_BYTE_STRING,m.snapshotVersion)),id(a,h);const T=new Qt(m.target,h,f,m.sequenceNumber);ga(a,T)})),a.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){M(Rn,"Failed to raise snapshot:",r),await Zs(n,r)}}async function Zs(n,e,t){if(!rr(e))throw e;n.Ea.add(1),await rs(n),n.Ra.set("Offline"),t||(t=()=>td(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{M(Rn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ti(n)}))}function ad(n,e){return e().catch((t=>Zs(n,t,e)))}async function Ii(n){const e=W(n),t=on(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ta;for(;oE(e);)try{const s=await jv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,aE(e,s)}catch(s){await Zs(e,s)}cd(e)&&ud(e)}function oE(n){return kn(n)&&n.Ta.length<10}function aE(n,e){n.Ta.push(e);const t=on(n);t.O_()&&t.X_&&t.ea(e.mutations)}function cd(n){return kn(n)&&!on(n).x_()&&n.Ta.length>0}function ud(n){on(n).start()}async function cE(n){on(n).ra()}async function uE(n){const e=on(n);for(const t of n.Ta)e.ea(t.mutations)}async function lE(n,e,t){const r=n.Ta.shift(),s=ca.from(r,e,t);await ad(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Ii(n)}async function hE(n,e){e&&on(n).X_&&await(async function(r,s){if((function(c){return Wy(c)&&c!==V.ABORTED})(s.code)){const a=r.Ta.shift();on(r).B_(),await ad(r,(()=>r.remoteSyncer.rejectFailedWrite(a.batchId,s))),await Ii(r)}})(n,e),cd(n)&&ud(n)}async function Uu(n,e){const t=W(n);t.asyncQueue.verifyOperationInProgress(),M(Rn,"RemoteStore received new credentials");const r=kn(t);t.Ea.add(3),await rs(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ti(t)}async function dE(n,e){const t=W(n);e?(t.Ea.delete(2),await Ti(t)):e||(t.Ea.add(2),await rs(t),t.Ra.set("Unknown"))}function sr(n){return n.ma||(n.ma=(function(t,r,s){const a=W(t);return a.sa(),new Yv(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)})(n.datastore,n.asyncQueue,{Xo:nE.bind(null,n),t_:rE.bind(null,n),r_:sE.bind(null,n),H_:iE.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ya(n)?_a(n):n.Ra.set("Unknown")):(await n.ma.stop(),od(n))}))),n.ma}function on(n){return n.fa||(n.fa=(function(t,r,s){const a=W(t);return a.sa(),new Xv(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:cE.bind(null,n),r_:hE.bind(null,n),ta:uE.bind(null,n),na:lE.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Ii(n)):(await n.fa.stop(),n.Ta.length>0&&(M(Rn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class va{constructor(e,t,r,s,a){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=a,this.deferred=new Ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,a){const c=Date.now()+r,l=new va(e,t,c,s,a);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ea(n,e){if(Nt("AsyncQueue",`${e}: ${n}`),rr(n))return new x(V.UNAVAILABLE,`${e}: ${n}`);throw n}class $n{static emptySet(e){return new $n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||j.comparator(t.key,r.key):(t,r)=>j.comparator(t.key,r.key),this.keyedMap=kr(),this.sortedSet=new _e(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $n)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,a=r.getNext().key;if(!s.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new $n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Bu{constructor(){this.ga=new _e(j.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Xn{constructor(e,t,r,s,a,c,l,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=a,this.fromCache=c,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,s,a){const c=[];return t.forEach((l=>{c.push({type:0,doc:l})})),new Xn(e,t,$n.emptySet(t),c,r,s,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class fE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class pE{constructor(){this.queries=ju(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=W(t),a=s.queries;s.queries=ju(),a.forEach(((c,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new x(V.ABORTED,"Firestore shutting down"))}}function ju(){return new Pn((n=>Ch(n)),mi)}async function ld(n,e){const t=W(n);let r=3;const s=e.query;let a=t.queries.get(s);a?!a.ba()&&e.Da()&&(r=2):(a=new fE,r=e.Da()?0:1);try{switch(r){case 0:a.wa=await t.onListen(s,!0);break;case 1:a.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(c){const l=Ea(c,`Initialization of query '${Ln(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,a),a.Sa.push(e),e.va(t.onlineState),a.wa&&e.Fa(a.wa)&&Ta(t)}async function hd(n,e){const t=W(n),r=e.query;let s=3;const a=t.queries.get(r);if(a){const c=a.Sa.indexOf(e);c>=0&&(a.Sa.splice(c,1),a.Sa.length===0?s=e.Da()?0:1:!a.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function mE(n,e){const t=W(n);let r=!1;for(const s of e){const a=s.query,c=t.queries.get(a);if(c){for(const l of c.Sa)l.Fa(s)&&(r=!0);c.wa=s}}r&&Ta(t)}function gE(n,e,t){const r=W(n),s=r.queries.get(e);if(s)for(const a of s.Sa)a.onError(t);r.queries.delete(e)}function Ta(n){n.Ca.forEach((e=>{e.next()}))}var Lo,qu;(qu=Lo||(Lo={})).Ma="default",qu.Cache="cache";class dd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Xn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Xn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Lo.Cache}}class fd{constructor(e){this.key=e}}class pd{constructor(e){this.key=e}}class _E{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=kh(e),this.tu=new $n(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Bu,s=t?t.tu:this.tu;let a=t?t.mutatedKeys:this.mutatedKeys,c=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((m,T)=>{const I=s.get(m),b=gi(this.query,T)?T:null,D=!!I&&this.mutatedKeys.has(I.key),N=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let k=!1;I&&b?I.data.isEqual(b.data)?D!==N&&(r.track({type:3,doc:b}),k=!0):this.su(I,b)||(r.track({type:2,doc:b}),k=!0,(h&&this.eu(b,h)>0||f&&this.eu(b,f)<0)&&(l=!0)):!I&&b?(r.track({type:0,doc:b}),k=!0):I&&!b&&(r.track({type:1,doc:I}),k=!0,(h||f)&&(l=!0)),k&&(b?(c=c.add(b),a=N?a.add(m):a.delete(m)):(c=c.delete(m),a=a.delete(m)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const m=this.query.limitType==="F"?c.last():c.first();c=c.delete(m.key),a=a.delete(m.key),r.track({type:1,doc:m})}return{tu:c,iu:r,Cs:l,mutatedKeys:a}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const a=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((m,T)=>(function(b,D){const N=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:k})}};return N(b)-N(D)})(m.type,T.type)||this.eu(m.doc,T.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,c.length!==0||f?{snapshot:new Xn(this.query,e.tu,a,c,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Bu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=J(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new pd(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new fd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=J();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Xn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ia="SyncEngine";class yE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class vE{constructor(e){this.key=e,this.hu=!1}}class EE{constructor(e,t,r,s,a,c){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=a,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new Pn((l=>Ch(l)),mi),this.Iu=new Map,this.Eu=new Set,this.du=new _e(j.comparator),this.Au=new Map,this.Ru=new ha,this.Vu={},this.mu=new Map,this.fu=Yn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function TE(n,e,t=!0){const r=Ed(n);let s;const a=r.Tu.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),s=a.view.lu()):s=await md(r,e,t,!0),s}async function IE(n,e){const t=Ed(n);await md(t,e,!0,!1)}async function md(n,e,t,r){const s=await qv(n.localStore,gt(e)),a=s.targetId,c=n.sharedClientState.addLocalQueryTarget(a,t);let l;return r&&(l=await wE(n,e,a,c==="current",s.resumeToken)),n.isPrimaryClient&&t&&sd(n.remoteStore,s),l}async function wE(n,e,t,r,s){n.pu=(T,I,b)=>(async function(N,k,B,F){let L=k.view.ru(B);L.Cs&&(L=await Ou(N.localStore,k.query,!1).then((({documents:w})=>k.view.ru(w,L))));const U=F&&F.targetChanges.get(k.targetId),z=F&&F.targetMismatches.get(k.targetId)!=null,G=k.view.applyChanges(L,N.isPrimaryClient,U,z);return zu(N,k.targetId,G.au),G.snapshot})(n,T,I,b);const a=await Ou(n.localStore,e,!0),c=new _E(e,a.Qs),l=c.ru(a.documents),h=ns.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),f=c.applyChanges(l,n.isPrimaryClient,h);zu(n,t,f.au);const m=new yE(e,t,c);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function AE(n,e,t){const r=W(n),s=r.Tu.get(e),a=r.Iu.get(s.targetId);if(a.length>1)return r.Iu.set(s.targetId,a.filter((c=>!mi(c,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Oo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ma(r.remoteStore,s.targetId),xo(r,s.targetId)})).catch(nr)):(xo(r,s.targetId),await Oo(r.localStore,s.targetId,!0))}async function RE(n,e){const t=W(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ma(t.remoteStore,r.targetId))}async function SE(n,e,t){const r=NE(n);try{const s=await(function(c,l){const h=W(c),f=fe.now(),m=l.reduce(((b,D)=>b.add(D.key)),J());let T,I;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let D=Ot(),N=J();return h.Ns.getEntries(b,m).next((k=>{D=k,D.forEach(((B,F)=>{F.isValidDocument()||(N=N.add(B))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,D))).next((k=>{T=k;const B=[];for(const F of l){const L=jy(F,T.get(F.key).overlayedDocument);L!=null&&B.push(new Cn(F.key,L,Ih(L.value.mapValue),kt.exists(!0)))}return h.mutationQueue.addMutationBatch(b,f,B,l)})).next((k=>{I=k;const B=k.applyToLocalDocumentSet(T,N);return h.documentOverlayCache.saveOverlays(b,k.batchId,B)}))})).then((()=>({batchId:I.batchId,changes:Vh(T)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(c,l,h){let f=c.Vu[c.currentUser.toKey()];f||(f=new _e(X)),f=f.insert(l,h),c.Vu[c.currentUser.toKey()]=f})(r,s.batchId,t),await ss(r,s.changes),await Ii(r.remoteStore)}catch(s){const a=Ea(s,"Failed to persist write");t.reject(a)}}async function gd(n,e){const t=W(n);try{const r=await Uv(t.localStore,e);e.targetChanges.forEach(((s,a)=>{const c=t.Au.get(a);c&&(oe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?c.hu=!0:s.modifiedDocuments.size>0?oe(c.hu,14607):s.removedDocuments.size>0&&(oe(c.hu,42227),c.hu=!1))})),await ss(t,r,e)}catch(r){await nr(r)}}function $u(n,e,t){const r=W(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((a,c)=>{const l=c.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(c,l){const h=W(c);h.onlineState=l;let f=!1;h.queries.forEach(((m,T)=>{for(const I of T.Sa)I.va(l)&&(f=!0)})),f&&Ta(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function bE(n,e,t){const r=W(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),a=s&&s.key;if(a){let c=new _e(j.comparator);c=c.insert(a,$e.newNoDocument(a,H.min()));const l=J().add(a),h=new vi(H.min(),new Map,new _e(X),c,l);await gd(r,h),r.du=r.du.remove(a),r.Au.delete(e),wa(r)}else await Oo(r.localStore,e,!1).then((()=>xo(r,e,t))).catch(nr)}async function PE(n,e){const t=W(n),r=e.batch.batchId;try{const s=await Fv(t.localStore,e);yd(t,r,null),_d(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await ss(t,s)}catch(s){await nr(s)}}async function CE(n,e,t){const r=W(n);try{const s=await(function(c,l){const h=W(c);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let m;return h.mutationQueue.lookupMutationBatch(f,l).next((T=>(oe(T!==null,37113),m=T.keys(),h.mutationQueue.removeMutationBatch(f,T)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m))).next((()=>h.localDocuments.getDocuments(f,m)))}))})(r.localStore,e);yd(r,e,t),_d(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await ss(r,s)}catch(s){await nr(s)}}function _d(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function yd(n,e,t){const r=W(n);let s=r.Vu[r.currentUser.toKey()];if(s){const a=s.get(e);a&&(t?a.reject(t):a.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function xo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||vd(n,r)}))}function vd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ma(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),wa(n))}function zu(n,e,t){for(const r of t)r instanceof fd?(n.Ru.addReference(r.key,e),kE(n,r)):r instanceof pd?(M(Ia,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||vd(n,r.key)):$(19791,{wu:r})}function kE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(M(Ia,"New document in limbo: "+t),n.Eu.add(r),wa(n))}function wa(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new j(de.fromString(e)),r=n.fu.next();n.Au.set(r,new vE(t)),n.du=n.du.insert(t,r),sd(n.remoteStore,new Qt(gt(oa(t.path)),r,"TargetPurposeLimboResolution",hi.ce))}}async function ss(n,e,t){const r=W(n),s=[],a=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{c.push(r.pu(h,e,t).then((f=>{if((f||t)&&r.isPrimaryClient){const m=f?!f.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,m?"current":"not-current")}if(f){s.push(f);const m=fa.As(h.targetId,f);a.push(m)}})))})),await Promise.all(c),r.Pu.H_(s),await(async function(h,f){const m=W(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(T=>C.forEach(f,(I=>C.forEach(I.Es,(b=>m.persistence.referenceDelegate.addReference(T,I.targetId,b))).next((()=>C.forEach(I.ds,(b=>m.persistence.referenceDelegate.removeReference(T,I.targetId,b)))))))))}catch(T){if(!rr(T))throw T;M(pa,"Failed to update sequence numbers: "+T)}for(const T of f){const I=T.targetId;if(!T.fromCache){const b=m.Ms.get(I),D=b.snapshotVersion,N=b.withLastLimboFreeSnapshotVersion(D);m.Ms=m.Ms.insert(I,N)}}})(r.localStore,a))}async function DE(n,e){const t=W(n);if(!t.currentUser.isEqual(e)){M(Ia,"User change. New user:",e.toKey());const r=await ed(t.localStore,e);t.currentUser=e,(function(a,c){a.mu.forEach((l=>{l.forEach((h=>{h.reject(new x(V.CANCELLED,c))}))})),a.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ss(t,r.Ls)}}function VE(n,e){const t=W(n),r=t.Au.get(e);if(r&&r.hu)return J().add(r.key);{let s=J();const a=t.Iu.get(e);if(!a)return s;for(const c of a){const l=t.Tu.get(c);s=s.unionWith(l.view.nu)}return s}}function Ed(n){const e=W(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=VE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bE.bind(null,e),e.Pu.H_=mE.bind(null,e.eventManager),e.Pu.yu=gE.bind(null,e.eventManager),e}function NE(n){const e=W(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=PE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=CE.bind(null,e),e}class ei{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ei(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return xv(this.persistence,new Ov,e.initialUser,this.serializer)}Cu(e){return new Zh(da.mi,this.serializer)}Du(e){return new zv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ei.provider={build:()=>new ei};class OE extends ei{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){oe(this.persistence.referenceDelegate instanceof Js,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new vv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Qe.withCacheSize(this.cacheSizeBytes):Qe.DEFAULT;return new Zh((r=>Js.mi(r,t)),this.serializer)}}class Fo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$u(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=DE.bind(null,this.syncEngine),await dE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new pE})()}createDatastore(e){const t=Ei(e.databaseInfo.databaseId),r=(function(a){return new Qv(a)})(e.databaseInfo);return(function(a,c,l,h){return new Zv(a,c,l,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,a,c,l){return new tE(r,s,a,c,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>$u(this.syncEngine,t,0)),(function(){return xu.v()?new xu:new Hv})())}createSyncEngine(e,t){return(function(s,a,c,l,h,f,m){const T=new EE(s,a,c,l,h,f);return m&&(T.gu=!0),T})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=W(t);M(Rn,"RemoteStore shutting down."),r.Ea.add(5),await rs(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Fo.provider={build:()=>new Fo};class Td{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Nt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const an="FirestoreClient";class ME{constructor(e,t,r,s,a){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=qe.UNAUTHENTICATED,this.clientId=Zo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,(async c=>{M(an,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,(c=>(M(an,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ea(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function co(n,e){n.asyncQueue.verifyOperationInProgress(),M(an,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await ed(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Hu(n,e){n.asyncQueue.verifyOperationInProgress();const t=await LE(n);M(an,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Uu(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Uu(e.remoteStore,s))),n._onlineComponents=e}async function LE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){M(an,"Using user provided OfflineComponentProvider");try{await co(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;Wn("Error using user provided cache. Falling back to memory cache: "+t),await co(n,new ei)}}else M(an,"Using default OfflineComponentProvider"),await co(n,new OE(void 0));return n._offlineComponents}async function Id(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(M(an,"Using user provided OnlineComponentProvider"),await Hu(n,n._uninitializedComponentsProvider._online)):(M(an,"Using default OnlineComponentProvider"),await Hu(n,new Fo))),n._onlineComponents}function xE(n){return Id(n).then((e=>e.syncEngine))}async function wd(n){const e=await Id(n),t=e.eventManager;return t.onListen=TE.bind(null,e.syncEngine),t.onUnlisten=AE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=IE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=RE.bind(null,e.syncEngine),t}function FE(n,e,t={}){const r=new Ct;return n.asyncQueue.enqueueAndForget((async()=>(function(a,c,l,h,f){const m=new Td({next:I=>{m.Nu(),c.enqueueAndForget((()=>hd(a,T)));const b=I.docs.has(l);!b&&I.fromCache?f.reject(new x(V.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&I.fromCache&&h&&h.source==="server"?f.reject(new x(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(I)},error:I=>f.reject(I)}),T=new dd(oa(l.path),m,{includeMetadataChanges:!0,qa:!0});return ld(a,T)})(await wd(n),n.asyncQueue,e,t,r))),r.promise}function UE(n,e,t={}){const r=new Ct;return n.asyncQueue.enqueueAndForget((async()=>(function(a,c,l,h,f){const m=new Td({next:I=>{m.Nu(),c.enqueueAndForget((()=>hd(a,T))),I.fromCache&&h.source==="server"?f.reject(new x(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(I)},error:I=>f.reject(I)}),T=new dd(l,m,{includeMetadataChanges:!0,qa:!0});return ld(a,T)})(await wd(n),n.asyncQueue,e,t,r))),r.promise}function Ad(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Wu=new Map;const Rd="firestore.googleapis.com",Gu=!0;class Ku{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new x(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Rd,this.ssl=Gu}else this.host=e.host,this.ssl=e.ssl??Gu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Jh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<_v)throw new x(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ey("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ad(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new x(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new x(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new x(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ku({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ku(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new z_;switch(r.type){case"firstParty":return new K_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Wu.get(t);r&&(M("ComponentProvider","Removing Datastore"),Wu.delete(t),r.terminate())})(this),Promise.resolve()}}function BE(n,e,t,r={}){n=An(n,wi);const s=Jn(e),a=n._getSettings(),c={...a,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(ml(`https://${l}`),gl("Firestore",!0)),a.host!==Rd&&a.host!==l&&Wn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...a,host:l,ssl:s,emulatorOptions:r};if(!vn(h,c)&&(n._setSettings(h),r.mockUserToken)){let f,m;if(typeof r.mockUserToken=="string")f=r.mockUserToken,m=qe.MOCK_USER;else{f=ep(r.mockUserToken,n._app?.options.projectId);const T=r.mockUserToken.sub||r.mockUserToken.user_id;if(!T)throw new x(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new qe(T)}n._authCredentials=new H_(new lh(f,m))}}class Ai{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ai(this.firestore,e,this._query)}}class Pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new en(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pe(this.firestore,e,this._key)}toJSON(){return{type:Pe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(es(t,Pe._jsonSchema))return new Pe(e,r||null,new j(de.fromString(t.referencePath)))}}Pe._jsonSchemaVersion="firestore/documentReference/1.0",Pe._jsonSchema={type:Re("string",Pe._jsonSchemaVersion),referencePath:Re("string")};class en extends Ai{constructor(e,t,r){super(e,t,oa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new j(e))}withConverter(e){return new en(this.firestore,e,this._path)}}function jE(n,e,...t){if(n=Je(n),hh("collection","path",e),n instanceof wi){const r=de.fromString(e,...t);return cu(r),new en(n,null,r)}{if(!(n instanceof Pe||n instanceof en))throw new x(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(de.fromString(e,...t));return cu(r),new en(n.firestore,null,r)}}function Uo(n,e,...t){if(n=Je(n),arguments.length===1&&(e=Zo.newId()),hh("doc","path",e),n instanceof wi){const r=de.fromString(e,...t);return au(r),new Pe(n,null,new j(r))}{if(!(n instanceof Pe||n instanceof en))throw new x(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(de.fromString(e,...t));return au(r),new Pe(n.firestore,n instanceof en?n.converter:null,new j(r))}}const Qu="AsyncQueue";class Yu{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new nd(this,"async_queue_retry"),this._c=()=>{const r=ao();r&&M(Qu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=ao();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ao();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Ct;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!rr(e))throw e;M(Qu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Nt("INTERNAL UNHANDLED ERROR: ",Xu(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=va.createAndSchedule(this,e,t,r,(a=>this.hc(a)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:Xu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Xu(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Ri extends wi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Yu,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Yu(e),this._firestoreClient=void 0,await e}}}function qE(n,e){const t=typeof n=="object"?n:El(),r=typeof n=="string"?n:Hs,s=$o(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const a=Jf("firestore");a&&BE(s,...a)}return s}function Aa(n){if(n._terminated)throw new x(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||$E(n),n._firestoreClient}function $E(n){const e=n._freezeSettings(),t=(function(s,a,c,l){return new hy(s,a,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Ad(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new ME(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const a=s?._online.build();return{_offline:s?._offline.build(a),_online:a}})(n._componentsProvider))}class it{constructor(e){this._byteString=e}static fromBase64String(e){try{return new it(xe.fromBase64String(e))}catch(t){throw new x(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new it(xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:it._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(es(e,it._jsonSchema))return it.fromBase64String(e.bytes)}}it._jsonSchemaVersion="firestore/bytes/1.0",it._jsonSchema={type:Re("string",it._jsonSchemaVersion),bytes:Re("string")};class Ra{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Sd{constructor(e){this._methodName=e}}class yt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:yt._jsonSchemaVersion}}static fromJSON(e){if(es(e,yt._jsonSchema))return new yt(e.latitude,e.longitude)}}yt._jsonSchemaVersion="firestore/geoPoint/1.0",yt._jsonSchema={type:Re("string",yt._jsonSchemaVersion),latitude:Re("number"),longitude:Re("number")};class vt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==s[a])return!1;return!0})(this._values,e._values)}toJSON(){return{type:vt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(es(e,vt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new vt(e.vectorValues);throw new x(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}vt._jsonSchemaVersion="firestore/vectorValue/1.0",vt._jsonSchema={type:Re("string",vt._jsonSchemaVersion),vectorValues:Re("object")};const zE=/^__.*__$/;class HE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Cn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ts(e,this.data,t,this.fieldTransforms)}}function bd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class Sa{constructor(e,t,r,s,a,c){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,a===void 0&&this.Rc(),this.fieldTransforms=a||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Sa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return ti(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(bd(this.Ac)&&zE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class WE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ei(e)}Cc(e,t,r,s=!1){return new Sa({Ac:e,methodName:t,Dc:r,path:Le.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function GE(n){const e=n._freezeSettings(),t=Ei(n._databaseId);return new WE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function KE(n,e,t,r,s,a={}){const c=n.Cc(a.merge||a.mergeFields?2:0,e,t,s);Dd("Data must be an object, but it was:",c,r);const l=Cd(r,c);let h,f;if(a.merge)h=new ct(c.fieldMask),f=c.fieldTransforms;else if(a.mergeFields){const m=[];for(const T of a.mergeFields){const I=QE(e,T,t);if(!c.contains(I))throw new x(V.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);XE(m,I)||m.push(I)}h=new ct(m),f=c.fieldTransforms.filter((T=>h.covers(T.field)))}else h=null,f=c.fieldTransforms;return new HE(new st(l),h,f)}function Pd(n,e){if(kd(n=Je(n)))return Dd("Unsupported field value:",e,n),Cd(n,e);if(n instanceof Sd)return(function(r,s){if(!bd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(s);a&&s.fieldTransforms.push(a)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const a=[];let c=0;for(const l of r){let h=Pd(l,s.wc(c));h==null&&(h={nullValue:"NULL_VALUE"}),a.push(h),c++}return{arrayValue:{values:a}}})(n,e)}return(function(r,s){if((r=Je(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return My(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=fe.fromDate(r);return{timestampValue:Xs(s.serializer,a)}}if(r instanceof fe){const a=new fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xs(s.serializer,a)}}if(r instanceof yt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof it)return{bytesValue:Hh(s.serializer,r._byteString)};if(r instanceof Pe){const a=s.databaseId,c=r.firestore._databaseId;if(!c.isEqual(a))throw s.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:la(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof vt)return(function(c,l){return{mapValue:{fields:{[Eh]:{stringValue:Th},[Ws]:{arrayValue:{values:c.toArray().map((f=>{if(typeof f!="number")throw l.Sc("VectorValues must only contain numeric values.");return aa(l.serializer,f)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${ea(r)}`)})(n,e)}function Cd(n,e){const t={};return ph(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):bn(n,((r,s)=>{const a=Pd(s,e.mc(r));a!=null&&(t[r]=a)})),{mapValue:{fields:t}}}function kd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof fe||n instanceof yt||n instanceof it||n instanceof Pe||n instanceof Sd||n instanceof vt)}function Dd(n,e,t){if(!kd(t)||!dh(t)){const r=ea(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function QE(n,e,t){if((e=Je(e))instanceof Ra)return e._internalPath;if(typeof e=="string")return Vd(n,e);throw ti("Field path arguments must be of type string or ",n,!1,void 0,t)}const YE=new RegExp("[~\\*/\\[\\]]");function Vd(n,e,t){if(e.search(YE)>=0)throw ti(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ra(...e.split("."))._internalPath}catch{throw ti(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ti(n,e,t,r,s){const a=r&&!r.isEmpty(),c=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(a||c)&&(h+=" (found",a&&(h+=` in field ${r}`),c&&(h+=` in document ${s}`),h+=")"),new x(V.INVALID_ARGUMENT,l+n+h)}function XE(n,e){return n.some((t=>t.isEqual(e)))}class Nd{constructor(e,t,r,s,a){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new JE(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Od("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class JE extends Nd{data(){return super.data()}}function Od(n,e){return typeof e=="string"?Vd(n,e):e instanceof Ra?e._internalPath:e._delegate._internalPath}function ZE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class eT{convertValue(e,t="none"){switch(sn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return bn(e,((s,a)=>{r[s]=this.convertValue(a,t)})),r}convertVectorValue(e){const t=e.fields?.[Ws].arrayValue?.values?.map((r=>we(r.doubleValue)));return new vt(t)}convertGeoPoint(e){return new yt(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=fi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp($r(e));default:return null}}convertTimestamp(e){const t=nn(e);return new fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=de.fromString(e);oe(Xh(r),9688,{name:e});const s=new zr(r.get(1),r.get(3)),a=new j(r.popFirst(5));return s.isEqual(t)||Nt(`Document ${a} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),a}}function tT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Vr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yn extends Nd{constructor(e,t,r,s,a,c){super(e,t,r,s,c),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Os(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Od("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=yn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}yn._jsonSchemaVersion="firestore/documentSnapshot/1.0",yn._jsonSchema={type:Re("string",yn._jsonSchemaVersion),bundleSource:Re("string","DocumentSnapshot"),bundleName:Re("string"),bundle:Re("string")};class Os extends yn{data(e={}){return super.data(e)}}class zn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Vr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Os(this._firestore,this._userDataWriter,r.key,r,new Vr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,a){if(s._snapshot.oldDocs.isEmpty()){let c=0;return s._snapshot.docChanges.map((l=>{const h=new Os(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Vr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:c++}}))}{let c=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>a||l.type!==3)).map((l=>{const h=new Os(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Vr(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,m=-1;return l.type!==0&&(f=c.indexOf(l.doc.key),c=c.delete(l.doc.key)),l.type!==1&&(c=c.add(l.doc),m=c.indexOf(l.doc.key)),{type:nT(l.type),doc:h,oldIndex:f,newIndex:m}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=zn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Zo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((a=>{a._document!==null&&(t.push(a._document),r.push(this._userDataWriter.convertObjectMap(a._document.data.value.mapValue.fields,"previous")),s.push(a.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function nT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}function rT(n){n=An(n,Pe);const e=An(n.firestore,Ri);return FE(Aa(e),n._key).then((t=>oT(e,n,t)))}zn._jsonSchemaVersion="firestore/querySnapshot/1.0",zn._jsonSchema={type:Re("string",zn._jsonSchemaVersion),bundleSource:Re("string","QuerySnapshot"),bundleName:Re("string"),bundle:Re("string")};class Md extends eT{constructor(e){super(),this.firestore=e}convertBytes(e){return new it(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}}function sT(n){n=An(n,Ai);const e=An(n.firestore,Ri),t=Aa(e),r=new Md(e);return ZE(n._query),UE(t,n._query).then((s=>new zn(e,r,n,s)))}function Bo(n,e,t){n=An(n,Pe);const r=An(n.firestore,Ri),s=tT(n.converter,e,t);return iT(r,[KE(GE(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,kt.none())])}function iT(n,e){return(function(r,s){const a=new Ct;return r.asyncQueue.enqueueAndForget((async()=>SE(await xE(r),s,a))),a.promise})(Aa(n),e)}function oT(n,e,t){const r=t.docs.get(e._key),s=new Md(n);return new yn(n,s,e._key,r,new Vr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){tr=s})(Zn),Hn(new En("firestore",((r,{instanceIdentifier:s,options:a})=>{const c=r.getProvider("app").getImmediate(),l=new Ri(new W_(r.getProvider("auth-internal")),new Q_(c,r.getProvider("app-check-internal")),(function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new x(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zr(f.options.projectId,m)})(c,s),c);return a={useFetchStreams:t,...a},l._setSettings(a),l}),"PUBLIC").setMultipleInstances(!0)),Jt(ru,su,e),Jt(ru,su,"esm2020")})();const aT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},Ld=vl(aT),ni=q_(Ld),ri=qE(Ld),wt=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var cT=Ne(`<div class="login svelte-2v2n6f"><br/> <h2>The Good Calendar</h2> <p style="text-align: center; margin-top: 0px">Here, you can log the quality of your days and nights for posterity. Dedicated to my girlfriend and her chronic migranes.</p> <div style="top: 3rem; position:relative"><div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem;"><input type="text" placeholder="Username" class="login_input svelte-2v2n6f" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input svelte-2v2n6f" style="width: 200px;"/> <button style="
            position: absolute;
            right: -45px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 10%;
            font-size: 0.75rem;
            padding: 0.1rem 0.25rem;
            white-space: nowrap;
          "> </button></div></div></div> <div style="top: 3rem; position:relative"><div style="align-items: center"><button>Login</button> <button>Sign up</button></div></div> <div style="top: 3rem; position:relative"><!></div></div>`);function uT(n,e){ii(e,!1),lf();let t=pe(""),r=pe(""),s=pe(""),a=pe(!0);async function c(){K(s,"");try{const g=`${P(t)}@tracker.app`,E=await Sg(ni,g,P(r))}catch(g){console.error(g),K(s,g.message)}}async function l(){K(s,"");try{const g=`${P(t)}@tracker.app`,E=await bg(ni,g,P(r))}catch(g){console.error(g),K(s,g.message)}}function h(g){switch(g){case"Firebase: Error (auth/invalid-credential).":return"Incorrect password or the account doesn't exist";case"Firebase: Missing password requirements: [Password must contain at least 6 characters] (auth/password-does-not-meet-requirements).":return"Password must contain at least 6 characters";case"Firebase: Error (auth/email-already-in-use).":return"This account already exists.";case"Firebase: Error (auth/invalid-email).":return"Your username cannot have any spaces";case"Firebase: Error (auth/missing-password).":return"Missing password";default:return g}}si();var f=cT(),m=Z(se(f),2),T=Z(m,4),I=se(T),b=se(I);ho(b);var D=Z(b,2),N=se(D);ho(N);var k=Z(N,2),B=se(k,!0);ne(k),ne(D),ne(I),ne(T);var F=Z(T,2),L=se(F),U=se(L),z=Z(U,2);ne(L),ne(F);var G=Z(F,2),w=se(G);{var _=g=>{var E=uo();Ye(y=>et(E,y),[()=>h(P(s))]),he(g,E)};Xe(w,g=>{P(s)&&g(_)})}ne(G),ne(f),Ye(()=>{bt(m,`background: url(${wt}); no-repeat; background-size: cover; 
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),sl(N,"type",P(a)?"password":"text"),et(B,P(a)?"show":"hide")}),Ms(b,()=>P(t),g=>K(t,g)),Ms(N,()=>P(r),g=>K(r,g)),je("click",k,()=>K(a,!P(a))),je("click",U,l),je("click",z,c),he(n,f),oi()}var lT=Ne("<h3>Entry logged!</h3>"),hT=Ne('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),dT=Ne('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Come back tomorrow!</h4>',1),fT=Ne('<div class="overlay"><!> <button>Return</button></div>'),pT=Ne('<br/> <div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3></div>',1),mT=Ne('<div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..."></textarea><br/> <button> </button></div>'),gT=Ne('<!> <button class="hiddencheck svelte-kkv8mu"></button>',1);function _T(n,e){ii(e,!1);let t=Kt(e,"user",8),r=Kt(e,"externalEntry",8,null),s=Kt(e,"onSaved",8,()=>{}),a=Kt(e,"invert",8),c=new Date;const l=c.getFullYear(),h=c.getMonth(),f=c.getDate();function m(A){return A.toString().padStart(2,"0")}let T=t().uid;t().email?name=t().email.replace("@tracker.app","").charAt(0).toUpperCase()+t().email.replace("@tracker.app","").slice(1):name="Temp",`${l}${m(h+1)}${m(f)}`;let I=pe(5),b=pe(""),D=pe(!1),N=pe(""),k=pe(!1),B=pe(""),F=pe(""),L=pe(!1);function U(A){return a()&&(A=10-A),`hsl(${120*(A/10)}, 70%, 65%)`}function z(){return P(I)/10}async function G(A){if(P(D)&&!P(L))return;K(k,!0);const v=Uo(ri,"users",T,"entries",A.key);A.period==="day"?(await Bo(v,{valueDay:P(I),textDay:P(b),timestamp:Date.now()},{merge:!0}),A.filledNight&&K(F,"Come back tomorrow!")):(await Bo(v,{valueNight:P(I),textNight:P(b),timestamp:Date.now()},{merge:!0}),A.filledDay&&K(F,"Come back tomorrow!")),console.log("Logged "+A.key+" at "+A.period),K(I,5),K(b,""),s()()}function w(){K(k,!1)}As(()=>ot(r()),()=>{if(r()){let A=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&A?K(D,!0):!r().current&&!A?K(D,!0):r().current&&(K(D,!1),K(b,r().period==="day"?r().textDay:r().textNight),K(I,(r().period==="day"?r().valueDay:r().valueNight)||5))}}),As(()=>(ot(a()),P(I)),()=>{a()?K(N,P(I)<=0?"celebrate":""):K(N,P(I)>=10?"celebrate":"")}),As(()=>(ot(a()),P(I)),()=>{(a()||P(I))&&K(B,U(P(I)))}),rl(),si();var _=gT(),g=At(_);{var E=A=>{var v=ws(),re=At(v);{var ve=me=>{var ie=fT(),ue=se(ie);{var Fe=ee=>{var ae=lT();he(ee,ae)},ge=ee=>{var ae=ws(),Te=At(ae);{var Ge=Oe=>{var Ke=hT();Ac(2),he(Oe,Ke)},ke=Oe=>{var Ke=dT();Ac(2),he(Oe,Ke)};Xe(Te,Oe=>{ot(r()),Ie(()=>r().period==="night"&&!r().filledDay)?Oe(Ge):Oe(ke,!1)},!0)}he(ee,ae)};Xe(ue,ee=>{ot(r()),Ie(()=>r().period==="day"&&!r().filledNight)?ee(Fe):ee(ge,!1)})}var Ee=Z(ue,2);Ee.__click=w,ne(ie),he(me,ie)},tt=me=>{var ie=ws(),ue=At(ie);{var Fe=Ee=>{var ee=pT(),ae=Z(At(ee),2),Te=se(ae);Te.textContent=`Welcome ${name??""}!`;var Ge=Z(Te,2),ke=se(Ge,!0);ne(Ge),ne(ae),Ye(()=>{bt(Te,`background: url(${wt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),et(ke,P(F)||"Viewing past entries")}),he(Ee,ee)},ge=Ee=>{var ee=mT(),ae=se(ee);ae.textContent=`Welcome ${name??""}!`;var Te=Z(ae,2),Ge=se(Te);ne(Te);var ke=Z(Te,2);ho(ke);var Oe=Z(ke,2);Mf(Oe);var Ke=Z(Oe,3);Ke.__click=()=>G(r());var ir=se(Ke);ne(Ke),ne(ee),Ye((It,Lt)=>{bt(ae,`background: url(${wt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),et(Ge,`Rate your ${ot(r()),Ie(()=>r().period==="day"?"day":"night")??""}`),ke.disabled=P(D)&&!P(L),$f(ke,1,Bf(P(N)),"svelte-kkv8mu"),bt(ke,`--fill-percentage: ${It??""}%; --slider-color: ${P(B)??""}`),Ke.disabled=P(D)&&!P(L),et(ir,`Save (${Lt??""}/10)`)},[()=>Ie(z),()=>(P(I),Ie(()=>P(I).toFixed(1)))]),Ms(ke,()=>P(I),It=>K(I,It)),Ms(Oe,()=>P(b),It=>K(b,It)),he(Ee,ee)};Xe(ue,Ee=>{P(D)&&!P(L)?Ee(Fe):Ee(ge,!1)})}he(me,ie)};Xe(re,me=>{P(k)?me(ve):me(tt,!1)})}he(A,v)};Xe(g,A=>{r()&&A(E)})}var y=Z(g,2);y.__dblclick=()=>{console.log("Activated override!"),K(L,!P(L))},he(n,_),oi()}Lf(["click","dblclick"]);var yT=Ne('<div class="day svelte-dw9jm0"><div class="day-number svelte-dw9jm0"> </div> <div class="day-half top-half svelte-dw9jm0"></div> <div class="day-half bottom-half svelte-dw9jm0"></div></div>'),vT=Ne("<!> <br/> <i> </i>",1),ET=Ne("<!> <br/> <i> </i>",1),TT=Ne('<div class="entry-info svelte-dw9jm0"><strong> </strong> <!></div>'),IT=Ne('<div class="month-nav svelte-dw9jm0"><button class="nav-btn svelte-dw9jm0" aria-label="Previous month"></button> <p> </p> <button class="nav-btn svelte-dw9jm0" aria-label="Next month"></button></div> <div class="calendar svelte-dw9jm0"></div> <!>',1);function wT(n,e){ii(e,!1);let t=Kt(e,"user",8),r=Kt(e,"onSelectEntry",8,E=>{}),s=Kt(e,"reloadTrigger",8,0),a=Kt(e,"invert",8),c=t().uid,l=pe([]),h=pe(null),f=pe(new Date),m=pe("");function T(E){return E==null?"#fff":`hsl(${120*(E/10)}, 70%, 65%)`}function I(E){return E.toString().padStart(2,"0")}async function b(){console.log("Loaded calendar entries");const E=P(f).getFullYear(),y=P(f).getMonth(),v=new Date().getHours()<16?"day":"night",re=new Date,ve=new Date(E,y+1,0).getDate();K(m,P(f).toLocaleString("default",{month:"long",year:"numeric"}));const tt=jE(ri,"users",c,"entries"),me=await sT(tt),ie={};me.forEach(ge=>{ie[ge.id]=ge.data()});const ue=[],Fe=E===re.getFullYear()&&y===re.getMonth()?re.getDate():ve;for(let ge=1;ge<=Fe;ge++){const Ee=`${E}-${I(y+1)}-${I(ge)}`,ee=ie[Ee],ae=E===re.getFullYear()&&y===re.getMonth()&&ge===re.getDate(),Te={key:Ee,day:ge,filledDay:ee?.valueDay!=null,filledNight:ee?.valueNight!=null,valueDay:ee?.valueDay??null,valueNight:ee?.valueNight??null,textDay:ee?.textDay??null,textNight:ee?.textNight??null,current:ae};ae&&P(h)===null&&(Te.period=v,D(Te)),ue.push(Te)}K(l,ue)}function D(E){K(h,E),r()(E),console.log("Selected "+E.key)}function N(){const E=new Date(P(f));E.setMonth(E.getMonth()-1),K(f,E),b(),K(h,null)}function k(){const E=new Date,y=new Date(P(f));y.setMonth(y.getMonth()+1),!(y.getFullYear()>E.getFullYear()||y.getFullYear()===E.getFullYear()&&y.getMonth()>E.getMonth())&&(K(f,y),b(),K(h,null))}Ju(b),As(()=>ot(s()),()=>{s()&&b()}),rl(),si();var B=IT(),F=At(B),L=se(F),U=Z(L,2),z=se(U,!0);ne(U);var G=Z(U,2);ne(F);var w=Z(F,2);ol(w,5,()=>P(l),il,(E,y)=>{var A=yT(),v=se(A),re=se(v,!0);ne(v);var ve=Z(v,2),tt=Z(ve,2);ne(A),Ye((me,ie)=>{bt(A,(P(y),P(h),Ie(()=>(P(y).current?"border: 1.5px solid #333;":"")+(P(h)!=null&&P(h).key===P(y).key&&P(h).period==="day"?"border-top: 2.5px solid #339FFF":P(h)!=null&&P(h).key===P(y).key?"border-bottom: 2.5px solid #339FFF":"")))),et(re,(P(y),Ie(()=>P(y).day))),bt(ve,me),bt(tt,ie)},[()=>(ot(a()),P(y),ot(wt),Ie(()=>!a()&&P(y).valueDay==10?`background: url('${wt}'); background-size: cover;`:a()&&P(y).valueDay==0?`background: url('${wt}'); background-size: cover;`:`background-color: ${T(P(y).valueDay!=null&&!a()?P(y).valueDay:P(y).valueDay!=null?10-P(y).valueDay:null)};`)),()=>(ot(a()),P(y),ot(wt),Ie(()=>!a()&&P(y).valueNight==10?`background: url('${wt}'); background-size: cover;`:a()&&P(y).valueNight==0?`background: url('${wt}'); background-size: cover;`:`background-color: ${T(P(y).valueNight!=null&&!a()?P(y).valueNight:P(y).valueNight!=null?10-P(y).valueNight:null)};`))]),je("click",ve,()=>D({...P(y),period:"day"})),je("click",tt,()=>D({...P(y),period:"night"})),he(E,A)}),ne(w);var _=Z(w,2);{var g=E=>{var y=TT(),A=se(y),v=se(A);ne(A);var re=Z(A,2);{var ve=me=>{var ie=vT(),ue=At(ie);{var Fe=ee=>{var ae=uo();Ye(()=>et(ae,` ${P(h),Ie(()=>P(h).valueDay)??""}/10`)),he(ee,ae)};Xe(ue,ee=>{P(h),Ie(()=>P(h).filledDay)&&ee(Fe)})}var ge=Z(ue,4),Ee=se(ge,!0);ne(ge),Ye(()=>et(Ee,(P(h),Ie(()=>P(h).textDay||"No Entry")))),he(me,ie)},tt=me=>{var ie=ET(),ue=At(ie);{var Fe=ee=>{var ae=uo();Ye(()=>et(ae,` ${P(h),Ie(()=>P(h).valueNight)??""}/10`)),he(ee,ae)};Xe(ue,ee=>{P(h),Ie(()=>P(h).filledNight)&&ee(Fe)})}var ge=Z(ue,4),Ee=se(ge,!0);ne(ge),Ye(()=>et(Ee,(P(h),Ie(()=>P(h).textNight||"No Entry")))),he(me,ie)};Xe(re,me=>{P(h),Ie(()=>P(h).period==="day")?me(ve):me(tt,!1)})}ne(y),Ye(me=>et(v,`${me??""} ${P(h),Ie(()=>P(h).period==="day"?"Day":"Night")??""}`),[()=>(P(h),Ie(()=>new Date(new Date(P(h).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),he(E,y)};Xe(_,E=>{P(h),Ie(()=>P(h)&&!(P(h).period==="day"&&!P(h).filledDay&&P(h).current||P(h).period==="night"&&!P(h).filledNight&&P(h).current))&&E(g)})}Ye(E=>{et(z,P(m)),G.disabled=E},[()=>(P(f),Ie(()=>P(f).getFullYear()===new Date().getFullYear()&&P(f).getMonth()===new Date().getMonth()))]),je("click",L,N),je("click",G,k),he(n,B),oi()}const AT="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20352%20512'%3e%3c!--!Font%20Awesome%20Free%205.15.4%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202025%20Fonticons,%20Inc.--%3e%3cpath%20d='M176%2080c-52.94%200-96%2043.06-96%2096%200%208.84%207.16%2016%2016%2016s16-7.16%2016-16c0-35.3%2028.72-64%2064-64%208.84%200%2016-7.16%2016-16s-7.16-16-16-16zM96.06%20459.17c0%203.15.93%206.22%202.68%208.84l24.51%2036.84c2.97%204.46%207.97%207.14%2013.32%207.14h78.85c5.36%200%2010.36-2.68%2013.32-7.14l24.51-36.84c1.74-2.62%202.67-5.7%202.68-8.84l.05-43.18H96.02l.04%2043.18zM176%200C73.72%200%200%2082.97%200%20176c0%2044.37%2016.45%2084.85%2043.56%20115.78%2016.64%2018.99%2042.74%2058.8%2052.42%2092.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64%2059.67-128%20127.95-128%2070.58%200%20128%2057.42%20128%20128%200%2030.97-11.24%2060.85-31.65%2084.14-39.11%2044.61-56.42%2091.47-62.1%20109.46a47.507%2047.507%200%200%200-2.22%2014.3v.1h48v-.05c9.68-33.37%2035.78-73.18%2052.42-92.16C335.55%20260.85%20352%20220.37%20352%20176%20352%2078.8%20273.2%200%20176%200z'/%3e%3c/svg%3e";var RT=Ne("<button> </button>"),ST=Ne('<div class="overlay"><span></span><br/> <span><button>Rename</button> <button>Delete</button> <button>New</button></span><br/> <button>Return</button></div>'),bT=Ne("<div><!> <button>Invert</button></div>"),PT=Ne('<div class="overlay"><div style="width: 65%; text-align:left"><span>Click on the top half of the current date to log an entry for <strong>today</strong>. Click on the bottom half to log an entry for <b>tonight</b>. Entries are only editable on the current day. <br/><br/>To reverse the red-green color scheme, click "Invert" in the bottom-right corner. Your preferences will be saved for the next time you login!</span></div> <br/><br/> <button>Return</button></div>'),CT=Ne(`<div style="display: flex;
  flex-direction: column;
  min-height: 100vh;"><div style="flex-grow: 1;"><!> <!></div> <div style="display: flex;
    justify-content: space-between;
    padding-left: 5%;
    padding-right: 5%;
    margin-bottom: 5%;"><div><button>Log Out</button> <button style="padding: .4rem inherit;"><img width="12px" style="transform: translateY(15%);"/></button></div> <!> <!></div></div>`);function FT(n,e){ii(e,!1);let t=pe(null),r=pe(null),s=pe(0),a=pe(null),c=pe(!1),l=pe(0),h="",f=["Calendar 1","Calendar 2","Calendar 3"],m=pe(!1);kg(ni,U=>{N(U),K(t,U)});async function T(){if(!P(t))return;K(a,!P(a));const U=Uo(ri,"users",P(t).uid);await Bo(U,{colorPreference:P(a),timestamp:Date.now()},{merge:!0}),console.log("Saved user profile invert="+P(a))}function I(){K(s,P(s)+1)}function b(){Dg(ni),K(t,null),K(r,null)}function D(U){K(r,U)}async function N(U){if(!U)return;const z=Uo(ri,"users",U.uid),G=await rT(z);G.exists()?(K(a,G.data().colorPreference),console.log("Loaded user profile invert="+P(a))):K(a,!1)}Ju(N),si();var k=ws(),B=At(k);{var F=U=>{uT(U,{})},L=U=>{var z=CT(),G=se(z),w=se(G);_T(w,{get user(){return P(t)},get externalEntry(){return P(r)},onSaved:I,get invert(){return P(a)}});var _=Z(w,2);wT(_,{get user(){return P(t)},onSelectEntry:D,get reloadTrigger(){return P(s)},get invert(){return P(a)}}),ne(G);var g=Z(G,2),E=se(g),y=se(E),A=Z(y,2),v=se(A);ne(A),ne(E);var re=Z(E,2);{var ve=ie=>{var ue=bT(),Fe=se(ue);{var ge=ae=>{var Te=ST(),Ge=se(Te);ol(Ge,5,()=>f,il,(Lt,or,ar)=>{var ln=RT(),cr=se(ln,!0);ne(ln),Ye(()=>{bt(ln,P(l)===ar?"border: 2px dashed #339FFF;":"margin: .5rem"),et(cr,P(or))}),je("click",ln,function(...ur){K(l,ar)?.apply(this,ur)}),he(Lt,ln)}),ne(Ge);var ke=Z(Ge,3),Oe=se(ke),Ke=Z(Oe,2),ir=Z(Ke,2);ne(ke);var It=Z(ke,3);ne(Te),je("click",Oe,()=>{h(i)}),je("click",Ke,()=>{deleteCalendar(i)}),je("click",ir,()=>{addCalendar(i)}),je("click",It,function(...Lt){K(m,!P(m))?.apply(this,Lt)}),he(ae,Te)};Xe(Fe,ae=>{P(m)&&ae(ge)})}var Ee=Z(Fe,2);let ee;ne(ue),Ye(()=>ee=bt(Ee,"",ee,{"background-color":P(a)?"hsl(0, 70%, 65%)":"hsl(120, 70%, 65%)"})),je("click",Ee,T),he(ie,ue)};Xe(re,ie=>{P(a)!=null&&ie(ve)})}var tt=Z(re,2);{var me=ie=>{var ue=PT(),Fe=Z(se(ue),5);ne(ue),je("click",Fe,()=>{K(c,!P(c))}),he(ie,ue)};Xe(tt,ie=>{P(c)&&ie(me)})}ne(g),ne(z),Ye(()=>sl(v,"src",AT)),je("click",y,b),je("click",A,()=>{K(c,!P(c))}),he(U,z)};Xe(B,U=>{P(t)?U(L,!1):U(F)})}he(n,k),oi()}export{FT as component};
