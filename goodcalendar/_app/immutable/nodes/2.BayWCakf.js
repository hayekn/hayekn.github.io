import{f as ye,a as ie,t as bo,c as js}from"../chunks/BysJwN_t.js";import{i as Ti}from"../chunks/BmcIUVPK.js";import{P as oo,h as pt,a4 as ff,e as iu,I as pf,H as mf,t as w,U as gf,K as _f,M as yf,O as kc,Q as ao,i as Lr,aa as vf,aF as Ef,f as Ro,s as Tf,c as Qn,aD as ou,z as If,aI as ae,af as Vc,ao as wf,r as au,p as Af,aM as bf,aN as co,d as cu,aO as Rf,aP as Sf,ab as Pf,aQ as Cf,aC as kf,aR as Vf,Y as Df,aS as Nf,aK as Of,l as we,ag as Mf,aT as xf,A as Ii,G as q,E as Q,F as G,C as $e,D as wi,W as N,aU as zr,aV as lu,B as Lt,v as mt,aW as Lf,ap as Dc,aX as Os}from"../chunks/KuIhI81p.js";import{s as ze,e as he,d as Ff}from"../chunks/BIAasXF6.js";import{p as vt,i as Pe}from"../chunks/DnMetUdW.js";import{r as tr,s as uu}from"../chunks/BtxzV7Uf.js";import{c as Uf,o as Bf}from"../chunks/YV_QUl1D.js";import"../chunks/8UtF8RsF.js";function hu(n,e){return e}function jf(n,e,t){for(var r=n.items,s=[],o=e.length,a=0;a<o;a++)Cf(e[a].e,s,!0);var l=o>0&&s.length===0&&t!==null;if(l){var h=t.parentNode;kf(h),h.append(t),r.clear(),bt(n,e[0].prev,e[o-1].next)}Vf(s,()=>{for(var d=0;d<o;d++){var p=e[d];l||(r.delete(p.k),bt(n,p.prev,p.next)),cu(p.e,!l)}})}function du(n,e,t,r,s,o=null){var a=n,l={flags:e,items:new Map,first:null};{var h=n;a=pt?oo(ff(h)):h.appendChild(iu())}pt&&pf();var d=null,p=!1,v=new Map,E=gf(()=>{var k=t();return If(k)?k:k==null?[]:ou(k)}),b,P;function D(){qf(P,b,l,v,a,s,e,r,t),o!==null&&(b.length===0?d?au(d):d=Ro(()=>o(a)):d!==null&&Af(d,()=>{d=null}))}mf(()=>{P??=Df,b=w(E);var k=b.length;if(p&&k===0)return;p=k===0;let B=!1;if(pt){var j=_f(a)===yf;j!==(k===0)&&(a=kc(),oo(a),ao(!1),B=!0)}if(pt){for(var L=null,K,z=0;z<k;z++){if(Lr.nodeType===vf&&Lr.data===Ef){a=Lr,B=!0,ao(!1);break}var Z=b[z],I=r(Z,z);K=So(Lr,l,L,null,Z,I,z,s,e,t),l.items.set(I,K),L=K}k>0&&oo(kc())}if(pt)k===0&&o&&(d=Ro(()=>o(a)));else if(Tf()){var g=new Set,_=Qn;for(z=0;z<k;z+=1){Z=b[z],I=r(Z,z);var A=l.items.get(I)??v.get(I);A?fu(A,Z,z):(K=So(null,l,null,null,Z,I,z,s,e,t,!0),v.set(I,K)),g.add(I)}for(const[y,T]of l.items)g.has(y)||_.skipped_effects.add(T.e);_.oncommit(D)}else D();B&&ao(!0),w(E)}),pt&&(a=Lr)}function qf(n,e,t,r,s,o,a,l,h){var d=e.length,p=t.items,v=t.first,E=v,b,P=null,D=[],k=[],B,j,L,K;for(K=0;K<d;K+=1){if(B=e[K],j=l(B,K),L=p.get(j),L===void 0){var z=r.get(j);if(z!==void 0){r.delete(j),p.set(j,z);var Z=P?P.next:E;bt(t,P,z),bt(t,z,Z),lo(z,Z,s),P=z}else{var I=E?E.e.nodes_start:s;P=So(I,t,P,P===null?t.first:P.next,B,j,K,o,a,h)}p.set(j,P),D=[],k=[],E=P.next;continue}if(fu(L,B,K),(L.e.f&co)!==0&&au(L.e),L!==E){if(b!==void 0&&b.has(L)){if(D.length<k.length){var g=k[0],_;P=g.prev;var A=D[0],y=D[D.length-1];for(_=0;_<D.length;_+=1)lo(D[_],g,s);for(_=0;_<k.length;_+=1)b.delete(k[_]);bt(t,A.prev,y.next),bt(t,P,A),bt(t,y,g),E=g,P=y,K-=1,D=[],k=[]}else b.delete(L),lo(L,E,s),bt(t,L.prev,L.next),bt(t,L,P===null?t.first:P.next),bt(t,P,L),P=L;continue}for(D=[],k=[];E!==null&&E.k!==j;)(E.e.f&co)===0&&(b??=new Set).add(E),k.push(E),E=E.next;if(E===null)continue;L=E}D.push(L),P=L,E=L.next}if(E!==null||b!==void 0){for(var T=b===void 0?[]:ou(b);E!==null;)(E.e.f&co)===0&&T.push(E),E=E.next;var m=T.length;if(m>0){var M=d===0?s:null;jf(t,T,M)}}n.first=t.first&&t.first.e,n.last=P&&P.e;for(var U of r.values())cu(U.e);r.clear()}function fu(n,e,t,r){wf(n.v,e),n.i=t}function So(n,e,t,r,s,o,a,l,h,d,p){var v=(h&Rf)!==0,E=(h&Sf)===0,b=v?E?ae(s,!1,!1):Vc(s):s,P=(h&bf)===0?a:Vc(a),D={i:P,v:b,k:o,a:null,e:null,prev:t,next:r};try{if(n===null){var k=document.createDocumentFragment();k.append(n=iu())}return D.e=Ro(()=>l(n,b,P,d),pt),D.e.prev=t&&t.e,D.e.next=r&&r.e,t===null?p||(e.first=D):(t.next=D,t.e.next=D.e),r!==null&&(r.prev=D,r.e.prev=D.e),D}finally{}}function lo(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==r;){var a=Pf(o);s.before(o),o=a}}function bt(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function pu(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=pu(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function $f(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=pu(n))&&(r&&(r+=" "),r+=e);return r}function zf(n){return typeof n=="object"?$f(n):n??""}function Hf(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Wf(n,e){return n==null?null:String(n)}function Gf(n,e,t,r,s,o){var a=n.__className;if(pt||a!==t||a===void 0){var l=Hf(t,r);(!pt||l!==n.getAttribute("class"))&&(l==null?n.removeAttribute("class"):n.className=l),n.__className=t}return o}function nr(n,e,t,r){var s=n.__style;if(pt||s!==e){var o=Wf(e);(!pt||o!==n.getAttribute("style"))&&(o==null?n.removeAttribute("style"):n.style.cssText=o),n.__style=e}return r}function Dn(n,e,t=e){var r=new WeakSet;Nf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=uo(n)?ho(o):o,t(o),Qn!==null&&r.add(Qn),await Of(),o!==(o=e())){var a=n.selectionStart,l=n.selectionEnd,h=n.value.length;if(n.value=o??"",l!==null){var d=n.value.length;a===l&&l===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(l,d))}}}),(pt&&n.defaultValue!==n.value||we(e)==null&&n.value)&&(t(uo(n)?ho(n.value):n.value),Qn!==null&&r.add(Qn)),Mf(()=>{var s=e();if(n===document.activeElement){var o=xf??Qn;if(r.has(o))return}uo(n)&&s===ho(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function uo(n){var e=n.type;return e==="number"||e==="range"}function ho(n){return n===""?null:+n}const Kf=()=>{};var Nc={};const mu=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Qf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],l=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},gu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,v=(o&3)<<4|l>>4;let E=(l&15)<<2|d>>6,b=d&63;h||(b=64,a||(E=64)),r.push(t[p],t[v],t[E],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(mu(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Qf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const v=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||l==null||d==null||v==null)throw new Yf;const E=o<<2|l>>4;if(r.push(E),d!==64){const b=l<<4&240|d>>2;if(r.push(b),v!==64){const P=d<<6&192|v;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Yf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Xf=function(n){const e=mu(n);return gu.encodeByteArray(e,!0)},Zs=function(n){return Xf(n).replace(/\./g,"")},_u=function(n){try{return gu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Jf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Zf=()=>Jf().__FIREBASE_DEFAULTS__,ep=()=>{if(typeof process>"u"||typeof Nc>"u")return;const n=Nc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},tp=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_u(n[1]);return e&&JSON.parse(e)},Ai=()=>{try{return Kf()||Zf()||ep()||tp()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yu=n=>Ai()?.emulatorHosts?.[n],np=n=>{const e=yu(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},vu=()=>Ai()?.config,Eu=n=>Ai()?.[`_${n}`];class rp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function mr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Tu(n){return(await fetch(n,{credentials:"include"})).ok}function sp(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Zs(JSON.stringify(t)),Zs(JSON.stringify(a)),""].join(".")}const Hr={};function ip(){const n={prod:[],emulator:[]};for(const e of Object.keys(Hr))Hr[e]?n.emulator.push(e):n.prod.push(e);return n}function op(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Oc=!1;function Iu(n,e){if(typeof window>"u"||typeof document>"u"||!mr(window.location.host)||Hr[n]===e||Hr[n]||Oc)return;Hr[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",o=ip().prod.length>0;function a(){const E=document.getElementById(r);E&&E.remove()}function l(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,b){E.setAttribute("width","24"),E.setAttribute("id",b),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Oc=!0,a()},E}function p(E,b){E.setAttribute("id",b),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function v(){const E=op(r),b=t("text"),P=document.getElementById(b)||document.createElement("span"),D=t("learnmore"),k=document.getElementById(D)||document.createElement("a"),B=t("preprendIcon"),j=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const L=E.element;l(L),p(k,D);const K=d();h(j,B),L.append(j,P,k,K),document.body.appendChild(L)}o?(P.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function rt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ap(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(rt())}function cp(){const n=Ai()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function up(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function hp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dp(){const n=rt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function fp(){return!cp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pp(){try{return typeof indexedDB=="object"}catch{return!1}}function mp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const gp="FirebaseError";class Gt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=gp,Object.setPrototypeOf(this,Gt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cs.prototype.create)}}class cs{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?_p(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Gt(s,l,r)}}function _p(n,e){return n.replace(yp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const yp=/\{\$([^}]+)}/g;function vp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function On(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Mc(o)&&Mc(a)){if(!On(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Mc(n){return n!==null&&typeof n=="object"}function ls(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Fr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Ur(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Ep(n,e){const t=new Tp(n,e);return t.subscribe.bind(t)}class Tp{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Ip(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=fo),s.error===void 0&&(s.error=fo),s.complete===void 0&&(s.complete=fo);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ip(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function fo(){}function He(n){return n&&n._delegate?n._delegate:n}class Mn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const kn="[DEFAULT]";class wp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new rp;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(bp(e))try{this.getOrInitializeService({instanceIdentifier:kn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=kn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=kn){return this.instances.has(e)}getOptions(e=kn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ap(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=kn){return this.component?this.component.multipleInstances?e:kn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ap(n){return n===kn?void 0:n}function bp(n){return n.instantiationMode==="EAGER"}class Rp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var te;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(te||(te={}));const Sp={debug:te.DEBUG,verbose:te.VERBOSE,info:te.INFO,warn:te.WARN,error:te.ERROR,silent:te.SILENT},Pp=te.INFO,Cp={[te.DEBUG]:"log",[te.VERBOSE]:"log",[te.INFO]:"info",[te.WARN]:"warn",[te.ERROR]:"error"},kp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Cp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Zo{constructor(e){this.name=e,this._logLevel=Pp,this._logHandler=kp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in te))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Sp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,te.DEBUG,...e),this._logHandler(this,te.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,te.VERBOSE,...e),this._logHandler(this,te.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,te.INFO,...e),this._logHandler(this,te.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,te.WARN,...e),this._logHandler(this,te.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,te.ERROR,...e),this._logHandler(this,te.ERROR,...e)}}const Vp=(n,e)=>e.some(t=>n instanceof t);let xc,Lc;function Dp(){return xc||(xc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Np(){return Lc||(Lc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wu=new WeakMap,Po=new WeakMap,Au=new WeakMap,po=new WeakMap,ea=new WeakMap;function Op(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(un(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&wu.set(t,n)}).catch(()=>{}),ea.set(e,n),e}function Mp(n){if(Po.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Po.set(n,e)}let Co={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Po.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Au.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return un(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function xp(n){Co=n(Co)}function Lp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(mo(this),e,...t);return Au.set(r,e.sort?e.sort():[e]),un(r)}:Np().includes(n)?function(...e){return n.apply(mo(this),e),un(wu.get(this))}:function(...e){return un(n.apply(mo(this),e))}}function Fp(n){return typeof n=="function"?Lp(n):(n instanceof IDBTransaction&&Mp(n),Vp(n,Dp())?new Proxy(n,Co):n)}function un(n){if(n instanceof IDBRequest)return Op(n);if(po.has(n))return po.get(n);const e=Fp(n);return e!==n&&(po.set(n,e),ea.set(e,n)),e}const mo=n=>ea.get(n);function Up(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),l=un(a);return r&&a.addEventListener("upgradeneeded",h=>{r(un(a.result),h.oldVersion,h.newVersion,un(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Bp=["get","getKey","getAll","getAllKeys","count"],jp=["put","add","delete","clear"],go=new Map;function Fc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(go.get(e))return go.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=jp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Bp.includes(t)))return;const o=async function(a,...l){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&h.done]))[0]};return go.set(e,o),o}xp(n=>({...n,get:(e,t,r)=>Fc(e,t)||n.get(e,t,r),has:(e,t)=>!!Fc(e,t)||n.has(e,t)}));class qp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($p(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function $p(n){return n.getComponent()?.type==="VERSION"}const ko="@firebase/app",Uc="0.14.5";const qt=new Zo("@firebase/app"),zp="@firebase/app-compat",Hp="@firebase/analytics-compat",Wp="@firebase/analytics",Gp="@firebase/app-check-compat",Kp="@firebase/app-check",Qp="@firebase/auth",Yp="@firebase/auth-compat",Xp="@firebase/database",Jp="@firebase/data-connect",Zp="@firebase/database-compat",em="@firebase/functions",tm="@firebase/functions-compat",nm="@firebase/installations",rm="@firebase/installations-compat",sm="@firebase/messaging",im="@firebase/messaging-compat",om="@firebase/performance",am="@firebase/performance-compat",cm="@firebase/remote-config",lm="@firebase/remote-config-compat",um="@firebase/storage",hm="@firebase/storage-compat",dm="@firebase/firestore",fm="@firebase/ai",pm="@firebase/firestore-compat",mm="firebase",gm="12.5.0";const Vo="[DEFAULT]",_m={[ko]:"fire-core",[zp]:"fire-core-compat",[Wp]:"fire-analytics",[Hp]:"fire-analytics-compat",[Kp]:"fire-app-check",[Gp]:"fire-app-check-compat",[Qp]:"fire-auth",[Yp]:"fire-auth-compat",[Xp]:"fire-rtdb",[Jp]:"fire-data-connect",[Zp]:"fire-rtdb-compat",[em]:"fire-fn",[tm]:"fire-fn-compat",[nm]:"fire-iid",[rm]:"fire-iid-compat",[sm]:"fire-fcm",[im]:"fire-fcm-compat",[om]:"fire-perf",[am]:"fire-perf-compat",[cm]:"fire-rc",[lm]:"fire-rc-compat",[um]:"fire-gcs",[hm]:"fire-gcs-compat",[dm]:"fire-fst",[pm]:"fire-fst-compat",[fm]:"fire-vertex","fire-js":"fire-js",[mm]:"fire-js-all"};const ei=new Map,ym=new Map,Do=new Map;function Bc(n,e){try{n.container.addComponent(e)}catch(t){qt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cr(n){const e=n.name;if(Do.has(e))return qt.debug(`There were multiple attempts to register component ${e}.`),!1;Do.set(e,n);for(const t of ei.values())Bc(t,n);for(const t of ym.values())Bc(t,n);return!0}function ta(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function gt(n){return n==null?!1:n.settings!==void 0}const vm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hn=new cs("app","Firebase",vm);class Em{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Mn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hn.create("app-deleted",{appName:this._name})}}const gr=gm;function bu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Vo,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw hn.create("bad-app-name",{appName:String(s)});if(t||(t=vu()),!t)throw hn.create("no-options");const o=ei.get(s);if(o){if(On(t,o.options)&&On(r,o.config))return o;throw hn.create("duplicate-app",{appName:s})}const a=new Rp(s);for(const h of Do.values())a.addComponent(h);const l=new Em(t,r,a);return ei.set(s,l),l}function Ru(n=Vo){const e=ei.get(n);if(!e&&n===Vo&&vu())return bu();if(!e)throw hn.create("no-app",{appName:n});return e}function dn(n,e,t){let r=_m[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qt.warn(a.join(" "));return}cr(new Mn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Tm="firebase-heartbeat-database",Im=1,Zr="firebase-heartbeat-store";let _o=null;function Su(){return _o||(_o=Up(Tm,Im,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Zr)}catch(t){console.warn(t)}}}}).catch(n=>{throw hn.create("idb-open",{originalErrorMessage:n.message})})),_o}async function wm(n){try{const t=(await Su()).transaction(Zr),r=await t.objectStore(Zr).get(Pu(n));return await t.done,r}catch(e){if(e instanceof Gt)qt.warn(e.message);else{const t=hn.create("idb-get",{originalErrorMessage:e?.message});qt.warn(t.message)}}}async function jc(n,e){try{const r=(await Su()).transaction(Zr,"readwrite");await r.objectStore(Zr).put(e,Pu(n)),await r.done}catch(t){if(t instanceof Gt)qt.warn(t.message);else{const r=hn.create("idb-set",{originalErrorMessage:t?.message});qt.warn(r.message)}}}function Pu(n){return`${n.name}!${n.options.appId}`}const Am=1024,bm=30;class Rm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=qc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>bm){const s=Cm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){qt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=qc(),{heartbeatsToSend:t,unsentEntries:r}=Sm(this._heartbeatsCache.heartbeats),s=Zs(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return qt.warn(e),""}}}function qc(){return new Date().toISOString().substring(0,10)}function Sm(n,e=Am){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),$c(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),$c(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Pm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pp()?mp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await wm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return jc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return jc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function $c(n){return Zs(JSON.stringify({version:2,heartbeats:n})).length}function Cm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function km(n){cr(new Mn("platform-logger",e=>new qp(e),"PRIVATE")),cr(new Mn("heartbeat",e=>new Rm(e),"PRIVATE")),dn(ko,Uc,n),dn(ko,Uc,"esm2020"),dn("fire-js","")}km("");var Vm="firebase",Dm="12.5.0";dn(Vm,Dm,"app");function Cu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nm=Cu,ku=new cs("auth","Firebase",Cu());const ti=new Zo("@firebase/auth");function Om(n,...e){ti.logLevel<=te.WARN&&ti.warn(`Auth (${gr}): ${n}`,...e)}function qs(n,...e){ti.logLevel<=te.ERROR&&ti.error(`Auth (${gr}): ${n}`,...e)}function Tt(n,...e){throw na(n,...e)}function St(n,...e){return na(n,...e)}function Vu(n,e,t){const r={...Nm(),[e]:t};return new cs("auth","Firebase",r).create(e,{appName:n.name})}function Bt(n){return Vu(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function na(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ku.create(n,...e)}function H(n,e,...t){if(!n)throw na(e,...t)}function Ft(n){const e="INTERNAL ASSERTION FAILED: "+n;throw qs(e),new Error(e)}function $t(n,e){n||Ft(e)}function No(){return typeof self<"u"&&self.location?.href||""}function Mm(){return zc()==="http:"||zc()==="https:"}function zc(){return typeof self<"u"&&self.location?.protocol||null}function xm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mm()||up()||"connection"in navigator)?navigator.onLine:!0}function Lm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class us{constructor(e,t){this.shortDelay=e,this.longDelay=t,$t(t>e,"Short delay should be less than long delay!"),this.isMobile=ap()||hp()}get(){return xm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ra(n,e){$t(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Du{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Fm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Um=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Bm=new us(3e4,6e4);function Kt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Qt(n,e,t,r,s={}){return Nu(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const l=ls({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return lp()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&mr(n.emulatorConfig.host)&&(d.credentials="include"),Du.fetch()(await Ou(n,n.config.apiHost,t,l),d)})}async function Nu(n,e,t){n._canInitEmulator=!1;const r={...Fm,...e};try{const s=new qm(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw Ms(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const l=o.ok?a.errorMessage:a.error.message,[h,d]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ms(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Ms(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Ms(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Vu(n,p,d);Tt(n,p)}}catch(s){if(s instanceof Gt)throw s;Tt(n,"network-request-failed",{message:String(s)})}}async function hs(n,e,t,r,s={}){const o=await Qt(n,e,t,r,s);return"mfaPendingCredential"in o&&Tt(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function Ou(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?ra(n.config,s):`${n.config.apiScheme}://${s}`;return Um.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function jm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(St(this.auth,"network-request-failed")),Bm.get())})}}function Ms(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=St(n,e,r);return s.customData._tokenResponse=t,s}function Hc(n){return n!==void 0&&n.enterprise!==void 0}class $m{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function zm(n,e){return Qt(n,"GET","/v2/recaptchaConfig",Kt(n,e))}async function Hm(n,e){return Qt(n,"POST","/v1/accounts:delete",e)}async function ni(n,e){return Qt(n,"POST","/v1/accounts:lookup",e)}function Wr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wm(n,e=!1){const t=He(n),r=await t.getIdToken(e),s=sa(r);H(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:Wr(yo(s.auth_time)),issuedAtTime:Wr(yo(s.iat)),expirationTime:Wr(yo(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function yo(n){return Number(n)*1e3}function sa(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return qs("JWT malformed, contained fewer than 3 sections"),null;try{const s=_u(t);return s?JSON.parse(s):(qs("Failed to decode base64 JWT payload"),null)}catch(s){return qs("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Wc(n){const e=sa(n);return H(e,"internal-error"),H(typeof e.exp<"u","internal-error"),H(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function es(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Gt&&Gm(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Gm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Km{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Oo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wr(this.lastLoginAt),this.creationTime=Wr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ri(n){const e=n.auth,t=await n.getIdToken(),r=await es(n,ni(e,{idToken:t}));H(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Mu(s.providerUserInfo):[],a=Ym(n.providerData,o),l=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=l?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Oo(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function Qm(n){const e=He(n);await ri(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ym(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Mu(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Xm(n,e){const t=await Nu(n,{},async()=>{const r=ls({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await Ou(n,s,"/v1/token",`key=${o}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:l,body:r};return n.emulatorConfig&&mr(n.emulatorConfig.host)&&(h.credentials="include"),Du.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Jm(n,e){return Qt(n,"POST","/v2/accounts:revokeToken",Kt(n,e))}class rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){H(e.idToken,"internal-error"),H(typeof e.idToken<"u","internal-error"),H(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Wc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){H(e.length!==0,"internal-error");const t=Wc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(H(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await Xm(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new rr;return r&&(H(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(H(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(H(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rr,this.toJSON())}_performRefresh(){return Ft("not implemented")}}function rn(n,e){H(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Et{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Km(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Oo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await es(this,this.stsTokenManager.getToken(this.auth,e));return H(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Wm(this,e)}reload(){return Qm(this)}_assign(e){this!==e&&(H(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Et({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){H(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ri(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(gt(this.auth.app))return Promise.reject(Bt(this.auth));const e=await this.getIdToken();return await es(this,Hm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:v,emailVerified:E,isAnonymous:b,providerData:P,stsTokenManager:D}=t;H(v&&D,e,"internal-error");const k=rr.fromJSON(this.name,D);H(typeof v=="string",e,"internal-error"),rn(r,e.name),rn(s,e.name),H(typeof E=="boolean",e,"internal-error"),H(typeof b=="boolean",e,"internal-error"),rn(o,e.name),rn(a,e.name),rn(l,e.name),rn(h,e.name),rn(d,e.name),rn(p,e.name);const B=new Et({uid:v,auth:e,email:s,emailVerified:E,displayName:r,isAnonymous:b,photoURL:a,phoneNumber:o,tenantId:l,stsTokenManager:k,createdAt:d,lastLoginAt:p});return P&&Array.isArray(P)&&(B.providerData=P.map(j=>({...j}))),h&&(B._redirectEventId=h),B}static async _fromIdTokenResponse(e,t,r=!1){const s=new rr;s.updateFromServerResponse(t);const o=new Et({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ri(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];H(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Mu(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,l=new rr;l.updateFromIdToken(r);const h=new Et({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Oo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Gc=new Map;function Ut(n){$t(n instanceof Function,"Expected a class definition");let e=Gc.get(n);return e?($t(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Gc.set(n,e),e)}class xu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}xu.type="NONE";const Kc=xu;function $s(n,e,t){return`firebase:${n}:${e}:${t}`}class sr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=$s(this.userKey,s.apiKey,o),this.fullPersistenceKey=$s("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ni(this.auth,{idToken:e}).catch(()=>{});return t?Et._fromGetAccountInfoResponse(this.auth,t,e):null}return Et._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new sr(Ut(Kc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||Ut(Kc);const a=$s(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const p=await d._get(a);if(p){let v;if(typeof p=="string"){const E=await ni(e,{idToken:p}).catch(()=>{});if(!E)break;v=await Et._fromGetAccountInfoResponse(e,E,p)}else v=Et._fromJSON(e,p);d!==o&&(l=v),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new sr(o,e,r):(o=h[0],l&&await o._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new sr(o,e,r))}}function Qc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Bu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Lu(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(qu(e))return"Blackberry";if($u(e))return"Webos";if(Fu(e))return"Safari";if((e.includes("chrome/")||Uu(e))&&!e.includes("edge/"))return"Chrome";if(ju(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Lu(n=rt()){return/firefox\//i.test(n)}function Fu(n=rt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Uu(n=rt()){return/crios\//i.test(n)}function Bu(n=rt()){return/iemobile/i.test(n)}function ju(n=rt()){return/android/i.test(n)}function qu(n=rt()){return/blackberry/i.test(n)}function $u(n=rt()){return/webos/i.test(n)}function ia(n=rt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Zm(n=rt()){return ia(n)&&!!window.navigator?.standalone}function eg(){return dp()&&document.documentMode===10}function zu(n=rt()){return ia(n)||ju(n)||$u(n)||qu(n)||/windows phone/i.test(n)||Bu(n)}function Hu(n,e=[]){let t;switch(n){case"Browser":t=Qc(rt());break;case"Worker":t=`${Qc(rt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gr}/${r}`}class tg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,l)=>{try{const h=e(o);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function ng(n,e={}){return Qt(n,"GET","/v2/passwordPolicy",Kt(n,e))}const rg=6;class sg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??rg,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class ig{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yc(this),this.idTokenSubscription=new Yc(this),this.beforeStateQueue=new tg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ku,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ut(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await sr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ni(this,{idToken:e}),r=await Et._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(gt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return H(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ri(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Lm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(gt(this.app))return Promise.reject(Bt(this));const t=e?He(e):null;return t&&H(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&H(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return gt(this.app)?Promise.reject(Bt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return gt(this.app)?Promise.reject(Bt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ut(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ng(this),t=new sg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new cs("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Jm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ut(e)||this._popupRedirectResolver;H(t,this,"argument-error"),this.redirectPersistenceManager=await sr.create(this,[Ut(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(H(l,this,"internal-error"),l.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return H(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Hu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(gt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Om(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Tn(n){return He(n)}class Yc{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ep(t=>this.observer=t)}get next(){return H(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let bi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function og(n){bi=n}function Wu(n){return bi.loadJS(n)}function ag(){return bi.recaptchaEnterpriseScript}function cg(){return bi.gapiScript}function lg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ug{constructor(){this.enterprise=new hg}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class hg{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const dg="recaptcha-enterprise",Gu="NO_RECAPTCHA";class fg{constructor(e){this.type=dg,this.auth=Tn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,l)=>{zm(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new $m(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{l(h)})})}function s(o,a,l){const h=window.grecaptcha;Hc(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(Gu)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ug().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(l=>{if(!t&&Hc(window.grecaptcha))s(l,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=ag();h.length!==0&&(h+=l),Wu(h).then(()=>{s(l,o,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Xc(n,e,t,r=!1,s=!1){const o=new fg(n);let a;if(s)a=Gu;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const h=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const h=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function si(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Xc(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Xc(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}function pg(n,e){const t=ta(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(On(o,e??{}))return s;Tt(s,"already-initialized")}return t.initialize({options:e})}function mg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Ut);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function gg(n,e,t){const r=Tn(n);H(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=Ku(e),{host:a,port:l}=_g(e),h=l===null?"":`:${l}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){H(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),H(On(d,r.config.emulator)&&On(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,mr(a)?(Tu(`${o}//${a}${h}`),Iu("Auth",!0)):yg()}function Ku(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function _g(n){const e=Ku(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:Jc(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:Jc(a)}}}function Jc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function yg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class oa{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ft("not implemented")}_getIdTokenResponse(e){return Ft("not implemented")}_linkToIdToken(e,t){return Ft("not implemented")}_getReauthenticationResolver(e){return Ft("not implemented")}}async function vg(n,e){return Qt(n,"POST","/v1/accounts:signUp",e)}async function Eg(n,e){return hs(n,"POST","/v1/accounts:signInWithPassword",Kt(n,e))}async function Tg(n,e){return Qt(n,"POST","/v1/accounts:sendOobCode",Kt(n,e))}async function Ig(n,e){return Tg(n,e)}async function wg(n,e){return hs(n,"POST","/v1/accounts:signInWithEmailLink",Kt(n,e))}async function Ag(n,e){return hs(n,"POST","/v1/accounts:signInWithEmailLink",Kt(n,e))}class ts extends oa{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new ts(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ts(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return si(e,t,"signInWithPassword",Eg);case"emailLink":return wg(e,{email:this._email,oobCode:this._password});default:Tt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return si(e,r,"signUpPassword",vg);case"emailLink":return Ag(e,{idToken:t,email:this._email,oobCode:this._password});default:Tt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ir(n,e){return hs(n,"POST","/v1/accounts:signInWithIdp",Kt(n,e))}const bg="http://localhost";class xn extends oa{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Tt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new xn(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ir(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ir(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ir(e,t)}buildRequest(){const e={requestUri:bg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ls(t)}return e}}function Rg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Sg(n){const e=Fr(Ur(n)).link,t=e?Fr(Ur(e)).deep_link_id:null,r=Fr(Ur(n)).deep_link_id;return(r?Fr(Ur(r)).link:null)||r||t||e||n}class aa{constructor(e){const t=Fr(Ur(e)),r=t.apiKey??null,s=t.oobCode??null,o=Rg(t.mode??null);H(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Sg(e);try{return new aa(t)}catch{return null}}}class Bn{constructor(){this.providerId=Bn.PROVIDER_ID}static credential(e,t){return ts._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=aa.parseLink(t);return H(r,"argument-error"),ts._fromEmailAndCode(e,r.code,r.tenantId)}}Bn.PROVIDER_ID="password";Bn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Qu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ds extends Qu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class sn extends ds{constructor(){super("facebook.com")}static credential(e){return xn._fromParams({providerId:sn.PROVIDER_ID,signInMethod:sn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sn.credentialFromTaggedObject(e)}static credentialFromError(e){return sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sn.credential(e.oauthAccessToken)}catch{return null}}}sn.FACEBOOK_SIGN_IN_METHOD="facebook.com";sn.PROVIDER_ID="facebook.com";class on extends ds{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return xn._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return on.credential(t,r)}catch{return null}}}on.GOOGLE_SIGN_IN_METHOD="google.com";on.PROVIDER_ID="google.com";class an extends ds{constructor(){super("github.com")}static credential(e){return xn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.GITHUB_SIGN_IN_METHOD="github.com";an.PROVIDER_ID="github.com";class cn extends ds{constructor(){super("twitter.com")}static credential(e,t){return xn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return cn.credential(t,r)}catch{return null}}}cn.TWITTER_SIGN_IN_METHOD="twitter.com";cn.PROVIDER_ID="twitter.com";async function Pg(n,e){return hs(n,"POST","/v1/accounts:signUp",Kt(n,e))}class Ln{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await Et._fromIdTokenResponse(e,r,s),a=Zc(r);return new Ln({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Zc(r);return new Ln({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Zc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class ii extends Gt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ii.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ii(e,t,r,s)}}function Yu(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?ii._fromErrorAndOperation(n,o,e,r):o})}async function Cg(n,e,t=!1){const r=await es(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ln._forOperation(n,"link",r)}async function Xu(n,e,t=!1){const{auth:r}=n;if(gt(r.app))return Promise.reject(Bt(r));const s="reauthenticate";try{const o=await es(n,Yu(r,s,e,n),t);H(o.idToken,r,"internal-error");const a=sa(o.idToken);H(a,r,"internal-error");const{sub:l}=a;return H(n.uid===l,r,"user-mismatch"),Ln._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&Tt(r,"user-mismatch"),o}}async function Ju(n,e,t=!1){if(gt(n.app))return Promise.reject(Bt(n));const r="signIn",s=await Yu(n,r,e),o=await Ln._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}async function kg(n,e){return Ju(Tn(n),e)}async function Vg(n,e){return Xu(He(n),e)}async function Zu(n){const e=Tn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Dg(n,e,t){const r=Tn(n);await si(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Ig)}async function Ng(n,e,t){if(gt(n.app))return Promise.reject(Bt(n));const r=Tn(n),a=await si(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Pg).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&Zu(n),h}),l=await Ln._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Og(n,e,t){return gt(n.app)?Promise.reject(Bt(n)):kg(He(n),Bn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Zu(n),r})}function Mg(n,e,t,r){return He(n).onIdTokenChanged(e,t,r)}function xg(n,e,t){return He(n).beforeAuthStateChanged(e,t)}function Lg(n,e,t,r){return He(n).onAuthStateChanged(e,t,r)}function Fg(n){return He(n).signOut()}const oi="__sak";class eh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(oi,"1"),this.storage.removeItem(oi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ug=1e3,Bg=10;class th extends eh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);eg()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Bg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Ug)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}th.type="LOCAL";const jg=th;class nh extends eh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nh.type="SESSION";const rh=nh;function qg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Ri{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Ri(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,o)),h=await qg(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ri.receivers=[];function ca(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class $g{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((l,h)=>{const d=ca("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(v){const E=v;if(E.data.eventId===d)switch(E.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),l(E.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Pt(){return window}function zg(n){Pt().location.href=n}function sh(){return typeof Pt().WorkerGlobalScope<"u"&&typeof Pt().importScripts=="function"}async function Hg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Wg(){return navigator?.serviceWorker?.controller||null}function Gg(){return sh()?self:null}const ih="firebaseLocalStorageDb",Kg=1,ai="firebaseLocalStorage",oh="fbase_key";class fs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Si(n,e){return n.transaction([ai],e?"readwrite":"readonly").objectStore(ai)}function Qg(){const n=indexedDB.deleteDatabase(ih);return new fs(n).toPromise()}function Mo(){const n=indexedDB.open(ih,Kg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(ai,{keyPath:oh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(ai)?e(r):(r.close(),await Qg(),e(await Mo()))})})}async function el(n,e,t){const r=Si(n,!0).put({[oh]:e,value:t});return new fs(r).toPromise()}async function Yg(n,e){const t=Si(n,!1).get(e),r=await new fs(t).toPromise();return r===void 0?null:r.value}function tl(n,e){const t=Si(n,!0).delete(e);return new fs(t).toPromise()}const Xg=800,Jg=3;class ah{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Mo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Jg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ri._getInstance(Gg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Hg(),!this.activeServiceWorker)return;this.sender=new $g(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Wg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Mo();return await el(e,oi,"1"),await tl(e,oi),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>el(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Yg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=Si(s,!1).getAll();return new fs(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Xg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ah.type="LOCAL";const Zg=ah;new us(3e4,6e4);function e_(n,e){return e?Ut(e):(H(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class la extends oa{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ir(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ir(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ir(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function t_(n){return Ju(n.auth,new la(n),n.bypassAuthState)}function n_(n){const{auth:e,user:t}=n;return H(t,e,"internal-error"),Xu(t,new la(n),n.bypassAuthState)}async function r_(n){const{auth:e,user:t}=n;return H(t,e,"internal-error"),Cg(t,new la(n),n.bypassAuthState)}class ch{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:l}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return t_;case"linkViaPopup":case"linkViaRedirect":return r_;case"reauthViaPopup":case"reauthViaRedirect":return n_;default:Tt(this.auth,"internal-error")}}resolve(e){$t(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$t(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const s_=new us(2e3,1e4);class er extends ch{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,er.currentPopupAction&&er.currentPopupAction.cancel(),er.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return H(e,this.auth,"internal-error"),e}async onExecution(){$t(this.filter.length===1,"Popup operations only handle one event");const e=ca();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(St(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(St(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,er.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(St(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,s_.get())};e()}}er.currentPopupAction=null;const i_="pendingRedirect",zs=new Map;class o_ extends ch{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=zs.get(this.auth._key());if(!e){try{const r=await a_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}zs.set(this.auth._key(),e)}return this.bypassAuthState||zs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function a_(n,e){const t=u_(e),r=l_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function c_(n,e){zs.set(n._key(),e)}function l_(n){return Ut(n._redirectPersistence)}function u_(n){return $s(i_,n.config.apiKey,n.name)}async function h_(n,e,t=!1){if(gt(n.app))return Promise.reject(Bt(n));const r=Tn(n),s=e_(r,e),a=await new o_(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const d_=600*1e3;class f_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!p_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!lh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(St(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=d_&&this.cachedEventUids.clear(),this.cachedEventUids.has(nl(e))}saveEventToCache(e){this.cachedEventUids.add(nl(e)),this.lastProcessedEventTime=Date.now()}}function nl(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function p_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lh(n);default:return!1}}async function m_(n,e={}){return Qt(n,"GET","/v1/projects",e)}const g_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,__=/^https?/;async function y_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await m_(n);for(const t of e)try{if(v_(t))return}catch{}Tt(n,"unauthorized-domain")}function v_(n){const e=No(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!__.test(t))return!1;if(g_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const E_=new us(3e4,6e4);function rl(){const n=Pt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function T_(n){return new Promise((e,t)=>{function r(){rl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rl(),t(St(n,"network-request-failed"))},timeout:E_.get()})}if(Pt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Pt().gapi?.load)r();else{const s=lg("iframefcb");return Pt()[s]=()=>{gapi.load?r():t(St(n,"network-request-failed"))},Wu(`${cg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw Hs=null,e})}let Hs=null;function I_(n){return Hs=Hs||T_(n),Hs}const w_=new us(5e3,15e3),A_="__/auth/iframe",b_="emulator/auth/iframe",R_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},S_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function P_(n){const e=n.config;H(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ra(e,b_):`https://${n.config.authDomain}/${A_}`,r={apiKey:e.apiKey,appName:n.name,v:gr},s=S_.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${ls(r).slice(1)}`}async function C_(n){const e=await I_(n),t=Pt().gapi;return H(t,n,"internal-error"),e.open({where:document.body,url:P_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:R_,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=St(n,"network-request-failed"),l=Pt().setTimeout(()=>{o(a)},w_.get());function h(){Pt().clearTimeout(l),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const k_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},V_=500,D_=600,N_="_blank",O_="http://localhost";class sl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function M_(n,e,t,r=V_,s=D_){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h={...k_,width:r.toString(),height:s.toString(),top:o,left:a},d=rt().toLowerCase();t&&(l=Uu(d)?N_:t),Lu(d)&&(e=e||O_,h.scrollbars="yes");const p=Object.entries(h).reduce((E,[b,P])=>`${E}${b}=${P},`,"");if(Zm(d)&&l!=="_self")return x_(e||"",l),new sl(null);const v=window.open(e||"",l,p);H(v,n,"popup-blocked");try{v.focus()}catch{}return new sl(v)}function x_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const L_="__/auth/handler",F_="emulator/auth/handler",U_=encodeURIComponent("fac");async function il(n,e,t,r,s,o){H(n.config.authDomain,n,"auth-domain-config-required"),H(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:gr,eventId:s};if(e instanceof Qu){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",vp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,v]of Object.entries({}))a[p]=v}if(e instanceof ds){const p=e.getScopes().filter(v=>v!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const h=await n._getAppCheckToken(),d=h?`#${U_}=${encodeURIComponent(h)}`:"";return`${B_(n)}?${ls(l).slice(1)}${d}`}function B_({config:n}){return n.emulator?ra(n,F_):`https://${n.authDomain}/${L_}`}const vo="webStorageSupport";class j_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rh,this._completeRedirectFn=h_,this._overrideRedirectResult=c_}async _openPopup(e,t,r,s){$t(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await il(e,t,r,No(),s);return M_(e,o,ca())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await il(e,t,r,No(),s);return zg(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):($t(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await C_(e),r=new f_(e);return t.register("authEvent",s=>(H(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(vo,{type:vo},s=>{const o=s?.[0]?.[vo];o!==void 0&&t(!!o),Tt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=y_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return zu()||Fu()||ia()}}const q_=j_;var ol="@firebase/auth",al="1.11.1";class $_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){H(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function z_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function H_(n){cr(new Mn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;H(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Hu(n)},d=new ig(r,s,o,h);return mg(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),cr(new Mn("auth-internal",e=>{const t=Tn(e.getProvider("auth").getImmediate());return(r=>new $_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),dn(ol,al,z_(n)),dn(ol,al,"esm2020")}const W_=300,G_=Eu("authIdTokenMaxAge")||W_;let cl=null;const K_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>G_)return;const s=t?.token;cl!==s&&(cl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Q_(n=Ru()){const e=ta(n,"auth");if(e.isInitialized())return e.getImmediate();const t=pg(n,{popupRedirectResolver:q_,persistence:[Zg,jg,rh]}),r=Eu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=K_(o.toString());xg(t,a,()=>a(t.currentUser)),Mg(t,l=>a(l))}}const s=yu("auth");return s&&gg(t,`http://${s}`),t}function Y_(){return document.getElementsByTagName("head")?.[0]??document}og({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=St("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",Y_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});H_("Browser");var ll=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var fn,uh;(function(){var n;function e(I,g){function _(){}_.prototype=g.prototype,I.F=g.prototype,I.prototype=new _,I.prototype.constructor=I,I.D=function(A,y,T){for(var m=Array(arguments.length-2),M=2;M<arguments.length;M++)m[M-2]=arguments[M];return g.prototype[y].apply(A,m)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,g,_){_||(_=0);const A=Array(16);if(typeof g=="string")for(var y=0;y<16;++y)A[y]=g.charCodeAt(_++)|g.charCodeAt(_++)<<8|g.charCodeAt(_++)<<16|g.charCodeAt(_++)<<24;else for(y=0;y<16;++y)A[y]=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24;g=I.g[0],_=I.g[1],y=I.g[2];let T=I.g[3],m;m=g+(T^_&(y^T))+A[0]+3614090360&4294967295,g=_+(m<<7&4294967295|m>>>25),m=T+(y^g&(_^y))+A[1]+3905402710&4294967295,T=g+(m<<12&4294967295|m>>>20),m=y+(_^T&(g^_))+A[2]+606105819&4294967295,y=T+(m<<17&4294967295|m>>>15),m=_+(g^y&(T^g))+A[3]+3250441966&4294967295,_=y+(m<<22&4294967295|m>>>10),m=g+(T^_&(y^T))+A[4]+4118548399&4294967295,g=_+(m<<7&4294967295|m>>>25),m=T+(y^g&(_^y))+A[5]+1200080426&4294967295,T=g+(m<<12&4294967295|m>>>20),m=y+(_^T&(g^_))+A[6]+2821735955&4294967295,y=T+(m<<17&4294967295|m>>>15),m=_+(g^y&(T^g))+A[7]+4249261313&4294967295,_=y+(m<<22&4294967295|m>>>10),m=g+(T^_&(y^T))+A[8]+1770035416&4294967295,g=_+(m<<7&4294967295|m>>>25),m=T+(y^g&(_^y))+A[9]+2336552879&4294967295,T=g+(m<<12&4294967295|m>>>20),m=y+(_^T&(g^_))+A[10]+4294925233&4294967295,y=T+(m<<17&4294967295|m>>>15),m=_+(g^y&(T^g))+A[11]+2304563134&4294967295,_=y+(m<<22&4294967295|m>>>10),m=g+(T^_&(y^T))+A[12]+1804603682&4294967295,g=_+(m<<7&4294967295|m>>>25),m=T+(y^g&(_^y))+A[13]+4254626195&4294967295,T=g+(m<<12&4294967295|m>>>20),m=y+(_^T&(g^_))+A[14]+2792965006&4294967295,y=T+(m<<17&4294967295|m>>>15),m=_+(g^y&(T^g))+A[15]+1236535329&4294967295,_=y+(m<<22&4294967295|m>>>10),m=g+(y^T&(_^y))+A[1]+4129170786&4294967295,g=_+(m<<5&4294967295|m>>>27),m=T+(_^y&(g^_))+A[6]+3225465664&4294967295,T=g+(m<<9&4294967295|m>>>23),m=y+(g^_&(T^g))+A[11]+643717713&4294967295,y=T+(m<<14&4294967295|m>>>18),m=_+(T^g&(y^T))+A[0]+3921069994&4294967295,_=y+(m<<20&4294967295|m>>>12),m=g+(y^T&(_^y))+A[5]+3593408605&4294967295,g=_+(m<<5&4294967295|m>>>27),m=T+(_^y&(g^_))+A[10]+38016083&4294967295,T=g+(m<<9&4294967295|m>>>23),m=y+(g^_&(T^g))+A[15]+3634488961&4294967295,y=T+(m<<14&4294967295|m>>>18),m=_+(T^g&(y^T))+A[4]+3889429448&4294967295,_=y+(m<<20&4294967295|m>>>12),m=g+(y^T&(_^y))+A[9]+568446438&4294967295,g=_+(m<<5&4294967295|m>>>27),m=T+(_^y&(g^_))+A[14]+3275163606&4294967295,T=g+(m<<9&4294967295|m>>>23),m=y+(g^_&(T^g))+A[3]+4107603335&4294967295,y=T+(m<<14&4294967295|m>>>18),m=_+(T^g&(y^T))+A[8]+1163531501&4294967295,_=y+(m<<20&4294967295|m>>>12),m=g+(y^T&(_^y))+A[13]+2850285829&4294967295,g=_+(m<<5&4294967295|m>>>27),m=T+(_^y&(g^_))+A[2]+4243563512&4294967295,T=g+(m<<9&4294967295|m>>>23),m=y+(g^_&(T^g))+A[7]+1735328473&4294967295,y=T+(m<<14&4294967295|m>>>18),m=_+(T^g&(y^T))+A[12]+2368359562&4294967295,_=y+(m<<20&4294967295|m>>>12),m=g+(_^y^T)+A[5]+4294588738&4294967295,g=_+(m<<4&4294967295|m>>>28),m=T+(g^_^y)+A[8]+2272392833&4294967295,T=g+(m<<11&4294967295|m>>>21),m=y+(T^g^_)+A[11]+1839030562&4294967295,y=T+(m<<16&4294967295|m>>>16),m=_+(y^T^g)+A[14]+4259657740&4294967295,_=y+(m<<23&4294967295|m>>>9),m=g+(_^y^T)+A[1]+2763975236&4294967295,g=_+(m<<4&4294967295|m>>>28),m=T+(g^_^y)+A[4]+1272893353&4294967295,T=g+(m<<11&4294967295|m>>>21),m=y+(T^g^_)+A[7]+4139469664&4294967295,y=T+(m<<16&4294967295|m>>>16),m=_+(y^T^g)+A[10]+3200236656&4294967295,_=y+(m<<23&4294967295|m>>>9),m=g+(_^y^T)+A[13]+681279174&4294967295,g=_+(m<<4&4294967295|m>>>28),m=T+(g^_^y)+A[0]+3936430074&4294967295,T=g+(m<<11&4294967295|m>>>21),m=y+(T^g^_)+A[3]+3572445317&4294967295,y=T+(m<<16&4294967295|m>>>16),m=_+(y^T^g)+A[6]+76029189&4294967295,_=y+(m<<23&4294967295|m>>>9),m=g+(_^y^T)+A[9]+3654602809&4294967295,g=_+(m<<4&4294967295|m>>>28),m=T+(g^_^y)+A[12]+3873151461&4294967295,T=g+(m<<11&4294967295|m>>>21),m=y+(T^g^_)+A[15]+530742520&4294967295,y=T+(m<<16&4294967295|m>>>16),m=_+(y^T^g)+A[2]+3299628645&4294967295,_=y+(m<<23&4294967295|m>>>9),m=g+(y^(_|~T))+A[0]+4096336452&4294967295,g=_+(m<<6&4294967295|m>>>26),m=T+(_^(g|~y))+A[7]+1126891415&4294967295,T=g+(m<<10&4294967295|m>>>22),m=y+(g^(T|~_))+A[14]+2878612391&4294967295,y=T+(m<<15&4294967295|m>>>17),m=_+(T^(y|~g))+A[5]+4237533241&4294967295,_=y+(m<<21&4294967295|m>>>11),m=g+(y^(_|~T))+A[12]+1700485571&4294967295,g=_+(m<<6&4294967295|m>>>26),m=T+(_^(g|~y))+A[3]+2399980690&4294967295,T=g+(m<<10&4294967295|m>>>22),m=y+(g^(T|~_))+A[10]+4293915773&4294967295,y=T+(m<<15&4294967295|m>>>17),m=_+(T^(y|~g))+A[1]+2240044497&4294967295,_=y+(m<<21&4294967295|m>>>11),m=g+(y^(_|~T))+A[8]+1873313359&4294967295,g=_+(m<<6&4294967295|m>>>26),m=T+(_^(g|~y))+A[15]+4264355552&4294967295,T=g+(m<<10&4294967295|m>>>22),m=y+(g^(T|~_))+A[6]+2734768916&4294967295,y=T+(m<<15&4294967295|m>>>17),m=_+(T^(y|~g))+A[13]+1309151649&4294967295,_=y+(m<<21&4294967295|m>>>11),m=g+(y^(_|~T))+A[4]+4149444226&4294967295,g=_+(m<<6&4294967295|m>>>26),m=T+(_^(g|~y))+A[11]+3174756917&4294967295,T=g+(m<<10&4294967295|m>>>22),m=y+(g^(T|~_))+A[2]+718787259&4294967295,y=T+(m<<15&4294967295|m>>>17),m=_+(T^(y|~g))+A[9]+3951481745&4294967295,I.g[0]=I.g[0]+g&4294967295,I.g[1]=I.g[1]+(y+(m<<21&4294967295|m>>>11))&4294967295,I.g[2]=I.g[2]+y&4294967295,I.g[3]=I.g[3]+T&4294967295}r.prototype.v=function(I,g){g===void 0&&(g=I.length);const _=g-this.blockSize,A=this.C;let y=this.h,T=0;for(;T<g;){if(y==0)for(;T<=_;)s(this,I,T),T+=this.blockSize;if(typeof I=="string"){for(;T<g;)if(A[y++]=I.charCodeAt(T++),y==this.blockSize){s(this,A),y=0;break}}else for(;T<g;)if(A[y++]=I[T++],y==this.blockSize){s(this,A),y=0;break}}this.h=y,this.o+=g},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var g=1;g<I.length-8;++g)I[g]=0;g=this.o*8;for(var _=I.length-8;_<I.length;++_)I[_]=g&255,g/=256;for(this.v(I),I=Array(16),g=0,_=0;_<4;++_)for(let A=0;A<32;A+=8)I[g++]=this.g[_]>>>A&255;return I};function o(I,g){var _=l;return Object.prototype.hasOwnProperty.call(_,I)?_[I]:_[I]=g(I)}function a(I,g){this.h=g;const _=[];let A=!0;for(let y=I.length-1;y>=0;y--){const T=I[y]|0;A&&T==g||(_[y]=T,A=!1)}this.g=_}var l={};function h(I){return-128<=I&&I<128?o(I,function(g){return new a([g|0],g<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return v;if(I<0)return k(d(-I));const g=[];let _=1;for(let A=0;I>=_;A++)g[A]=I/_|0,_*=4294967296;return new a(g,0)}function p(I,g){if(I.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(I.charAt(0)=="-")return k(p(I.substring(1),g));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(g,8));let A=v;for(let T=0;T<I.length;T+=8){var y=Math.min(8,I.length-T);const m=parseInt(I.substring(T,T+y),g);y<8?(y=d(Math.pow(g,y)),A=A.j(y).add(d(m))):(A=A.j(_),A=A.add(d(m)))}return A}var v=h(0),E=h(1),b=h(16777216);n=a.prototype,n.m=function(){if(D(this))return-k(this).m();let I=0,g=1;for(let _=0;_<this.g.length;_++){const A=this.i(_);I+=(A>=0?A:4294967296+A)*g,g*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(P(this))return"0";if(D(this))return"-"+k(this).toString(I);const g=d(Math.pow(I,6));var _=this;let A="";for(;;){const y=K(_,g).g;_=B(_,y.j(g));let T=((_.g.length>0?_.g[0]:_.h)>>>0).toString(I);if(_=y,P(_))return T+A;for(;T.length<6;)T="0"+T;A=T+A}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function P(I){if(I.h!=0)return!1;for(let g=0;g<I.g.length;g++)if(I.g[g]!=0)return!1;return!0}function D(I){return I.h==-1}n.l=function(I){return I=B(this,I),D(I)?-1:P(I)?0:1};function k(I){const g=I.g.length,_=[];for(let A=0;A<g;A++)_[A]=~I.g[A];return new a(_,~I.h).add(E)}n.abs=function(){return D(this)?k(this):this},n.add=function(I){const g=Math.max(this.g.length,I.g.length),_=[];let A=0;for(let y=0;y<=g;y++){let T=A+(this.i(y)&65535)+(I.i(y)&65535),m=(T>>>16)+(this.i(y)>>>16)+(I.i(y)>>>16);A=m>>>16,T&=65535,m&=65535,_[y]=m<<16|T}return new a(_,_[_.length-1]&-2147483648?-1:0)};function B(I,g){return I.add(k(g))}n.j=function(I){if(P(this)||P(I))return v;if(D(this))return D(I)?k(this).j(k(I)):k(k(this).j(I));if(D(I))return k(this.j(k(I)));if(this.l(b)<0&&I.l(b)<0)return d(this.m()*I.m());const g=this.g.length+I.g.length,_=[];for(var A=0;A<2*g;A++)_[A]=0;for(A=0;A<this.g.length;A++)for(let y=0;y<I.g.length;y++){const T=this.i(A)>>>16,m=this.i(A)&65535,M=I.i(y)>>>16,U=I.i(y)&65535;_[2*A+2*y]+=m*U,j(_,2*A+2*y),_[2*A+2*y+1]+=T*U,j(_,2*A+2*y+1),_[2*A+2*y+1]+=m*M,j(_,2*A+2*y+1),_[2*A+2*y+2]+=T*M,j(_,2*A+2*y+2)}for(I=0;I<g;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=g;I<2*g;I++)_[I]=0;return new a(_,0)};function j(I,g){for(;(I[g]&65535)!=I[g];)I[g+1]+=I[g]>>>16,I[g]&=65535,g++}function L(I,g){this.g=I,this.h=g}function K(I,g){if(P(g))throw Error("division by zero");if(P(I))return new L(v,v);if(D(I))return g=K(k(I),g),new L(k(g.g),k(g.h));if(D(g))return g=K(I,k(g)),new L(k(g.g),g.h);if(I.g.length>30){if(D(I)||D(g))throw Error("slowDivide_ only works with positive integers.");for(var _=E,A=g;A.l(I)<=0;)_=z(_),A=z(A);var y=Z(_,1),T=Z(A,1);for(A=Z(A,2),_=Z(_,2);!P(A);){var m=T.add(A);m.l(I)<=0&&(y=y.add(_),T=m),A=Z(A,1),_=Z(_,1)}return g=B(I,y.j(g)),new L(y,g)}for(y=v;I.l(g)>=0;){for(_=Math.max(1,Math.floor(I.m()/g.m())),A=Math.ceil(Math.log(_)/Math.LN2),A=A<=48?1:Math.pow(2,A-48),T=d(_),m=T.j(g);D(m)||m.l(I)>0;)_-=A,T=d(_),m=T.j(g);P(T)&&(T=E),y=y.add(T),I=B(I,m)}return new L(y,I)}n.B=function(I){return K(this,I).h},n.and=function(I){const g=Math.max(this.g.length,I.g.length),_=[];for(let A=0;A<g;A++)_[A]=this.i(A)&I.i(A);return new a(_,this.h&I.h)},n.or=function(I){const g=Math.max(this.g.length,I.g.length),_=[];for(let A=0;A<g;A++)_[A]=this.i(A)|I.i(A);return new a(_,this.h|I.h)},n.xor=function(I){const g=Math.max(this.g.length,I.g.length),_=[];for(let A=0;A<g;A++)_[A]=this.i(A)^I.i(A);return new a(_,this.h^I.h)};function z(I){const g=I.g.length+1,_=[];for(let A=0;A<g;A++)_[A]=I.i(A)<<1|I.i(A-1)>>>31;return new a(_,I.h)}function Z(I,g){const _=g>>5;g%=32;const A=I.g.length-_,y=[];for(let T=0;T<A;T++)y[T]=g>0?I.i(T+_)>>>g|I.i(T+_+1)<<32-g:I.i(T+_);return new a(y,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,uh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,fn=a}).apply(typeof ll<"u"?ll:typeof self<"u"?self:typeof window<"u"?window:{});var xs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var hh,Br,dh,Ws,xo,fh,ph,mh;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof xs=="object"&&xs];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var u=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var R=i[f];if(!(R in u))break e;u=u[R]}i=i[i.length-1],f=u[i],c=c(f),c!=f&&c!=null&&e(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&u.push([f,c[f]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function d(i,c,u){return d=h,d.apply(null,arguments)}function p(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function v(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(f,R,S){for(var O=Array(arguments.length-2),J=2;J<arguments.length;J++)O[J-2]=arguments[J];return c.prototype[R].apply(f,O)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function b(i){const c=i.length;if(c>0){const u=Array(c);for(let f=0;f<c;f++)u[f]=i[f];return u}return[]}function P(i,c){for(let f=1;f<arguments.length;f++){const R=arguments[f];var u=typeof R;if(u=u!="object"?u:R?Array.isArray(R)?"array":u:"null",u=="array"||u=="object"&&typeof R.length=="number"){u=i.length||0;const S=R.length||0;i.length=u+S;for(let O=0;O<S;O++)i[u+O]=R[O]}else i.push(R)}}class D{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function k(i){a.setTimeout(()=>{throw i},0)}function B(){var i=I;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class j{constructor(){this.h=this.g=null}add(c,u){const f=L.get();f.set(c,u),this.h?this.h.next=f:this.g=f,this.h=f}}var L=new D(()=>new K,i=>i.reset());class K{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let z,Z=!1,I=new j,g=()=>{const i=Promise.resolve(void 0);z=()=>{i.then(_)}};function _(){for(var i;i=B();){try{i.h.call(i.g)}catch(u){k(u)}var c=L;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}Z=!1}function A(){this.u=this.u,this.C=this.C}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var T=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i})();function m(i){return/^[\s\xa0]*$/.test(i)}function M(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}v(M,y),M.prototype.init=function(i,c){const u=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var U="closure_listenable_"+(Math.random()*1e6|0),Ee=0;function ge(i,c,u,f,R){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!f,this.ha=R,this.key=++Ee,this.da=this.fa=!1}function oe(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function ue(i,c,u){for(const f in i)c.call(u,i[f],f,i)}function Le(i,c){for(const u in i)c.call(void 0,i[u],u,i)}function st(i){const c={};for(const u in i)c[u]=i[u];return c}const _e="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Re(i,c){let u,f;for(let R=1;R<arguments.length;R++){f=arguments[R];for(u in f)i[u]=f[u];for(let S=0;S<_e.length;S++)u=_e[S],Object.prototype.hasOwnProperty.call(f,u)&&(i[u]=f[u])}}function ee(i){this.src=i,this.g={},this.h=0}ee.prototype.add=function(i,c,u,f,R){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const O=Ve(i,c,f,R);return O>-1?(c=i[O],u||(c.fa=!1)):(c=new ge(c,this.src,S,!!f,R),c.fa=u,i.push(c)),c};function de(i,c){const u=c.type;if(u in i.g){var f=i.g[u],R=Array.prototype.indexOf.call(f,c,void 0),S;(S=R>=0)&&Array.prototype.splice.call(f,R,1),S&&(oe(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function Ve(i,c,u,f){for(let R=0;R<i.length;++R){const S=i[R];if(!S.da&&S.listener==c&&S.capture==!!u&&S.ha==f)return R}return-1}var dt="closure_lm_"+(Math.random()*1e6|0),Te={};function Ae(i,c,u,f,R){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Ae(i,c[S],u,f,R);return null}return u=Is(u),i&&i[U]?i.J(c,u,l(f)?!!f.capture:!1,R):We(i,c,u,!1,f,R)}function We(i,c,u,f,R,S){if(!c)throw Error("Invalid event type");const O=l(R)?!!R.capture:!!R;let J=Tr(i);if(J||(i[dt]=J=new ee(i)),u=J.add(c,u,f,O,S),u.proxy)return u;if(f=$n(),u.proxy=f,f.src=i,f.listener=u,i.addEventListener)T||(R=O),R===void 0&&(R=!1),i.addEventListener(c.toString(),f,R);else if(i.attachEvent)i.attachEvent(Es(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function $n(){function i(u){return c.call(i.src,i.listener,u)}const c=Ts;return i}function It(i,c,u,f,R){if(Array.isArray(c))for(var S=0;S<c.length;S++)It(i,c[S],u,f,R);else f=l(f)?!!f.capture:!!f,u=Is(u),i&&i[U]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],u=Ve(c,u,f,R),u>-1&&(oe(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Tr(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Ve(c,u,f,R)),(u=i>-1?c[i]:null)&&Yt(u))}function Yt(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[U])de(c.i,i);else{var u=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(u,f,i.capture):c.detachEvent?c.detachEvent(Es(u),f):c.addListener&&c.removeListener&&c.removeListener(f),(u=Tr(c))?(de(u,i),u.h==0&&(u.src=null,c[dt]=null)):oe(i)}}}function Es(i){return i in Te?Te[i]:Te[i]="on"+i}function Ts(i,c){if(i.da)i=!0;else{c=new M(c,this);const u=i.listener,f=i.ha||i.src;i.fa&&Yt(i),i=u.call(f,c)}return i}function Tr(i){return i=i[dt],i instanceof ee?i:null}var zn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Is(i){return typeof i=="function"?i:(i[zn]||(i[zn]=function(c){return i.handleEvent(c)}),i[zn])}function De(){A.call(this),this.i=new ee(this),this.M=this,this.G=null}v(De,A),De.prototype[U]=!0,De.prototype.removeEventListener=function(i,c,u,f){It(this,i,c,u,f)};function Ge(i,c){var u,f=i.G;if(f)for(u=[];f;f=f.G)u.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var R=c;c=new y(f,i),Re(c,R)}R=!0;let S,O;if(u)for(O=u.length-1;O>=0;O--)S=c.g=u[O],R=An(S,f,!0,c)&&R;if(S=c.g=i,R=An(S,f,!0,c)&&R,R=An(S,f,!1,c)&&R,u)for(O=0;O<u.length;O++)S=c.g=u[O],R=An(S,f,!1,c)&&R}De.prototype.N=function(){if(De.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const u=i.g[c];for(let f=0;f<u.length;f++)oe(u[f]);delete i.g[c],i.h--}}this.G=null},De.prototype.J=function(i,c,u,f){return this.i.add(String(i),c,!1,u,f)},De.prototype.K=function(i,c,u,f){return this.i.add(String(i),c,!0,u,f)};function An(i,c,u,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let R=!0;for(let S=0;S<c.length;++S){const O=c[S];if(O&&!O.da&&O.capture==u){const J=O.listener,Oe=O.ha||O.src;O.fa&&de(i.i,O),R=J.call(Oe,f)!==!1&&R}}return R&&!f.defaultPrevented}function Ke(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Fe(i){i.g=Ke(()=>{i.g=null,i.i&&(i.i=!1,Fe(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Ue extends A{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Fe(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ne(i){A.call(this),this.h=i,this.g={}}v(Ne,A);var it=[];function lt(i){ue(i.g,function(c,u){this.g.hasOwnProperty(u)&&Yt(c)},i),i.g={}}Ne.prototype.N=function(){Ne.Z.N.call(this),lt(this)},Ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ft=a.JSON.stringify,xt=a.JSON.parse,Qe=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Ze(){}function Be(){}var yt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ir(){y.call(this,"d")}v(Ir,y);function Hi(){y.call(this,"c")}v(Hi,y);var bn={},ja=null;function ws(){return ja=ja||new De}bn.Ia="serverreachability";function qa(i){y.call(this,bn.Ia,i)}v(qa,y);function wr(i){const c=ws();Ge(c,new qa(c))}bn.STAT_EVENT="statevent";function $a(i,c){y.call(this,bn.STAT_EVENT,i),this.stat=c}v($a,y);function ot(i){const c=ws();Ge(c,new $a(c,i))}bn.Ja="timingevent";function za(i,c){y.call(this,bn.Ja,i),this.size=c}v(za,y);function Ar(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function br(){this.g=!0}br.prototype.ua=function(){this.g=!1};function zd(i,c,u,f,R,S){i.info(function(){if(i.g)if(S){var O="",J=S.split("&");for(let le=0;le<J.length;le++){var Oe=J[le].split("=");if(Oe.length>1){const je=Oe[0];Oe=Oe[1];const At=je.split("_");O=At.length>=2&&At[1]=="type"?O+(je+"="+Oe+"&"):O+(je+"=redacted&")}}}else O=null;else O=S;return"XMLHTTP REQ ("+f+") [attempt "+R+"]: "+c+`
`+u+`
`+O})}function Hd(i,c,u,f,R,S,O){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+R+"]: "+c+`
`+u+`
`+S+" "+O})}function Hn(i,c,u,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Gd(i,u)+(f?" "+f:"")})}function Wd(i,c){i.info(function(){return"TIMEOUT: "+c})}br.prototype.info=function(){};function Gd(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var u=S[i];if(!(u.length<2)){var f=u[1];if(Array.isArray(f)&&!(f.length<1)){var R=f[0];if(R!="noop"&&R!="stop"&&R!="close")for(let O=1;O<f.length;O++)f[O]=""}}}}return ft(S)}catch{return c}}var As={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ha={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Wa;function Wi(){}v(Wi,Ze),Wi.prototype.g=function(){return new XMLHttpRequest},Wa=new Wi;function Rr(i){return encodeURIComponent(String(i))}function Kd(i){var c=1;i=i.split(":");const u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function Xt(i,c,u,f){this.j=i,this.i=c,this.l=u,this.S=f||1,this.V=new Ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ga}function Ga(){this.i=null,this.g="",this.h=!1}var Ka={},Gi={};function Ki(i,c,u){i.M=1,i.A=Rs(wt(c)),i.u=u,i.R=!0,Qa(i,null)}function Qa(i,c){i.F=Date.now(),bs(i),i.B=wt(i.A);var u=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),cc(u.i,"t",f),i.C=0,u=i.j.L,i.h=new Ga,i.g=Rc(i.j,u?c:null,!i.u),i.P>0&&(i.O=new Ue(d(i.Y,i,i.g),i.P)),c=i.V,u=i.g,f=i.ba;var R="readystatechange";Array.isArray(R)||(R&&(it[0]=R.toString()),R=it);for(let S=0;S<R.length;S++){const O=Ae(u,R[S],f||c.handleEvent,!1,c.h||c);if(!O)break;c.g[O.key]=O}c=i.J?st(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),wr(),zd(i.i,i.v,i.B,i.l,i.S,i.u)}Xt.prototype.ba=function(i){i=i.target;const c=this.O;c&&en(i)==3?c.j():this.Y(i)},Xt.prototype.Y=function(i){try{if(i==this.g)e:{const J=en(this.g),Oe=this.g.ya(),le=this.g.ca();if(!(J<3)&&(J!=3||this.g&&(this.h.h||this.g.la()||mc(this.g)))){this.K||J!=4||Oe==7||(Oe==8||le<=0?wr(3):wr(2)),Qi(this);var c=this.g.ca();this.X=c;var u=Qd(this);if(this.o=c==200,Hd(this.i,this.v,this.B,this.l,this.S,J,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,R=this.g;if((f=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(f)){var S=f;break t}}S=null}if(i=S)Hn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Yi(this,i);else{this.o=!1,this.m=3,ot(12),Rn(this),Sr(this);break e}}if(this.R){i=!0;let je;for(;!this.K&&this.C<u.length;)if(je=Yd(this,u),je==Gi){J==4&&(this.m=4,ot(14),i=!1),Hn(this.i,this.l,null,"[Incomplete Response]");break}else if(je==Ka){this.m=4,ot(15),Hn(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else Hn(this.i,this.l,je,null),Yi(this,je);if(Ya(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),J!=4||u.length!=0||this.h.h||(this.m=1,ot(16),i=!1),this.o=this.o&&i,!i)Hn(this.i,this.l,u,"[Invalid Chunked Response]"),Rn(this),Sr(this);else if(u.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),so(O),O.P=!0,ot(11))}}else Hn(this.i,this.l,u,null),Yi(this,u);J==4&&Rn(this),this.o&&!this.K&&(J==4?Ic(this.j,this):(this.o=!1,bs(this)))}else hf(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,ot(12)):(this.m=0,ot(13)),Rn(this),Sr(this)}}}catch{}finally{}};function Qd(i){if(!Ya(i))return i.g.la();const c=mc(i.g);if(c==="")return"";let u="";const f=c.length,R=en(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Rn(i),Sr(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,u+=i.h.i.decode(c[S],{stream:!(R&&S==f-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function Ya(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Yd(i,c){var u=i.C,f=c.indexOf(`
`,u);return f==-1?Gi:(u=Number(c.substring(u,f)),isNaN(u)?Ka:(f+=1,f+u>c.length?Gi:(c=c.slice(f,f+u),i.C=f+u,c)))}Xt.prototype.cancel=function(){this.K=!0,Rn(this)};function bs(i){i.T=Date.now()+i.H,Xa(i,i.H)}function Xa(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Ar(d(i.aa,i),c)}function Qi(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Xt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Wd(this.i,this.B),this.M!=2&&(wr(),ot(17)),Rn(this),this.m=2,Sr(this)):Xa(this,this.T-i)};function Sr(i){i.j.I==0||i.K||Ic(i.j,i)}function Rn(i){Qi(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,lt(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Yi(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||Xi(u.h,i))){if(!i.L&&Xi(u.h,i)&&u.I==3){try{var f=u.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var R=f;if(R[0]==0){e:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)Vs(u),Cs(u);else break e;ro(u),ot(18)}}else u.xa=R[1],0<u.xa-u.K&&R[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=Ar(d(u.Va,u),6e3));ec(u.h)<=1&&u.ta&&(u.ta=void 0)}else Pn(u,11)}else if((i.L||u.g==i)&&Vs(u),!m(c))for(R=u.Ba.g.parse(c),c=0;c<R.length;c++){let le=R[c];const je=le[0];if(!(je<=u.K))if(u.K=je,le=le[1],u.I==2)if(le[0]=="c"){u.M=le[1],u.ba=le[2];const At=le[3];At!=null&&(u.ka=At,u.j.info("VER="+u.ka));const Cn=le[4];Cn!=null&&(u.za=Cn,u.j.info("SVER="+u.za));const tn=le[5];tn!=null&&typeof tn=="number"&&tn>0&&(f=1.5*tn,u.O=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;const nn=i.g;if(nn){const Ns=nn.g?nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ns){var S=f.h;S.g||Ns.indexOf("spdy")==-1&&Ns.indexOf("quic")==-1&&Ns.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Ji(S,S.h),S.h=null))}if(f.G){const io=nn.g?nn.g.getResponseHeader("X-HTTP-Session-Id"):null;io&&(f.wa=io,fe(f.J,f.G,io))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),f=u;var O=i;if(f.na=bc(f,f.L?f.ba:null,f.W),O.L){tc(f.h,O);var J=O,Oe=f.O;Oe&&(J.H=Oe),J.D&&(Qi(J),bs(J)),f.g=O}else Ec(f);u.i.length>0&&ks(u)}else le[0]!="stop"&&le[0]!="close"||Pn(u,7);else u.I==3&&(le[0]=="stop"||le[0]=="close"?le[0]=="stop"?Pn(u,7):no(u):le[0]!="noop"&&u.l&&u.l.qa(le),u.A=0)}}wr(4)}catch{}}var Xd=class{constructor(i,c){this.g=i,this.map=c}};function Ja(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Za(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function ec(i){return i.h?1:i.g?i.g.size:0}function Xi(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Ji(i,c){i.g?i.g.add(c):i.h=c}function tc(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Ja.prototype.cancel=function(){if(this.i=nc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function nc(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const u of i.g.values())c=c.concat(u.G);return c}return b(i.i)}var rc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jd(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){const f=i[u].indexOf("=");let R,S=null;f>=0?(R=i[u].substring(0,f),S=i[u].substring(f+1)):R=i[u],c(R,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Jt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Jt?(this.l=i.l,Pr(this,i.j),this.o=i.o,this.g=i.g,Cr(this,i.u),this.h=i.h,Zi(this,lc(i.i)),this.m=i.m):i&&(c=String(i).match(rc))?(this.l=!1,Pr(this,c[1]||"",!0),this.o=kr(c[2]||""),this.g=kr(c[3]||"",!0),Cr(this,c[4]),this.h=kr(c[5]||"",!0),Zi(this,c[6]||"",!0),this.m=kr(c[7]||"")):(this.l=!1,this.i=new Dr(null,this.l))}Jt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Vr(c,sc,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Vr(c,sc,!0),"@"),i.push(Rr(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(Vr(u,u.charAt(0)=="/"?tf:ef,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",Vr(u,rf)),i.join("")},Jt.prototype.resolve=function(i){const c=wt(this);let u=!!i.j;u?Pr(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var f=i.h;if(u)Cr(c,i.u);else if(u=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var R=c.h.lastIndexOf("/");R!=-1&&(f=c.h.slice(0,R+1)+f)}if(R=f,R==".."||R==".")f="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){f=R.lastIndexOf("/",0)==0,R=R.split("/");const S=[];for(let O=0;O<R.length;){const J=R[O++];J=="."?f&&O==R.length&&S.push(""):J==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&O==R.length&&S.push("")):(S.push(J),f=!0)}f=S.join("/")}else f=R}return u?c.h=f:u=i.i.toString()!=="",u?Zi(c,lc(i.i)):u=!!i.m,u&&(c.m=i.m),c};function wt(i){return new Jt(i)}function Pr(i,c,u){i.j=u?kr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function Cr(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Zi(i,c,u){c instanceof Dr?(i.i=c,sf(i.i,i.l)):(u||(c=Vr(c,nf)),i.i=new Dr(c,i.l))}function fe(i,c,u){i.i.set(c,u)}function Rs(i){return fe(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function kr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Vr(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,Zd),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Zd(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var sc=/[#\/\?@]/g,ef=/[#\?:]/g,tf=/[#\?]/g,nf=/[#\?@]/g,rf=/#/g;function Dr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Sn(i){i.g||(i.g=new Map,i.h=0,i.i&&Jd(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=Dr.prototype,n.add=function(i,c){Sn(this),this.i=null,i=Wn(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function ic(i,c){Sn(i),c=Wn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function oc(i,c){return Sn(i),c=Wn(i,c),i.g.has(c)}n.forEach=function(i,c){Sn(this),this.g.forEach(function(u,f){u.forEach(function(R){i.call(c,R,f,this)},this)},this)};function ac(i,c){Sn(i);let u=[];if(typeof c=="string")oc(i,c)&&(u=u.concat(i.g.get(Wn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return Sn(this),this.i=null,i=Wn(this,i),oc(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=ac(this,i),i.length>0?String(i[0]):c):c};function cc(i,c,u){ic(i,c),u.length>0&&(i.i=null,i.g.set(Wn(i,c),b(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var u=c[f];const R=Rr(u);u=ac(this,u);for(let S=0;S<u.length;S++){let O=R;u[S]!==""&&(O+="="+Rr(u[S])),i.push(O)}}return this.i=i.join("&")};function lc(i){const c=new Dr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Wn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function sf(i,c){c&&!i.j&&(Sn(i),i.i=null,i.g.forEach(function(u,f){const R=f.toLowerCase();f!=R&&(ic(this,f),cc(this,R,u))},i)),i.j=c}function of(i,c){const u=new br;if(a.Image){const f=new Image;f.onload=p(Zt,u,"TestLoadImage: loaded",!0,c,f),f.onerror=p(Zt,u,"TestLoadImage: error",!1,c,f),f.onabort=p(Zt,u,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(Zt,u,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function af(i,c){const u=new br,f=new AbortController,R=setTimeout(()=>{f.abort(),Zt(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(R),S.ok?Zt(u,"TestPingServer: ok",!0,c):Zt(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(R),Zt(u,"TestPingServer: error",!1,c)})}function Zt(i,c,u,f,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),f(u)}catch{}}function cf(){this.g=new Qe}function eo(i){this.i=i.Sb||null,this.h=i.ab||!1}v(eo,Ze),eo.prototype.g=function(){return new Ss(this.i,this.h)};function Ss(i,c){De.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(Ss,De),n=Ss.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Or(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Nr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Or(this)),this.g&&(this.readyState=3,Or(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;uc(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function uc(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Nr(this):Or(this),this.readyState==3&&uc(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Nr(this))},n.Na=function(i){this.g&&(this.response=i,Nr(this))},n.ga=function(){this.g&&Nr(this)};function Nr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Or(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function Or(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Ss.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function hc(i){let c="";return ue(i,function(u,f){c+=f,c+=":",c+=u,c+=`\r
`}),c}function to(i,c,u){e:{for(f in u){var f=!1;break e}f=!0}f||(u=hc(u),typeof i=="string"?u!=null&&Rr(u):fe(i,c,u))}function Ie(i){De.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(Ie,De);var lf=/^https?$/i,uf=["POST","PUT"];n=Ie.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Wa.g(),this.g.onreadystatechange=E(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){dc(this,S);return}if(i=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var R in f)u.set(R,f[R]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())u.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(S=>S.toLowerCase()=="content-type"),R=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(uf,c,void 0)>=0)||f||R||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,O]of u)this.g.setRequestHeader(S,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){dc(this,S)}};function dc(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,fc(i),Ps(i)}function fc(i){i.A||(i.A=!0,Ge(i,"complete"),Ge(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Ge(this,"complete"),Ge(this,"abort"),Ps(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ps(this,!0)),Ie.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?pc(this):this.Xa())},n.Xa=function(){pc(this)};function pc(i){if(i.h&&typeof o<"u"){if(i.v&&en(i)==4)setTimeout(i.Ca.bind(i),0);else if(Ge(i,"readystatechange"),en(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var u;if(!(u=c)){var f;if(f=S===0){let O=String(i.D).match(rc)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),f=!lf.test(O?O.toLowerCase():"")}u=f}if(u)Ge(i,"complete"),Ge(i,"success");else{i.o=6;try{var R=en(i)>2?i.g.statusText:""}catch{R=""}i.l=R+" ["+i.ca()+"]",fc(i)}}finally{Ps(i)}}}}function Ps(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const u=i.g;i.g=null,c||Ge(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function en(i){return i.g?i.g.readyState:0}n.ca=function(){try{return en(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),xt(c)}};function mc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function hf(i){const c={};i=(i.g&&en(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(m(i[f]))continue;var u=Kd(i[f]);const R=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const S=c[R]||[];c[R]=S,S.push(u)}Le(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Mr(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function gc(i){this.za=0,this.i=[],this.j=new br,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Mr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Mr("baseRetryDelayMs",5e3,i),this.Za=Mr("retryDelaySeedMs",1e4,i),this.Ta=Mr("forwardChannelMaxRetries",2,i),this.va=Mr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Ja(i&&i.concurrentRequestLimit),this.Ba=new cf,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=gc.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,f){ot(0),this.W=i,this.H=c||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.J=bc(this,null,this.W),ks(this)};function no(i){if(_c(i),i.I==3){var c=i.V++,u=wt(i.J);if(fe(u,"SID",i.M),fe(u,"RID",c),fe(u,"TYPE","terminate"),xr(i,u),c=new Xt(i,i.j,c),c.M=2,c.A=Rs(wt(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=Rc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),bs(c)}Ac(i)}function Cs(i){i.g&&(so(i),i.g.cancel(),i.g=null)}function _c(i){Cs(i),i.v&&(a.clearTimeout(i.v),i.v=null),Vs(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function ks(i){if(!Za(i.h)&&!i.m){i.m=!0;var c=i.Ea;z||g(),Z||(z(),Z=!0),I.add(c,i),i.D=0}}function df(i,c){return ec(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Ar(d(i.Ea,i,c),wc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const R=new Xt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=st(S),Re(S,this.U)):S=this.U),this.u!==null||this.R||(R.J=S,S=null),this.S)e:{for(var c=0,u=0;u<this.i.length;u++){t:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=u;break e}if(c===4096||u===this.i.length-1){c=u+1;break e}}c=1e3}else c=1e3;c=vc(this,R,c),u=wt(this.J),fe(u,"RID",i),fe(u,"CVER",22),this.G&&fe(u,"X-HTTP-Session-Id",this.G),xr(this,u),S&&(this.R?c="headers="+Rr(hc(S))+"&"+c:this.u&&to(u,this.u,S)),Ji(this.h,R),this.Ra&&fe(u,"TYPE","init"),this.S?(fe(u,"$req",c),fe(u,"SID","null"),R.U=!0,Ki(R,u,null)):Ki(R,u,c),this.I=2}}else this.I==3&&(i?yc(this,i):this.i.length==0||Za(this.h)||yc(this))};function yc(i,c){var u;c?u=c.l:u=i.V++;const f=wt(i.J);fe(f,"SID",i.M),fe(f,"RID",u),fe(f,"AID",i.K),xr(i,f),i.u&&i.o&&to(f,i.u,i.o),u=new Xt(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=vc(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Ji(i.h,u),Ki(u,f,c)}function xr(i,c){i.H&&ue(i.H,function(u,f){fe(c,f,u)}),i.l&&ue({},function(u,f){fe(c,f,u)})}function vc(i,c,u){u=Math.min(i.i.length,u);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var R=i.i;let J=-1;for(;;){const Oe=["count="+u];J==-1?u>0?(J=R[0].g,Oe.push("ofs="+J)):J=0:Oe.push("ofs="+J);let le=!0;for(let je=0;je<u;je++){var S=R[je].g;const At=R[je].map;if(S-=J,S<0)J=Math.max(0,R[je].g-100),le=!1;else try{S="req"+S+"_"||"";try{var O=At instanceof Map?At:Object.entries(At);for(const[Cn,tn]of O){let nn=tn;l(tn)&&(nn=ft(tn)),Oe.push(S+Cn+"="+encodeURIComponent(nn))}}catch(Cn){throw Oe.push(S+"type="+encodeURIComponent("_badmap")),Cn}}catch{f&&f(At)}}if(le){O=Oe.join("&");break e}}O=void 0}return i=i.i.splice(0,u),c.G=i,O}function Ec(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;z||g(),Z||(z(),Z=!0),I.add(c,i),i.A=0}}function ro(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Ar(d(i.Da,i),wc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Tc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Ar(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ot(10),Cs(this),Tc(this))};function so(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Tc(i){i.g=new Xt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=wt(i.na);fe(c,"RID","rpc"),fe(c,"SID",i.M),fe(c,"AID",i.K),fe(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&fe(c,"TO",i.ia),fe(c,"TYPE","xmlhttp"),xr(i,c),i.u&&i.o&&to(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=Rs(wt(c)),u.u=null,u.R=!0,Qa(u,i)}n.Va=function(){this.C!=null&&(this.C=null,Cs(this),ro(this),ot(19))};function Vs(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Ic(i,c){var u=null;if(i.g==c){Vs(i),so(i),i.g=null;var f=2}else if(Xi(i.h,c))u=c.G,tc(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var R=i.D;f=ws(),Ge(f,new za(f,u)),ks(i)}else Ec(i);else if(R=c.m,R==3||R==0&&c.X>0||!(f==1&&df(i,c)||f==2&&ro(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),R){case 1:Pn(i,5);break;case 4:Pn(i,10);break;case 3:Pn(i,6);break;default:Pn(i,2)}}}function wc(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function Pn(i,c){if(i.j.info("Error code "+c),c==2){var u=d(i.bb,i),f=i.Ua;const R=!f;f=new Jt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Pr(f,"https"),Rs(f),R?of(f.toString(),u):af(f.toString(),u)}else ot(2);i.I=0,i.l&&i.l.pa(c),Ac(i),_c(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),ot(2)):(this.j.info("Failed to ping google.com"),ot(1))};function Ac(i){if(i.I=0,i.ja=[],i.l){const c=nc(i.h);(c.length!=0||i.i.length!=0)&&(P(i.ja,c),P(i.ja,i.i),i.h.i.length=0,b(i.i),i.i.length=0),i.l.oa()}}function bc(i,c,u){var f=u instanceof Jt?wt(u):new Jt(u);if(f.g!="")c&&(f.g=c+"."+f.g),Cr(f,f.u);else{var R=a.location;f=R.protocol,c=c?c+"."+R.hostname:R.hostname,R=+R.port;const S=new Jt(null);f&&Pr(S,f),c&&(S.g=c),R&&Cr(S,R),u&&(S.h=u),f=S}return u=i.G,c=i.wa,u&&c&&fe(f,u,c),fe(f,"VER",i.ka),xr(i,f),f}function Rc(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Ie(new eo({ab:u})):new Ie(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Sc(){}n=Sc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ds(){}Ds.prototype.g=function(i,c){return new ut(i,c)};function ut(i,c){De.call(this),this.g=new gc(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!m(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!m(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Gn(this)}v(ut,De),ut.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ut.prototype.close=function(){no(this.g)},ut.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=ft(i),i=u);c.i.push(new Xd(c.Ya++,i)),c.I==3&&ks(c)},ut.prototype.N=function(){this.g.l=null,delete this.j,no(this.g),delete this.g,ut.Z.N.call(this)};function Pc(i){Ir.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const u in c){i=u;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}v(Pc,Ir);function Cc(){Hi.call(this),this.status=1}v(Cc,Hi);function Gn(i){this.g=i}v(Gn,Sc),Gn.prototype.ra=function(){Ge(this.g,"a")},Gn.prototype.qa=function(i){Ge(this.g,new Pc(i))},Gn.prototype.pa=function(i){Ge(this.g,new Cc)},Gn.prototype.oa=function(){Ge(this.g,"b")},Ds.prototype.createWebChannel=Ds.prototype.g,ut.prototype.send=ut.prototype.o,ut.prototype.open=ut.prototype.m,ut.prototype.close=ut.prototype.close,mh=function(){return new Ds},ph=function(){return ws()},fh=bn,xo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},As.NO_ERROR=0,As.TIMEOUT=8,As.HTTP_ERROR=6,Ws=As,Ha.COMPLETE="complete",dh=Ha,Be.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",De.prototype.listen=De.prototype.J,Br=Be,Ie.prototype.listenOnce=Ie.prototype.K,Ie.prototype.getLastError=Ie.prototype.Ha,Ie.prototype.getLastErrorCode=Ie.prototype.ya,Ie.prototype.getStatus=Ie.prototype.ca,Ie.prototype.getResponseJson=Ie.prototype.La,Ie.prototype.getResponseText=Ie.prototype.la,Ie.prototype.send=Ie.prototype.ea,Ie.prototype.setWithCredentials=Ie.prototype.Fa,hh=Ie}).apply(typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{});const ul="@firebase/firestore",hl="4.9.2";class tt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tt.UNAUTHENTICATED=new tt(null),tt.GOOGLE_CREDENTIALS=new tt("google-credentials-uid"),tt.FIRST_PARTY=new tt("first-party-uid"),tt.MOCK_USER=new tt("mock-user");let _r="12.3.0";const Fn=new Zo("@firebase/firestore");function Yn(){return Fn.logLevel}function x(n,...e){if(Fn.logLevel<=te.DEBUG){const t=e.map(ua);Fn.debug(`Firestore (${_r}): ${n}`,...t)}}function zt(n,...e){if(Fn.logLevel<=te.ERROR){const t=e.map(ua);Fn.error(`Firestore (${_r}): ${n}`,...t)}}function lr(n,...e){if(Fn.logLevel<=te.WARN){const t=e.map(ua);Fn.warn(`Firestore (${_r}): ${n}`,...t)}}function ua(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function W(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,gh(n,r,t)}function gh(n,e,t){let r=`FIRESTORE (${_r}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw zt(r),new Error(r)}function ce(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||gh(e,s,r)}function X(n,e){return n}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends Gt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class jt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class _h{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class X_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(tt.UNAUTHENTICATED)))}shutdown(){}}class J_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Z_{constructor(e){this.t=e,this.currentUser=tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ce(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new jt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new jt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new jt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ce(typeof r.accessToken=="string",31837,{l:r}),new _h(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ce(e===null||typeof e=="string",2055,{h:e}),new tt(e)}}class ey{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=tt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ty{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ey(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(tt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class dl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ny{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,gt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ce(this.o===void 0,3512);const r=o=>{o.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new dl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ce(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new dl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ry(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class ha{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=ry(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function ne(n,e){return n<e?-1:n>e?1:0}function Lo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Eo(s)===Eo(o)?ne(s,o):Eo(s)?1:-1}return ne(n.length,e.length)}const sy=55296,iy=57343;function Eo(n){const e=n.charCodeAt(0);return e>=sy&&e<=iy}function ur(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const fl="__name__";class Rt{constructor(e,t,r){t===void 0?t=0:t>e.length&&W(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&W(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Rt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Rt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=Rt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return ne(e.length,t.length)}static compareSegments(e,t){const r=Rt.isNumericId(e),s=Rt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Rt.extractNumericId(e).compare(Rt.extractNumericId(t)):Lo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fn.fromString(e.substring(4,e.length-2))}}class pe extends Rt{construct(e,t,r){return new pe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new F(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new pe(t)}static emptyPath(){return new pe([])}}const oy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xe extends Rt{construct(e,t,r){return new Xe(e,t,r)}static isValidIdentifier(e){return oy.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===fl}static keyField(){return new Xe([fl])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new F(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new F(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new F(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new F(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xe(t)}static emptyPath(){return new Xe([])}}class ${constructor(e){this.path=e}static fromPath(e){return new $(pe.fromString(e))}static fromName(e){return new $(pe.fromString(e).popFirst(5))}static empty(){return new $(pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $(new pe(e.slice()))}}function yh(n,e,t){if(!t)throw new F(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ay(n,e,t,r){if(e===!0&&r===!0)throw new F(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pl(n){if(!$.isDocumentKey(n))throw new F(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ml(n){if($.isDocumentKey(n))throw new F(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function da(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":W(12329,{type:typeof n})}function Ht(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new F(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=da(n);throw new F(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Ce(n,e){const t={typeString:n};return e&&(t.value=e),t}function ps(n,e){if(!vh(n))throw new F(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new F(V.INVALID_ARGUMENT,t);return!0}const gl=-62135596800,_l=1e6;class me{static now(){return me.fromMillis(Date.now())}static fromDate(e){return me.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*_l);return new me(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<gl)throw new F(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_l}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:me._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ps(e,me._jsonSchema))return new me(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-gl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}me._jsonSchemaVersion="firestore/timestamp/1.0",me._jsonSchema={type:Ce("string",me._jsonSchemaVersion),seconds:Ce("number"),nanoseconds:Ce("number")};class Y{static fromTimestamp(e){return new Y(e)}static min(){return new Y(new me(0,0))}static max(){return new Y(new me(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ns=-1;function cy(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Y.fromTimestamp(r===1e9?new me(t+1,0):new me(t,r));return new mn(s,$.empty(),e)}function ly(n){return new mn(n.readTime,n.key,ns)}class mn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new mn(Y.min(),$.empty(),ns)}static max(){return new mn(Y.max(),$.empty(),ns)}}function uy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=$.comparator(n.documentKey,e.documentKey),t!==0?t:ne(n.largestBatchId,e.largestBatchId))}const hy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class dy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function yr(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==hy)throw n;x("LocalStore","Unexpectedly lost primary lease")}class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new C(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof C?t:C.resolve(t)}catch(t){return C.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):C.reject(t)}static resolve(e){return new C(((t,r)=>{t(e)}))}static reject(e){return new C(((t,r)=>{r(e)}))}static waitFor(e){return new C(((t,r)=>{let s=0,o=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=C.resolve(!1);for(const r of e)t=t.next((s=>s?C.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new C(((r,s)=>{const o=e.length,a=new Array(o);let l=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++l,l===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new C(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function fy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function vr(n){return n.name==="IndexedDbTransactionError"}class Pi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Pi.ce=-1;const fa=-1;function Ci(n){return n==null}function ci(n){return n===0&&1/n==-1/0}function py(n){return typeof n=="number"&&Number.isInteger(n)&&!ci(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Eh="";function my(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yl(e)),e=gy(n.get(t),e);return yl(e)}function gy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case Eh:t+="";break;default:t+=o}}return t}function yl(n){return n+Eh+""}function vl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function In(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Th(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ve{constructor(e,t){this.comparator=e,this.root=t||Ye.EMPTY}insert(e,t){return new ve(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ye.BLACK,null,null))}remove(e){return new ve(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ye.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ls(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ls(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ls(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ls(this.root,e,this.comparator,!0)}}class Ls{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ye{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Ye.RED,this.left=s??Ye.EMPTY,this.right=o??Ye.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Ye(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ye.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ye.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw W(27949);return e+(this.isRed()?0:1)}}Ye.EMPTY=null,Ye.RED=!0,Ye.BLACK=!1;Ye.EMPTY=new class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Ye(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class xe{constructor(e){this.comparator=e,this.data=new ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new El(this.data.getIterator())}getIteratorFrom(e){return new El(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof xe)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new xe(this.comparator);return t.data=e,t}}class El{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ht{constructor(e){this.fields=e,e.sort(Xe.comparator)}static empty(){return new ht([])}unionWith(e){let t=new xe(Xe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ht(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ur(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Ih extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Je{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Ih("Invalid base64 string: "+o):o}})(e);return new Je(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Je(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Je.EMPTY_BYTE_STRING=new Je("");const _y=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gn(n){if(ce(!!n,39018),typeof n=="string"){let e=0;const t=_y.exec(n);if(ce(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:be(n.seconds),nanos:be(n.nanos)}}function be(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Je.fromBase64String(n):Je.fromUint8Array(n)}const wh="server_timestamp",Ah="__type__",bh="__previous_value__",Rh="__local_write_time__";function pa(n){return(n?.mapValue?.fields||{})[Ah]?.stringValue===wh}function ki(n){const e=n.mapValue.fields[bh];return pa(e)?ki(e):e}function rs(n){const e=gn(n.mapValue.fields[Rh].timestampValue);return new me(e.seconds,e.nanos)}class yy{constructor(e,t,r,s,o,a,l,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const li="(default)";class ss{constructor(e,t){this.projectId=e,this.database=t||li}static empty(){return new ss("","")}get isDefaultDatabase(){return this.database===li}isEqual(e){return e instanceof ss&&e.projectId===this.projectId&&e.database===this.database}}const Sh="__type__",vy="__max__",Fs={mapValue:{}},Ph="__vector__",ui="value";function yn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?pa(n)?4:Ty(n)?9007199254740991:Ey(n)?10:11:W(28295,{value:n})}function Ot(n,e){if(n===e)return!0;const t=yn(n);if(t!==yn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return rs(n).isEqual(rs(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=gn(s.timestampValue),l=gn(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return _n(s.bytesValue).isEqual(_n(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return be(s.geoPointValue.latitude)===be(o.geoPointValue.latitude)&&be(s.geoPointValue.longitude)===be(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return be(s.integerValue)===be(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=be(s.doubleValue),l=be(o.doubleValue);return a===l?ci(a)===ci(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return ur(n.arrayValue.values||[],e.arrayValue.values||[],Ot);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(vl(a)!==vl(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!Ot(a[h],l[h])))return!1;return!0})(n,e);default:return W(52216,{left:n})}}function is(n,e){return(n.values||[]).find((t=>Ot(t,e)))!==void 0}function hr(n,e){if(n===e)return 0;const t=yn(n),r=yn(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const l=be(o.integerValue||o.doubleValue),h=be(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,e);case 3:return Tl(n.timestampValue,e.timestampValue);case 4:return Tl(rs(n),rs(e));case 5:return Lo(n.stringValue,e.stringValue);case 6:return(function(o,a){const l=_n(o),h=_n(a);return l.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const l=o.split("/"),h=a.split("/");for(let d=0;d<l.length&&d<h.length;d++){const p=ne(l[d],h[d]);if(p!==0)return p}return ne(l.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const l=ne(be(o.latitude),be(a.latitude));return l!==0?l:ne(be(o.longitude),be(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Il(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const l=o.fields||{},h=a.fields||{},d=l[ui]?.arrayValue,p=h[ui]?.arrayValue,v=ne(d?.values?.length||0,p?.values?.length||0);return v!==0?v:Il(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Fs.mapValue&&a===Fs.mapValue)return 0;if(o===Fs.mapValue)return 1;if(a===Fs.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){const E=Lo(h[v],p[v]);if(E!==0)return E;const b=hr(l[h[v]],d[p[v]]);if(b!==0)return b}return ne(h.length,p.length)})(n.mapValue,e.mapValue);default:throw W(23264,{he:t})}}function Tl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);const t=gn(n),r=gn(e),s=ne(t.seconds,r.seconds);return s!==0?s:ne(t.nanos,r.nanos)}function Il(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=hr(t[s],r[s]);if(o)return o}return ne(t.length,r.length)}function dr(n){return Fo(n)}function Fo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=gn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _n(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return $.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=Fo(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Fo(t.fields[a])}`;return s+"}"})(n.mapValue):W(61005,{value:n})}function Gs(n){switch(yn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ki(n);return e?16+Gs(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Gs(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return In(r.fields,((o,a)=>{s+=o.length+Gs(a)})),s})(n.mapValue);default:throw W(13486,{value:n})}}function Uo(n){return!!n&&"integerValue"in n}function ma(n){return!!n&&"arrayValue"in n}function wl(n){return!!n&&"nullValue"in n}function Al(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ks(n){return!!n&&"mapValue"in n}function Ey(n){return(n?.mapValue?.fields||{})[Sh]?.stringValue===Ph}function Gr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return In(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Gr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gr(n.arrayValue.values[t]);return e}return{...n}}function Ty(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===vy}class ct{constructor(e){this.value=e}static empty(){return new ct({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ks(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gr(t)}setAll(e){let t=Xe.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=Gr(a):s.push(l.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Ks(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ks(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){In(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new ct(Gr(this.value))}}function Ch(n){const e=[];return In(n.fields,((t,r)=>{const s=new Xe([t]);if(Ks(r)){const o=Ch(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new ht(e)}class nt{constructor(e,t,r,s,o,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new nt(e,0,Y.min(),Y.min(),Y.min(),ct.empty(),0)}static newFoundDocument(e,t,r,s){return new nt(e,1,t,Y.min(),r,s,0)}static newNoDocument(e,t){return new nt(e,2,t,Y.min(),Y.min(),ct.empty(),0)}static newUnknownDocument(e,t){return new nt(e,3,t,Y.min(),Y.min(),ct.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Y.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ct.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof nt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class hi{constructor(e,t){this.position=e,this.inclusive=t}}function bl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=$.comparator($.fromName(a.referenceValue),t.key):r=hr(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Rl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ot(n.position[t],e.position[t]))return!1;return!0}class di{constructor(e,t="asc"){this.field=e,this.dir=t}}function Iy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class kh{}class Me extends kh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ay(e,t,r):t==="array-contains"?new Sy(e,r):t==="in"?new Py(e,r):t==="not-in"?new Cy(e,r):t==="array-contains-any"?new ky(e,r):new Me(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new by(e,r):new Ry(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(hr(t,this.value)):t!==null&&yn(this.value)===yn(t)&&this.matchesComparison(hr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mt extends kh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Mt(e,t)}matches(e){return Vh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Vh(n){return n.op==="and"}function Dh(n){return wy(n)&&Vh(n)}function wy(n){for(const e of n.filters)if(e instanceof Mt)return!1;return!0}function Bo(n){if(n instanceof Me)return n.field.canonicalString()+n.op.toString()+dr(n.value);if(Dh(n))return n.filters.map((e=>Bo(e))).join(",");{const e=n.filters.map((t=>Bo(t))).join(",");return`${n.op}(${e})`}}function Nh(n,e){return n instanceof Me?(function(r,s){return s instanceof Me&&r.op===s.op&&r.field.isEqual(s.field)&&Ot(r.value,s.value)})(n,e):n instanceof Mt?(function(r,s){return s instanceof Mt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,l)=>o&&Nh(a,s.filters[l])),!0):!1})(n,e):void W(19439)}function Oh(n){return n instanceof Me?(function(t){return`${t.field.canonicalString()} ${t.op} ${dr(t.value)}`})(n):n instanceof Mt?(function(t){return t.op.toString()+" {"+t.getFilters().map(Oh).join(" ,")+"}"})(n):"Filter"}class Ay extends Me{constructor(e,t,r){super(e,t,r),this.key=$.fromName(r.referenceValue)}matches(e){const t=$.comparator(e.key,this.key);return this.matchesComparison(t)}}class by extends Me{constructor(e,t){super(e,"in",t),this.keys=Mh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ry extends Me{constructor(e,t){super(e,"not-in",t),this.keys=Mh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Mh(n,e){return(e.arrayValue?.values||[]).map((t=>$.fromName(t.referenceValue)))}class Sy extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ma(t)&&is(t.arrayValue,this.value)}}class Py extends Me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&is(this.value.arrayValue,t)}}class Cy extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(is(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!is(this.value.arrayValue,t)}}class ky extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ma(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>is(this.value.arrayValue,r)))}}class Vy{constructor(e,t=null,r=[],s=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function Sl(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Vy(n,e,t,r,s,o,a)}function ga(n){const e=X(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Bo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Ci(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>dr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>dr(r))).join(",")),e.Te=t}return e.Te}function _a(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Iy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Nh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Rl(n.startAt,e.startAt)&&Rl(n.endAt,e.endAt)}function jo(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Vi{constructor(e,t=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Dy(n,e,t,r,s,o,a,l){return new Vi(n,e,t,r,s,o,a,l)}function ya(n){return new Vi(n)}function Pl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ny(n){return n.collectionGroup!==null}function Kr(n){const e=X(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new xe(Xe.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new di(o,r))})),t.has(Xe.keyField().canonicalString())||e.Ie.push(new di(Xe.keyField(),r))}return e.Ie}function Ct(n){const e=X(n);return e.Ee||(e.Ee=Oy(e,Kr(n))),e.Ee}function Oy(n,e){if(n.limitType==="F")return Sl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new di(s.field,o)}));const t=n.endAt?new hi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new hi(n.startAt.position,n.startAt.inclusive):null;return Sl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function qo(n,e,t){return new Vi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Di(n,e){return _a(Ct(n),Ct(e))&&n.limitType===e.limitType}function xh(n){return`${ga(Ct(n))}|lt:${n.limitType}`}function Xn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Oh(s))).join(", ")}]`),Ci(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>dr(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>dr(s))).join(",")),`Target(${r})`})(Ct(n))}; limitType=${n.limitType})`}function Ni(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):$.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Kr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,h){const d=bl(a,l,h);return a.inclusive?d<=0:d<0})(r.startAt,Kr(r),s)||r.endAt&&!(function(a,l,h){const d=bl(a,l,h);return a.inclusive?d>=0:d>0})(r.endAt,Kr(r),s))})(n,e)}function My(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Lh(n){return(e,t)=>{let r=!1;for(const s of Kr(n)){const o=xy(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function xy(n,e,t){const r=n.field.isKeyField()?$.comparator(e.key,t.key):(function(o,a,l){const h=a.data.field(o),d=l.data.field(o);return h!==null&&d!==null?hr(h,d):W(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return W(19790,{direction:n.dir})}}class jn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){In(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return Th(this.inner)}size(){return this.innerSize}}const Ly=new ve($.comparator);function Wt(){return Ly}const Fh=new ve($.comparator);function jr(...n){let e=Fh;for(const t of n)e=e.insert(t.key,t);return e}function Uh(n){let e=Fh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Vn(){return Qr()}function Bh(){return Qr()}function Qr(){return new jn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Fy=new ve($.comparator),Uy=new xe($.comparator);function re(...n){let e=Uy;for(const t of n)e=e.add(t);return e}const By=new xe(ne);function jy(){return By}function va(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ci(e)?"-0":e}}function jh(n){return{integerValue:""+n}}function qy(n,e){return py(e)?jh(e):va(n,e)}class Oi{constructor(){this._=void 0}}function $y(n,e,t){return n instanceof fi?(function(s,o){const a={fields:{[Ah]:{stringValue:wh},[Rh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&pa(o)&&(o=ki(o)),o&&(a.fields[bh]=o),{mapValue:a}})(t,e):n instanceof os?$h(n,e):n instanceof as?zh(n,e):(function(s,o){const a=qh(s,o),l=Cl(a)+Cl(s.Ae);return Uo(a)&&Uo(s.Ae)?jh(l):va(s.serializer,l)})(n,e)}function zy(n,e,t){return n instanceof os?$h(n,e):n instanceof as?zh(n,e):t}function qh(n,e){return n instanceof pi?(function(r){return Uo(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class fi extends Oi{}class os extends Oi{constructor(e){super(),this.elements=e}}function $h(n,e){const t=Hh(e);for(const r of n.elements)t.some((s=>Ot(s,r)))||t.push(r);return{arrayValue:{values:t}}}class as extends Oi{constructor(e){super(),this.elements=e}}function zh(n,e){let t=Hh(e);for(const r of n.elements)t=t.filter((s=>!Ot(s,r)));return{arrayValue:{values:t}}}class pi extends Oi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Cl(n){return be(n.integerValue||n.doubleValue)}function Hh(n){return ma(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Hy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof os&&s instanceof os||r instanceof as&&s instanceof as?ur(r.elements,s.elements,Ot):r instanceof pi&&s instanceof pi?Ot(r.Ae,s.Ae):r instanceof fi&&s instanceof fi})(n.transform,e.transform)}class Wy{constructor(e,t){this.version=e,this.transformResults=t}}class kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new kt}static exists(e){return new kt(void 0,e)}static updateTime(e){return new kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Qs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Mi{}function Wh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Kh(n.key,kt.none()):new ms(n.key,n.data,kt.none());{const t=n.data,r=ct.empty();let s=new xe(Xe.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new wn(n.key,r,new ht(s.toArray()),kt.none())}}function Gy(n,e,t){n instanceof ms?(function(s,o,a){const l=s.value.clone(),h=Vl(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof wn?(function(s,o,a){if(!Qs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=Vl(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Gh(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Yr(n,e,t,r){return n instanceof ms?(function(o,a,l,h){if(!Qs(o.precondition,a))return l;const d=o.value.clone(),p=Dl(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof wn?(function(o,a,l,h){if(!Qs(o.precondition,a))return l;const d=Dl(o.fieldTransforms,h,a),p=a.data;return p.setAll(Gh(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(n,e,t,r):(function(o,a,l){return Qs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function Ky(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=qh(r.transform,s||null);o!=null&&(t===null&&(t=ct.empty()),t.set(r.field,o))}return t||null}function kl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ur(r,s,((o,a)=>Hy(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ms extends Mi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class wn extends Mi{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Gh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Vl(n,e,t){const r=new Map;ce(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,l=e.data.field(o.field);r.set(o.field,zy(a,l,t[s]))}return r}function Dl(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,$y(o,a,e))}return r}class Kh extends Mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qy extends Mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Yy{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&Gy(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Yr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Bh();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=t.has(s.key)?null:l;const h=Wh(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(Y.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),re())}isEqual(e){return this.batchId===e.batchId&&ur(this.mutations,e.mutations,((t,r)=>kl(t,r)))&&ur(this.baseMutations,e.baseMutations,((t,r)=>kl(t,r)))}}class Ea{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ce(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Fy})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Ea(e,t,r,s)}}class Xy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Jy{constructor(e,t){this.count=e,this.unchangedNames=t}}var Se,se;function Zy(n){switch(n){case V.OK:return W(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return W(15467,{code:n})}}function Qh(n){if(n===void 0)return zt("GRPC error has no .code"),V.UNKNOWN;switch(n){case Se.OK:return V.OK;case Se.CANCELLED:return V.CANCELLED;case Se.UNKNOWN:return V.UNKNOWN;case Se.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Se.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Se.INTERNAL:return V.INTERNAL;case Se.UNAVAILABLE:return V.UNAVAILABLE;case Se.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Se.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Se.NOT_FOUND:return V.NOT_FOUND;case Se.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Se.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Se.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Se.ABORTED:return V.ABORTED;case Se.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Se.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Se.DATA_LOSS:return V.DATA_LOSS;default:return W(39323,{code:n})}}(se=Se||(Se={}))[se.OK=0]="OK",se[se.CANCELLED=1]="CANCELLED",se[se.UNKNOWN=2]="UNKNOWN",se[se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",se[se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",se[se.NOT_FOUND=5]="NOT_FOUND",se[se.ALREADY_EXISTS=6]="ALREADY_EXISTS",se[se.PERMISSION_DENIED=7]="PERMISSION_DENIED",se[se.UNAUTHENTICATED=16]="UNAUTHENTICATED",se[se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",se[se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",se[se.ABORTED=10]="ABORTED",se[se.OUT_OF_RANGE=11]="OUT_OF_RANGE",se[se.UNIMPLEMENTED=12]="UNIMPLEMENTED",se[se.INTERNAL=13]="INTERNAL",se[se.UNAVAILABLE=14]="UNAVAILABLE",se[se.DATA_LOSS=15]="DATA_LOSS";function ev(){return new TextEncoder}const tv=new fn([4294967295,4294967295],0);function Nl(n){const e=ev().encode(n),t=new uh;return t.update(e),new Uint8Array(t.digest())}function Ol(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new fn([t,r],0),new fn([s,o],0)]}class Ta{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new qr(`Invalid padding: ${t}`);if(r<0)throw new qr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new qr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new qr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=fn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(fn.fromNumber(r)));return s.compare(tv)===1&&(s=new fn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Nl(e),[r,s]=Ol(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Ta(o,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=Nl(e),[r,s]=Ol(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class qr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class xi{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,gs.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new xi(Y.min(),s,new ve(ne),Wt(),re())}}class gs{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new gs(r,t,re(),re(),re())}}class Ys{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Yh{constructor(e,t){this.targetId=e,this.Ce=t}}class Xh{constructor(e,t,r=Je.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Ml{constructor(){this.ve=0,this.Fe=xl(),this.Me=Je.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=re(),t=re(),r=re();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:W(38017,{changeType:o})}})),new gs(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=xl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ce(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class nv{constructor(e){this.Ge=e,this.ze=new Map,this.je=Wt(),this.Je=Us(),this.He=Us(),this.Ye=new ve(ne)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:W(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(jo(o))if(r===0){const a=new $(o.path);this.et(t,a,nt.newNoDocument(a,Y.min()))}else ce(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),h=l?this.ct(l,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,l;try{a=_n(r).toUint8Array()}catch(h){if(h instanceof Ih)return lr("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Ta(a,s,o)}catch(h){return lr(h instanceof qr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const l=this.ot(a);if(l){if(o.current&&jo(l.target)){const h=new $(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,nt.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=re();this.He.forEach(((o,a)=>{let l=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new xi(e,t,this.Ye,this.je,r);return this.je=Wt(),this.Je=Us(),this.He=Us(),this.Ye=new ve(ne),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ml,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new xe(ne),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new xe(ne),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ml),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Us(){return new ve($.comparator)}function xl(){return new ve($.comparator)}const rv={asc:"ASCENDING",desc:"DESCENDING"},sv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iv={and:"AND",or:"OR"};class ov{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function $o(n,e){return n.useProto3Json||Ci(e)?e:{value:e}}function mi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Jh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function av(n,e){return mi(n,e.toTimestamp())}function Vt(n){return ce(!!n,49232),Y.fromTimestamp((function(t){const r=gn(t);return new me(r.seconds,r.nanos)})(n))}function Ia(n,e){return zo(n,e).canonicalString()}function zo(n,e){const t=(function(s){return new pe(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Zh(n){const e=pe.fromString(n);return ce(sd(e),10190,{key:e.toString()}),e}function Ho(n,e){return Ia(n.databaseId,e.path)}function To(n,e){const t=Zh(e);if(t.get(1)!==n.databaseId.projectId)throw new F(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new F(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new $(td(t))}function ed(n,e){return Ia(n.databaseId,e)}function cv(n){const e=Zh(n);return e.length===4?pe.emptyPath():td(e)}function Wo(n){return new pe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function td(n){return ce(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Ll(n,e,t){return{name:Ho(n,e),fields:t.value.mapValue.fields}}function lv(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:W(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(ce(p===void 0||typeof p=="string",58123),Je.fromBase64String(p||"")):(ce(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Je.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const p=d.code===void 0?V.UNKNOWN:Qh(d.code);return new F(p,d.message||"")})(a);t=new Xh(r,s,o,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=To(n,r.document.name),o=Vt(r.document.updateTime),a=r.document.createTime?Vt(r.document.createTime):Y.min(),l=new ct({mapValue:{fields:r.document.fields}}),h=nt.newFoundDocument(s,o,a,l),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Ys(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=To(n,r.document),o=r.readTime?Vt(r.readTime):Y.min(),a=nt.newNoDocument(s,o),l=r.removedTargetIds||[];t=new Ys([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=To(n,r.document),o=r.removedTargetIds||[];t=new Ys([],o,s,null)}else{if(!("filter"in e))return W(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new Jy(s,o),l=r.targetId;t=new Yh(l,a)}}return t}function uv(n,e){let t;if(e instanceof ms)t={update:Ll(n,e.key,e.value)};else if(e instanceof Kh)t={delete:Ho(n,e.key)};else if(e instanceof wn)t={update:Ll(n,e.key,e.data),updateMask:vv(e.fieldMask)};else{if(!(e instanceof Qy))return W(16599,{Vt:e.type});t={verify:Ho(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const l=a.transform;if(l instanceof fi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof os)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof as)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof pi)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw W(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:av(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:W(27497)})(n,e.precondition)),t}function hv(n,e){return n&&n.length>0?(ce(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Vt(s.updateTime):Vt(o);return a.isEqual(Y.min())&&(a=Vt(o)),new Wy(a,s.transformResults||[])})(t,e)))):[]}function dv(n,e){return{documents:[ed(n,e.path)]}}function fv(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ed(n,s);const o=(function(d){if(d.length!==0)return rd(Mt.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(E){return{field:Jn(E.field),direction:gv(E.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=$o(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function pv(n){let e=cv(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ce(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(v){const E=nd(v);return E instanceof Mt&&Dh(E)?E.getFilters():[E]})(t.where));let a=[];t.orderBy&&(a=(function(v){return v.map((E=>(function(P){return new di(Zn(P.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(P.direction))})(E)))})(t.orderBy));let l=null;t.limit&&(l=(function(v){let E;return E=typeof v=="object"?v.value:v,Ci(E)?null:E})(t.limit));let h=null;t.startAt&&(h=(function(v){const E=!!v.before,b=v.values||[];return new hi(b,E)})(t.startAt));let d=null;return t.endAt&&(d=(function(v){const E=!v.before,b=v.values||[];return new hi(b,E)})(t.endAt)),Dy(e,s,a,o,l,"F",h,d)}function mv(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function nd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Zn(t.unaryFilter.field);return Me.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Zn(t.unaryFilter.field);return Me.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Zn(t.unaryFilter.field);return Me.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Zn(t.unaryFilter.field);return Me.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Me.create(Zn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Mt.create(t.compositeFilter.filters.map((r=>nd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return W(1026)}})(t.compositeFilter.op))})(n):W(30097,{filter:n})}function gv(n){return rv[n]}function _v(n){return sv[n]}function yv(n){return iv[n]}function Jn(n){return{fieldPath:n.canonicalString()}}function Zn(n){return Xe.fromServerFormat(n.fieldPath)}function rd(n){return n instanceof Me?(function(t){if(t.op==="=="){if(Al(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NAN"}};if(wl(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Al(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NOT_NAN"}};if(wl(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Jn(t.field),op:_v(t.op),value:t.value}}})(n):n instanceof Mt?(function(t){const r=t.getFilters().map((s=>rd(s)));return r.length===1?r[0]:{compositeFilter:{op:yv(t.op),filters:r}}})(n):W(54877,{filter:n})}function vv(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function sd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ln{constructor(e,t,r,s,o=Y.min(),a=Y.min(),l=Je.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new ln(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ev{constructor(e){this.yt=e}}function Tv(n){const e=pv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qo(e,e.limit,"L"):e}class Iv{constructor(){this.Cn=new wv}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(mn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(mn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class wv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new xe(pe.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new xe(pe.comparator)).toArray()}}const Fl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},id=41943040;class at{static withCacheSize(e){return new at(e,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}at.DEFAULT_COLLECTION_PERCENTILE=10,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,at.DEFAULT=new at(id,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),at.DISABLED=new at(-1,0,0);class fr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new fr(0)}static cr(){return new fr(-1)}}const Ul="LruGarbageCollector",Av=1048576;function Bl([n,e],[t,r]){const s=ne(n,t);return s===0?ne(e,r):s}class bv{constructor(e){this.Ir=e,this.buffer=new xe(Bl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Bl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Rv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){x(Ul,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vr(t)?x(Ul,"Ignoring IndexedDB error during garbage collection: ",t):await yr(t)}await this.Vr(3e5)}))}}class Sv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Pi.ce);const r=new bv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Fl)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,l,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,a=Date.now(),this.nthSequenceNumber(e,s)))).next((v=>(r=v,l=Date.now(),this.removeTargets(e,r,t)))).next((v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((v=>(d=Date.now(),Yn()<=te.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function Pv(n,e){return new Sv(n,e)}class Cv{constructor(){this.changes=new jn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class kv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Vv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Yr(r.mutation,s,ht.empty(),me.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,re()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=re()){const s=Vn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=jr();return o.forEach(((l,h)=>{a=a.insert(l,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Vn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,re())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let o=Wt();const a=Qr(),l=(function(){return Qr()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof wn)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Yr(p.mutation,d,p.mutation.getFieldMask(),me.now())):a.set(d.key,ht.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>l.set(d,new kv(p,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=Qr();let s=new ve(((a,l)=>a-l)),o=re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||ht.empty();p=l.applyToLocalView(d,p),r.set(h,p);const v=(s.get(l.batchId)||re()).add(h);s=s.insert(l.batchId,v)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),d=h.key,p=h.value,v=Bh();p.forEach((E=>{if(!o.has(E)){const b=Wh(t.get(E),r.get(E));b!==null&&v.set(E,b),o=o.add(E)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return C.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return $.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ny(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):C.resolve(Vn());let l=ns,h=o;return a.next((d=>C.forEach(d,((p,v)=>(l<v.largestBatchId&&(l=v.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next((E=>{h=h.insert(p,E)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,re()))).next((p=>({batchId:l,changes:Uh(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $(t)).next((r=>{let s=jr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=jr();return this.indexManager.getCollectionParents(e,o).next((l=>C.forEach(l,(h=>{const d=(function(v,E){return new Vi(E,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((v,E)=>{a=a.insert(v,E)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,nt.newInvalidDocument(p)))}));let l=jr();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Yr(p.mutation,d,ht.empty(),me.now()),Ni(t,d)&&(l=l.insert(h,d))})),l}))}}class Dv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Vt(s.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Tv(s.bundledQuery),readTime:Vt(s.readTime)}})(t)),C.resolve()}}class Nv{constructor(){this.overlays=new ve($.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vn();return C.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),C.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){const s=Vn(),o=t.length+1,a=new $(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return C.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new ve(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Vn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=Vn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>l.set(d,p))),!(l.size()>=s)););return C.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Xy(t,r));let o=this.qr.get(t);o===void 0&&(o=re(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class Ov{constructor(){this.sessionToken=Je.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}class wa{constructor(){this.Qr=new xe(qe.$r),this.Ur=new xe(qe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new qe(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new qe(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new $(new pe([])),r=new qe(t,e),s=new qe(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new $(new pe([])),r=new qe(t,e),s=new qe(t,e+1);let o=re();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new qe(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qe{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return $.comparator(e.key,t.key)||ne(e.Yr,t.Yr)}static Kr(e,t){return ne(e.Yr,t.Yr)||$.comparator(e.key,t.key)}}class Mv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new xe(qe.$r)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Yy(o,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new qe(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?fa:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qe(t,0),s=new qe(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);o.push(l)})),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new xe(ne);return t.forEach((s=>{const o=new qe(s,0),a=new qe(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(l=>{r=r.add(l.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;$.isDocumentKey(o)||(o=o.child(""));const a=new qe(new $(o),0);let l=new xe(ne);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(h.Yr)),!0)}),a),C.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){ce(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(t.mutations,(s=>{const o=new qe(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new qe(t,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class xv{constructor(e){this.ri=e,this.docs=(function(){return new ve($.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():nt.newInvalidDocument(t))}getEntries(e,t){let r=Wt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():nt.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=Wt();const a=t.path,l=new $(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||uy(ly(p),r)<=0||(s.has(p.key)||Ni(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,s){W(9500)}ii(e,t){return C.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new Lv(this)}getSize(e){return C.resolve(this.size)}}class Lv extends Cv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),C.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Fv{constructor(e){this.persistence=e,this.si=new jn((t=>ga(t)),_a),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.oi=0,this._i=new wa,this.targetCount=0,this.ai=fr.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new fr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),C.waitFor(o).next((()=>s))}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}}class od{constructor(e,t){this.ui={},this.overlays={},this.ci=new Pi(0),this.li=!1,this.li=!0,this.hi=new Ov,this.referenceDelegate=e(this),this.Pi=new Fv(this),this.indexManager=new Iv,this.remoteDocumentCache=(function(s){return new xv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Ev(t),this.Ii=new Dv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Nv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Mv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const s=new Uv(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class Uv extends dy{constructor(e){super(),this.currentSequenceNumber=e}}class Aa{constructor(e){this.persistence=e,this.Ri=new wa,this.Vi=null}static mi(e){return new Aa(e)}get fi(){if(this.Vi)return this.Vi;throw W(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=$.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,Y.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class gi{constructor(e,t){this.persistence=e,this.pi=new jn((r=>my(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Pv(this,t)}static mi(e,t){return new gi(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return C.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?C.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,o.removeEntry(a,Y.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Gs(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ba{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=re(),s=re();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new ba(e,t.fromCache,r,s)}}class Bv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class jv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return fp()?8:fy(rt())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Bv;return this.Ss(e,t,a).next((l=>{if(o.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Yn()<=te.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Xn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(Yn()<=te.DEBUG&&x("QueryEngine","Query:",Xn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Yn()<=te.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Xn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ct(t))):C.resolve())}ys(e,t){if(Pl(t))return C.resolve(null);let r=Ct(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=qo(t,null,"F"),r=Ct(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=re(...o);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.Ds(t,l);return this.Cs(t,d,a,h.readTime)?this.ys(e,qo(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ws(e,t,r,s){return Pl(t)||s.isEqual(Y.min())?C.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?C.resolve(null):(Yn()<=te.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Xn(t)),this.vs(e,a,t,cy(s,ns)).next((l=>l)))}))}Ds(e,t){let r=new xe(Lh(e));return t.forEach(((s,o)=>{Ni(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Yn()<=te.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Xn(t)),this.ps.getDocumentsMatchingQuery(e,t,mn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Ra="LocalStore",qv=3e8;class $v{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ve(ne),this.xs=new jn((o=>ga(o)),_a),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function zv(n,e,t,r){return new $v(n,e,t,r)}async function ad(n,e){const t=X(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],l=[];let h=re();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){l.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function Hv(n,e){const t=X(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,d,p){const v=d.batch,E=v.keys();let b=C.resolve();return E.forEach((P=>{b=b.next((()=>p.getEntry(h,P))).next((D=>{const k=d.docVersions.get(P);ce(k!==null,48541),D.version.compareTo(k)<0&&(v.applyToRemoteDocument(D,d),D.isValidDocument()&&(D.setReadTime(d.commitVersion),p.addEntry(D)))}))})),b.next((()=>l.mutationQueue.removeMutationBatch(h,v)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=re();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(h=h.add(l.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function cd(n){const e=X(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Wv(n,e){const t=X(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((p,v)=>{const E=s.get(v);if(!E)return;l.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,v).next((()=>t.Pi.addMatchingKeys(o,p.addedDocuments,v))));let b=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?b=b.withResumeToken(Je.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):p.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(p.resumeToken,r)),s=s.insert(v,b),(function(D,k,B){return D.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-D.snapshotVersion.toMicroseconds()>=qv?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0})(E,b,p)&&l.push(t.Pi.updateTargetData(o,b))}));let h=Wt(),d=re();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),l.push(Gv(o,a,e.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(Y.min())){const p=t.Pi.getLastRemoteSnapshotVersion(o).next((v=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(p)}return C.waitFor(l).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function Gv(n,e,t){let r=re(),s=re();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=Wt();return t.forEach(((l,h)=>{const d=o.get(l);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(Y.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):x(Ra,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function Kv(n,e){const t=X(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=fa),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Qv(n,e){const t=X(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,C.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new ln(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Go(n,e,t){const r=X(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!vr(a))throw a;x(Ra,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function jl(n,e,t){const r=X(n);let s=Y.min(),o=re();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const v=X(h),E=v.xs.get(p);return E!==void 0?C.resolve(v.Ms.get(E)):v.Pi.getTargetData(d,p)})(r,a,Ct(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:Y.min(),t?o:re()))).next((l=>(Yv(r,My(e),l),{documents:l,Qs:o})))))}function Yv(n,e,t){let r=n.Os.get(e)||Y.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class ql{constructor(){this.activeTargetIds=jy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Xv{constructor(){this.Mo=new ql,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ql,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Jv{Oo(e){}shutdown(){}}const $l="ConnectivityMonitor";class zl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){x($l,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){x($l,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Bs=null;function Ko(){return Bs===null?Bs=(function(){return 268435456+Math.round(2147483648*Math.random())})():Bs++,"0x"+Bs.toString(16)}const Io="RestConnection",Zv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===li?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=Ko(),l=this.zo(e,t.toUriEncodedString());x(Io,`Sending RPC '${e}' ${a}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(l),p=mr(d);return this.Jo(e,l,h,r,p).then((v=>(x(Io,`Received RPC '${e}' ${a}: `,v),v)),(v=>{throw lr(Io,`RPC '${e}' ${a} failed with error: `,v,"url: ",l,"request:",r),v}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+_r})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=Zv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class tE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const et="WebChannelConnection";class nE extends eE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=Ko();return new Promise(((l,h)=>{const d=new hh;d.setWithCredentials(!0),d.listenOnce(dh.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Ws.NO_ERROR:const v=d.getResponseJson();x(et,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),l(v);break;case Ws.TIMEOUT:x(et,`RPC '${e}' ${a} timed out`),h(new F(V.DEADLINE_EXCEEDED,"Request time out"));break;case Ws.HTTP_ERROR:const E=d.getStatus();if(x(et,`RPC '${e}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);const P=b?.error;if(P&&P.status&&P.message){const D=(function(B){const j=B.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(j)>=0?j:V.UNKNOWN})(P.status);h(new F(D,P.message))}else h(new F(V.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new F(V.UNAVAILABLE,"Connection failed."));break;default:W(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{x(et,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);x(et,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=Ko(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=mh(),l=ph(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=o.join("");x(et,`Creating RPC '${e}' stream ${s}: ${p}`,h);const v=a.createWebChannel(p,h);this.I_(v);let E=!1,b=!1;const P=new tE({Yo:k=>{b?x(et,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(E||(x(et,`Opening RPC '${e}' stream ${s} transport.`),v.open(),E=!0),x(et,`RPC '${e}' stream ${s} sending:`,k),v.send(k))},Zo:()=>v.close()}),D=(k,B,j)=>{k.listen(B,(L=>{try{j(L)}catch(K){setTimeout((()=>{throw K}),0)}}))};return D(v,Br.EventType.OPEN,(()=>{b||(x(et,`RPC '${e}' stream ${s} transport opened.`),P.o_())})),D(v,Br.EventType.CLOSE,(()=>{b||(b=!0,x(et,`RPC '${e}' stream ${s} transport closed`),P.a_(),this.E_(v))})),D(v,Br.EventType.ERROR,(k=>{b||(b=!0,lr(et,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),P.a_(new F(V.UNAVAILABLE,"The operation could not be completed")))})),D(v,Br.EventType.MESSAGE,(k=>{if(!b){const B=k.data[0];ce(!!B,16349);const j=B,L=j?.error||j[0]?.error;if(L){x(et,`RPC '${e}' stream ${s} received error:`,L);const K=L.status;let z=(function(g){const _=Se[g];if(_!==void 0)return Qh(_)})(K),Z=L.message;z===void 0&&(z=V.INTERNAL,Z="Unknown error status: "+K+" with message "+L.message),b=!0,P.a_(new F(z,Z)),v.close()}else x(et,`RPC '${e}' stream ${s} received:`,B),P.u_(B)}})),D(l,fh.STAT_EVENT,(k=>{k.stat===xo.PROXY?x(et,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===xo.NOPROXY&&x(et,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{P.__()}),0),P}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function wo(){return typeof document<"u"?document:null}function Li(n){return new ov(n,!0)}class ld{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Hl="PersistentStream";class ud{constructor(e,t,r,s,o,a,l,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ld(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(zt(t.toString()),zt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new F(V.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(Hl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(x(Hl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class rE extends ud{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=lv(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Y.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Y.min():a.readTime?Vt(a.readTime):Y.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Wo(this.serializer),t.addTarget=(function(o,a){let l;const h=a.target;if(l=jo(h)?{documents:dv(o,h)}:{query:fv(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Jh(o,a.resumeToken);const d=$o(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(Y.min())>0){l.readTime=mi(o,a.snapshotVersion.toTimestamp());const d=$o(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=mv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Wo(this.serializer),t.removeTarget=e,this.q_(t)}}class sE extends ud{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ce(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ce(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ce(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=hv(e.writeResults,e.commitTime),r=Vt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Wo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>uv(this.serializer,r)))};this.q_(t)}}class iE{}class oE extends iE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new F(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,zo(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new F(V.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,zo(t,r),s,a,l,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new F(V.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class aE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(zt(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Un="RemoteStore";class cE{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{qn(this)&&(x(Un,"Restarting streams for network reachability change."),await(async function(h){const d=X(h);d.Ea.add(4),await _s(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Fi(d)})(this))}))})),this.Ra=new aE(r,s)}}async function Fi(n){if(qn(n))for(const e of n.da)await e(!0)}async function _s(n){for(const e of n.da)await e(!1)}function hd(n,e){const t=X(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ka(t)?Ca(t):Er(t).O_()&&Pa(t,e))}function Sa(n,e){const t=X(n),r=Er(t);t.Ia.delete(e),r.O_()&&dd(t,e),t.Ia.size===0&&(r.O_()?r.L_():qn(t)&&t.Ra.set("Unknown"))}function Pa(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Er(n).Y_(e)}function dd(n,e){n.Va.Ue(e),Er(n).Z_(e)}function Ca(n){n.Va=new nv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Er(n).start(),n.Ra.ua()}function ka(n){return qn(n)&&!Er(n).x_()&&n.Ia.size>0}function qn(n){return X(n).Ea.size===0}function fd(n){n.Va=void 0}async function lE(n){n.Ra.set("Online")}async function uE(n){n.Ia.forEach(((e,t)=>{Pa(n,e)}))}async function hE(n,e){fd(n),ka(n)?(n.Ra.ha(e),Ca(n)):n.Ra.set("Unknown")}async function dE(n,e,t){if(n.Ra.set("Online"),e instanceof Xh&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){x(Un,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await _i(n,r)}else if(e instanceof Ys?n.Va.Ze(e):e instanceof Yh?n.Va.st(e):n.Va.tt(e),!t.isEqual(Y.min()))try{const r=await cd(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const l=o.Va.Tt(a);return l.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),l.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Je.EMPTY_BYTE_STRING,p.snapshotVersion)),dd(o,h);const v=new ln(p.target,h,d,p.sequenceNumber);Pa(o,v)})),o.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){x(Un,"Failed to raise snapshot:",r),await _i(n,r)}}async function _i(n,e,t){if(!vr(e))throw e;n.Ea.add(1),await _s(n),n.Ra.set("Offline"),t||(t=()=>cd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{x(Un,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Fi(n)}))}function pd(n,e){return e().catch((t=>_i(n,t,e)))}async function Ui(n){const e=X(n),t=vn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:fa;for(;fE(e);)try{const s=await Kv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,pE(e,s)}catch(s){await _i(e,s)}md(e)&&gd(e)}function fE(n){return qn(n)&&n.Ta.length<10}function pE(n,e){n.Ta.push(e);const t=vn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function md(n){return qn(n)&&!vn(n).x_()&&n.Ta.length>0}function gd(n){vn(n).start()}async function mE(n){vn(n).ra()}async function gE(n){const e=vn(n);for(const t of n.Ta)e.ea(t.mutations)}async function _E(n,e,t){const r=n.Ta.shift(),s=Ea.from(r,e,t);await pd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Ui(n)}async function yE(n,e){e&&vn(n).X_&&await(async function(r,s){if((function(a){return Zy(a)&&a!==V.ABORTED})(s.code)){const o=r.Ta.shift();vn(r).B_(),await pd(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await Ui(r)}})(n,e),md(n)&&gd(n)}async function Wl(n,e){const t=X(n);t.asyncQueue.verifyOperationInProgress(),x(Un,"RemoteStore received new credentials");const r=qn(t);t.Ea.add(3),await _s(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Fi(t)}async function vE(n,e){const t=X(n);e?(t.Ea.delete(2),await Fi(t)):e||(t.Ea.add(2),await _s(t),t.Ra.set("Unknown"))}function Er(n){return n.ma||(n.ma=(function(t,r,s){const o=X(t);return o.sa(),new rE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:lE.bind(null,n),t_:uE.bind(null,n),r_:hE.bind(null,n),H_:dE.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ka(n)?Ca(n):n.Ra.set("Unknown")):(await n.ma.stop(),fd(n))}))),n.ma}function vn(n){return n.fa||(n.fa=(function(t,r,s){const o=X(t);return o.sa(),new sE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:mE.bind(null,n),r_:yE.bind(null,n),ta:gE.bind(null,n),na:_E.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Ui(n)):(await n.fa.stop(),n.Ta.length>0&&(x(Un,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Va{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,l=new Va(e,t,a,s,o);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new F(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Da(n,e){if(zt("AsyncQueue",`${e}: ${n}`),vr(n))return new F(V.UNAVAILABLE,`${e}: ${n}`);throw n}class or{static emptySet(e){return new or(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||$.comparator(t.key,r.key):(t,r)=>$.comparator(t.key,r.key),this.keyedMap=jr(),this.sortedSet=new ve(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof or)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new or;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Gl{constructor(){this.ga=new ve($.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):W(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class pr{constructor(e,t,r,s,o,a,l,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new pr(e,t,or.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Di(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class EE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class TE{constructor(){this.queries=Kl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=X(t),o=s.queries;s.queries=Kl(),o.forEach(((a,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new F(V.ABORTED,"Firestore shutting down"))}}function Kl(){return new jn((n=>xh(n)),Di)}async function _d(n,e){const t=X(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new EE,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=Da(a,`Initialization of query '${Xn(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Na(t)}async function yd(n,e){const t=X(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function IE(n,e){const t=X(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Na(t)}function wE(n,e,t){const r=X(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function Na(n){n.Ca.forEach((e=>{e.next()}))}var Qo,Ql;(Ql=Qo||(Qo={})).Ma="default",Ql.Cache="cache";class vd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new pr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Qo.Cache}}class Ed{constructor(e){this.key=e}}class Td{constructor(e){this.key=e}}class AE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=re(),this.mutatedKeys=re(),this.eu=Lh(e),this.tu=new or(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Gl,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,v)=>{const E=s.get(p),b=Ni(this.query,v)?v:null,P=!!E&&this.mutatedKeys.has(E.key),D=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let k=!1;E&&b?E.data.isEqual(b.data)?P!==D&&(r.track({type:3,doc:b}),k=!0):this.su(E,b)||(r.track({type:2,doc:b}),k=!0,(h&&this.eu(b,h)>0||d&&this.eu(b,d)<0)&&(l=!0)):!E&&b?(r.track({type:0,doc:b}),k=!0):E&&!b&&(r.track({type:1,doc:E}),k=!0,(h||d)&&(l=!0)),k&&(b?(a=a.add(b),o=D?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:l,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,v)=>(function(b,P){const D=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W(20277,{Rt:k})}};return D(b)-D(P)})(p.type,v.type)||this.eu(p.doc,v.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new pr(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Gl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=re(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Td(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new Ed(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=re();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Oa="SyncEngine";class bE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class RE{constructor(e){this.key=e,this.hu=!1}}class SE{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new jn((l=>xh(l)),Di),this.Iu=new Map,this.Eu=new Set,this.du=new ve($.comparator),this.Au=new Map,this.Ru=new wa,this.Vu={},this.mu=new Map,this.fu=fr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function PE(n,e,t=!0){const r=Sd(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Id(r,e,t,!0),s}async function CE(n,e){const t=Sd(n);await Id(t,e,!0,!1)}async function Id(n,e,t,r){const s=await Qv(n.localStore,Ct(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let l;return r&&(l=await kE(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&hd(n.remoteStore,s),l}async function kE(n,e,t,r,s){n.pu=(v,E,b)=>(async function(D,k,B,j){let L=k.view.ru(B);L.Cs&&(L=await jl(D.localStore,k.query,!1).then((({documents:I})=>k.view.ru(I,L))));const K=j&&j.targetChanges.get(k.targetId),z=j&&j.targetMismatches.get(k.targetId)!=null,Z=k.view.applyChanges(L,D.isPrimaryClient,K,z);return Xl(D,k.targetId,Z.au),Z.snapshot})(n,v,E,b);const o=await jl(n.localStore,e,!0),a=new AE(e,o.Qs),l=a.ru(o.documents),h=gs.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,h);Xl(n,t,d.au);const p=new bE(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function VE(n,e,t){const r=X(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!Di(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Go(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Sa(r.remoteStore,s.targetId),Yo(r,s.targetId)})).catch(yr)):(Yo(r,s.targetId),await Go(r.localStore,s.targetId,!0))}async function DE(n,e){const t=X(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Sa(t.remoteStore,r.targetId))}async function NE(n,e,t){const r=BE(n);try{const s=await(function(a,l){const h=X(a),d=me.now(),p=l.reduce(((b,P)=>b.add(P.key)),re());let v,E;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let P=Wt(),D=re();return h.Ns.getEntries(b,p).next((k=>{P=k,P.forEach(((B,j)=>{j.isValidDocument()||(D=D.add(B))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,P))).next((k=>{v=k;const B=[];for(const j of l){const L=Ky(j,v.get(j.key).overlayedDocument);L!=null&&B.push(new wn(j.key,L,Ch(L.value.mapValue),kt.exists(!0)))}return h.mutationQueue.addMutationBatch(b,d,B,l)})).next((k=>{E=k;const B=k.applyToLocalDocumentSet(v,D);return h.documentOverlayCache.saveOverlays(b,k.batchId,B)}))})).then((()=>({batchId:E.batchId,changes:Uh(v)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new ve(ne)),d=d.insert(l,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await ys(r,s.changes),await Ui(r.remoteStore)}catch(s){const o=Da(s,"Failed to persist write");t.reject(o)}}async function wd(n,e){const t=X(n);try{const r=await Wv(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(ce(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?ce(a.hu,14607):s.removedDocuments.size>0&&(ce(a.hu,42227),a.hu=!1))})),await ys(t,r,e)}catch(r){await yr(r)}}function Yl(n,e,t){const r=X(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const h=X(a);h.onlineState=l;let d=!1;h.queries.forEach(((p,v)=>{for(const E of v.Sa)E.va(l)&&(d=!0)})),d&&Na(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function OE(n,e,t){const r=X(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new ve($.comparator);a=a.insert(o,nt.newNoDocument(o,Y.min()));const l=re().add(o),h=new xi(Y.min(),new Map,new ve(ne),a,l);await wd(r,h),r.du=r.du.remove(o),r.Au.delete(e),Ma(r)}else await Go(r.localStore,e,!1).then((()=>Yo(r,e,t))).catch(yr)}async function ME(n,e){const t=X(n),r=e.batch.batchId;try{const s=await Hv(t.localStore,e);bd(t,r,null),Ad(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await ys(t,s)}catch(s){await yr(s)}}async function xE(n,e,t){const r=X(n);try{const s=await(function(a,l){const h=X(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,l).next((v=>(ce(v!==null,37113),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);bd(r,e,t),Ad(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await ys(r,s)}catch(s){await yr(s)}}function Ad(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function bd(n,e,t){const r=X(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Yo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||Rd(n,r)}))}function Rd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Sa(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Ma(n))}function Xl(n,e,t){for(const r of t)r instanceof Ed?(n.Ru.addReference(r.key,e),LE(n,r)):r instanceof Td?(x(Oa,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||Rd(n,r.key)):W(19791,{wu:r})}function LE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(x(Oa,"New document in limbo: "+t),n.Eu.add(r),Ma(n))}function Ma(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new $(pe.fromString(e)),r=n.fu.next();n.Au.set(r,new RE(t)),n.du=n.du.insert(t,r),hd(n.remoteStore,new ln(Ct(ya(t.path)),r,"TargetPurposeLimboResolution",Pi.ce))}}async function ys(n,e,t){const r=X(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=ba.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=X(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>C.forEach(d,(E=>C.forEach(E.Es,(b=>p.persistence.referenceDelegate.addReference(v,E.targetId,b))).next((()=>C.forEach(E.ds,(b=>p.persistence.referenceDelegate.removeReference(v,E.targetId,b)))))))))}catch(v){if(!vr(v))throw v;x(Ra,"Failed to update sequence numbers: "+v)}for(const v of d){const E=v.targetId;if(!v.fromCache){const b=p.Ms.get(E),P=b.snapshotVersion,D=b.withLastLimboFreeSnapshotVersion(P);p.Ms=p.Ms.insert(E,D)}}})(r.localStore,o))}async function FE(n,e){const t=X(n);if(!t.currentUser.isEqual(e)){x(Oa,"User change. New user:",e.toKey());const r=await ad(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new F(V.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ys(t,r.Ls)}}function UE(n,e){const t=X(n),r=t.Au.get(e);if(r&&r.hu)return re().add(r.key);{let s=re();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Sd(n){const e=X(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=wd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=UE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OE.bind(null,e),e.Pu.H_=IE.bind(null,e.eventManager),e.Pu.yu=wE.bind(null,e.eventManager),e}function BE(n){const e=X(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ME.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xE.bind(null,e),e}class yi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Li(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return zv(this.persistence,new jv,e.initialUser,this.serializer)}Cu(e){return new od(Aa.mi,this.serializer)}Du(e){return new Xv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}yi.provider={build:()=>new yi};class jE extends yi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ce(this.persistence.referenceDelegate instanceof gi,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Rv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?at.withCacheSize(this.cacheSizeBytes):at.DEFAULT;return new od((r=>gi.mi(r,t)),this.serializer)}}class Xo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Yl(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=FE.bind(null,this.syncEngine),await vE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new TE})()}createDatastore(e){const t=Li(e.databaseInfo.databaseId),r=(function(o){return new nE(o)})(e.databaseInfo);return(function(o,a,l,h){return new oE(o,a,l,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,l){return new cE(r,s,o,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>Yl(this.syncEngine,t,0)),(function(){return zl.v()?new zl:new Jv})())}createSyncEngine(e,t){return(function(s,o,a,l,h,d,p){const v=new SE(s,o,a,l,h,d);return p&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=X(t);x(Un,"RemoteStore shutting down."),r.Ea.add(5),await _s(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Xo.provider={build:()=>new Xo};class Pd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):zt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const En="FirestoreClient";class qE{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=tt.UNAUTHENTICATED,this.clientId=ha.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{x(En,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(x(En,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Da(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ao(n,e){n.asyncQueue.verifyOperationInProgress(),x(En,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await ad(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Jl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await $E(n);x(En,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Wl(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Wl(e.remoteStore,s))),n._onlineComponents=e}async function $E(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(En,"Using user provided OfflineComponentProvider");try{await Ao(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;lr("Error using user provided cache. Falling back to memory cache: "+t),await Ao(n,new yi)}}else x(En,"Using default OfflineComponentProvider"),await Ao(n,new jE(void 0));return n._offlineComponents}async function Cd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(En,"Using user provided OnlineComponentProvider"),await Jl(n,n._uninitializedComponentsProvider._online)):(x(En,"Using default OnlineComponentProvider"),await Jl(n,new Xo))),n._onlineComponents}function zE(n){return Cd(n).then((e=>e.syncEngine))}async function kd(n){const e=await Cd(n),t=e.eventManager;return t.onListen=PE.bind(null,e.syncEngine),t.onUnlisten=VE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=CE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=DE.bind(null,e.syncEngine),t}function HE(n,e,t={}){const r=new jt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new Pd({next:E=>{p.Nu(),a.enqueueAndForget((()=>yd(o,v)));const b=E.docs.has(l);!b&&E.fromCache?d.reject(new F(V.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&E.fromCache&&h&&h.source==="server"?d.reject(new F(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(E)},error:E=>d.reject(E)}),v=new vd(ya(l.path),p,{includeMetadataChanges:!0,qa:!0});return _d(o,v)})(await kd(n),n.asyncQueue,e,t,r))),r.promise}function WE(n,e,t={}){const r=new jt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new Pd({next:E=>{p.Nu(),a.enqueueAndForget((()=>yd(o,v))),E.fromCache&&h.source==="server"?d.reject(new F(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(E)},error:E=>d.reject(E)}),v=new vd(l,p,{includeMetadataChanges:!0,qa:!0});return _d(o,v)})(await kd(n),n.asyncQueue,e,t,r))),r.promise}function Vd(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Zl=new Map;const Dd="firestore.googleapis.com",eu=!0;class tu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new F(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Dd,this.ssl=eu}else this.host=e.host,this.ssl=e.ssl??eu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=id;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Av)throw new F(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ay("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vd(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new F(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new F(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new F(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new F(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new X_;switch(r.type){case"firstParty":return new ty(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new F(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Zl.get(t);r&&(x("ComponentProvider","Removing Datastore"),Zl.delete(t),r.terminate())})(this),Promise.resolve()}}function GE(n,e,t,r={}){n=Ht(n,Bi);const s=mr(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(Tu(`https://${l}`),Iu("Firestore",!0)),o.host!==Dd&&o.host!==l&&lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!On(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=tt.MOCK_USER;else{d=sp(r.mockUserToken,n._app?.options.projectId);const v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new F(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new tt(v)}n._authCredentials=new J_(new _h(d,p))}}class ji{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ji(this.firestore,e,this._query)}}class ke{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ke(this.firestore,e,this._key)}toJSON(){return{type:ke._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ps(t,ke._jsonSchema))return new ke(e,r||null,new $(pe.fromString(t.referencePath)))}}ke._jsonSchemaVersion="firestore/documentReference/1.0",ke._jsonSchema={type:Ce("string",ke._jsonSchemaVersion),referencePath:Ce("string")};class pn extends ji{constructor(e,t,r){super(e,t,ya(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ke(this.firestore,null,new $(e))}withConverter(e){return new pn(this.firestore,e,this._path)}}function KE(n,e,...t){if(n=He(n),yh("collection","path",e),n instanceof Bi){const r=pe.fromString(e,...t);return ml(r),new pn(n,null,r)}{if(!(n instanceof ke||n instanceof pn))throw new F(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(pe.fromString(e,...t));return ml(r),new pn(n.firestore,null,r)}}function Xs(n,e,...t){if(n=He(n),arguments.length===1&&(e=ha.newId()),yh("doc","path",e),n instanceof Bi){const r=pe.fromString(e,...t);return pl(r),new ke(n,null,new $(r))}{if(!(n instanceof ke||n instanceof pn))throw new F(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(pe.fromString(e,...t));return pl(r),new ke(n.firestore,n instanceof pn?n.converter:null,new $(r))}}const nu="AsyncQueue";class ru{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ld(this,"async_queue_retry"),this._c=()=>{const r=wo();r&&x(nu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=wo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=wo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new jt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!vr(e))throw e;x(nu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,zt("INTERNAL UNHANDLED ERROR: ",su(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Va.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&W(47125,{Pc:su(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function su(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class vs extends Bi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ru,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ru(e),this._firestoreClient=void 0,await e}}}function QE(n,e){const t=typeof n=="object"?n:Ru(),r=typeof n=="string"?n:li,s=ta(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=np("firestore");o&&GE(s,...o)}return s}function xa(n){if(n._terminated)throw new F(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||YE(n),n._firestoreClient}function YE(n){const e=n._freezeSettings(),t=(function(s,o,a,l){return new yy(s,o,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Vd(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new qE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class _t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _t(Je.fromBase64String(e))}catch(t){throw new F(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _t(Je.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:_t._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ps(e,_t._jsonSchema))return _t.fromBase64String(e.bytes)}}_t._jsonSchemaVersion="firestore/bytes/1.0",_t._jsonSchema={type:Ce("string",_t._jsonSchemaVersion),bytes:Ce("string")};class qi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new F(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class La{constructor(e){this._methodName=e}}class Dt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Dt._jsonSchemaVersion}}static fromJSON(e){if(ps(e,Dt._jsonSchema))return new Dt(e.latitude,e.longitude)}}Dt._jsonSchemaVersion="firestore/geoPoint/1.0",Dt._jsonSchema={type:Ce("string",Dt._jsonSchemaVersion),latitude:Ce("number"),longitude:Ce("number")};class Nt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Nt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ps(e,Nt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Nt(e.vectorValues);throw new F(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Nt._jsonSchemaVersion="firestore/vectorValue/1.0",Nt._jsonSchema={type:Ce("string",Nt._jsonSchemaVersion),vectorValues:Ce("object")};const XE=/^__.*__$/;class JE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new wn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ms(e,this.data,t,this.fieldTransforms)}}class Nd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Od(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{Ac:n})}}class Fa{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Fa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return vi(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Od(this.Ac)&&XE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class ZE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Li(e)}Cc(e,t,r,s=!1){return new Fa({Ac:e,methodName:t,Dc:r,path:Xe.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Md(n){const e=n._freezeSettings(),t=Li(n._databaseId);return new ZE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eT(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);Ua("Data must be an object, but it was:",a,r);const l=xd(r,a);let h,d;if(o.merge)h=new ht(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const v of o.mergeFields){const E=Jo(e,v,t);if(!a.contains(E))throw new F(V.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Fd(p,E)||p.push(E)}h=new ht(p),d=a.fieldTransforms.filter((v=>h.covers(v.field)))}else h=null,d=a.fieldTransforms;return new JE(new ct(l),h,d)}class $i extends La{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof $i}}function tT(n,e,t,r){const s=n.Cc(1,e,t);Ua("Data must be an object, but it was:",s,r);const o=[],a=ct.empty();In(r,((h,d)=>{const p=Ba(e,h,t);d=He(d);const v=s.yc(p);if(d instanceof $i)o.push(p);else{const E=zi(d,v);E!=null&&(o.push(p),a.set(p,E))}}));const l=new ht(o);return new Nd(a,l,s.fieldTransforms)}function nT(n,e,t,r,s,o){const a=n.Cc(1,e,t),l=[Jo(e,r,t)],h=[s];if(o.length%2!=0)throw new F(V.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<o.length;E+=2)l.push(Jo(e,o[E])),h.push(o[E+1]);const d=[],p=ct.empty();for(let E=l.length-1;E>=0;--E)if(!Fd(d,l[E])){const b=l[E];let P=h[E];P=He(P);const D=a.yc(b);if(P instanceof $i)d.push(b);else{const k=zi(P,D);k!=null&&(d.push(b),p.set(b,k))}}const v=new ht(d);return new Nd(p,v,a.fieldTransforms)}function zi(n,e){if(Ld(n=He(n)))return Ua("Unsupported field value:",e,n),xd(n,e);if(n instanceof La)return(function(r,s){if(!Od(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const l of r){let h=zi(l,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=He(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return qy(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=me.fromDate(r);return{timestampValue:mi(s.serializer,o)}}if(r instanceof me){const o=new me(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:mi(s.serializer,o)}}if(r instanceof Dt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _t)return{bytesValue:Jh(s.serializer,r._byteString)};if(r instanceof ke){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ia(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Nt)return(function(a,l){return{mapValue:{fields:{[Sh]:{stringValue:Ph},[ui]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return va(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${da(r)}`)})(n,e)}function xd(n,e){const t={};return Th(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):In(n,((r,s)=>{const o=zi(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function Ld(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof me||n instanceof Dt||n instanceof _t||n instanceof ke||n instanceof La||n instanceof Nt)}function Ua(n,e,t){if(!Ld(t)||!vh(t)){const r=da(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Jo(n,e,t){if((e=He(e))instanceof qi)return e._internalPath;if(typeof e=="string")return Ba(n,e);throw vi("Field path arguments must be of type string or ",n,!1,void 0,t)}const rT=new RegExp("[~\\*/\\[\\]]");function Ba(n,e,t){if(e.search(rT)>=0)throw vi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qi(...e.split("."))._internalPath}catch{throw vi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function vi(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new F(V.INVALID_ARGUMENT,l+n+h)}function Fd(n,e){return n.some((t=>t.isEqual(e)))}class Ud{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ke(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new sT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class sT extends Ud{data(){return super.data()}}function Bd(n,e){return typeof e=="string"?Ba(n,e):e instanceof qi?e._internalPath:e._delegate._internalPath}function iT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new F(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oT{convertValue(e,t="none"){switch(yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return In(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[ui].arrayValue?.values?.map((r=>be(r.doubleValue)));return new Nt(t)}convertGeoPoint(e){return new Dt(be(e.latitude),be(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ki(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(rs(e));default:return null}}convertTimestamp(e){const t=gn(e);return new me(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=pe.fromString(e);ce(sd(r),9688,{name:e});const s=new ss(r.get(1),r.get(3)),o=new $(r.popFirst(5));return s.isEqual(t)||zt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function aT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class $r{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nn extends Ud{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Js(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Bd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new F(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Nn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Nn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Nn._jsonSchema={type:Ce("string",Nn._jsonSchemaVersion),bundleSource:Ce("string","DocumentSnapshot"),bundleName:Ce("string"),bundle:Ce("string")};class Js extends Nn{data(e={}){return super.data(e)}}class ar{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new $r(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Js(this._firestore,this._userDataWriter,r.key,r,new $r(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const h=new Js(s._firestore,s._userDataWriter,l.doc.key,l.doc,new $r(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new Js(s._firestore,s._userDataWriter,l.doc.key,l.doc,new $r(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:cT(l.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new F(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ar._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ha.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function cT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:n})}}function lT(n){n=Ht(n,ke);const e=Ht(n.firestore,vs);return HE(xa(e),n._key).then((t=>dT(e,n,t)))}ar._jsonSchemaVersion="firestore/querySnapshot/1.0",ar._jsonSchema={type:Ce("string",ar._jsonSchemaVersion),bundleSource:Ce("string","QuerySnapshot"),bundleName:Ce("string"),bundle:Ce("string")};class jd extends oT{constructor(e){super(),this.firestore=e}convertBytes(e){return new _t(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ke(this.firestore,null,t)}}function uT(n){n=Ht(n,ji);const e=Ht(n.firestore,vs),t=xa(e),r=new jd(e);return iT(n._query),WE(t,n._query).then((s=>new ar(e,r,n,s)))}function Ei(n,e,t){n=Ht(n,ke);const r=Ht(n.firestore,vs),s=aT(n.converter,e,t);return qd(r,[eT(Md(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,kt.none())])}function hT(n,e,t,...r){n=Ht(n,ke);const s=Ht(n.firestore,vs),o=Md(s);let a;return a=typeof(e=He(e))=="string"||e instanceof qi?nT(o,"updateDoc",n._key,e,t,r):tT(o,"updateDoc",n._key,e),qd(s,[a.toMutation(n._key,kt.exists(!0))])}function qd(n,e){return(function(r,s){const o=new jt;return r.asyncQueue.enqueueAndForget((async()=>NE(await zE(r),s,o))),o.promise})(xa(n),e)}function dT(n,e,t){const r=t.docs.get(e._key),s=new jd(n);return new Nn(n,s,e._key,r,new $r(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){_r=s})(gr),cr(new Mn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new vs(new Z_(r.getProvider("auth-internal")),new ny(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new F(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ss(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:t,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),dn(ul,hl,e),dn(ul,hl,"esm2020")})();const fT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},$d=bu(fT),Xr=Q_($d),Jr=QE($d),Kn=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var pT=ye('<div class="parent"><br/> <h1 class="title">Good Calendar</h1> <div style="margin-top: 2rem; position:relative"><div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem;"><input type="text" placeholder="Username or Email" class="login_input" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input" style="width: 200px;"/> <button class="login-show-password"> </button></div></div></div> <div style="position:relative"><div style="text-align:center"><button style="font-size:11pt;">Login</button> <button style="font-size:11pt;">Sign up</button></div> <div style="margin-top: 5px; text-align:center"><button style="font-size:11pt;">Forgot Password</button></div></div> <div class="login-hint"><!></div> <p style="text-align: center; max-width: 550px; color: var(--V-medium-text); font-size: 12pt">Track the quality of your days and nights using color-coded ratings and comments. Dedicated to my girlfriend and her chronic migranes.</p> <p style="text-align: center; max-width: 550px; color: var(--V-medium-text); font-size: 9pt">For demo, username and password: <span style="text-decoration:underline">goodcalendar</span></p> <span><a href="https://nicholashayek.com/" style="margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 576 512"><path fill="var(--V-medium-text)" d="M575.8 255.5c0 18-15 32.1-32 32.1l-32 0 .7 160.2c0 2.7-.2 5.4-.5 8.1l0 16.2c0 22.1-17.9 40-40 40l-16 0c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1L416 512l-24 0c-22.1 0-40-17.9-40-40l0-24 0-64c0-17.7-14.3-32-32-32l-64 0c-17.7 0-32 14.3-32 32l0 64 0 24c0 22.1-17.9 40-40 40l-24 0-31.9 0c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2l-16 0c-22.1 0-40-17.9-40-40l0-112c0-.9 0-1.9 .1-2.8l0-69.7-32 0c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"></path></svg></a> <button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></button></span></div>');function mT(n,e){Ii(e,!1),Uf();let t=ae(""),r=ae(""),s=ae(""),o="",a=ae(!0),l=vt(e,"darkMode",8,()=>{});async function h(){N(s,"");try{w(t).includes("@")?o=w(t):o=`${w(t)}@tracker.app`;const U=await Ng(Xr,o,w(r))}catch(U){console.error(U),N(s,U.message)}}async function d(){N(s,"");try{w(t).includes("@")?o=w(t):o=`${w(t)}@tracker.app`;const U=await Og(Xr,o,w(r))}catch(U){console.error(U),N(s,U.message)}}async function p(){if(N(s,""),w(t).includes("@"))o=w(t);else{N(s,"You can only reset the password of an account which uses a valid email.");return}Dg(Xr,o).then(()=>{N(s,"If this email is associated with an account, an email has been sent.")}).catch(U=>{N(s,U.message)})}function v(U){switch(!0){case U.startsWith("Firebase: Error (auth/invalid-credential)."):return"Incorrect password or the account doesn't exist.";case U.startsWith("Firebase: Missing password requirements:"):return"Your password must contain at least one uppercase character, lowercase character, and number. Minimum length is 6 characters.";case U.startsWith("Firebase: Error (auth/email-already-in-use)."):return"This account already exists.";case U.startsWith("Firebase: Error (auth/invalid-email)."):return"Your username cannot have any spaces. If using email, it must be valid.";case U.startsWith("Firebase: Error (auth/missing-password)."):return"Missing password";default:return U}}Ti();var E=pT(),b=q(Q(E),4),P=Q(b),D=Q(P);tr(D);var k=q(D,2),B=Q(k);tr(B);var j=q(B,2),L=Q(j,!0);G(j),G(k),G(P),G(b);var K=q(b,2),z=Q(K),Z=Q(z),I=q(Z,2);G(z);var g=q(z,2),_=Q(g);G(g),G(K);var A=q(K,2),y=Q(A);{var T=U=>{var Ee=bo();$e(ge=>ze(Ee,ge),[()=>(w(s),we(()=>v(w(s))))]),ie(U,Ee)};Pe(y,U=>{w(s)&&U(T)})}G(A);var m=q(A,6),M=q(Q(m),2);G(m),G(E),$e(()=>{uu(B,"type",w(a)?"password":"text"),ze(L,w(a)?"show":"hide")}),Dn(D,()=>w(t),U=>N(t,U)),Dn(B,()=>w(r),U=>N(r,U)),he("click",j,()=>N(a,!w(a))),he("click",Z,d),he("click",I,h),he("click",_,p),he("click",M,function(...U){l()?.apply(this,U)}),ie(n,E),wi()}var gT=ye("<h3>Entry logged!</h3>"),_T=ye('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),yT=ye('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Come back tomorrow!</h4>',1),vT=ye('<div class="overlay"><!> <button>Return</button></div>'),ET=ye('<br/> <div class="parent"><h1 class="title svelte-kkv8mu"></h1> <h3 style="margin-top: 0; font-style: italic;"> </h3></div>',1),TT=ye('<div class="parent"><h1 class="title svelte-kkv8mu"></h1> <h3 style="margin-top: 0; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..." style="margin-top:0"></textarea> <button> </button></div>'),IT=ye('<!> <button class="floating-button" style="opacity: 0; left: 2%;"></button>',1);function wT(n,e){Ii(e,!1);let t=vt(e,"user",8),r=vt(e,"externalEntry",8,null),s=vt(e,"onSaved",8,()=>{}),o=vt(e,"invert",8),a=vt(e,"selectedCalendar",8),l=new Date;const h=l.getFullYear(),d=l.getMonth(),p=l.getDate();function v(m){return m.toString().padStart(2,"0")}let E=t().uid;if(t().email){const m=t().email.split("@")[0];name=m.charAt(0).toUpperCase()+m.slice(1)}else name="Temp";`${h}${v(d+1)}${v(p)}`;let b=ae(5),P=ae(""),D=ae(!1),k=ae(""),B=ae(!1),j=ae(""),L=ae(""),K=ae(!1);function z(m){return o()&&(m=10-m),`hsl(${120*(m/10)}, 70%, var(--V-brightness))`}function Z(){return w(b)/10}async function I(m){if(w(D)&&!w(K))return;N(B,!0);const M=Xs(Jr,"users",E,a(),m.key);m.period==="day"?(await Ei(M,{valueDay:w(b),textDay:w(P),timestamp:Date.now()},{merge:!0}),m.filledNight&&N(L,"Come back tomorrow!")):(await Ei(M,{valueNight:w(b),textNight:w(P),timestamp:Date.now()},{merge:!0}),m.filledDay&&N(L,"Come back tomorrow!")),console.log("Logged "+m.key+" at "+m.period),s()()}function g(){N(B,!1)}zr(()=>mt(r()),()=>{if(r()){let m=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&m?N(D,!0):!r().current&&!m?N(D,!0):r().current&&(N(D,!1),N(P,r().period==="day"?r().textDay:r().textNight),N(b,(r().period==="day"?r().valueDay:r().valueNight)||5))}}),zr(()=>(mt(o()),w(b)),()=>{o()?N(k,w(b)<=0?"celebrate":""):N(k,w(b)>=10?"celebrate":"")}),zr(()=>(mt(o()),w(b)),()=>{(o()||w(b))&&N(j,z(w(b)))}),lu(),Ti();var _=IT(),A=Lt(_);{var y=m=>{var M=js(),U=Lt(M);{var Ee=oe=>{var ue=vT(),Le=Q(ue);{var st=ee=>{var de=gT();ie(ee,de)},_e=ee=>{var de=js(),Ve=Lt(de);{var dt=Ae=>{var We=_T();Dc(2),ie(Ae,We)},Te=Ae=>{var We=yT();Dc(2),ie(Ae,We)};Pe(Ve,Ae=>{mt(r()),we(()=>r().period==="night"&&!r().filledDay)?Ae(dt):Ae(Te,!1)},!0)}ie(ee,de)};Pe(Le,ee=>{mt(r()),we(()=>r().period==="day"&&!r().filledNight)?ee(st):ee(_e,!1)})}var Re=q(Le,2);Re.__click=g,G(ue),ie(oe,ue)},ge=oe=>{var ue=js(),Le=Lt(ue);{var st=Re=>{var ee=ET(),de=q(Lt(ee),2),Ve=Q(de);Ve.textContent=`Welcome ${name??""}!`;var dt=q(Ve,2),Te=Q(dt,!0);G(dt),G(de),$e(()=>ze(Te,w(L)||"Viewing past entries")),ie(Re,ee)},_e=Re=>{var ee=TT(),de=Q(ee);de.textContent=`Welcome ${name??""}!`;var Ve=q(de,2),dt=Q(Ve);G(Ve);var Te=q(Ve,2);tr(Te);var Ae=q(Te,2);Lf(Ae);var We=q(Ae,2);We.__click=()=>I(r());var $n=Q(We);G(We),G(ee),$e((It,Yt)=>{ze(dt,`Rate your ${mt(r()),we(()=>r().period==="day"?"day":"night")??""}`),Te.disabled=w(D)&&!w(K),Gf(Te,1,zf(w(k)),"svelte-kkv8mu"),nr(Te,`--fill-percentage: ${It??""}%; --slider-color: ${w(j)??""}; margin-bottom: 0`),We.disabled=w(D)&&!w(K),ze($n,`Save (${Yt??""}/10)`)},[()=>we(Z),()=>(w(b),we(()=>w(b).toFixed(1)))]),Dn(Te,()=>w(b),It=>N(b,It)),Dn(Ae,()=>w(P),It=>N(P,It)),ie(Re,ee)};Pe(Le,Re=>{w(D)&&!w(K)?Re(st):Re(_e,!1)})}ie(oe,ue)};Pe(U,oe=>{w(B)?oe(Ee):oe(ge,!1)})}ie(m,M)};Pe(A,m=>{r()&&m(y)})}var T=q(A,2);T.__dblclick=()=>{console.log("Activated override!"),N(K,!w(K))},ie(n,_),wi()}Ff(["click","dblclick"]);var AT=ye('<div class="day"><div class="day-number"> </div>  <div class="day-half top-half"></div>  <div class="day-half bottom-half"></div></div>'),bT=ye("<!> <br/> <i> </i>",1),RT=ye("<!> <br/> <i> </i>",1),ST=ye('<div class="entry-info"><strong> </strong> <!></div>'),PT=ye('<div class="month-nav"><button class="nav-btn" aria-label="Previous month"></button> <p> </p> <button class="nav-btn" aria-label="Next month"></button></div> <div class="calendar"></div> <!>',1);function CT(n,e){Ii(e,!1);let t=vt(e,"user",8),r=vt(e,"onSelectEntry",8,y=>{}),s=vt(e,"reloadTrigger",8,0),o=vt(e,"invert",8),a=vt(e,"selectedCalendar",8),l=t().uid,h=ae([]),d=ae(null),p=ae(new Date),v=ae("");function E(y){return y==null?"var(--V-background-white)":`hsl(${120*(y/10)}, 70%, var(--V-brightness))`}function b(y){return y.toString().padStart(2,"0")}async function P(){console.log("Loaded calendar entries");const y=w(p).getFullYear(),T=w(p).getMonth(),M=new Date().getHours()<16?"day":"night",U=new Date,Ee=new Date(y,T+1,0).getDate();N(v,w(p).toLocaleString("default",{month:"long",year:"numeric"}));const ge=KE(Jr,"users",l,a()),oe=await uT(ge),ue={};oe.forEach(_e=>{ue[_e.id]=_e.data()});const Le=[],st=y===U.getFullYear()&&T===U.getMonth()?U.getDate():Ee;for(let _e=1;_e<=st;_e++){const Re=`${y}-${b(T+1)}-${b(_e)}`,ee=ue[Re],de=y===U.getFullYear()&&T===U.getMonth()&&_e===U.getDate(),Ve={key:Re,day:_e,filledDay:ee?.valueDay!=null,filledNight:ee?.valueNight!=null,valueDay:ee?.valueDay??null,valueNight:ee?.valueNight??null,textDay:ee?.textDay??null,textNight:ee?.textNight??null,current:de};de&&(w(d)?.period?Ve.period=w(d).period:Ve.period=M,D(Ve)),Le.push(Ve)}N(h,Le)}function D(y){N(d,y),r()(y),console.log("Selected "+w(d).key+" at "+w(d).period)}function k(){const y=new Date(w(p));y.setMonth(y.getMonth()-1),N(p,y),P(),N(d,null)}function B(){const y=new Date,T=new Date(w(p));T.setMonth(T.getMonth()+1),!(T.getFullYear()>y.getFullYear()||T.getFullYear()===y.getFullYear()&&T.getMonth()>y.getMonth())&&(N(p,T),P(),N(d,null))}Bf(P),zr(()=>mt(s()),()=>{s()&&P()}),zr(()=>mt(a()),()=>{a()&&(P(),N(d,null))}),lu(),Ti();var j=PT(),L=Lt(j),K=Q(L),z=q(K,2),Z=Q(z,!0);G(z);var I=q(z,2);G(L);var g=q(L,2);du(g,5,()=>w(h),hu,(y,T)=>{var m=AT(),M=Q(m),U=Q(M,!0);G(M);var Ee=q(M,2),ge=q(Ee,2);G(m),$e((oe,ue)=>{nr(m,(w(T),w(d),we(()=>(w(T).current?"border: 1.5px solid var(--V-lighter-text);":"")+(w(d)!=null&&w(d).key===w(T).key&&w(d).period==="day"?"border-top: 2.5px solid #6BCBFF;":w(d)!=null&&w(d).key===w(T).key?"border-bottom: 2.5px solid #0077BA;":"")))),ze(U,(w(T),we(()=>w(T).day))),nr(Ee,oe),nr(ge,ue)},[()=>(w(T),mt(o()),mt(Kn),we(()=>(w(T).valueDay!=null?!o()&&w(T).valueDay==10?`background: url('${Kn}'); background-size: cover;`:o()&&w(T).valueDay==0?`background: url('${Kn}'); background-size: cover;`:`background-color: ${E(w(T).valueDay!=null&&!o()?w(T).valueDay:w(T).valueDay!=null?10-w(T).valueDay:null)};`:"")+"transition: background-color .3s ease-in-out")),()=>(w(T),mt(o()),mt(Kn),we(()=>(w(T).valueNight!=null?!o()&&w(T).valueNight==10?`background: url('${Kn}'); background-size: cover;`:o()&&w(T).valueNight==0?`background: url('${Kn}'); background-size: cover;`:`background-color: ${E(w(T).valueNight!=null&&!o()?w(T).valueNight:w(T).valueNight!=null?10-w(T).valueNight:null)};`:"")+"transition: background-color .3s ease-in-out"))]),he("click",Ee,()=>D({...w(T),period:"day"})),he("click",ge,()=>D({...w(T),period:"night"})),ie(y,m)}),G(g);var _=q(g,2);{var A=y=>{var T=ST(),m=Q(T),M=Q(m);G(m);var U=q(m,2);{var Ee=oe=>{var ue=bT(),Le=Lt(ue);{var st=ee=>{var de=bo();$e(()=>ze(de,` ${w(d),we(()=>w(d).valueDay)??""}/10`)),ie(ee,de)};Pe(Le,ee=>{w(d),we(()=>w(d).filledDay)&&ee(st)})}var _e=q(Le,4),Re=Q(_e,!0);G(_e),$e(()=>ze(Re,(w(d),we(()=>w(d).textDay||"No Entry")))),ie(oe,ue)},ge=oe=>{var ue=RT(),Le=Lt(ue);{var st=ee=>{var de=bo();$e(()=>ze(de,` ${w(d),we(()=>w(d).valueNight)??""}/10`)),ie(ee,de)};Pe(Le,ee=>{w(d),we(()=>w(d).filledNight)&&ee(st)})}var _e=q(Le,4),Re=Q(_e,!0);G(_e),$e(()=>ze(Re,(w(d),we(()=>w(d).textNight||"No Entry")))),ie(oe,ue)};Pe(U,oe=>{w(d),we(()=>w(d).period==="day")?oe(Ee):oe(ge,!1)})}G(T),$e(oe=>ze(M,`${oe??""} ${w(d),we(()=>w(d).period==="day"?"Day":"Night")??""}`),[()=>(w(d),we(()=>new Date(new Date(w(d).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),ie(y,T)};Pe(_,y=>{w(d),we(()=>w(d)&&!(w(d).period==="day"&&!w(d).filledDay&&w(d).current||w(d).period==="night"&&!w(d).filledNight&&w(d).current))&&y(A)})}$e(y=>{ze(Z,w(v)),I.disabled=y},[()=>(w(p),we(()=>w(p).getFullYear()===new Date().getFullYear()&&w(p).getMonth()===new Date().getMonth()))]),he("click",K,k),he("click",I,B),ie(n,j),wi()}var kT=ye("<button> </button>"),VT=ye('<div class="overlay"><h2 style="margin-bottom: .5rem;">Your Calendars</h2> <span></span><br/><br/> <span style="margin-bottom: .5rem; flex-wrap: wrap; gap:.5rem;display: flex;"><button>Rename</button> <button>Delete</button> <button>New</button></span> <button>Back</button></div>'),DT=ye("<p> </p>"),NT=ye('<div class="overlay"><input type="text" class="login_input"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),OT=ye("<p> </p>"),MT=ye('<div class="overlay"><h3 style="margin-bottom: 0;"> </h3> <p><i>This action cannot be undone.</i></p><br/><br/> <input type="password" class="login_input" placeholder="Re-enter Password"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),xT=ye("<p> </p>"),LT=ye('<div class="overlay"><input type="text" class="login_input" placeholder="New Calendar"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),FT=ye('<div style="order: 1; flex-wrap: wrap; gap:.5rem;display: flex"><button style="padding: .4rem inherit; border: 2px dashed #339FFF;"><b> </b></button> <!> <!> <!> <!> <button>Invert</button></div>'),UT=ye('<div class="overlay"><div style="width: 65%; text-align:left"><span>Click on the <b>top half</b> of the current date to log an entry for today. Click on the <b>bottom half</b> to log an entry for tonight. You can save a rating (0-10) and, optionally, some text. Entries may be edited only on the current date. <br/><br/>To manage your calendars, click on <b>Main</b> in the bottom-left corner. You may add, delete, rename, and toggle between calendars to your liking. To reverse the red-green color scheme, click <b>Invert.</b> Your preferences will be saved for the next time you login!</span></div> <br/><br/> <button>Return</button></div>'),BT=ye(`<div style="flex-grow: 1;"><!> <!> <div style="display: flex;
  justify-content: space-between;
  gap: .5rem;
  flex-wrap: wrap;
  padding-left: 5%;
  padding-right: 5%;"><div style="order: 2; flex-wrap: wrap; gap:.5rem; display: flex;"><span><button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 352 512"><path fill="var(--V-medium-text)" d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></button> <button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></button> <button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 8px"><svg height="25px" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path></svg></button></span></div> <!> <!></div></div>`);function YT(n,e){Ii(e,!1);let t=ae(null),r=ae(null),s=ae(0),o=ae(null),a=ae(!1),l=ae(null),h=ae(null),d=ae(""),p=ae(""),v=ae(""),E=ae(""),b=ae(""),P=ae(!1),D=!1;Lg(Xr,M=>{_(M),N(t,M)});async function k(){if(!w(t))return;N(o,!w(o));const M=Xs(Jr,"users",w(t).uid);await Ei(M,{colorPreference:w(o),timestamp:Date.now()},{merge:!0}),console.log("Saved user profile invert="+w(o))}function B(){D=!D,D?(document.documentElement.style.setProperty("--V-background-white","var(--background-black)"),document.documentElement.style.setProperty("--V-background-off-white","var(--background-off-black)"),document.documentElement.style.setProperty("--V-medium-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-dark-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-ligher-text","var(--dark-text)"),document.documentElement.style.setProperty("--V-brightness","50%"),document.querySelectorAll(".day-number").forEach(M=>{M.style.textShadow="0px 0px 2px black"}),document.querySelectorAll(".title").forEach(M=>{M.style.backgroundPositionY="0px",M.style.backgroundPositionX="-70px",M.style.backgroundSize="150% auto"})):(document.documentElement.style.setProperty("--V-background-white","var(--background-white)"),document.documentElement.style.setProperty("--V-background-off-white","var(--background-off-white)"),document.documentElement.style.setProperty("--V-medium-text","var(--medium-text)"),document.documentElement.style.setProperty("--V-dark-text","var(--dark-text)"),document.documentElement.style.setProperty("--V-ligher-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-brightness","var(--brightness)"),document.querySelectorAll(".day-number").forEach(M=>{M.style.textShadow="0px 0px 2px white"}),document.querySelectorAll(".title").forEach(M=>{M.style.backgroundPositionY="-100px",M.style.backgroundPositionX="0px",M.style.backgroundSize="cover"}))}function j(){w(p)===""?N(b,"New name cannot be empty!"):Object.values(w(l)).includes(w(p))?N(b,"New name cannot be a duplicate!"):(Os(l,w(l)[w(h)]=w(p)),z(),N(p,""),N(b,""),N(v,""))}function L(){Vg(w(t),Bn.credential(w(t).email,w(E))).then(()=>{Object.keys(w(l)).length===1?(N(b,"You cannot delete your last calendar!"),N(E,"")):(delete w(l)[w(h)],N(l,{...w(l)}),N(h,Object.keys(w(l)).sort()[0]),z(),N(E,""),N(b,""),N(v,""))}).catch(M=>{N(b,"Incorrect password!")})}function K(){if(w(d)==="")N(b,"New name cannot be empty!");else if(Object.values(w(l)).includes(w(d)))N(b,"New name cannot be a duplicate!");else{const M=Date.now().toString();Os(l,w(l)[M]=w(d)),N(l,{...w(l)}),N(h,M),z(),N(b,""),N(d,""),N(v,"")}}async function z(){if(!w(t))return;const M=Date.now(),U=Xs(Jr,"users",w(t).uid),Ee=w(t).email?w(t).email.replace("@tracker.app",""):"anonymous"+M.toString();U.calendars?await hT(U,{calendars:w(l),selectedCalendar:w(h),timestamp:M}):await Ei(U,{calendars:w(l),selectedCalendar:w(h),name:Ee,timestamp:M}),console.log("Saved calendars to database")}function Z(){N(s,w(s)+1)}function I(){Fg(Xr),N(t,null),N(r,null)}function g(M){N(r,M)}async function _(M){if(!M)return;const U=Xs(Jr,"users",M.uid),Ee=await lT(U);if(Ee.exists()){const ge=Ee.data();if(ge.calendars)N(l,ge.calendars),N(h,ge.selectedCalendar),console.log("Loaded user calendars");else{N(l,{});const oe=Date.now().toString();Os(l,w(l)[oe]="Main"),N(h,oe),await z(),console.log("Initialized user calendars")}ge.colorPreference?(N(o,ge.colorPreference),console.log("Loaded user invert="+w(o))):(N(o,!1),console.log("Initialized user invert="+w(o)))}else{N(o,!1),N(l,{});const ge=Date.now().toString();Os(l,w(l)[ge]="Main"),N(h,ge),await z(),console.log("New user.")}}Ti();var A=js(),y=Lt(A);{var T=M=>{mT(M,{darkMode:B})},m=M=>{var U=BT(),Ee=Q(U);wT(Ee,{get user(){return w(t)},get externalEntry(){return w(r)},onSaved:Z,get invert(){return w(o)},get selectedCalendar(){return w(h)}});var ge=q(Ee,2);CT(ge,{get user(){return w(t)},onSelectEntry:g,get reloadTrigger(){return w(s)},get invert(){return w(o)},get selectedCalendar(){return w(h)}});var oe=q(ge,2),ue=Q(oe),Le=Q(ue),st=Q(Le),_e=q(st,2),Re=q(_e,2);G(Le),G(ue);var ee=q(ue,2);{var de=Te=>{var Ae=FT(),We=Q(Ae),$n=Q(We),It=Q($n,!0);G($n),G(We);var Yt=q(We,2);{var Es=Ke=>{var Fe=VT(),Ue=q(Q(Fe),2);du(Ue,5,()=>Object.keys(w(l)).sort(),hu,(Qe,Ze)=>{var Be=kT(),yt=Q(Be,!0);G(Be),$e(()=>{nr(Be,(w(h)===w(Ze)?"border: 2px dashed #339FFF;":"border: 2px dashed #ccc;")+"margin: .5rem; margin-bottom: 0; font-size: 1.1rem"),ze(yt,w(l)[w(Ze)])}),he("click",Be,()=>{N(h,w(Ze)),z()}),ie(Qe,Be)}),G(Ue);var Ne=q(Ue,4),it=Q(Ne),lt=q(it,2),ft=q(lt,2);G(Ne);var xt=q(Ne,2);G(Fe),he("click",it,()=>{N(v,"rename")}),he("click",lt,()=>{N(v,"delete")}),he("click",ft,()=>{N(v,"new")}),he("click",xt,()=>{N(P,!w(P))}),ie(Ke,Fe)};Pe(Yt,Ke=>{w(P)&&Ke(Es)})}var Ts=q(Yt,2);{var Tr=Ke=>{var Fe=NT(),Ue=Q(Fe);tr(Ue);var Ne=q(Ue,3),it=Q(Ne),lt=q(it,2);G(Ne);var ft=q(Ne,2);{var xt=Qe=>{var Ze=DT(),Be=Q(Ze,!0);G(Ze),$e(()=>ze(Be,w(b))),ie(Qe,Ze)};Pe(ft,Qe=>{w(b)!=""&&Qe(xt)})}G(Fe),$e(()=>uu(Ue,"placeholder",`Renaming ${w(l)[w(h)]??""}`)),Dn(Ue,()=>w(p),Qe=>N(p,Qe)),he("click",it,()=>{N(v,""),N(p,"")}),he("click",lt,j),ie(Ke,Fe)};Pe(Ts,Ke=>{w(v)==="rename"&&Ke(Tr)})}var zn=q(Ts,2);{var Is=Ke=>{var Fe=MT(),Ue=Q(Fe),Ne=Q(Ue);G(Ue);var it=q(Ue,6);tr(it);var lt=q(it,3),ft=Q(lt),xt=q(ft,2);G(lt);var Qe=q(lt,2);{var Ze=Be=>{var yt=OT(),Ir=Q(yt,!0);G(yt),$e(()=>ze(Ir,w(b))),ie(Be,yt)};Pe(Qe,Be=>{w(b)!=""&&Be(Ze)})}G(Fe),$e(()=>ze(Ne,`Delete ${w(l)[w(h)]??""}?`)),Dn(it,()=>w(E),Be=>N(E,Be)),he("click",ft,()=>{N(v,""),N(E,""),N(b,"")}),he("click",xt,L),ie(Ke,Fe)};Pe(zn,Ke=>{w(v)==="delete"&&Ke(Is)})}var De=q(zn,2);{var Ge=Ke=>{var Fe=LT(),Ue=Q(Fe);tr(Ue);var Ne=q(Ue,3),it=Q(Ne),lt=q(it,2);G(Ne);var ft=q(Ne,2);{var xt=Qe=>{var Ze=xT(),Be=Q(Ze,!0);G(Ze),$e(()=>ze(Be,w(b))),ie(Qe,Ze)};Pe(ft,Qe=>{w(b)!=""&&Qe(xt)})}G(Fe),Dn(Ue,()=>w(d),Qe=>N(d,Qe)),he("click",it,()=>{N(v,""),N(d,""),N(b,"")}),he("click",lt,K),ie(Ke,Fe)};Pe(De,Ke=>{w(v)==="new"&&Ke(Ge)})}var An=q(De,2);G(Ae),$e(()=>{ze(It,w(l)[w(h)]),nr(An,`background-color: ${w(o)?"hsl(0, 70%, var(--V-brightness))":"hsl(120, 70%, var(--V-brightness))"}; color: #202020; transition: background-color .2s ease-in-out`)}),he("click",We,()=>{N(P,!w(P))}),he("click",An,k),ie(Te,Ae)};Pe(ee,Te=>{w(o)!=null&&Te(de)})}var Ve=q(ee,2);{var dt=Te=>{var Ae=UT(),We=q(Q(Ae),5);G(Ae),he("click",We,()=>{N(a,!w(a))}),ie(Te,Ae)};Pe(Ve,Te=>{w(a)&&Te(dt)})}G(oe),G(U),he("click",st,()=>{N(a,!w(a))}),he("click",_e,B),he("click",Re,I),ie(M,U)};Pe(y,M=>{!w(t)||!w(h)?M(T):M(m,!1)})}ie(n,A),wi()}export{YT as component};
