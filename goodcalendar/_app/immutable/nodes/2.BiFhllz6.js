import{f as _e,a as ie,t as bo,c as Us}from"../chunks/BysJwN_t.js";import{i as vi}from"../chunks/BmcIUVPK.js";import{P as io,h as ft,a4 as gf,e as ul,I as _f,H as yf,t as A,U as vf,K as Ef,M as Tf,O as Nc,Q as oo,i as Lr,aa as If,aF as wf,f as So,s as Af,c as Yn,aD as ll,z as Rf,aI as oe,af as Oc,ao as bf,r as hl,p as Sf,aM as Cf,aN as ao,d as dl,aO as Pf,aP as kf,ab as Df,aQ as Vf,aC as Nf,aR as Of,Y as Mf,aS as Lf,aK as xf,l as Ie,ag as Ff,aT as Uf,A as Ei,G as j,E as K,F as z,C as Oe,D as Ti,W as N,aU as $r,aV as fl,B as xt,v as pt,aW as Bf,ap as Mc,aX as Vs}from"../chunks/KuIhI81p.js";import{s as $e,e as ye,d as jf}from"../chunks/BIAasXF6.js";import{i as Se,p as bt}from"../chunks/DnMetUdW.js";import{r as nr,s as Co}from"../chunks/BtxzV7Uf.js";import{c as qf,o as $f}from"../chunks/YV_QUl1D.js";import"../chunks/8UtF8RsF.js";function pl(n,e){return e}function zf(n,e,t){for(var r=n.items,s=[],o=e.length,a=0;a<o;a++)Vf(e[a].e,s,!0);var u=o>0&&s.length===0&&t!==null;if(u){var h=t.parentNode;Nf(h),h.append(t),r.clear(),At(n,e[0].prev,e[o-1].next)}Of(s,()=>{for(var d=0;d<o;d++){var p=e[d];u||(r.delete(p.k),At(n,p.prev,p.next)),dl(p.e,!u)}})}function ml(n,e,t,r,s,o=null){var a=n,u={flags:e,items:new Map,first:null};{var h=n;a=ft?io(gf(h)):h.appendChild(ul())}ft&&_f();var d=null,p=!1,y=new Map,T=vf(()=>{var k=t();return Rf(k)?k:k==null?[]:ll(k)}),R,C;function V(){Hf(C,R,u,y,a,s,e,r,t),o!==null&&(R.length===0?d?hl(d):d=So(()=>o(a)):d!==null&&Sf(d,()=>{d=null}))}yf(()=>{C??=Mf,R=A(T);var k=R.length;if(p&&k===0)return;p=k===0;let U=!1;if(ft){var F=Ef(a)===Tf;F!==(k===0)&&(a=Nc(),io(a),oo(!1),U=!0)}if(ft){for(var M=null,H,G=0;G<k;G++){if(Lr.nodeType===If&&Lr.data===wf){a=Lr,U=!0,oo(!1);break}var J=R[G],I=r(J,G);H=Po(Lr,u,M,null,J,I,G,s,e,t),u.items.set(I,H),M=H}k>0&&io(Nc())}if(ft)k===0&&o&&(d=So(()=>o(a)));else if(Af()){var _=new Set,g=Yn;for(G=0;G<k;G+=1){J=R[G],I=r(J,G);var w=u.items.get(I)??y.get(I);w?gl(w,J,G):(H=Po(null,u,null,null,J,I,G,s,e,t,!0),y.set(I,H)),_.add(I)}for(const[v,E]of u.items)_.has(v)||g.skipped_effects.add(E.e);g.oncommit(V)}else V();U&&oo(!0),A(T)}),ft&&(a=Lr)}function Hf(n,e,t,r,s,o,a,u,h){var d=e.length,p=t.items,y=t.first,T=y,R,C=null,V=[],k=[],U,F,M,H;for(H=0;H<d;H+=1){if(U=e[H],F=u(U,H),M=p.get(F),M===void 0){var G=r.get(F);if(G!==void 0){r.delete(F),p.set(F,G);var J=C?C.next:T;At(t,C,G),At(t,G,J),co(G,J,s),C=G}else{var I=T?T.e.nodes_start:s;C=Po(I,t,C,C===null?t.first:C.next,U,F,H,o,a,h)}p.set(F,C),V=[],k=[],T=C.next;continue}if(gl(M,U,H),(M.e.f&ao)!==0&&hl(M.e),M!==T){if(R!==void 0&&R.has(M)){if(V.length<k.length){var _=k[0],g;C=_.prev;var w=V[0],v=V[V.length-1];for(g=0;g<V.length;g+=1)co(V[g],_,s);for(g=0;g<k.length;g+=1)R.delete(k[g]);At(t,w.prev,v.next),At(t,C,w),At(t,v,_),T=_,C=v,H-=1,V=[],k=[]}else R.delete(M),co(M,T,s),At(t,M.prev,M.next),At(t,M,C===null?t.first:C.next),At(t,C,M),C=M;continue}for(V=[],k=[];T!==null&&T.k!==F;)(T.e.f&ao)===0&&(R??=new Set).add(T),k.push(T),T=T.next;if(T===null)continue;M=T}V.push(M),C=M,T=M.next}if(T!==null||R!==void 0){for(var E=R===void 0?[]:ll(R);T!==null;)(T.e.f&ao)===0&&E.push(T),T=T.next;var m=E.length;if(m>0){var Y=d===0?s:null;zf(t,E,Y)}}n.first=t.first&&t.first.e,n.last=C&&C.e;for(var re of r.values())dl(re.e);r.clear()}function gl(n,e,t,r){bf(n.v,e),n.i=t}function Po(n,e,t,r,s,o,a,u,h,d,p){var y=(h&Pf)!==0,T=(h&kf)===0,R=y?T?oe(s,!1,!1):Oc(s):s,C=(h&Cf)===0?a:Oc(a),V={i:C,v:R,k:o,a:null,e:null,prev:t,next:r};try{if(n===null){var k=document.createDocumentFragment();k.append(n=ul())}return V.e=So(()=>u(n,R,C,d),ft),V.e.prev=t&&t.e,V.e.next=r&&r.e,t===null?p||(e.first=V):(t.next=V,t.e.next=V.e),r!==null&&(r.prev=V,r.e.prev=V.e),V}finally{}}function co(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==r;){var a=Df(o);s.before(o),o=a}}function At(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function _l(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=_l(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Wf(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=_l(n))&&(r&&(r+=" "),r+=e);return r}function Gf(n){return typeof n=="object"?Wf(n):n??""}function Kf(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Lc(n,e=!1){var t=e?" !important;":";",r="";for(var s in n){var o=n[s];o!=null&&o!==""&&(r+=" "+s+": "+o+t)}return r}function uo(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function Qf(n,e){if(e){var t="",r,s;if(Array.isArray(e)?(r=e[0],s=e[1]):r=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,u=!1,h=[];r&&h.push(...Object.keys(r).map(uo)),s&&h.push(...Object.keys(s).map(uo));var d=0,p=-1;const V=n.length;for(var y=0;y<V;y++){var T=n[y];if(u?T==="/"&&n[y-1]==="*"&&(u=!1):o?o===T&&(o=!1):T==="/"&&n[y+1]==="*"?u=!0:T==='"'||T==="'"?o=T:T==="("?a++:T===")"&&a--,!u&&o===!1&&a===0){if(T===":"&&p===-1)p=y;else if(T===";"||y===V-1){if(p!==-1){var R=uo(n.substring(d,p).trim());if(!h.includes(R)){T!==";"&&y++;var C=n.substring(d,y).trim();t+=" "+C+";"}}d=y+1,p=-1}}}}return r&&(t+=Lc(r)),s&&(t+=Lc(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function Yf(n,e,t,r,s,o){var a=n.__className;if(ft||a!==t||a===void 0){var u=Kf(t,r);(!ft||u!==n.getAttribute("class"))&&(u==null?n.removeAttribute("class"):n.className=u),n.__className=t}return o}function lo(n,e={},t,r){for(var s in t){var o=t[s];e[s]!==o&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,o,r))}}function Bt(n,e,t,r){var s=n.__style;if(ft||s!==e){var o=Qf(e,r);(!ft||o!==n.getAttribute("style"))&&(o==null?n.removeAttribute("style"):n.style.cssText=o),n.__style=e}else r&&(Array.isArray(r)?(lo(n,t?.[0],r[0]),lo(n,t?.[1],r[1],"important")):lo(n,t,r));return r}function Nn(n,e,t=e){var r=new WeakSet;Lf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=ho(n)?fo(o):o,t(o),Yn!==null&&r.add(Yn),await xf(),o!==(o=e())){var a=n.selectionStart,u=n.selectionEnd,h=n.value.length;if(n.value=o??"",u!==null){var d=n.value.length;a===u&&u===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(u,d))}}}),(ft&&n.defaultValue!==n.value||Ie(e)==null&&n.value)&&(t(ho(n)?fo(n.value):n.value),Yn!==null&&r.add(Yn)),Ff(()=>{var s=e();if(n===document.activeElement){var o=Uf??Yn;if(r.has(o))return}ho(n)&&s===fo(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function ho(n){var e=n.type;return e==="number"||e==="range"}function fo(n){return n===""?null:+n}const Xf=()=>{};var xc={};const yl=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Jf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},vl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,y=(o&3)<<4|u>>4;let T=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(T=64)),r.push(t[p],t[y],t[T],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(yl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Jf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const y=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||y==null)throw new Zf;const T=o<<2|u>>4;if(r.push(T),d!==64){const R=u<<4&240|d>>2;if(r.push(R),y!==64){const C=d<<6&192|y;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Zf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ep=function(n){const e=yl(n);return vl.encodeByteArray(e,!0)},Xs=function(n){return ep(n).replace(/\./g,"")},El=function(n){try{return vl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function tp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const np=()=>tp().__FIREBASE_DEFAULTS__,rp=()=>{if(typeof process>"u"||typeof xc>"u")return;const n=xc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},sp=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&El(n[1]);return e&&JSON.parse(e)},Ii=()=>{try{return Xf()||np()||rp()||sp()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Tl=n=>Ii()?.emulatorHosts?.[n],ip=n=>{const e=Tl(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Il=()=>Ii()?.config,wl=n=>Ii()?.[`_${n}`];class op{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function mr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Al(n){return(await fetch(n,{credentials:"include"})).ok}function ap(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Xs(JSON.stringify(t)),Xs(JSON.stringify(a)),""].join(".")}const zr={};function cp(){const n={prod:[],emulator:[]};for(const e of Object.keys(zr))zr[e]?n.emulator.push(e):n.prod.push(e);return n}function up(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Fc=!1;function Rl(n,e){if(typeof window>"u"||typeof document>"u"||!mr(window.location.host)||zr[n]===e||zr[n]||Fc)return;zr[n]=e;function t(T){return`__firebase__banner__${T}`}const r="__firebase__banner",o=cp().prod.length>0;function a(){const T=document.getElementById(r);T&&T.remove()}function u(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function h(T,R){T.setAttribute("width","24"),T.setAttribute("id",R),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function d(){const T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{Fc=!0,a()},T}function p(T,R){T.setAttribute("id",R),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function y(){const T=up(r),R=t("text"),C=document.getElementById(R)||document.createElement("span"),V=t("learnmore"),k=document.getElementById(V)||document.createElement("a"),U=t("preprendIcon"),F=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){const M=T.element;u(M),p(k,V);const H=d();h(F,U),M.append(F,C,k,H),document.body.appendChild(M)}o?(C.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function tt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tt())}function hp(){const n=Ii()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function fp(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function pp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function mp(){const n=tt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function gp(){return!hp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _p(){try{return typeof indexedDB=="object"}catch{return!1}}function yp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const vp="FirebaseError";class Kt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=vp,Object.setPrototypeOf(this,Kt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,os.prototype.create)}}class os{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Ep(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Kt(s,u,r)}}function Ep(n,e){return n.replace(Tp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Tp=/\{\$([^}]+)}/g;function Ip(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Mn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Uc(o)&&Uc(a)){if(!Mn(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Uc(n){return n!==null&&typeof n=="object"}function as(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function xr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Fr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function wp(n,e){const t=new Ap(n,e);return t.subscribe.bind(t)}class Ap{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Rp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=po),s.error===void 0&&(s.error=po),s.complete===void 0&&(s.complete=po);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Rp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function po(){}function ze(n){return n&&n._delegate?n._delegate:n}class Ln{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Dn="[DEFAULT]";class bp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new op;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Cp(e))try{this.getOrInitializeService({instanceIdentifier:Dn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=Dn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Dn){return this.instances.has(e)}getOptions(e=Dn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Sp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Dn){return this.component?this.component.multipleInstances?e:Dn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Sp(n){return n===Dn?void 0:n}function Cp(n){return n.instantiationMode==="EAGER"}class Pp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new bp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Z||(Z={}));const kp={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},Dp=Z.INFO,Vp={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},Np=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Vp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class na{constructor(e){this.name=e,this._logLevel=Dp,this._logHandler=Np,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?kp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}const Op=(n,e)=>e.some(t=>n instanceof t);let Bc,jc;function Mp(){return Bc||(Bc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Lp(){return jc||(jc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bl=new WeakMap,ko=new WeakMap,Sl=new WeakMap,mo=new WeakMap,ra=new WeakMap;function xp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(ln(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&bl.set(t,n)}).catch(()=>{}),ra.set(e,n),e}function Fp(n){if(ko.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});ko.set(n,e)}let Do={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ko.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Sl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ln(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Up(n){Do=n(Do)}function Bp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(go(this),e,...t);return Sl.set(r,e.sort?e.sort():[e]),ln(r)}:Lp().includes(n)?function(...e){return n.apply(go(this),e),ln(bl.get(this))}:function(...e){return ln(n.apply(go(this),e))}}function jp(n){return typeof n=="function"?Bp(n):(n instanceof IDBTransaction&&Fp(n),Op(n,Mp())?new Proxy(n,Do):n)}function ln(n){if(n instanceof IDBRequest)return xp(n);if(mo.has(n))return mo.get(n);const e=jp(n);return e!==n&&(mo.set(n,e),ra.set(e,n)),e}const go=n=>ra.get(n);function qp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=ln(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ln(a.result),h.oldVersion,h.newVersion,ln(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const $p=["get","getKey","getAll","getAllKeys","count"],zp=["put","add","delete","clear"],_o=new Map;function qc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(_o.get(e))return _o.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=zp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||$p.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),s&&h.done]))[0]};return _o.set(e,o),o}Up(n=>({...n,get:(e,t,r)=>qc(e,t)||n.get(e,t,r),has:(e,t)=>!!qc(e,t)||n.has(e,t)}));class Hp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Wp(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Wp(n){return n.getComponent()?.type==="VERSION"}const Vo="@firebase/app",$c="0.14.5";const $t=new na("@firebase/app"),Gp="@firebase/app-compat",Kp="@firebase/analytics-compat",Qp="@firebase/analytics",Yp="@firebase/app-check-compat",Xp="@firebase/app-check",Jp="@firebase/auth",Zp="@firebase/auth-compat",em="@firebase/database",tm="@firebase/data-connect",nm="@firebase/database-compat",rm="@firebase/functions",sm="@firebase/functions-compat",im="@firebase/installations",om="@firebase/installations-compat",am="@firebase/messaging",cm="@firebase/messaging-compat",um="@firebase/performance",lm="@firebase/performance-compat",hm="@firebase/remote-config",dm="@firebase/remote-config-compat",fm="@firebase/storage",pm="@firebase/storage-compat",mm="@firebase/firestore",gm="@firebase/ai",_m="@firebase/firestore-compat",ym="firebase",vm="12.5.0";const No="[DEFAULT]",Em={[Vo]:"fire-core",[Gp]:"fire-core-compat",[Qp]:"fire-analytics",[Kp]:"fire-analytics-compat",[Xp]:"fire-app-check",[Yp]:"fire-app-check-compat",[Jp]:"fire-auth",[Zp]:"fire-auth-compat",[em]:"fire-rtdb",[tm]:"fire-data-connect",[nm]:"fire-rtdb-compat",[rm]:"fire-fn",[sm]:"fire-fn-compat",[im]:"fire-iid",[om]:"fire-iid-compat",[am]:"fire-fcm",[cm]:"fire-fcm-compat",[um]:"fire-perf",[lm]:"fire-perf-compat",[hm]:"fire-rc",[dm]:"fire-rc-compat",[fm]:"fire-gcs",[pm]:"fire-gcs-compat",[mm]:"fire-fst",[_m]:"fire-fst-compat",[gm]:"fire-vertex","fire-js":"fire-js",[ym]:"fire-js-all"};const Js=new Map,Tm=new Map,Oo=new Map;function zc(n,e){try{n.container.addComponent(e)}catch(t){$t.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cr(n){const e=n.name;if(Oo.has(e))return $t.debug(`There were multiple attempts to register component ${e}.`),!1;Oo.set(e,n);for(const t of Js.values())zc(t,n);for(const t of Tm.values())zc(t,n);return!0}function sa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function mt(n){return n==null?!1:n.settings!==void 0}const Im={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hn=new os("app","Firebase",Im);class wm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ln("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hn.create("app-deleted",{appName:this._name})}}const gr=vm;function Cl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:No,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw hn.create("bad-app-name",{appName:String(s)});if(t||(t=Il()),!t)throw hn.create("no-options");const o=Js.get(s);if(o){if(Mn(t,o.options)&&Mn(r,o.config))return o;throw hn.create("duplicate-app",{appName:s})}const a=new Pp(s);for(const h of Oo.values())a.addComponent(h);const u=new wm(t,r,a);return Js.set(s,u),u}function Pl(n=No){const e=Js.get(n);if(!e&&n===No&&Il())return Cl();if(!e)throw hn.create("no-app",{appName:n});return e}function dn(n,e,t){let r=Em[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$t.warn(a.join(" "));return}cr(new Ln(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Am="firebase-heartbeat-database",Rm=1,Xr="firebase-heartbeat-store";let yo=null;function kl(){return yo||(yo=qp(Am,Rm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Xr)}catch(t){console.warn(t)}}}}).catch(n=>{throw hn.create("idb-open",{originalErrorMessage:n.message})})),yo}async function bm(n){try{const t=(await kl()).transaction(Xr),r=await t.objectStore(Xr).get(Dl(n));return await t.done,r}catch(e){if(e instanceof Kt)$t.warn(e.message);else{const t=hn.create("idb-get",{originalErrorMessage:e?.message});$t.warn(t.message)}}}async function Hc(n,e){try{const r=(await kl()).transaction(Xr,"readwrite");await r.objectStore(Xr).put(e,Dl(n)),await r.done}catch(t){if(t instanceof Kt)$t.warn(t.message);else{const r=hn.create("idb-set",{originalErrorMessage:t?.message});$t.warn(r.message)}}}function Dl(n){return`${n.name}!${n.options.appId}`}const Sm=1024,Cm=30;class Pm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Dm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Wc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Cm){const s=Vm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){$t.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Wc(),{heartbeatsToSend:t,unsentEntries:r}=km(this._heartbeatsCache.heartbeats),s=Xs(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return $t.warn(e),""}}}function Wc(){return new Date().toISOString().substring(0,10)}function km(n,e=Sm){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Gc(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Gc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Dm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _p()?yp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await bm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Hc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Hc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Gc(n){return Xs(JSON.stringify({version:2,heartbeats:n})).length}function Vm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Nm(n){cr(new Ln("platform-logger",e=>new Hp(e),"PRIVATE")),cr(new Ln("heartbeat",e=>new Pm(e),"PRIVATE")),dn(Vo,$c,n),dn(Vo,$c,"esm2020"),dn("fire-js","")}Nm("");var Om="firebase",Mm="12.5.0";dn(Om,Mm,"app");function Vl(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Lm=Vl,Nl=new os("auth","Firebase",Vl());const Zs=new na("@firebase/auth");function xm(n,...e){Zs.logLevel<=Z.WARN&&Zs.warn(`Auth (${gr}): ${n}`,...e)}function Bs(n,...e){Zs.logLevel<=Z.ERROR&&Zs.error(`Auth (${gr}): ${n}`,...e)}function Et(n,...e){throw ia(n,...e)}function St(n,...e){return ia(n,...e)}function Ol(n,e,t){const r={...Lm(),[e]:t};return new os("auth","Firebase",r).create(e,{appName:n.name})}function jt(n){return Ol(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ia(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Nl.create(n,...e)}function q(n,e,...t){if(!n)throw ia(e,...t)}function Ft(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Bs(e),new Error(e)}function zt(n,e){n||Ft(e)}function Mo(){return typeof self<"u"&&self.location?.href||""}function Fm(){return Kc()==="http:"||Kc()==="https:"}function Kc(){return typeof self<"u"&&self.location?.protocol||null}function Um(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Fm()||fp()||"connection"in navigator)?navigator.onLine:!0}function Bm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class cs{constructor(e,t){this.shortDelay=e,this.longDelay=t,zt(t>e,"Short delay should be less than long delay!"),this.isMobile=lp()||pp()}get(){return Um()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function oa(n,e){zt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Ml{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const jm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const qm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],$m=new cs(3e4,6e4);function Tn(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function In(n,e,t,r,s={}){return Ll(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const u=as({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return dp()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&mr(n.emulatorConfig.host)&&(d.credentials="include"),Ml.fetch()(await xl(n,n.config.apiHost,t,u),d)})}async function Ll(n,e,t){n._canInitEmulator=!1;const r={...jm,...e};try{const s=new Hm(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw Ns(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ns(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Ns(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Ns(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Ol(n,p,d);Et(n,p)}}catch(s){if(s instanceof Kt)throw s;Et(n,"network-request-failed",{message:String(s)})}}async function us(n,e,t,r,s={}){const o=await In(n,e,t,r,s);return"mfaPendingCredential"in o&&Et(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function xl(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?oa(n.config,s):`${n.config.apiScheme}://${s}`;return qm.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function zm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Hm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(St(this.auth,"network-request-failed")),$m.get())})}}function Ns(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=St(n,e,r);return s.customData._tokenResponse=t,s}function Qc(n){return n!==void 0&&n.enterprise!==void 0}class Wm{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return zm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Gm(n,e){return In(n,"GET","/v2/recaptchaConfig",Tn(n,e))}async function Km(n,e){return In(n,"POST","/v1/accounts:delete",e)}async function ei(n,e){return In(n,"POST","/v1/accounts:lookup",e)}function Hr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Qm(n,e=!1){const t=ze(n),r=await t.getIdToken(e),s=aa(r);q(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:Hr(vo(s.auth_time)),issuedAtTime:Hr(vo(s.iat)),expirationTime:Hr(vo(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function vo(n){return Number(n)*1e3}function aa(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Bs("JWT malformed, contained fewer than 3 sections"),null;try{const s=El(t);return s?JSON.parse(s):(Bs("Failed to decode base64 JWT payload"),null)}catch(s){return Bs("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Yc(n){const e=aa(n);return q(e,"internal-error"),q(typeof e.exp<"u","internal-error"),q(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Jr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Kt&&Ym(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Ym({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Xm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Lo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hr(this.lastLoginAt),this.creationTime=Hr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ti(n){const e=n.auth,t=await n.getIdToken(),r=await Jr(n,ei(e,{idToken:t}));q(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Fl(s.providerUserInfo):[],a=Zm(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=u?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Lo(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function Jm(n){const e=ze(n);await ti(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Zm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Fl(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function eg(n,e){const t=await Ll(n,{},async()=>{const r=as({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await xl(n,s,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return n.emulatorConfig&&mr(n.emulatorConfig.host)&&(h.credentials="include"),Ml.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function tg(n,e){return In(n,"POST","/v2/accounts:revokeToken",Tn(n,e))}class rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){q(e.idToken,"internal-error"),q(typeof e.idToken<"u","internal-error"),q(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Yc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){q(e.length!==0,"internal-error");const t=Yc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(q(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await eg(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new rr;return r&&(q(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(q(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(q(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rr,this.toJSON())}_performRefresh(){return Ft("not implemented")}}function rn(n,e){q(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class vt{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Xm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Lo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Jr(this,this.stsTokenManager.getToken(this.auth,e));return q(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Qm(this,e)}reload(){return Jm(this)}_assign(e){this!==e&&(q(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new vt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){q(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ti(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(mt(this.auth.app))return Promise.reject(jt(this.auth));const e=await this.getIdToken();return await Jr(this,Km(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:y,emailVerified:T,isAnonymous:R,providerData:C,stsTokenManager:V}=t;q(y&&V,e,"internal-error");const k=rr.fromJSON(this.name,V);q(typeof y=="string",e,"internal-error"),rn(r,e.name),rn(s,e.name),q(typeof T=="boolean",e,"internal-error"),q(typeof R=="boolean",e,"internal-error"),rn(o,e.name),rn(a,e.name),rn(u,e.name),rn(h,e.name),rn(d,e.name),rn(p,e.name);const U=new vt({uid:y,auth:e,email:s,emailVerified:T,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:k,createdAt:d,lastLoginAt:p});return C&&Array.isArray(C)&&(U.providerData=C.map(F=>({...F}))),h&&(U._redirectEventId=h),U}static async _fromIdTokenResponse(e,t,r=!1){const s=new rr;s.updateFromServerResponse(t);const o=new vt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ti(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];q(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Fl(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,u=new rr;u.updateFromIdToken(r);const h=new vt({uid:s.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Lo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Xc=new Map;function Ut(n){zt(n instanceof Function,"Expected a class definition");let e=Xc.get(n);return e?(zt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Xc.set(n,e),e)}class Ul{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ul.type="NONE";const Jc=Ul;function js(n,e,t){return`firebase:${n}:${e}:${t}`}class sr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=js(this.userKey,s.apiKey,o),this.fullPersistenceKey=js("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ei(this.auth,{idToken:e}).catch(()=>{});return t?vt._fromGetAccountInfoResponse(this.auth,t,e):null}return vt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new sr(Ut(Jc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||Ut(Jc);const a=js(r,e.config.apiKey,e.name);let u=null;for(const d of t)try{const p=await d._get(a);if(p){let y;if(typeof p=="string"){const T=await ei(e,{idToken:p}).catch(()=>{});if(!T)break;y=await vt._fromGetAccountInfoResponse(e,T,p)}else y=vt._fromJSON(e,p);d!==o&&(u=y),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new sr(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new sr(o,e,r))}}function Zc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($l(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Bl(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Hl(e))return"Blackberry";if(Wl(e))return"Webos";if(jl(e))return"Safari";if((e.includes("chrome/")||ql(e))&&!e.includes("edge/"))return"Chrome";if(zl(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Bl(n=tt()){return/firefox\//i.test(n)}function jl(n=tt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ql(n=tt()){return/crios\//i.test(n)}function $l(n=tt()){return/iemobile/i.test(n)}function zl(n=tt()){return/android/i.test(n)}function Hl(n=tt()){return/blackberry/i.test(n)}function Wl(n=tt()){return/webos/i.test(n)}function ca(n=tt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function ng(n=tt()){return ca(n)&&!!window.navigator?.standalone}function rg(){return mp()&&document.documentMode===10}function Gl(n=tt()){return ca(n)||zl(n)||Wl(n)||Hl(n)||/windows phone/i.test(n)||$l(n)}function Kl(n,e=[]){let t;switch(n){case"Browser":t=Zc(tt());break;case"Worker":t=`${Zc(tt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gr}/${r}`}class sg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,u)=>{try{const h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function ig(n,e={}){return In(n,"GET","/v2/passwordPolicy",Tn(n,e))}const og=6;class ag{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??og,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class cg{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eu(this),this.idTokenSubscription=new eu(this),this.beforeStateQueue=new sg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nl,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ut(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await sr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ei(this,{idToken:e}),r=await vt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(mt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return q(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ti(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Bm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(mt(this.app))return Promise.reject(jt(this));const t=e?ze(e):null;return t&&q(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&q(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return mt(this.app)?Promise.reject(jt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return mt(this.app)?Promise.reject(jt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ut(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ig(this),t=new ag(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new os("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await tg(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ut(e)||this._popupRedirectResolver;q(t,this,"argument-error"),this.redirectPersistenceManager=await sr.create(this,[Ut(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(q(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return q(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Kl(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(mt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&xm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function jn(n){return ze(n)}class eu{constructor(e){this.auth=e,this.observer=null,this.addObserver=wp(t=>this.observer=t)}get next(){return q(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let wi={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ug(n){wi=n}function Ql(n){return wi.loadJS(n)}function lg(){return wi.recaptchaEnterpriseScript}function hg(){return wi.gapiScript}function dg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class fg{constructor(){this.enterprise=new pg}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class pg{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const mg="recaptcha-enterprise",Yl="NO_RECAPTCHA";class gg{constructor(e){this.type=mg,this.auth=jn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,u)=>{Gm(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const d=new Wm(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{u(h)})})}function s(o,a,u){const h=window.grecaptcha;Qc(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(Yl)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new fg().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(u=>{if(!t&&Qc(window.grecaptcha))s(u,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=lg();h.length!==0&&(h+=u),Ql(h).then(()=>{s(u,o,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})}}async function tu(n,e,t,r=!1,s=!1){const o=new gg(n);let a;if(s)a=Yl;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function xo(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await tu(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await tu(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}function _g(n,e){const t=sa(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(Mn(o,e??{}))return s;Et(s,"already-initialized")}return t.initialize({options:e})}function yg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Ut);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function vg(n,e,t){const r=jn(n);q(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=Xl(e),{host:a,port:u}=Eg(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){q(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),q(Mn(d,r.config.emulator)&&Mn(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,mr(a)?(Al(`${o}//${a}${h}`),Rl("Auth",!0)):Tg()}function Xl(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Eg(n){const e=Xl(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:nu(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:nu(a)}}}function nu(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Tg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class ua{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ft("not implemented")}_getIdTokenResponse(e){return Ft("not implemented")}_linkToIdToken(e,t){return Ft("not implemented")}_getReauthenticationResolver(e){return Ft("not implemented")}}async function Ig(n,e){return In(n,"POST","/v1/accounts:signUp",e)}async function wg(n,e){return us(n,"POST","/v1/accounts:signInWithPassword",Tn(n,e))}async function Ag(n,e){return us(n,"POST","/v1/accounts:signInWithEmailLink",Tn(n,e))}async function Rg(n,e){return us(n,"POST","/v1/accounts:signInWithEmailLink",Tn(n,e))}class Zr extends ua{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Zr(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Zr(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xo(e,t,"signInWithPassword",wg);case"emailLink":return Ag(e,{email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xo(e,r,"signUpPassword",Ig);case"emailLink":return Rg(e,{idToken:t,email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ir(n,e){return us(n,"POST","/v1/accounts:signInWithIdp",Tn(n,e))}const bg="http://localhost";class xn extends ua{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Et("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new xn(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ir(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ir(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ir(e,t)}buildRequest(){const e={requestUri:bg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=as(t)}return e}}function Sg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Cg(n){const e=xr(Fr(n)).link,t=e?xr(Fr(e)).deep_link_id:null,r=xr(Fr(n)).deep_link_id;return(r?xr(Fr(r)).link:null)||r||t||e||n}class la{constructor(e){const t=xr(Fr(e)),r=t.apiKey??null,s=t.oobCode??null,o=Sg(t.mode??null);q(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Cg(e);try{return new la(t)}catch{return null}}}class qn{constructor(){this.providerId=qn.PROVIDER_ID}static credential(e,t){return Zr._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=la.parseLink(t);return q(r,"argument-error"),Zr._fromEmailAndCode(e,r.code,r.tenantId)}}qn.PROVIDER_ID="password";qn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";qn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Jl{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ls extends Jl{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class sn extends ls{constructor(){super("facebook.com")}static credential(e){return xn._fromParams({providerId:sn.PROVIDER_ID,signInMethod:sn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sn.credentialFromTaggedObject(e)}static credentialFromError(e){return sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sn.credential(e.oauthAccessToken)}catch{return null}}}sn.FACEBOOK_SIGN_IN_METHOD="facebook.com";sn.PROVIDER_ID="facebook.com";class on extends ls{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return xn._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return on.credential(t,r)}catch{return null}}}on.GOOGLE_SIGN_IN_METHOD="google.com";on.PROVIDER_ID="google.com";class an extends ls{constructor(){super("github.com")}static credential(e){return xn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.GITHUB_SIGN_IN_METHOD="github.com";an.PROVIDER_ID="github.com";class cn extends ls{constructor(){super("twitter.com")}static credential(e,t){return xn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return cn.credential(t,r)}catch{return null}}}cn.TWITTER_SIGN_IN_METHOD="twitter.com";cn.PROVIDER_ID="twitter.com";async function Pg(n,e){return us(n,"POST","/v1/accounts:signUp",Tn(n,e))}class Fn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await vt._fromIdTokenResponse(e,r,s),a=ru(r);return new Fn({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=ru(r);return new Fn({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function ru(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class ni extends Kt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ni.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ni(e,t,r,s)}}function Zl(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?ni._fromErrorAndOperation(n,o,e,r):o})}async function kg(n,e,t=!1){const r=await Jr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Fn._forOperation(n,"link",r)}async function eh(n,e,t=!1){const{auth:r}=n;if(mt(r.app))return Promise.reject(jt(r));const s="reauthenticate";try{const o=await Jr(n,Zl(r,s,e,n),t);q(o.idToken,r,"internal-error");const a=aa(o.idToken);q(a,r,"internal-error");const{sub:u}=a;return q(n.uid===u,r,"user-mismatch"),Fn._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&Et(r,"user-mismatch"),o}}async function th(n,e,t=!1){if(mt(n.app))return Promise.reject(jt(n));const r="signIn",s=await Zl(n,r,e),o=await Fn._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}async function Dg(n,e){return th(jn(n),e)}async function Vg(n,e){return eh(ze(n),e)}async function nh(n){const e=jn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Ng(n,e,t){if(mt(n.app))return Promise.reject(jt(n));const r=jn(n),a=await xo(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Pg).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&nh(n),h}),u=await Fn._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function Og(n,e,t){return mt(n.app)?Promise.reject(jt(n)):Dg(ze(n),qn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&nh(n),r})}function Mg(n,e,t,r){return ze(n).onIdTokenChanged(e,t,r)}function Lg(n,e,t){return ze(n).beforeAuthStateChanged(e,t)}function xg(n,e,t,r){return ze(n).onAuthStateChanged(e,t,r)}function Fg(n){return ze(n).signOut()}const ri="__sak";class rh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ri,"1"),this.storage.removeItem(ri),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ug=1e3,Bg=10;class sh extends rh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Gl(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,u,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);rg()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Bg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Ug)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}sh.type="LOCAL";const jg=sh;class ih extends rh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ih.type="SESSION";const oh=ih;function qg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Ai{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Ai(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const u=Array.from(a).map(async d=>d(t.origin,o)),h=await qg(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ai.receivers=[];function ha(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class $g{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{const d=ha("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(y){const T=y;if(T.data.eventId===d)switch(T.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(T.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Ct(){return window}function zg(n){Ct().location.href=n}function ah(){return typeof Ct().WorkerGlobalScope<"u"&&typeof Ct().importScripts=="function"}async function Hg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Wg(){return navigator?.serviceWorker?.controller||null}function Gg(){return ah()?self:null}const ch="firebaseLocalStorageDb",Kg=1,si="firebaseLocalStorage",uh="fbase_key";class hs{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ri(n,e){return n.transaction([si],e?"readwrite":"readonly").objectStore(si)}function Qg(){const n=indexedDB.deleteDatabase(ch);return new hs(n).toPromise()}function Fo(){const n=indexedDB.open(ch,Kg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(si,{keyPath:uh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(si)?e(r):(r.close(),await Qg(),e(await Fo()))})})}async function su(n,e,t){const r=Ri(n,!0).put({[uh]:e,value:t});return new hs(r).toPromise()}async function Yg(n,e){const t=Ri(n,!1).get(e),r=await new hs(t).toPromise();return r===void 0?null:r.value}function iu(n,e){const t=Ri(n,!0).delete(e);return new hs(t).toPromise()}const Xg=800,Jg=3;class lh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Fo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Jg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ah()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ai._getInstance(Gg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Hg(),!this.activeServiceWorker)return;this.sender=new $g(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Wg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Fo();return await su(e,ri,"1"),await iu(e,ri),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>su(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Yg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iu(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=Ri(s,!1).getAll();return new hs(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Xg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lh.type="LOCAL";const Zg=lh;new cs(3e4,6e4);function e_(n,e){return e?Ut(e):(q(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class da extends ua{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ir(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ir(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ir(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function t_(n){return th(n.auth,new da(n),n.bypassAuthState)}function n_(n){const{auth:e,user:t}=n;return q(t,e,"internal-error"),eh(t,new da(n),n.bypassAuthState)}async function r_(n){const{auth:e,user:t}=n;return q(t,e,"internal-error"),kg(t,new da(n),n.bypassAuthState)}class hh{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return t_;case"linkViaPopup":case"linkViaRedirect":return r_;case"reauthViaPopup":case"reauthViaRedirect":return n_;default:Et(this.auth,"internal-error")}}resolve(e){zt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){zt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const s_=new cs(2e3,1e4);class tr extends hh{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,tr.currentPopupAction&&tr.currentPopupAction.cancel(),tr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return q(e,this.auth,"internal-error"),e}async onExecution(){zt(this.filter.length===1,"Popup operations only handle one event");const e=ha();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(St(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(St(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tr.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(St(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,s_.get())};e()}}tr.currentPopupAction=null;const i_="pendingRedirect",qs=new Map;class o_ extends hh{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=qs.get(this.auth._key());if(!e){try{const r=await a_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qs.set(this.auth._key(),e)}return this.bypassAuthState||qs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function a_(n,e){const t=l_(e),r=u_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function c_(n,e){qs.set(n._key(),e)}function u_(n){return Ut(n._redirectPersistence)}function l_(n){return js(i_,n.config.apiKey,n.name)}async function h_(n,e,t=!1){if(mt(n.app))return Promise.reject(jt(n));const r=jn(n),s=e_(r,e),a=await new o_(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const d_=600*1e3;class f_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!p_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!dh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(St(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=d_&&this.cachedEventUids.clear(),this.cachedEventUids.has(ou(e))}saveEventToCache(e){this.cachedEventUids.add(ou(e)),this.lastProcessedEventTime=Date.now()}}function ou(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function dh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function p_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dh(n);default:return!1}}async function m_(n,e={}){return In(n,"GET","/v1/projects",e)}const g_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,__=/^https?/;async function y_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await m_(n);for(const t of e)try{if(v_(t))return}catch{}Et(n,"unauthorized-domain")}function v_(n){const e=Mo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!__.test(t))return!1;if(g_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const E_=new cs(3e4,6e4);function au(){const n=Ct().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function T_(n){return new Promise((e,t)=>{function r(){au(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{au(),t(St(n,"network-request-failed"))},timeout:E_.get()})}if(Ct().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Ct().gapi?.load)r();else{const s=dg("iframefcb");return Ct()[s]=()=>{gapi.load?r():t(St(n,"network-request-failed"))},Ql(`${hg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw $s=null,e})}let $s=null;function I_(n){return $s=$s||T_(n),$s}const w_=new cs(5e3,15e3),A_="__/auth/iframe",R_="emulator/auth/iframe",b_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},S_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function C_(n){const e=n.config;q(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?oa(e,R_):`https://${n.config.authDomain}/${A_}`,r={apiKey:e.apiKey,appName:n.name,v:gr},s=S_.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${as(r).slice(1)}`}async function P_(n){const e=await I_(n),t=Ct().gapi;return q(t,n,"internal-error"),e.open({where:document.body,url:C_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:b_,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=St(n,"network-request-failed"),u=Ct().setTimeout(()=>{o(a)},w_.get());function h(){Ct().clearTimeout(u),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const k_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},D_=500,V_=600,N_="_blank",O_="http://localhost";class cu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function M_(n,e,t,r=D_,s=V_){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...k_,width:r.toString(),height:s.toString(),top:o,left:a},d=tt().toLowerCase();t&&(u=ql(d)?N_:t),Bl(d)&&(e=e||O_,h.scrollbars="yes");const p=Object.entries(h).reduce((T,[R,C])=>`${T}${R}=${C},`,"");if(ng(d)&&u!=="_self")return L_(e||"",u),new cu(null);const y=window.open(e||"",u,p);q(y,n,"popup-blocked");try{y.focus()}catch{}return new cu(y)}function L_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const x_="__/auth/handler",F_="emulator/auth/handler",U_=encodeURIComponent("fac");async function uu(n,e,t,r,s,o){q(n.config.authDomain,n,"auth-domain-config-required"),q(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:gr,eventId:s};if(e instanceof Jl){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Ip(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,y]of Object.entries({}))a[p]=y}if(e instanceof ls){const p=e.getScopes().filter(y=>y!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const u=a;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await n._getAppCheckToken(),d=h?`#${U_}=${encodeURIComponent(h)}`:"";return`${B_(n)}?${as(u).slice(1)}${d}`}function B_({config:n}){return n.emulator?oa(n,F_):`https://${n.authDomain}/${x_}`}const Eo="webStorageSupport";class j_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=oh,this._completeRedirectFn=h_,this._overrideRedirectResult=c_}async _openPopup(e,t,r,s){zt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await uu(e,t,r,Mo(),s);return M_(e,o,ha())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await uu(e,t,r,Mo(),s);return zg(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(zt(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await P_(e),r=new f_(e);return t.register("authEvent",s=>(q(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Eo,{type:Eo},s=>{const o=s?.[0]?.[Eo];o!==void 0&&t(!!o),Et(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=y_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Gl()||jl()||ca()}}const q_=j_;var lu="@firebase/auth",hu="1.11.1";class $_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){q(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function z_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function H_(n){cr(new Ln("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;q(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Kl(n)},d=new cg(r,s,o,h);return yg(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),cr(new Ln("auth-internal",e=>{const t=jn(e.getProvider("auth").getImmediate());return(r=>new $_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),dn(lu,hu,z_(n)),dn(lu,hu,"esm2020")}const W_=300,G_=wl("authIdTokenMaxAge")||W_;let du=null;const K_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>G_)return;const s=t?.token;du!==s&&(du=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Q_(n=Pl()){const e=sa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=_g(n,{popupRedirectResolver:q_,persistence:[Zg,jg,oh]}),r=wl("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=K_(o.toString());Lg(t,a,()=>a(t.currentUser)),Mg(t,u=>a(u))}}const s=Tl("auth");return s&&vg(t,`http://${s}`),t}function Y_(){return document.getElementsByTagName("head")?.[0]??document}ug({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=St("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",Y_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});H_("Browser");var fu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var fn,fh;(function(){var n;function e(I,_){function g(){}g.prototype=_.prototype,I.F=_.prototype,I.prototype=new g,I.prototype.constructor=I,I.D=function(w,v,E){for(var m=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)m[Y-2]=arguments[Y];return _.prototype[v].apply(w,m)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,_,g){g||(g=0);const w=Array(16);if(typeof _=="string")for(var v=0;v<16;++v)w[v]=_.charCodeAt(g++)|_.charCodeAt(g++)<<8|_.charCodeAt(g++)<<16|_.charCodeAt(g++)<<24;else for(v=0;v<16;++v)w[v]=_[g++]|_[g++]<<8|_[g++]<<16|_[g++]<<24;_=I.g[0],g=I.g[1],v=I.g[2];let E=I.g[3],m;m=_+(E^g&(v^E))+w[0]+3614090360&4294967295,_=g+(m<<7&4294967295|m>>>25),m=E+(v^_&(g^v))+w[1]+3905402710&4294967295,E=_+(m<<12&4294967295|m>>>20),m=v+(g^E&(_^g))+w[2]+606105819&4294967295,v=E+(m<<17&4294967295|m>>>15),m=g+(_^v&(E^_))+w[3]+3250441966&4294967295,g=v+(m<<22&4294967295|m>>>10),m=_+(E^g&(v^E))+w[4]+4118548399&4294967295,_=g+(m<<7&4294967295|m>>>25),m=E+(v^_&(g^v))+w[5]+1200080426&4294967295,E=_+(m<<12&4294967295|m>>>20),m=v+(g^E&(_^g))+w[6]+2821735955&4294967295,v=E+(m<<17&4294967295|m>>>15),m=g+(_^v&(E^_))+w[7]+4249261313&4294967295,g=v+(m<<22&4294967295|m>>>10),m=_+(E^g&(v^E))+w[8]+1770035416&4294967295,_=g+(m<<7&4294967295|m>>>25),m=E+(v^_&(g^v))+w[9]+2336552879&4294967295,E=_+(m<<12&4294967295|m>>>20),m=v+(g^E&(_^g))+w[10]+4294925233&4294967295,v=E+(m<<17&4294967295|m>>>15),m=g+(_^v&(E^_))+w[11]+2304563134&4294967295,g=v+(m<<22&4294967295|m>>>10),m=_+(E^g&(v^E))+w[12]+1804603682&4294967295,_=g+(m<<7&4294967295|m>>>25),m=E+(v^_&(g^v))+w[13]+4254626195&4294967295,E=_+(m<<12&4294967295|m>>>20),m=v+(g^E&(_^g))+w[14]+2792965006&4294967295,v=E+(m<<17&4294967295|m>>>15),m=g+(_^v&(E^_))+w[15]+1236535329&4294967295,g=v+(m<<22&4294967295|m>>>10),m=_+(v^E&(g^v))+w[1]+4129170786&4294967295,_=g+(m<<5&4294967295|m>>>27),m=E+(g^v&(_^g))+w[6]+3225465664&4294967295,E=_+(m<<9&4294967295|m>>>23),m=v+(_^g&(E^_))+w[11]+643717713&4294967295,v=E+(m<<14&4294967295|m>>>18),m=g+(E^_&(v^E))+w[0]+3921069994&4294967295,g=v+(m<<20&4294967295|m>>>12),m=_+(v^E&(g^v))+w[5]+3593408605&4294967295,_=g+(m<<5&4294967295|m>>>27),m=E+(g^v&(_^g))+w[10]+38016083&4294967295,E=_+(m<<9&4294967295|m>>>23),m=v+(_^g&(E^_))+w[15]+3634488961&4294967295,v=E+(m<<14&4294967295|m>>>18),m=g+(E^_&(v^E))+w[4]+3889429448&4294967295,g=v+(m<<20&4294967295|m>>>12),m=_+(v^E&(g^v))+w[9]+568446438&4294967295,_=g+(m<<5&4294967295|m>>>27),m=E+(g^v&(_^g))+w[14]+3275163606&4294967295,E=_+(m<<9&4294967295|m>>>23),m=v+(_^g&(E^_))+w[3]+4107603335&4294967295,v=E+(m<<14&4294967295|m>>>18),m=g+(E^_&(v^E))+w[8]+1163531501&4294967295,g=v+(m<<20&4294967295|m>>>12),m=_+(v^E&(g^v))+w[13]+2850285829&4294967295,_=g+(m<<5&4294967295|m>>>27),m=E+(g^v&(_^g))+w[2]+4243563512&4294967295,E=_+(m<<9&4294967295|m>>>23),m=v+(_^g&(E^_))+w[7]+1735328473&4294967295,v=E+(m<<14&4294967295|m>>>18),m=g+(E^_&(v^E))+w[12]+2368359562&4294967295,g=v+(m<<20&4294967295|m>>>12),m=_+(g^v^E)+w[5]+4294588738&4294967295,_=g+(m<<4&4294967295|m>>>28),m=E+(_^g^v)+w[8]+2272392833&4294967295,E=_+(m<<11&4294967295|m>>>21),m=v+(E^_^g)+w[11]+1839030562&4294967295,v=E+(m<<16&4294967295|m>>>16),m=g+(v^E^_)+w[14]+4259657740&4294967295,g=v+(m<<23&4294967295|m>>>9),m=_+(g^v^E)+w[1]+2763975236&4294967295,_=g+(m<<4&4294967295|m>>>28),m=E+(_^g^v)+w[4]+1272893353&4294967295,E=_+(m<<11&4294967295|m>>>21),m=v+(E^_^g)+w[7]+4139469664&4294967295,v=E+(m<<16&4294967295|m>>>16),m=g+(v^E^_)+w[10]+3200236656&4294967295,g=v+(m<<23&4294967295|m>>>9),m=_+(g^v^E)+w[13]+681279174&4294967295,_=g+(m<<4&4294967295|m>>>28),m=E+(_^g^v)+w[0]+3936430074&4294967295,E=_+(m<<11&4294967295|m>>>21),m=v+(E^_^g)+w[3]+3572445317&4294967295,v=E+(m<<16&4294967295|m>>>16),m=g+(v^E^_)+w[6]+76029189&4294967295,g=v+(m<<23&4294967295|m>>>9),m=_+(g^v^E)+w[9]+3654602809&4294967295,_=g+(m<<4&4294967295|m>>>28),m=E+(_^g^v)+w[12]+3873151461&4294967295,E=_+(m<<11&4294967295|m>>>21),m=v+(E^_^g)+w[15]+530742520&4294967295,v=E+(m<<16&4294967295|m>>>16),m=g+(v^E^_)+w[2]+3299628645&4294967295,g=v+(m<<23&4294967295|m>>>9),m=_+(v^(g|~E))+w[0]+4096336452&4294967295,_=g+(m<<6&4294967295|m>>>26),m=E+(g^(_|~v))+w[7]+1126891415&4294967295,E=_+(m<<10&4294967295|m>>>22),m=v+(_^(E|~g))+w[14]+2878612391&4294967295,v=E+(m<<15&4294967295|m>>>17),m=g+(E^(v|~_))+w[5]+4237533241&4294967295,g=v+(m<<21&4294967295|m>>>11),m=_+(v^(g|~E))+w[12]+1700485571&4294967295,_=g+(m<<6&4294967295|m>>>26),m=E+(g^(_|~v))+w[3]+2399980690&4294967295,E=_+(m<<10&4294967295|m>>>22),m=v+(_^(E|~g))+w[10]+4293915773&4294967295,v=E+(m<<15&4294967295|m>>>17),m=g+(E^(v|~_))+w[1]+2240044497&4294967295,g=v+(m<<21&4294967295|m>>>11),m=_+(v^(g|~E))+w[8]+1873313359&4294967295,_=g+(m<<6&4294967295|m>>>26),m=E+(g^(_|~v))+w[15]+4264355552&4294967295,E=_+(m<<10&4294967295|m>>>22),m=v+(_^(E|~g))+w[6]+2734768916&4294967295,v=E+(m<<15&4294967295|m>>>17),m=g+(E^(v|~_))+w[13]+1309151649&4294967295,g=v+(m<<21&4294967295|m>>>11),m=_+(v^(g|~E))+w[4]+4149444226&4294967295,_=g+(m<<6&4294967295|m>>>26),m=E+(g^(_|~v))+w[11]+3174756917&4294967295,E=_+(m<<10&4294967295|m>>>22),m=v+(_^(E|~g))+w[2]+718787259&4294967295,v=E+(m<<15&4294967295|m>>>17),m=g+(E^(v|~_))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(v+(m<<21&4294967295|m>>>11))&4294967295,I.g[2]=I.g[2]+v&4294967295,I.g[3]=I.g[3]+E&4294967295}r.prototype.v=function(I,_){_===void 0&&(_=I.length);const g=_-this.blockSize,w=this.C;let v=this.h,E=0;for(;E<_;){if(v==0)for(;E<=g;)s(this,I,E),E+=this.blockSize;if(typeof I=="string"){for(;E<_;)if(w[v++]=I.charCodeAt(E++),v==this.blockSize){s(this,w),v=0;break}}else for(;E<_;)if(w[v++]=I[E++],v==this.blockSize){s(this,w),v=0;break}}this.h=v,this.o+=_},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;_=this.o*8;for(var g=I.length-8;g<I.length;++g)I[g]=_&255,_/=256;for(this.v(I),I=Array(16),_=0,g=0;g<4;++g)for(let w=0;w<32;w+=8)I[_++]=this.g[g]>>>w&255;return I};function o(I,_){var g=u;return Object.prototype.hasOwnProperty.call(g,I)?g[I]:g[I]=_(I)}function a(I,_){this.h=_;const g=[];let w=!0;for(let v=I.length-1;v>=0;v--){const E=I[v]|0;w&&E==_||(g[v]=E,w=!1)}this.g=g}var u={};function h(I){return-128<=I&&I<128?o(I,function(_){return new a([_|0],_<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return y;if(I<0)return k(d(-I));const _=[];let g=1;for(let w=0;I>=g;w++)_[w]=I/g|0,g*=4294967296;return new a(_,0)}function p(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return k(p(I.substring(1),_));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const g=d(Math.pow(_,8));let w=y;for(let E=0;E<I.length;E+=8){var v=Math.min(8,I.length-E);const m=parseInt(I.substring(E,E+v),_);v<8?(v=d(Math.pow(_,v)),w=w.j(v).add(d(m))):(w=w.j(g),w=w.add(d(m)))}return w}var y=h(0),T=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(V(this))return-k(this).m();let I=0,_=1;for(let g=0;g<this.g.length;g++){const w=this.i(g);I+=(w>=0?w:4294967296+w)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(C(this))return"0";if(V(this))return"-"+k(this).toString(I);const _=d(Math.pow(I,6));var g=this;let w="";for(;;){const v=H(g,_).g;g=U(g,v.j(_));let E=((g.g.length>0?g.g[0]:g.h)>>>0).toString(I);if(g=v,C(g))return E+w;for(;E.length<6;)E="0"+E;w=E+w}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function C(I){if(I.h!=0)return!1;for(let _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function V(I){return I.h==-1}n.l=function(I){return I=U(this,I),V(I)?-1:C(I)?0:1};function k(I){const _=I.g.length,g=[];for(let w=0;w<_;w++)g[w]=~I.g[w];return new a(g,~I.h).add(T)}n.abs=function(){return V(this)?k(this):this},n.add=function(I){const _=Math.max(this.g.length,I.g.length),g=[];let w=0;for(let v=0;v<=_;v++){let E=w+(this.i(v)&65535)+(I.i(v)&65535),m=(E>>>16)+(this.i(v)>>>16)+(I.i(v)>>>16);w=m>>>16,E&=65535,m&=65535,g[v]=m<<16|E}return new a(g,g[g.length-1]&-2147483648?-1:0)};function U(I,_){return I.add(k(_))}n.j=function(I){if(C(this)||C(I))return y;if(V(this))return V(I)?k(this).j(k(I)):k(k(this).j(I));if(V(I))return k(this.j(k(I)));if(this.l(R)<0&&I.l(R)<0)return d(this.m()*I.m());const _=this.g.length+I.g.length,g=[];for(var w=0;w<2*_;w++)g[w]=0;for(w=0;w<this.g.length;w++)for(let v=0;v<I.g.length;v++){const E=this.i(w)>>>16,m=this.i(w)&65535,Y=I.i(v)>>>16,re=I.i(v)&65535;g[2*w+2*v]+=m*re,F(g,2*w+2*v),g[2*w+2*v+1]+=E*re,F(g,2*w+2*v+1),g[2*w+2*v+1]+=m*Y,F(g,2*w+2*v+1),g[2*w+2*v+2]+=E*Y,F(g,2*w+2*v+2)}for(I=0;I<_;I++)g[I]=g[2*I+1]<<16|g[2*I];for(I=_;I<2*_;I++)g[I]=0;return new a(g,0)};function F(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function M(I,_){this.g=I,this.h=_}function H(I,_){if(C(_))throw Error("division by zero");if(C(I))return new M(y,y);if(V(I))return _=H(k(I),_),new M(k(_.g),k(_.h));if(V(_))return _=H(I,k(_)),new M(k(_.g),_.h);if(I.g.length>30){if(V(I)||V(_))throw Error("slowDivide_ only works with positive integers.");for(var g=T,w=_;w.l(I)<=0;)g=G(g),w=G(w);var v=J(g,1),E=J(w,1);for(w=J(w,2),g=J(g,2);!C(w);){var m=E.add(w);m.l(I)<=0&&(v=v.add(g),E=m),w=J(w,1),g=J(g,1)}return _=U(I,v.j(_)),new M(v,_)}for(v=y;I.l(_)>=0;){for(g=Math.max(1,Math.floor(I.m()/_.m())),w=Math.ceil(Math.log(g)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),E=d(g),m=E.j(_);V(m)||m.l(I)>0;)g-=w,E=d(g),m=E.j(_);C(E)&&(E=T),v=v.add(E),I=U(I,m)}return new M(v,I)}n.B=function(I){return H(this,I).h},n.and=function(I){const _=Math.max(this.g.length,I.g.length),g=[];for(let w=0;w<_;w++)g[w]=this.i(w)&I.i(w);return new a(g,this.h&I.h)},n.or=function(I){const _=Math.max(this.g.length,I.g.length),g=[];for(let w=0;w<_;w++)g[w]=this.i(w)|I.i(w);return new a(g,this.h|I.h)},n.xor=function(I){const _=Math.max(this.g.length,I.g.length),g=[];for(let w=0;w<_;w++)g[w]=this.i(w)^I.i(w);return new a(g,this.h^I.h)};function G(I){const _=I.g.length+1,g=[];for(let w=0;w<_;w++)g[w]=I.i(w)<<1|I.i(w-1)>>>31;return new a(g,I.h)}function J(I,_){const g=_>>5;_%=32;const w=I.g.length-g,v=[];for(let E=0;E<w;E++)v[E]=_>0?I.i(E+g)>>>_|I.i(E+g+1)<<32-_:I.i(E+g);return new a(v,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,fh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,fn=a}).apply(typeof fu<"u"?fu:typeof self<"u"?self:typeof window<"u"?window:{});var Os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ph,Ur,mh,zs,Uo,gh,_h,yh;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Os=="object"&&Os];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var b=i[f];if(!(b in l))break e;l=l[b]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&e(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function p(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function y(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,b,S){for(var O=Array(arguments.length-2),X=2;X<arguments.length;X++)O[X-2]=arguments[X];return c.prototype[b].apply(f,O)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function R(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function C(i,c){for(let f=1;f<arguments.length;f++){const b=arguments[f];var l=typeof b;if(l=l!="object"?l:b?Array.isArray(b)?"array":l:"null",l=="array"||l=="object"&&typeof b.length=="number"){l=i.length||0;const S=b.length||0;i.length=l+S;for(let O=0;O<S;O++)i[l+O]=b[O]}else i.push(b)}}class V{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function k(i){a.setTimeout(()=>{throw i},0)}function U(){var i=I;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class F{constructor(){this.h=this.g=null}add(c,l){const f=M.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var M=new V(()=>new H,i=>i.reset());class H{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let G,J=!1,I=new F,_=()=>{const i=Promise.resolve(void 0);G=()=>{i.then(g)}};function g(){for(var i;i=U();){try{i.h.call(i.g)}catch(l){k(l)}var c=M;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}J=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function v(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}v.prototype.h=function(){this.defaultPrevented=!0};var E=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function m(i){return/^[\s\xa0]*$/.test(i)}function Y(i,c){v.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}y(Y,v),Y.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Y.Z.h.call(this)},Y.prototype.h=function(){Y.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var re="closure_listenable_"+(Math.random()*1e6|0),Ye=0;function ct(i,c,l,f,b){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=b,this.key=++Ye,this.da=this.fa=!1}function ce(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function he(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function ke(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function it(i){const c={};for(const l in i)c[l]=i[l];return c}const ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ae(i,c){let l,f;for(let b=1;b<arguments.length;b++){f=arguments[b];for(l in f)i[l]=f[l];for(let S=0;S<ge.length;S++)l=ge[S],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function ne(i){this.src=i,this.g={},this.h=0}ne.prototype.add=function(i,c,l,f,b){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const O=de(i,c,f,b);return O>-1?(c=i[O],l||(c.fa=!1)):(c=new ct(c,this.src,S,!!f,b),c.fa=l,i.push(c)),c};function le(i,c){const l=c.type;if(l in i.g){var f=i.g[l],b=Array.prototype.indexOf.call(f,c,void 0),S;(S=b>=0)&&Array.prototype.splice.call(f,b,1),S&&(ce(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function de(i,c,l,f){for(let b=0;b<i.length;++b){const S=i[b];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return b}return-1}var xe="closure_lm_"+(Math.random()*1e6|0),Te={};function Xe(i,c,l,f,b){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Xe(i,c[S],l,f,b);return null}return l=Es(l),i&&i[re]?i.J(c,l,u(f)?!!f.capture:!1,b):dt(i,c,l,!1,f,b)}function dt(i,c,l,f,b,S){if(!c)throw Error("Invalid event type");const O=u(b)?!!b.capture:!!b;let X=Tr(i);if(X||(i[xe]=X=new ne(i)),l=X.add(c,l,f,O,S),l.proxy)return l;if(f=Hn(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)E||(b=O),b===void 0&&(b=!1),i.addEventListener(c.toString(),f,b);else if(i.attachEvent)i.attachEvent(ys(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Hn(){function i(l){return c.call(i.src,i.listener,l)}const c=vs;return i}function Tt(i,c,l,f,b){if(Array.isArray(c))for(var S=0;S<c.length;S++)Tt(i,c[S],l,f,b);else f=u(f)?!!f.capture:!!f,l=Es(l),i&&i[re]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],l=de(c,l,f,b),l>-1&&(ce(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Tr(i))&&(c=i.g[c.toString()],i=-1,c&&(i=de(c,l,f,b)),(l=i>-1?c[i]:null)&&Qt(l))}function Qt(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[re])le(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(ys(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=Tr(c))?(le(l,i),l.h==0&&(l.src=null,c[xe]=null)):ce(i)}}}function ys(i){return i in Te?Te[i]:Te[i]="on"+i}function vs(i,c){if(i.da)i=!0;else{c=new Y(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&Qt(i),i=l.call(f,c)}return i}function Tr(i){return i=i[xe],i instanceof ne?i:null}var Wn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Es(i){return typeof i=="function"?i:(i[Wn]||(i[Wn]=function(c){return i.handleEvent(c)}),i[Wn])}function De(){w.call(this),this.i=new ne(this),this.M=this,this.G=null}y(De,w),De.prototype[re]=!0,De.prototype.removeEventListener=function(i,c,l,f){Tt(this,i,c,l,f)};function Fe(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new v(c,i);else if(c instanceof v)c.target=c.target||i;else{var b=c;c=new v(f,i),Ae(c,b)}b=!0;let S,O;if(l)for(O=l.length-1;O>=0;O--)S=c.g=l[O],b=Re(S,f,!0,c)&&b;if(S=c.g=i,b=Re(S,f,!0,c)&&b,b=Re(S,f,!1,c)&&b,l)for(O=0;O<l.length;O++)S=c.g=l[O],b=Re(S,f,!1,c)&&b}De.prototype.N=function(){if(De.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)ce(l[f]);delete i.g[c],i.h--}}this.G=null},De.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},De.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function Re(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let b=!0;for(let S=0;S<c.length;++S){const O=c[S];if(O&&!O.da&&O.capture==l){const X=O.listener,Ne=O.ha||O.src;O.fa&&le(i.i,O),b=X.call(Ne,f)!==!1&&b}}return b&&!f.defaultPrevented}function He(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Ve(i){i.g=He(()=>{i.g=null,i.i&&(i.i=!1,Ve(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class nt extends w{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ve(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ue(i){w.call(this),this.h=i,this.g={}}y(Ue,w);var ut=[];function _t(i){he(i.g,function(c,l){this.g.hasOwnProperty(l)&&Qt(c)},i),i.g={}}Ue.prototype.N=function(){Ue.Z.N.call(this),_t(this)},Ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var yt=a.JSON.stringify,We=a.JSON.parse,rt=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Be(){}function Yt(){}var Rn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function $i(){v.call(this,"d")}y($i,v);function zi(){v.call(this,"c")}y(zi,v);var bn={},za=null;function Ts(){return za=za||new De}bn.Ia="serverreachability";function Ha(i){v.call(this,bn.Ia,i)}y(Ha,v);function Ir(i){const c=Ts();Fe(c,new Ha(c))}bn.STAT_EVENT="statevent";function Wa(i,c){v.call(this,bn.STAT_EVENT,i),this.stat=c}y(Wa,v);function st(i){const c=Ts();Fe(c,new Wa(c,i))}bn.Ja="timingevent";function Ga(i,c){v.call(this,bn.Ja,i),this.size=c}y(Ga,v);function wr(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function Ar(){this.g=!0}Ar.prototype.ua=function(){this.g=!1};function Gd(i,c,l,f,b,S){i.info(function(){if(i.g)if(S){var O="",X=S.split("&");for(let ue=0;ue<X.length;ue++){var Ne=X[ue].split("=");if(Ne.length>1){const je=Ne[0];Ne=Ne[1];const wt=je.split("_");O=wt.length>=2&&wt[1]=="type"?O+(je+"="+Ne+"&"):O+(je+"=redacted&")}}}else O=null;else O=S;return"XMLHTTP REQ ("+f+") [attempt "+b+"]: "+c+`
`+l+`
`+O})}function Kd(i,c,l,f,b,S,O){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+b+"]: "+c+`
`+l+`
`+S+" "+O})}function Gn(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Yd(i,l)+(f?" "+f:"")})}function Qd(i,c){i.info(function(){return"TIMEOUT: "+c})}Ar.prototype.info=function(){};function Yd(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var l=S[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var b=f[0];if(b!="noop"&&b!="stop"&&b!="close")for(let O=1;O<f.length;O++)f[O]=""}}}}return yt(S)}catch{return c}}var Is={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ka={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Qa;function Hi(){}y(Hi,Be),Hi.prototype.g=function(){return new XMLHttpRequest},Qa=new Hi;function Rr(i){return encodeURIComponent(String(i))}function Xd(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Xt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new Ue(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ya}function Ya(){this.i=null,this.g="",this.h=!1}var Xa={},Wi={};function Gi(i,c,l){i.M=1,i.A=As(It(c)),i.u=l,i.R=!0,Ja(i,null)}function Ja(i,c){i.F=Date.now(),ws(i),i.B=It(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),hc(l.i,"t",f),i.C=0,l=i.j.L,i.h=new Ya,i.g=Pc(i.j,l?c:null,!i.u),i.P>0&&(i.O=new nt(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var b="readystatechange";Array.isArray(b)||(b&&(ut[0]=b.toString()),b=ut);for(let S=0;S<b.length;S++){const O=Xe(l,b[S],f||c.handleEvent,!1,c.h||c);if(!O)break;c.g[O.key]=O}c=i.J?it(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),Ir(),Gd(i.i,i.v,i.B,i.l,i.S,i.u)}Xt.prototype.ba=function(i){i=i.target;const c=this.O;c&&en(i)==3?c.j():this.Y(i)},Xt.prototype.Y=function(i){try{if(i==this.g)e:{const X=en(this.g),Ne=this.g.ya(),ue=this.g.ca();if(!(X<3)&&(X!=3||this.g&&(this.h.h||this.g.la()||yc(this.g)))){this.K||X!=4||Ne==7||(Ne==8||ue<=0?Ir(3):Ir(2)),Ki(this);var c=this.g.ca();this.X=c;var l=Jd(this);if(this.o=c==200,Kd(this.i,this.v,this.B,this.l,this.S,X,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,b=this.g;if((f=b.g?b.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(f)){var S=f;break t}}S=null}if(i=S)Gn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Qi(this,i);else{this.o=!1,this.m=3,st(12),Sn(this),br(this);break e}}if(this.R){i=!0;let je;for(;!this.K&&this.C<l.length;)if(je=Zd(this,l),je==Wi){X==4&&(this.m=4,st(14),i=!1),Gn(this.i,this.l,null,"[Incomplete Response]");break}else if(je==Xa){this.m=4,st(15),Gn(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Gn(this.i,this.l,je,null),Qi(this,je);if(Za(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),X!=4||l.length!=0||this.h.h||(this.m=1,st(16),i=!1),this.o=this.o&&i,!i)Gn(this.i,this.l,l,"[Invalid Chunked Response]"),Sn(this),br(this);else if(l.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),ro(O),O.P=!0,st(11))}}else Gn(this.i,this.l,l,null),Qi(this,l);X==4&&Sn(this),this.o&&!this.K&&(X==4?Rc(this.j,this):(this.o=!1,ws(this)))}else pf(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,st(12)):(this.m=0,st(13)),Sn(this),br(this)}}}catch{}finally{}};function Jd(i){if(!Za(i))return i.g.la();const c=yc(i.g);if(c==="")return"";let l="";const f=c.length,b=en(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Sn(i),br(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,l+=i.h.i.decode(c[S],{stream:!(b&&S==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function Za(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Zd(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?Wi:(l=Number(c.substring(l,f)),isNaN(l)?Xa:(f+=1,f+l>c.length?Wi:(c=c.slice(f,f+l),i.C=f+l,c)))}Xt.prototype.cancel=function(){this.K=!0,Sn(this)};function ws(i){i.T=Date.now()+i.H,ec(i,i.H)}function ec(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=wr(d(i.aa,i),c)}function Ki(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Xt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Qd(this.i,this.B),this.M!=2&&(Ir(),st(17)),Sn(this),this.m=2,br(this)):ec(this,this.T-i)};function br(i){i.j.I==0||i.K||Rc(i.j,i)}function Sn(i){Ki(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,_t(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Qi(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||Yi(l.h,i))){if(!i.L&&Yi(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var b=f;if(b[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)Ps(l),Ss(l);else break e;no(l),st(18)}}else l.xa=b[1],0<l.xa-l.K&&b[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=wr(d(l.Va,l),6e3));rc(l.h)<=1&&l.ta&&(l.ta=void 0)}else Pn(l,11)}else if((i.L||l.g==i)&&Ps(l),!m(c))for(b=l.Ba.g.parse(c),c=0;c<b.length;c++){let ue=b[c];const je=ue[0];if(!(je<=l.K))if(l.K=je,ue=ue[1],l.I==2)if(ue[0]=="c"){l.M=ue[1],l.ba=ue[2];const wt=ue[3];wt!=null&&(l.ka=wt,l.j.info("VER="+l.ka));const kn=ue[4];kn!=null&&(l.za=kn,l.j.info("SVER="+l.za));const tn=ue[5];tn!=null&&typeof tn=="number"&&tn>0&&(f=1.5*tn,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const nn=i.g;if(nn){const Ds=nn.g?nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ds){var S=f.h;S.g||Ds.indexOf("spdy")==-1&&Ds.indexOf("quic")==-1&&Ds.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Xi(S,S.h),S.h=null))}if(f.G){const so=nn.g?nn.g.getResponseHeader("X-HTTP-Session-Id"):null;so&&(f.wa=so,fe(f.J,f.G,so))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var O=i;if(f.na=Cc(f,f.L?f.ba:null,f.W),O.L){sc(f.h,O);var X=O,Ne=f.O;Ne&&(X.H=Ne),X.D&&(Ki(X),ws(X)),f.g=O}else wc(f);l.i.length>0&&Cs(l)}else ue[0]!="stop"&&ue[0]!="close"||Pn(l,7);else l.I==3&&(ue[0]=="stop"||ue[0]=="close"?ue[0]=="stop"?Pn(l,7):to(l):ue[0]!="noop"&&l.l&&l.l.qa(ue),l.A=0)}}Ir(4)}catch{}}var ef=class{constructor(i,c){this.g=i,this.map=c}};function tc(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function nc(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function rc(i){return i.h?1:i.g?i.g.size:0}function Yi(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Xi(i,c){i.g?i.g.add(c):i.h=c}function sc(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}tc.prototype.cancel=function(){if(this.i=ic(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function ic(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return R(i.i)}var oc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tf(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let b,S=null;f>=0?(b=i[l].substring(0,f),S=i[l].substring(f+1)):b=i[l],c(b,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Jt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Jt?(this.l=i.l,Sr(this,i.j),this.o=i.o,this.g=i.g,Cr(this,i.u),this.h=i.h,Ji(this,dc(i.i)),this.m=i.m):i&&(c=String(i).match(oc))?(this.l=!1,Sr(this,c[1]||"",!0),this.o=Pr(c[2]||""),this.g=Pr(c[3]||"",!0),Cr(this,c[4]),this.h=Pr(c[5]||"",!0),Ji(this,c[6]||"",!0),this.m=Pr(c[7]||"")):(this.l=!1,this.i=new Dr(null,this.l))}Jt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(kr(c,ac,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(kr(c,ac,!0),"@"),i.push(Rr(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(kr(l,l.charAt(0)=="/"?sf:rf,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",kr(l,af)),i.join("")},Jt.prototype.resolve=function(i){const c=It(this);let l=!!i.j;l?Sr(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)Cr(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var b=c.h.lastIndexOf("/");b!=-1&&(f=c.h.slice(0,b+1)+f)}if(b=f,b==".."||b==".")f="";else if(b.indexOf("./")!=-1||b.indexOf("/.")!=-1){f=b.lastIndexOf("/",0)==0,b=b.split("/");const S=[];for(let O=0;O<b.length;){const X=b[O++];X=="."?f&&O==b.length&&S.push(""):X==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&O==b.length&&S.push("")):(S.push(X),f=!0)}f=S.join("/")}else f=b}return l?c.h=f:l=i.i.toString()!=="",l?Ji(c,dc(i.i)):l=!!i.m,l&&(c.m=i.m),c};function It(i){return new Jt(i)}function Sr(i,c,l){i.j=l?Pr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function Cr(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Ji(i,c,l){c instanceof Dr?(i.i=c,cf(i.i,i.l)):(l||(c=kr(c,of)),i.i=new Dr(c,i.l))}function fe(i,c,l){i.i.set(c,l)}function As(i){return fe(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function Pr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function kr(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,nf),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function nf(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var ac=/[#\/\?@]/g,rf=/[#\?:]/g,sf=/[#\?]/g,of=/[#\?@]/g,af=/#/g;function Dr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Cn(i){i.g||(i.g=new Map,i.h=0,i.i&&tf(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=Dr.prototype,n.add=function(i,c){Cn(this),this.i=null,i=Kn(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function cc(i,c){Cn(i),c=Kn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function uc(i,c){return Cn(i),c=Kn(i,c),i.g.has(c)}n.forEach=function(i,c){Cn(this),this.g.forEach(function(l,f){l.forEach(function(b){i.call(c,b,f,this)},this)},this)};function lc(i,c){Cn(i);let l=[];if(typeof c=="string")uc(i,c)&&(l=l.concat(i.g.get(Kn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return Cn(this),this.i=null,i=Kn(this,i),uc(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=lc(this,i),i.length>0?String(i[0]):c):c};function hc(i,c,l){cc(i,c),l.length>0&&(i.i=null,i.g.set(Kn(i,c),R(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const b=Rr(l);l=lc(this,l);for(let S=0;S<l.length;S++){let O=b;l[S]!==""&&(O+="="+Rr(l[S])),i.push(O)}}return this.i=i.join("&")};function dc(i){const c=new Dr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Kn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function cf(i,c){c&&!i.j&&(Cn(i),i.i=null,i.g.forEach(function(l,f){const b=f.toLowerCase();f!=b&&(cc(this,f),hc(this,b,l))},i)),i.j=c}function uf(i,c){const l=new Ar;if(a.Image){const f=new Image;f.onload=p(Zt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(Zt,l,"TestLoadImage: error",!1,c,f),f.onabort=p(Zt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(Zt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function lf(i,c){const l=new Ar,f=new AbortController,b=setTimeout(()=>{f.abort(),Zt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(b),S.ok?Zt(l,"TestPingServer: ok",!0,c):Zt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(b),Zt(l,"TestPingServer: error",!1,c)})}function Zt(i,c,l,f,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),f(l)}catch{}}function hf(){this.g=new rt}function Zi(i){this.i=i.Sb||null,this.h=i.ab||!1}y(Zi,Be),Zi.prototype.g=function(){return new Rs(this.i,this.h)};function Rs(i,c){De.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}y(Rs,De),n=Rs.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Nr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Vr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Nr(this)),this.g&&(this.readyState=3,Nr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;fc(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function fc(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Vr(this):Nr(this),this.readyState==3&&fc(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Vr(this))},n.Na=function(i){this.g&&(this.response=i,Vr(this))},n.ga=function(){this.g&&Vr(this)};function Vr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Nr(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function Nr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Rs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function pc(i){let c="";return he(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function eo(i,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=pc(l),typeof i=="string"?l!=null&&Rr(l):fe(i,c,l))}function Ee(i){De.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}y(Ee,De);var df=/^https?$/i,ff=["POST","PUT"];n=Ee.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Qa.g(),this.g.onreadystatechange=T(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){mc(this,S);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var b in f)l.set(b,f[b]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),b=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(ff,c,void 0)>=0)||f||b||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,O]of l)this.g.setRequestHeader(S,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){mc(this,S)}};function mc(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,gc(i),bs(i)}function gc(i){i.A||(i.A=!0,Fe(i,"complete"),Fe(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Fe(this,"complete"),Fe(this,"abort"),bs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),bs(this,!0)),Ee.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?_c(this):this.Xa())},n.Xa=function(){_c(this)};function _c(i){if(i.h&&typeof o<"u"){if(i.v&&en(i)==4)setTimeout(i.Ca.bind(i),0);else if(Fe(i,"readystatechange"),en(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let O=String(i.D).match(oc)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),f=!df.test(O?O.toLowerCase():"")}l=f}if(l)Fe(i,"complete"),Fe(i,"success");else{i.o=6;try{var b=en(i)>2?i.g.statusText:""}catch{b=""}i.l=b+" ["+i.ca()+"]",gc(i)}}finally{bs(i)}}}}function bs(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||Fe(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function en(i){return i.g?i.g.readyState:0}n.ca=function(){try{return en(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),We(c)}};function yc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function pf(i){const c={};i=(i.g&&en(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(m(i[f]))continue;var l=Xd(i[f]);const b=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const S=c[b]||[];c[b]=S,S.push(l)}ke(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Or(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function vc(i){this.za=0,this.i=[],this.j=new Ar,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Or("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Or("baseRetryDelayMs",5e3,i),this.Za=Or("retryDelaySeedMs",1e4,i),this.Ta=Or("forwardChannelMaxRetries",2,i),this.va=Or("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new tc(i&&i.concurrentRequestLimit),this.Ba=new hf,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=vc.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){st(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=Cc(this,null,this.W),Cs(this)};function to(i){if(Ec(i),i.I==3){var c=i.V++,l=It(i.J);if(fe(l,"SID",i.M),fe(l,"RID",c),fe(l,"TYPE","terminate"),Mr(i,l),c=new Xt(i,i.j,c),c.M=2,c.A=As(It(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=Pc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),ws(c)}Sc(i)}function Ss(i){i.g&&(ro(i),i.g.cancel(),i.g=null)}function Ec(i){Ss(i),i.v&&(a.clearTimeout(i.v),i.v=null),Ps(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Cs(i){if(!nc(i.h)&&!i.m){i.m=!0;var c=i.Ea;G||_(),J||(G(),J=!0),I.add(c,i),i.D=0}}function mf(i,c){return rc(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=wr(d(i.Ea,i,c),bc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const b=new Xt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=it(S),Ae(S,this.U)):S=this.U),this.u!==null||this.R||(b.J=S,S=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Ic(this,b,c),l=It(this.J),fe(l,"RID",i),fe(l,"CVER",22),this.G&&fe(l,"X-HTTP-Session-Id",this.G),Mr(this,l),S&&(this.R?c="headers="+Rr(pc(S))+"&"+c:this.u&&eo(l,this.u,S)),Xi(this.h,b),this.Ra&&fe(l,"TYPE","init"),this.S?(fe(l,"$req",c),fe(l,"SID","null"),b.U=!0,Gi(b,l,null)):Gi(b,l,c),this.I=2}}else this.I==3&&(i?Tc(this,i):this.i.length==0||nc(this.h)||Tc(this))};function Tc(i,c){var l;c?l=c.l:l=i.V++;const f=It(i.J);fe(f,"SID",i.M),fe(f,"RID",l),fe(f,"AID",i.K),Mr(i,f),i.u&&i.o&&eo(f,i.u,i.o),l=new Xt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Ic(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Xi(i.h,l),Gi(l,f,c)}function Mr(i,c){i.H&&he(i.H,function(l,f){fe(c,f,l)}),i.l&&he({},function(l,f){fe(c,f,l)})}function Ic(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var b=i.i;let X=-1;for(;;){const Ne=["count="+l];X==-1?l>0?(X=b[0].g,Ne.push("ofs="+X)):X=0:Ne.push("ofs="+X);let ue=!0;for(let je=0;je<l;je++){var S=b[je].g;const wt=b[je].map;if(S-=X,S<0)X=Math.max(0,b[je].g-100),ue=!1;else try{S="req"+S+"_"||"";try{var O=wt instanceof Map?wt:Object.entries(wt);for(const[kn,tn]of O){let nn=tn;u(tn)&&(nn=yt(tn)),Ne.push(S+kn+"="+encodeURIComponent(nn))}}catch(kn){throw Ne.push(S+"type="+encodeURIComponent("_badmap")),kn}}catch{f&&f(wt)}}if(ue){O=Ne.join("&");break e}}O=void 0}return i=i.i.splice(0,l),c.G=i,O}function wc(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;G||_(),J||(G(),J=!0),I.add(c,i),i.A=0}}function no(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=wr(d(i.Da,i),bc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Ac(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=wr(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,st(10),Ss(this),Ac(this))};function ro(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Ac(i){i.g=new Xt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=It(i.na);fe(c,"RID","rpc"),fe(c,"SID",i.M),fe(c,"AID",i.K),fe(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&fe(c,"TO",i.ia),fe(c,"TYPE","xmlhttp"),Mr(i,c),i.u&&i.o&&eo(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=As(It(c)),l.u=null,l.R=!0,Ja(l,i)}n.Va=function(){this.C!=null&&(this.C=null,Ss(this),no(this),st(19))};function Ps(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Rc(i,c){var l=null;if(i.g==c){Ps(i),ro(i),i.g=null;var f=2}else if(Yi(i.h,c))l=c.G,sc(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var b=i.D;f=Ts(),Fe(f,new Ga(f,l)),Cs(i)}else wc(i);else if(b=c.m,b==3||b==0&&c.X>0||!(f==1&&mf(i,c)||f==2&&no(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),b){case 1:Pn(i,5);break;case 4:Pn(i,10);break;case 3:Pn(i,6);break;default:Pn(i,2)}}}function bc(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function Pn(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const b=!f;f=new Jt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Sr(f,"https"),As(f),b?uf(f.toString(),l):lf(f.toString(),l)}else st(2);i.I=0,i.l&&i.l.pa(c),Sc(i),Ec(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),st(2)):(this.j.info("Failed to ping google.com"),st(1))};function Sc(i){if(i.I=0,i.ja=[],i.l){const c=ic(i.h);(c.length!=0||i.i.length!=0)&&(C(i.ja,c),C(i.ja,i.i),i.h.i.length=0,R(i.i),i.i.length=0),i.l.oa()}}function Cc(i,c,l){var f=l instanceof Jt?It(l):new Jt(l);if(f.g!="")c&&(f.g=c+"."+f.g),Cr(f,f.u);else{var b=a.location;f=b.protocol,c=c?c+"."+b.hostname:b.hostname,b=+b.port;const S=new Jt(null);f&&Sr(S,f),c&&(S.g=c),b&&Cr(S,b),l&&(S.h=l),f=S}return l=i.G,c=i.wa,l&&c&&fe(f,l,c),fe(f,"VER",i.ka),Mr(i,f),f}function Pc(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Ee(new Zi({ab:l})):new Ee(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function kc(){}n=kc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ks(){}ks.prototype.g=function(i,c){return new lt(i,c)};function lt(i,c){De.call(this),this.g=new vc(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!m(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!m(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Qn(this)}y(lt,De),lt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},lt.prototype.close=function(){to(this.g)},lt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=yt(i),i=l);c.i.push(new ef(c.Ya++,i)),c.I==3&&Cs(c)},lt.prototype.N=function(){this.g.l=null,delete this.j,to(this.g),delete this.g,lt.Z.N.call(this)};function Dc(i){$i.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const l in c){i=l;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}y(Dc,$i);function Vc(){zi.call(this),this.status=1}y(Vc,zi);function Qn(i){this.g=i}y(Qn,kc),Qn.prototype.ra=function(){Fe(this.g,"a")},Qn.prototype.qa=function(i){Fe(this.g,new Dc(i))},Qn.prototype.pa=function(i){Fe(this.g,new Vc)},Qn.prototype.oa=function(){Fe(this.g,"b")},ks.prototype.createWebChannel=ks.prototype.g,lt.prototype.send=lt.prototype.o,lt.prototype.open=lt.prototype.m,lt.prototype.close=lt.prototype.close,yh=function(){return new ks},_h=function(){return Ts()},gh=bn,Uo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Is.NO_ERROR=0,Is.TIMEOUT=8,Is.HTTP_ERROR=6,zs=Is,Ka.COMPLETE="complete",mh=Ka,Yt.EventType=Rn,Rn.OPEN="a",Rn.CLOSE="b",Rn.ERROR="c",Rn.MESSAGE="d",De.prototype.listen=De.prototype.J,Ur=Yt,Ee.prototype.listenOnce=Ee.prototype.K,Ee.prototype.getLastError=Ee.prototype.Ha,Ee.prototype.getLastErrorCode=Ee.prototype.ya,Ee.prototype.getStatus=Ee.prototype.ca,Ee.prototype.getResponseJson=Ee.prototype.La,Ee.prototype.getResponseText=Ee.prototype.la,Ee.prototype.send=Ee.prototype.ea,Ee.prototype.setWithCredentials=Ee.prototype.Fa,ph=Ee}).apply(typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{});const pu="@firebase/firestore",mu="4.9.2";class Ze{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ze.UNAUTHENTICATED=new Ze(null),Ze.GOOGLE_CREDENTIALS=new Ze("google-credentials-uid"),Ze.FIRST_PARTY=new Ze("first-party-uid"),Ze.MOCK_USER=new Ze("mock-user");let _r="12.3.0";const Un=new na("@firebase/firestore");function Xn(){return Un.logLevel}function L(n,...e){if(Un.logLevel<=Z.DEBUG){const t=e.map(fa);Un.debug(`Firestore (${_r}): ${n}`,...t)}}function Ht(n,...e){if(Un.logLevel<=Z.ERROR){const t=e.map(fa);Un.error(`Firestore (${_r}): ${n}`,...t)}}function ur(n,...e){if(Un.logLevel<=Z.WARN){const t=e.map(fa);Un.warn(`Firestore (${_r}): ${n}`,...t)}}function fa(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,vh(n,r,t)}function vh(n,e,t){let r=`FIRESTORE (${_r}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ht(r),new Error(r)}function ae(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||vh(e,s,r)}function Q(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends Kt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Eh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class X_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ze.UNAUTHENTICATED)))}shutdown(){}}class J_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Z_{constructor(e){this.t=e,this.currentUser=Ze.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ae(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new qt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new qt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new qt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ae(typeof r.accessToken=="string",31837,{l:r}),new Eh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ae(e===null||typeof e=="string",2055,{h:e}),new Ze(e)}}class ey{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Ze.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ty{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ey(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ze.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class gu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ny{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,mt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ae(this.o===void 0,3512);const r=o=>{o.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new gu(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ae(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new gu(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ry(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class pa{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=ry(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function ee(n,e){return n<e?-1:n>e?1:0}function Bo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return To(s)===To(o)?ee(s,o):To(s)?1:-1}return ee(n.length,e.length)}const sy=55296,iy=57343;function To(n){const e=n.charCodeAt(0);return e>=sy&&e<=iy}function lr(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const _u="__name__";class Rt{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Rt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Rt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=Rt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return ee(e.length,t.length)}static compareSegments(e,t){const r=Rt.isNumericId(e),s=Rt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Rt.extractNumericId(e).compare(Rt.extractNumericId(t)):Bo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fn.fromString(e.substring(4,e.length-2))}}class pe extends Rt{construct(e,t,r){return new pe(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new x(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new pe(t)}static emptyPath(){return new pe([])}}const oy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ke extends Rt{construct(e,t,r){return new Ke(e,t,r)}static isValidIdentifier(e){return oy.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ke.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_u}static keyField(){return new Ke([_u])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new x(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new x(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new x(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new x(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ke(t)}static emptyPath(){return new Ke([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(pe.fromString(e))}static fromName(e){return new B(pe.fromString(e).popFirst(5))}static empty(){return new B(pe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&pe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return pe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new pe(e.slice()))}}function Th(n,e,t){if(!t)throw new x(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ay(n,e,t,r){if(e===!0&&r===!0)throw new x(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function yu(n){if(!B.isDocumentKey(n))throw new x(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function vu(n){if(B.isDocumentKey(n))throw new x(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ih(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ma(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function Wt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ma(n);throw new x(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Ce(n,e){const t={typeString:n};return e&&(t.value=e),t}function ds(n,e){if(!Ih(n))throw new x(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new x(D.INVALID_ARGUMENT,t);return!0}const Eu=-62135596800,Tu=1e6;class me{static now(){return me.fromMillis(Date.now())}static fromDate(e){return me.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Tu);return new me(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Eu)throw new x(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Tu}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:me._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ds(e,me._jsonSchema))return new me(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Eu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}me._jsonSchemaVersion="firestore/timestamp/1.0",me._jsonSchema={type:Ce("string",me._jsonSchemaVersion),seconds:Ce("number"),nanoseconds:Ce("number")};class W{static fromTimestamp(e){return new W(e)}static min(){return new W(new me(0,0))}static max(){return new W(new me(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const es=-1;function cy(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=W.fromTimestamp(r===1e9?new me(t+1,0):new me(t,r));return new mn(s,B.empty(),e)}function uy(n){return new mn(n.readTime,n.key,es)}class mn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new mn(W.min(),B.empty(),es)}static max(){return new mn(W.max(),B.empty(),es)}}function ly(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:ee(n.largestBatchId,e.largestBatchId))}const hy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class dy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function yr(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==hy)throw n;L("LocalStore","Unexpectedly lost primary lease")}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):P.reject(t)}static resolve(e){return new P(((t,r)=>{t(e)}))}static reject(e){return new P(((t,r)=>{r(e)}))}static waitFor(e){return new P(((t,r)=>{let s=0,o=0,a=!1;e.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=P.resolve(!1);for(const r of e)t=t.next((s=>s?P.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new P(((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++u,u===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new P(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function fy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function vr(n){return n.name==="IndexedDbTransactionError"}class bi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}bi.ce=-1;const ga=-1;function Si(n){return n==null}function ii(n){return n===0&&1/n==-1/0}function py(n){return typeof n=="number"&&Number.isInteger(n)&&!ii(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const wh="";function my(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Iu(e)),e=gy(n.get(t),e);return Iu(e)}function gy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case wh:t+="";break;default:t+=o}}return t}function Iu(n){return n+wh+""}function wu(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function wn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Ah(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ve{constructor(e,t){this.comparator=e,this.root=t||Ge.EMPTY}insert(e,t){return new ve(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ge.BLACK,null,null))}remove(e){return new ve(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ge.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ms(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ms(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ms(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ms(this.root,e,this.comparator,!0)}}class Ms{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ge{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Ge.RED,this.left=s??Ge.EMPTY,this.right=o??Ge.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Ge(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ge.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ge.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ge.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ge.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Ge.EMPTY=null,Ge.RED=!0,Ge.BLACK=!1;Ge.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Ge(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Le{constructor(e){this.comparator=e,this.data=new ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Au(this.data.getIterator())}getIteratorFrom(e){return new Au(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Le)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Le(this.comparator);return t.data=e,t}}class Au{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ht{constructor(e){this.fields=e,e.sort(Ke.comparator)}static empty(){return new ht([])}unionWith(e){let t=new Le(Ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ht(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lr(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Rh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Qe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Rh("Invalid base64 string: "+o):o}})(e);return new Qe(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Qe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qe.EMPTY_BYTE_STRING=new Qe("");const _y=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gn(n){if(ae(!!n,39018),typeof n=="string"){let e=0;const t=_y.exec(n);if(ae(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Qe.fromBase64String(n):Qe.fromUint8Array(n)}const bh="server_timestamp",Sh="__type__",Ch="__previous_value__",Ph="__local_write_time__";function _a(n){return(n?.mapValue?.fields||{})[Sh]?.stringValue===bh}function Ci(n){const e=n.mapValue.fields[Ch];return _a(e)?Ci(e):e}function ts(n){const e=gn(n.mapValue.fields[Ph].timestampValue);return new me(e.seconds,e.nanos)}class yy{constructor(e,t,r,s,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const oi="(default)";class ns{constructor(e,t){this.projectId=e,this.database=t||oi}static empty(){return new ns("","")}get isDefaultDatabase(){return this.database===oi}isEqual(e){return e instanceof ns&&e.projectId===this.projectId&&e.database===this.database}}const kh="__type__",vy="__max__",Ls={mapValue:{}},Dh="__vector__",ai="value";function yn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?_a(n)?4:Ty(n)?9007199254740991:Ey(n)?10:11:$(28295,{value:n})}function Ot(n,e){if(n===e)return!0;const t=yn(n);if(t!==yn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ts(n).isEqual(ts(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=gn(s.timestampValue),u=gn(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return _n(s.bytesValue).isEqual(_n(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return we(s.geoPointValue.latitude)===we(o.geoPointValue.latitude)&&we(s.geoPointValue.longitude)===we(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return we(s.integerValue)===we(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=we(s.doubleValue),u=we(o.doubleValue);return a===u?ii(a)===ii(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return lr(n.arrayValue.values||[],e.arrayValue.values||[],Ot);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(wu(a)!==wu(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Ot(a[h],u[h])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function rs(n,e){return(n.values||[]).find((t=>Ot(t,e)))!==void 0}function hr(n,e){if(n===e)return 0;const t=yn(n),r=yn(e);if(t!==r)return ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=we(o.integerValue||o.doubleValue),h=we(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return Ru(n.timestampValue,e.timestampValue);case 4:return Ru(ts(n),ts(e));case 5:return Bo(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=_n(o),h=_n(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const p=ee(u[d],h[d]);if(p!==0)return p}return ee(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=ee(we(o.latitude),we(a.latitude));return u!==0?u:ee(we(o.longitude),we(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return bu(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[ai]?.arrayValue,p=h[ai]?.arrayValue,y=ee(d?.values?.length||0,p?.values?.length||0);return y!==0?y:bu(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Ls.mapValue&&a===Ls.mapValue)return 0;if(o===Ls.mapValue)return 1;if(a===Ls.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let y=0;y<h.length&&y<p.length;++y){const T=Bo(h[y],p[y]);if(T!==0)return T;const R=hr(u[h[y]],d[p[y]]);if(R!==0)return R}return ee(h.length,p.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function Ru(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ee(n,e);const t=gn(n),r=gn(e),s=ee(t.seconds,r.seconds);return s!==0?s:ee(t.nanos,r.nanos)}function bu(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=hr(t[s],r[s]);if(o)return o}return ee(t.length,r.length)}function dr(n){return jo(n)}function jo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=gn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _n(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return B.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=jo(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${jo(t.fields[a])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function Hs(n){switch(yn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ci(n);return e?16+Hs(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Hs(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return wn(r.fields,((o,a)=>{s+=o.length+Hs(a)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function qo(n){return!!n&&"integerValue"in n}function ya(n){return!!n&&"arrayValue"in n}function Su(n){return!!n&&"nullValue"in n}function Cu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ws(n){return!!n&&"mapValue"in n}function Ey(n){return(n?.mapValue?.fields||{})[kh]?.stringValue===Dh}function Wr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return wn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Wr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Wr(n.arrayValue.values[t]);return e}return{...n}}function Ty(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===vy}class at{constructor(e){this.value=e}static empty(){return new at({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wr(t)}setAll(e){let t=Ke.emptyPath(),r={},s=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=Wr(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ws(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){wn(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new at(Wr(this.value))}}function Vh(n){const e=[];return wn(n.fields,((t,r)=>{const s=new Ke([t]);if(Ws(r)){const o=Vh(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new ht(e)}class et{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new et(e,0,W.min(),W.min(),W.min(),at.empty(),0)}static newFoundDocument(e,t,r,s){return new et(e,1,t,W.min(),r,s,0)}static newNoDocument(e,t){return new et(e,2,t,W.min(),W.min(),at.empty(),0)}static newUnknownDocument(e,t){return new et(e,3,t,W.min(),W.min(),at.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=at.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=at.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof et&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new et(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ci{constructor(e,t){this.position=e,this.inclusive=t}}function Pu(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),t.key):r=hr(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function ku(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ot(n.position[t],e.position[t]))return!1;return!0}class ui{constructor(e,t="asc"){this.field=e,this.dir=t}}function Iy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Nh{}class Me extends Nh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ay(e,t,r):t==="array-contains"?new Sy(e,r):t==="in"?new Cy(e,r):t==="not-in"?new Py(e,r):t==="array-contains-any"?new ky(e,r):new Me(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Ry(e,r):new by(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(hr(t,this.value)):t!==null&&yn(this.value)===yn(t)&&this.matchesComparison(hr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mt extends Nh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Mt(e,t)}matches(e){return Oh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Oh(n){return n.op==="and"}function Mh(n){return wy(n)&&Oh(n)}function wy(n){for(const e of n.filters)if(e instanceof Mt)return!1;return!0}function $o(n){if(n instanceof Me)return n.field.canonicalString()+n.op.toString()+dr(n.value);if(Mh(n))return n.filters.map((e=>$o(e))).join(",");{const e=n.filters.map((t=>$o(t))).join(",");return`${n.op}(${e})`}}function Lh(n,e){return n instanceof Me?(function(r,s){return s instanceof Me&&r.op===s.op&&r.field.isEqual(s.field)&&Ot(r.value,s.value)})(n,e):n instanceof Mt?(function(r,s){return s instanceof Mt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&Lh(a,s.filters[u])),!0):!1})(n,e):void $(19439)}function xh(n){return n instanceof Me?(function(t){return`${t.field.canonicalString()} ${t.op} ${dr(t.value)}`})(n):n instanceof Mt?(function(t){return t.op.toString()+" {"+t.getFilters().map(xh).join(" ,")+"}"})(n):"Filter"}class Ay extends Me{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ry extends Me{constructor(e,t){super(e,"in",t),this.keys=Fh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class by extends Me{constructor(e,t){super(e,"not-in",t),this.keys=Fh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Fh(n,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class Sy extends Me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ya(t)&&rs(t.arrayValue,this.value)}}class Cy extends Me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&rs(this.value.arrayValue,t)}}class Py extends Me{constructor(e,t){super(e,"not-in",t)}matches(e){if(rs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!rs(this.value.arrayValue,t)}}class ky extends Me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ya(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>rs(this.value.arrayValue,r)))}}class Dy{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Du(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Dy(n,e,t,r,s,o,a)}function va(n){const e=Q(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>$o(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Si(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>dr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>dr(r))).join(",")),e.Te=t}return e.Te}function Ea(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Iy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Lh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ku(n.startAt,e.startAt)&&ku(n.endAt,e.endAt)}function zo(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Pi{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Vy(n,e,t,r,s,o,a,u){return new Pi(n,e,t,r,s,o,a,u)}function Ta(n){return new Pi(n)}function Vu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ny(n){return n.collectionGroup!==null}function Gr(n){const e=Q(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Le(Ke.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new ui(o,r))})),t.has(Ke.keyField().canonicalString())||e.Ie.push(new ui(Ke.keyField(),r))}return e.Ie}function Pt(n){const e=Q(n);return e.Ee||(e.Ee=Oy(e,Gr(n))),e.Ee}function Oy(n,e){if(n.limitType==="F")return Du(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new ui(s.field,o)}));const t=n.endAt?new ci(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ci(n.startAt.position,n.startAt.inclusive):null;return Du(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ho(n,e,t){return new Pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ki(n,e){return Ea(Pt(n),Pt(e))&&n.limitType===e.limitType}function Uh(n){return`${va(Pt(n))}|lt:${n.limitType}`}function Jn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>xh(s))).join(", ")}]`),Si(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>dr(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>dr(s))).join(",")),`Target(${r})`})(Pt(n))}; limitType=${n.limitType})`}function Di(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):B.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Gr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=Pu(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Gr(r),s)||r.endAt&&!(function(a,u,h){const d=Pu(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Gr(r),s))})(n,e)}function My(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Bh(n){return(e,t)=>{let r=!1;for(const s of Gr(n)){const o=Ly(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Ly(n,e,t){const r=n.field.isKeyField()?B.comparator(e.key,t.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?hr(h,d):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}class $n{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){wn(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return Ah(this.inner)}size(){return this.innerSize}}const xy=new ve(B.comparator);function Gt(){return xy}const jh=new ve(B.comparator);function Br(...n){let e=jh;for(const t of n)e=e.insert(t.key,t);return e}function qh(n){let e=jh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Vn(){return Kr()}function $h(){return Kr()}function Kr(){return new $n((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Fy=new ve(B.comparator),Uy=new Le(B.comparator);function te(...n){let e=Uy;for(const t of n)e=e.add(t);return e}const By=new Le(ee);function jy(){return By}function Ia(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ii(e)?"-0":e}}function zh(n){return{integerValue:""+n}}function qy(n,e){return py(e)?zh(e):Ia(n,e)}class Vi{constructor(){this._=void 0}}function $y(n,e,t){return n instanceof li?(function(s,o){const a={fields:{[Sh]:{stringValue:bh},[Ph]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&_a(o)&&(o=Ci(o)),o&&(a.fields[Ch]=o),{mapValue:a}})(t,e):n instanceof ss?Wh(n,e):n instanceof is?Gh(n,e):(function(s,o){const a=Hh(s,o),u=Nu(a)+Nu(s.Ae);return qo(a)&&qo(s.Ae)?zh(u):Ia(s.serializer,u)})(n,e)}function zy(n,e,t){return n instanceof ss?Wh(n,e):n instanceof is?Gh(n,e):t}function Hh(n,e){return n instanceof hi?(function(r){return qo(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class li extends Vi{}class ss extends Vi{constructor(e){super(),this.elements=e}}function Wh(n,e){const t=Kh(e);for(const r of n.elements)t.some((s=>Ot(s,r)))||t.push(r);return{arrayValue:{values:t}}}class is extends Vi{constructor(e){super(),this.elements=e}}function Gh(n,e){let t=Kh(e);for(const r of n.elements)t=t.filter((s=>!Ot(s,r)));return{arrayValue:{values:t}}}class hi extends Vi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Nu(n){return we(n.integerValue||n.doubleValue)}function Kh(n){return ya(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Hy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof ss&&s instanceof ss||r instanceof is&&s instanceof is?lr(r.elements,s.elements,Ot):r instanceof hi&&s instanceof hi?Ot(r.Ae,s.Ae):r instanceof li&&s instanceof li})(n.transform,e.transform)}class Wy{constructor(e,t){this.version=e,this.transformResults=t}}class kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new kt}static exists(e){return new kt(void 0,e)}static updateTime(e){return new kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ni{}function Qh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Xh(n.key,kt.none()):new fs(n.key,n.data,kt.none());{const t=n.data,r=at.empty();let s=new Le(Ke.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new An(n.key,r,new ht(s.toArray()),kt.none())}}function Gy(n,e,t){n instanceof fs?(function(s,o,a){const u=s.value.clone(),h=Mu(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof An?(function(s,o,a){if(!Gs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Mu(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Yh(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Qr(n,e,t,r){return n instanceof fs?(function(o,a,u,h){if(!Gs(o.precondition,a))return u;const d=o.value.clone(),p=Lu(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof An?(function(o,a,u,h){if(!Gs(o.precondition,a))return u;const d=Lu(o.fieldTransforms,h,a),p=a.data;return p.setAll(Yh(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((y=>y.field)))})(n,e,t,r):(function(o,a,u){return Gs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function Ky(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=Hh(r.transform,s||null);o!=null&&(t===null&&(t=at.empty()),t.set(r.field,o))}return t||null}function Ou(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&lr(r,s,((o,a)=>Hy(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class fs extends Ni{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class An extends Ni{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Yh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Mu(n,e,t){const r=new Map;ae(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,zy(a,u,t[s]))}return r}function Lu(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,$y(o,a,e))}return r}class Xh extends Ni{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qy extends Ni{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Yy{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&Gy(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Qr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Qr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=$h();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=Qh(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(W.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),te())}isEqual(e){return this.batchId===e.batchId&&lr(this.mutations,e.mutations,((t,r)=>Ou(t,r)))&&lr(this.baseMutations,e.baseMutations,((t,r)=>Ou(t,r)))}}class wa{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ae(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Fy})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new wa(e,t,r,s)}}class Xy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Jy{constructor(e,t){this.count=e,this.unchangedNames=t}}var be,se;function Zy(n){switch(n){case D.OK:return $(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Jh(n){if(n===void 0)return Ht("GRPC error has no .code"),D.UNKNOWN;switch(n){case be.OK:return D.OK;case be.CANCELLED:return D.CANCELLED;case be.UNKNOWN:return D.UNKNOWN;case be.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case be.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case be.INTERNAL:return D.INTERNAL;case be.UNAVAILABLE:return D.UNAVAILABLE;case be.UNAUTHENTICATED:return D.UNAUTHENTICATED;case be.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case be.NOT_FOUND:return D.NOT_FOUND;case be.ALREADY_EXISTS:return D.ALREADY_EXISTS;case be.PERMISSION_DENIED:return D.PERMISSION_DENIED;case be.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case be.ABORTED:return D.ABORTED;case be.OUT_OF_RANGE:return D.OUT_OF_RANGE;case be.UNIMPLEMENTED:return D.UNIMPLEMENTED;case be.DATA_LOSS:return D.DATA_LOSS;default:return $(39323,{code:n})}}(se=be||(be={}))[se.OK=0]="OK",se[se.CANCELLED=1]="CANCELLED",se[se.UNKNOWN=2]="UNKNOWN",se[se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",se[se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",se[se.NOT_FOUND=5]="NOT_FOUND",se[se.ALREADY_EXISTS=6]="ALREADY_EXISTS",se[se.PERMISSION_DENIED=7]="PERMISSION_DENIED",se[se.UNAUTHENTICATED=16]="UNAUTHENTICATED",se[se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",se[se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",se[se.ABORTED=10]="ABORTED",se[se.OUT_OF_RANGE=11]="OUT_OF_RANGE",se[se.UNIMPLEMENTED=12]="UNIMPLEMENTED",se[se.INTERNAL=13]="INTERNAL",se[se.UNAVAILABLE=14]="UNAVAILABLE",se[se.DATA_LOSS=15]="DATA_LOSS";function ev(){return new TextEncoder}const tv=new fn([4294967295,4294967295],0);function xu(n){const e=ev().encode(n),t=new fh;return t.update(e),new Uint8Array(t.digest())}function Fu(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new fn([t,r],0),new fn([s,o],0)]}class Aa{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new jr(`Invalid padding: ${t}`);if(r<0)throw new jr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new jr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new jr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=fn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(fn.fromNumber(r)));return s.compare(tv)===1&&(s=new fn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=xu(e),[r,s]=Fu(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Aa(o,s,t);return r.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=xu(e),[r,s]=Fu(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class jr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Oi{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ps.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Oi(W.min(),s,new ve(ee),Gt(),te())}}class ps{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ps(r,t,te(),te(),te())}}class Ks{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Zh{constructor(e,t){this.targetId=e,this.Ce=t}}class ed{constructor(e,t,r=Qe.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Uu{constructor(){this.ve=0,this.Fe=Bu(),this.Me=Qe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=te(),t=te(),r=te();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:o})}})),new ps(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Bu()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ae(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class nv{constructor(e){this.Ge=e,this.ze=new Map,this.je=Gt(),this.Je=xs(),this.He=xs(),this.Ye=new ve(ee)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(zo(o))if(r===0){const a=new B(o.path);this.et(t,a,et.newNoDocument(a,W.min()))}else ae(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=_n(r).toUint8Array()}catch(h){if(h instanceof Rh)return ur("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Aa(a,s,o)}catch(h){return ur(h instanceof jr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&zo(u.target)){const h=new B(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,et.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=te();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new Oi(e,t,this.Ye,this.je,r);return this.je=Gt(),this.Je=xs(),this.He=xs(),this.Ye=new ve(ee),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Uu,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Le(ee),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Le(ee),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Uu),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function xs(){return new ve(B.comparator)}function Bu(){return new ve(B.comparator)}const rv={asc:"ASCENDING",desc:"DESCENDING"},sv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iv={and:"AND",or:"OR"};class ov{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Wo(n,e){return n.useProto3Json||Si(e)?e:{value:e}}function di(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function td(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function av(n,e){return di(n,e.toTimestamp())}function Dt(n){return ae(!!n,49232),W.fromTimestamp((function(t){const r=gn(t);return new me(r.seconds,r.nanos)})(n))}function Ra(n,e){return Go(n,e).canonicalString()}function Go(n,e){const t=(function(s){return new pe(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function nd(n){const e=pe.fromString(n);return ae(ad(e),10190,{key:e.toString()}),e}function Ko(n,e){return Ra(n.databaseId,e.path)}function Io(n,e){const t=nd(e);if(t.get(1)!==n.databaseId.projectId)throw new x(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(sd(t))}function rd(n,e){return Ra(n.databaseId,e)}function cv(n){const e=nd(n);return e.length===4?pe.emptyPath():sd(e)}function Qo(n){return new pe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function sd(n){return ae(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ju(n,e,t){return{name:Ko(n,e),fields:t.value.mapValue.fields}}function uv(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:$(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(ae(p===void 0||typeof p=="string",58123),Qe.fromBase64String(p||"")):(ae(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Qe.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){const p=d.code===void 0?D.UNKNOWN:Jh(d.code);return new x(p,d.message||"")})(a);t=new ed(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Io(n,r.document.name),o=Dt(r.document.updateTime),a=r.document.createTime?Dt(r.document.createTime):W.min(),u=new at({mapValue:{fields:r.document.fields}}),h=et.newFoundDocument(s,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Ks(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Io(n,r.document),o=r.readTime?Dt(r.readTime):W.min(),a=et.newNoDocument(s,o),u=r.removedTargetIds||[];t=new Ks([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Io(n,r.document),o=r.removedTargetIds||[];t=new Ks([],o,s,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new Jy(s,o),u=r.targetId;t=new Zh(u,a)}}return t}function lv(n,e){let t;if(e instanceof fs)t={update:ju(n,e.key,e.value)};else if(e instanceof Xh)t={delete:Ko(n,e.key)};else if(e instanceof An)t={update:ju(n,e.key,e.data),updateMask:vv(e.fieldMask)};else{if(!(e instanceof Qy))return $(16599,{Vt:e.type});t={verify:Ko(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof li)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ss)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof is)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof hi)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw $(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:av(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:$(27497)})(n,e.precondition)),t}function hv(n,e){return n&&n.length>0?(ae(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Dt(s.updateTime):Dt(o);return a.isEqual(W.min())&&(a=Dt(o)),new Wy(a,s.transformResults||[])})(t,e)))):[]}function dv(n,e){return{documents:[rd(n,e.path)]}}function fv(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=rd(n,s);const o=(function(d){if(d.length!==0)return od(Mt.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(T){return{field:Zn(T.field),direction:gv(T.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Wo(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function pv(n){let e=cv(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ae(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(y){const T=id(y);return T instanceof Mt&&Mh(T)?T.getFilters():[T]})(t.where));let a=[];t.orderBy&&(a=(function(y){return y.map((T=>(function(C){return new ui(er(C.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(T)))})(t.orderBy));let u=null;t.limit&&(u=(function(y){let T;return T=typeof y=="object"?y.value:y,Si(T)?null:T})(t.limit));let h=null;t.startAt&&(h=(function(y){const T=!!y.before,R=y.values||[];return new ci(R,T)})(t.startAt));let d=null;return t.endAt&&(d=(function(y){const T=!y.before,R=y.values||[];return new ci(R,T)})(t.endAt)),Vy(e,s,a,o,u,"F",h,d)}function mv(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function id(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=er(t.unaryFilter.field);return Me.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=er(t.unaryFilter.field);return Me.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=er(t.unaryFilter.field);return Me.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=er(t.unaryFilter.field);return Me.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Me.create(er(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Mt.create(t.compositeFilter.filters.map((r=>id(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function gv(n){return rv[n]}function _v(n){return sv[n]}function yv(n){return iv[n]}function Zn(n){return{fieldPath:n.canonicalString()}}function er(n){return Ke.fromServerFormat(n.fieldPath)}function od(n){return n instanceof Me?(function(t){if(t.op==="=="){if(Cu(t.value))return{unaryFilter:{field:Zn(t.field),op:"IS_NAN"}};if(Su(t.value))return{unaryFilter:{field:Zn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Cu(t.value))return{unaryFilter:{field:Zn(t.field),op:"IS_NOT_NAN"}};if(Su(t.value))return{unaryFilter:{field:Zn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zn(t.field),op:_v(t.op),value:t.value}}})(n):n instanceof Mt?(function(t){const r=t.getFilters().map((s=>od(s)));return r.length===1?r[0]:{compositeFilter:{op:yv(t.op),filters:r}}})(n):$(54877,{filter:n})}function vv(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ad(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class un{constructor(e,t,r,s,o=W.min(),a=W.min(),u=Qe.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new un(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new un(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new un(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new un(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ev{constructor(e){this.yt=e}}function Tv(n){const e=pv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ho(e,e.limit,"L"):e}class Iv{constructor(){this.Cn=new wv}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(mn.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(mn.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class wv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Le(pe.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Le(pe.comparator)).toArray()}}const qu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},cd=41943040;class ot{static withCacheSize(e){return new ot(e,ot.DEFAULT_COLLECTION_PERCENTILE,ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ot.DEFAULT_COLLECTION_PERCENTILE=10,ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ot.DEFAULT=new ot(cd,ot.DEFAULT_COLLECTION_PERCENTILE,ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ot.DISABLED=new ot(-1,0,0);class fr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new fr(0)}static cr(){return new fr(-1)}}const $u="LruGarbageCollector",Av=1048576;function zu([n,e],[t,r]){const s=ee(n,t);return s===0?ee(e,r):s}class Rv{constructor(e){this.Ir=e,this.buffer=new Le(zu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();zu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class bv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){L($u,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vr(t)?L($u,"Ignoring IndexedDB error during garbage collection: ",t):await yr(t)}await this.Vr(3e5)}))}}class Sv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return P.resolve(bi.ce);const r=new Rv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(qu)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qu):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,u,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((y=>(y>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),s=this.params.maximumSequenceNumbersToCollect):s=y,a=Date.now(),this.nthSequenceNumber(e,s)))).next((y=>(r=y,u=Date.now(),this.removeTargets(e,r,t)))).next((y=>(o=y,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((y=>(d=Date.now(),Xn()<=Z.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${y} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:y}))))}}function Cv(n,e){return new Sv(n,e)}class Pv{constructor(){this.changes=new $n((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,et.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class kv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Dv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Qr(r.mutation,s,ht.empty(),me.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,te()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=te()){const s=Vn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=Br();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Vn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,te())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,r,s){let o=Gt();const a=Kr(),u=(function(){return Kr()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof An)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Qr(p.mutation,d,p.mutation.getFieldMask(),me.now())):a.set(d.key,ht.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>u.set(d,new kv(p,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=Kr();let s=new ve(((a,u)=>a-u)),o=te();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||ht.empty();p=u.applyToLocalView(d,p),r.set(h,p);const y=(s.get(u.batchId)||te()).add(h);s=s.insert(u.batchId,y)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,p=h.value,y=$h();p.forEach((T=>{if(!o.has(T)){const R=Qh(t.get(T),r.get(T));R!==null&&y.set(T,R),o=o.add(T)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,y))}return P.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ny(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):P.resolve(Vn());let u=es,h=o;return a.next((d=>P.forEach(d,((p,y)=>(u<y.largestBatchId&&(u=y.largestBatchId),o.get(p)?P.resolve():this.remoteDocumentCache.getEntry(e,p).next((T=>{h=h.insert(p,T)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,te()))).next((p=>({batchId:u,changes:qh(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((r=>{let s=Br();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=Br();return this.indexManager.getCollectionParents(e,o).next((u=>P.forEach(u,(h=>{const d=(function(y,T){return new Pi(T,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((y,T)=>{a=a.insert(y,T)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,et.newInvalidDocument(p)))}));let u=Br();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Qr(p.mutation,d,ht.empty(),me.now()),Di(t,d)&&(u=u.insert(h,d))})),u}))}}class Vv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Dt(s.createTime)}})(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:Tv(s.bundledQuery),readTime:Dt(s.readTime)}})(t)),P.resolve()}}class Nv{constructor(){this.overlays=new ve(B.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vn();return P.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),P.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){const s=Vn(),o=t.length+1,a=new B(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new ve(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Vn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const u=Vn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>u.set(d,p))),!(u.size()>=s)););return P.resolve(u)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Xy(t,r));let o=this.qr.get(t);o===void 0&&(o=te(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class Ov{constructor(){this.sessionToken=Qe.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class ba{constructor(){this.Qr=new Le(qe.$r),this.Ur=new Le(qe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new qe(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new qe(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new B(new pe([])),r=new qe(t,e),s=new qe(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new pe([])),r=new qe(t,e),s=new qe(t,e+1);let o=te();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new qe(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qe{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||ee(e.Yr,t.Yr)}static Kr(e,t){return ee(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class Mv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Le(qe.$r)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Yy(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new qe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?ga:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qe(t,0),s=new qe(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Le(ee);return t.forEach((s=>{const o=new qe(s,0),a=new qe(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),P.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;B.isDocumentKey(o)||(o=o.child(""));const a=new qe(new B(o),0);let u=new Le(ee);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),P.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){ae(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return P.forEach(t.mutations,(s=>{const o=new qe(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new qe(t,0),s=this.Zr.firstAfterOrEqual(r);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Lv{constructor(e){this.ri=e,this.docs=(function(){return new ve(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():et.newInvalidDocument(t))}getEntries(e,t){let r=Gt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():et.newInvalidDocument(s))})),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=Gt();const a=t.path,u=new B(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ly(uy(p),r)<=0||(s.has(p.key)||Di(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ii(e,t){return P.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new xv(this)}getSize(e){return P.resolve(this.size)}}class xv extends Pv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Fv{constructor(e){this.persistence=e,this.si=new $n((t=>va(t)),Ea),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.oi=0,this._i=new ba,this.targetCount=0,this.ai=fr.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new fr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)})),P.waitFor(o).next((()=>s))}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}class ud{constructor(e,t){this.ui={},this.overlays={},this.ci=new bi(0),this.li=!1,this.li=!0,this.hi=new Ov,this.referenceDelegate=e(this),this.Pi=new Fv(this),this.indexManager=new Iv,this.remoteDocumentCache=(function(s){return new Lv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Ev(t),this.Ii=new Vv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Nv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Mv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);const s=new Uv(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return P.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class Uv extends dy{constructor(e){super(),this.currentSequenceNumber=e}}class Sa{constructor(e){this.persistence=e,this.Ri=new ba,this.Vi=null}static mi(e){return new Sa(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,(r=>{const s=B.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,W.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class fi{constructor(e,t){this.persistence=e,this.pi=new $n((r=>my(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Cv(this,t)}static mi(e,t){return new fi(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return P.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?P.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((u=>{u||(r++,o.removeEntry(a,W.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Hs(e.data.value)),t}br(e,t,r){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return P.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Ca{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=te(),s=te();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Ca(e,t.fromCache,r,s)}}class Bv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class jv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return gp()?8:fy(tt())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Bv;return this.Ss(e,t,a).next((u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Xn()<=Z.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",Jn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(Xn()<=Z.DEBUG&&L("QueryEngine","Query:",Jn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Xn()<=Z.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",Jn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pt(t))):P.resolve())}ys(e,t){if(Vu(t))return P.resolve(null);let r=Pt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Ho(t,null,"F"),r=Pt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=te(...o);return this.ps.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,Ho(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ws(e,t,r,s){return Vu(t)||s.isEqual(W.min())?P.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?P.resolve(null):(Xn()<=Z.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Jn(t)),this.vs(e,a,t,cy(s,es)).next((u=>u)))}))}Ds(e,t){let r=new Le(Bh(e));return t.forEach(((s,o)=>{Di(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Xn()<=Z.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",Jn(t)),this.ps.getDocumentsMatchingQuery(e,t,mn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Pa="LocalStore",qv=3e8;class $v{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ve(ee),this.xs=new $n((o=>va(o)),Ea),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Dv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function zv(n,e,t,r){return new $v(n,e,t,r)}async function ld(n,e){const t=Q(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=te();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){u.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function Hv(n,e){const t=Q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){const y=d.batch,T=y.keys();let R=P.resolve();return T.forEach((C=>{R=R.next((()=>p.getEntry(h,C))).next((V=>{const k=d.docVersions.get(C);ae(k!==null,48541),V.version.compareTo(k)<0&&(y.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),p.addEntry(V)))}))})),R.next((()=>u.mutationQueue.removeMutationBatch(h,y)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=te();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function hd(n){const e=Q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function Wv(n,e){const t=Q(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const u=[];e.targetChanges.forEach(((p,y)=>{const T=s.get(y);if(!T)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,y).next((()=>t.Pi.addMatchingKeys(o,p.addedDocuments,y))));let R=T.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?R=R.withResumeToken(Qe.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),s=s.insert(y,R),(function(V,k,U){return V.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=qv?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0})(T,R,p)&&u.push(t.Pi.updateTargetData(o,R))}));let h=Gt(),d=te();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(Gv(o,a,e.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(W.min())){const p=t.Pi.getLastRemoteSnapshotVersion(o).next((y=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return P.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function Gv(n,e,t){let r=te(),s=te();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=Gt();return t.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(W.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):L(Pa,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function Kv(n,e){const t=Q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=ga),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Qv(n,e){const t=Q(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,P.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new un(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Yo(n,e,t){const r=Q(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!vr(a))throw a;L(Pa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Hu(n,e,t){const r=Q(n);let s=W.min(),o=te();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const y=Q(h),T=y.xs.get(p);return T!==void 0?P.resolve(y.Ms.get(T)):y.Pi.getTargetData(d,p)})(r,a,Pt(e)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:W.min(),t?o:te()))).next((u=>(Yv(r,My(e),u),{documents:u,Qs:o})))))}function Yv(n,e,t){let r=n.Os.get(e)||W.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class Wu{constructor(){this.activeTargetIds=jy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Xv{constructor(){this.Mo=new Wu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Wu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Jv{Oo(e){}shutdown(){}}const Gu="ConnectivityMonitor";class Ku{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){L(Gu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){L(Gu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Fs=null;function Xo(){return Fs===null?Fs=(function(){return 268435456+Math.round(2147483648*Math.random())})():Fs++,"0x"+Fs.toString(16)}const wo="RestConnection",Zv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===oi?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=Xo(),u=this.zo(e,t.toUriEncodedString());L(wo,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),p=mr(d);return this.Jo(e,u,h,r,p).then((y=>(L(wo,`Received RPC '${e}' ${a}: `,y),y)),(y=>{throw ur(wo,`RPC '${e}' ${a} failed with error: `,y,"url: ",u,"request:",r),y}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+_r})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=Zv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class tE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Je="WebChannelConnection";class nE extends eE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=Xo();return new Promise(((u,h)=>{const d=new ph;d.setWithCredentials(!0),d.listenOnce(mh.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case zs.NO_ERROR:const y=d.getResponseJson();L(Je,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),u(y);break;case zs.TIMEOUT:L(Je,`RPC '${e}' ${a} timed out`),h(new x(D.DEADLINE_EXCEEDED,"Request time out"));break;case zs.HTTP_ERROR:const T=d.getStatus();if(L(Je,`RPC '${e}' ${a} failed with status:`,T,"response text:",d.getResponseText()),T>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const C=R?.error;if(C&&C.status&&C.message){const V=(function(U){const F=U.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(F)>=0?F:D.UNKNOWN})(C.status);h(new x(V,C.message))}else h(new x(D.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new x(D.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{L(Je,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);L(Je,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=Xo(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=yh(),u=_h(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=o.join("");L(Je,`Creating RPC '${e}' stream ${s}: ${p}`,h);const y=a.createWebChannel(p,h);this.I_(y);let T=!1,R=!1;const C=new tE({Yo:k=>{R?L(Je,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(T||(L(Je,`Opening RPC '${e}' stream ${s} transport.`),y.open(),T=!0),L(Je,`RPC '${e}' stream ${s} sending:`,k),y.send(k))},Zo:()=>y.close()}),V=(k,U,F)=>{k.listen(U,(M=>{try{F(M)}catch(H){setTimeout((()=>{throw H}),0)}}))};return V(y,Ur.EventType.OPEN,(()=>{R||(L(Je,`RPC '${e}' stream ${s} transport opened.`),C.o_())})),V(y,Ur.EventType.CLOSE,(()=>{R||(R=!0,L(Je,`RPC '${e}' stream ${s} transport closed`),C.a_(),this.E_(y))})),V(y,Ur.EventType.ERROR,(k=>{R||(R=!0,ur(Je,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),C.a_(new x(D.UNAVAILABLE,"The operation could not be completed")))})),V(y,Ur.EventType.MESSAGE,(k=>{if(!R){const U=k.data[0];ae(!!U,16349);const F=U,M=F?.error||F[0]?.error;if(M){L(Je,`RPC '${e}' stream ${s} received error:`,M);const H=M.status;let G=(function(_){const g=be[_];if(g!==void 0)return Jh(g)})(H),J=M.message;G===void 0&&(G=D.INTERNAL,J="Unknown error status: "+H+" with message "+M.message),R=!0,C.a_(new x(G,J)),y.close()}else L(Je,`RPC '${e}' stream ${s} received:`,U),C.u_(U)}})),V(u,gh.STAT_EVENT,(k=>{k.stat===Uo.PROXY?L(Je,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Uo.NOPROXY&&L(Je,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{C.__()}),0),C}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Ao(){return typeof document<"u"?document:null}function Mi(n){return new ov(n,!0)}class dd{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&L("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Qu="PersistentStream";class fd{constructor(e,t,r,s,o,a,u,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new dd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Ht(t.toString()),Ht("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new x(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return L(Qu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(L(Qu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class rE extends fd{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=uv(this.serializer,e),r=(function(o){if(!("targetChange"in o))return W.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?W.min():a.readTime?Dt(a.readTime):W.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Qo(this.serializer),t.addTarget=(function(o,a){let u;const h=a.target;if(u=zo(h)?{documents:dv(o,h)}:{query:fv(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=td(o,a.resumeToken);const d=Wo(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(W.min())>0){u.readTime=di(o,a.snapshotVersion.toTimestamp());const d=Wo(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);const r=mv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Qo(this.serializer),t.removeTarget=e,this.q_(t)}}class sE extends fd{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ae(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ae(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ae(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=hv(e.writeResults,e.commitTime),r=Dt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Qo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>lv(this.serializer,r)))};this.q_(t)}}class iE{}class oE extends iE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new x(D.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,Go(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(D.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(e,Go(t,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class aE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ht(t),this.aa=!1):L("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Bn="RemoteStore";class cE{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{zn(this)&&(L(Bn,"Restarting streams for network reachability change."),await(async function(h){const d=Q(h);d.Ea.add(4),await ms(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Li(d)})(this))}))})),this.Ra=new aE(r,s)}}async function Li(n){if(zn(n))for(const e of n.da)await e(!0)}async function ms(n){for(const e of n.da)await e(!1)}function pd(n,e){const t=Q(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Na(t)?Va(t):Er(t).O_()&&Da(t,e))}function ka(n,e){const t=Q(n),r=Er(t);t.Ia.delete(e),r.O_()&&md(t,e),t.Ia.size===0&&(r.O_()?r.L_():zn(t)&&t.Ra.set("Unknown"))}function Da(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Er(n).Y_(e)}function md(n,e){n.Va.Ue(e),Er(n).Z_(e)}function Va(n){n.Va=new nv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Er(n).start(),n.Ra.ua()}function Na(n){return zn(n)&&!Er(n).x_()&&n.Ia.size>0}function zn(n){return Q(n).Ea.size===0}function gd(n){n.Va=void 0}async function uE(n){n.Ra.set("Online")}async function lE(n){n.Ia.forEach(((e,t)=>{Da(n,e)}))}async function hE(n,e){gd(n),Na(n)?(n.Ra.ha(e),Va(n)):n.Ra.set("Unknown")}async function dE(n,e,t){if(n.Ra.set("Online"),e instanceof ed&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,e)}catch(r){L(Bn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await pi(n,r)}else if(e instanceof Ks?n.Va.Ze(e):e instanceof Zh?n.Va.st(e):n.Va.tt(e),!t.isEqual(W.min()))try{const r=await hd(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Qe.EMPTY_BYTE_STRING,p.snapshotVersion)),md(o,h);const y=new un(p.target,h,d,p.sequenceNumber);Da(o,y)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){L(Bn,"Failed to raise snapshot:",r),await pi(n,r)}}async function pi(n,e,t){if(!vr(e))throw e;n.Ea.add(1),await ms(n),n.Ra.set("Offline"),t||(t=()=>hd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{L(Bn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Li(n)}))}function _d(n,e){return e().catch((t=>pi(n,t,e)))}async function xi(n){const e=Q(n),t=vn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ga;for(;fE(e);)try{const s=await Kv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,pE(e,s)}catch(s){await pi(e,s)}yd(e)&&vd(e)}function fE(n){return zn(n)&&n.Ta.length<10}function pE(n,e){n.Ta.push(e);const t=vn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function yd(n){return zn(n)&&!vn(n).x_()&&n.Ta.length>0}function vd(n){vn(n).start()}async function mE(n){vn(n).ra()}async function gE(n){const e=vn(n);for(const t of n.Ta)e.ea(t.mutations)}async function _E(n,e,t){const r=n.Ta.shift(),s=wa.from(r,e,t);await _d(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await xi(n)}async function yE(n,e){e&&vn(n).X_&&await(async function(r,s){if((function(a){return Zy(a)&&a!==D.ABORTED})(s.code)){const o=r.Ta.shift();vn(r).B_(),await _d(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await xi(r)}})(n,e),yd(n)&&vd(n)}async function Yu(n,e){const t=Q(n);t.asyncQueue.verifyOperationInProgress(),L(Bn,"RemoteStore received new credentials");const r=zn(t);t.Ea.add(3),await ms(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Li(t)}async function vE(n,e){const t=Q(n);e?(t.Ea.delete(2),await Li(t)):e||(t.Ea.add(2),await ms(t),t.Ra.set("Unknown"))}function Er(n){return n.ma||(n.ma=(function(t,r,s){const o=Q(t);return o.sa(),new rE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:uE.bind(null,n),t_:lE.bind(null,n),r_:hE.bind(null,n),H_:dE.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Na(n)?Va(n):n.Ra.set("Unknown")):(await n.ma.stop(),gd(n))}))),n.ma}function vn(n){return n.fa||(n.fa=(function(t,r,s){const o=Q(t);return o.sa(),new sE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:mE.bind(null,n),r_:yE.bind(null,n),ta:gE.bind(null,n),na:_E.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await xi(n)):(await n.fa.stop(),n.Ta.length>0&&(L(Bn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Oa{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new qt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new Oa(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ma(n,e){if(Ht("AsyncQueue",`${e}: ${n}`),vr(n))return new x(D.UNAVAILABLE,`${e}: ${n}`);throw n}class or{static emptySet(e){return new or(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||B.comparator(t.key,r.key):(t,r)=>B.comparator(t.key,r.key),this.keyedMap=Br(),this.sortedSet=new ve(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof or)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new or;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Xu{constructor(){this.ga=new ve(B.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class pr{constructor(e,t,r,s,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new pr(e,t,or.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ki(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class EE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class TE{constructor(){this.queries=Ju(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Q(t),o=s.queries;s.queries=Ju(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new x(D.ABORTED,"Firestore shutting down"))}}function Ju(){return new $n((n=>Uh(n)),ki)}async function Ed(n,e){const t=Q(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new EE,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=Ma(a,`Initialization of query '${Jn(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&La(t)}async function Td(n,e){const t=Q(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function IE(n,e){const t=Q(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&La(t)}function wE(n,e,t){const r=Q(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function La(n){n.Ca.forEach((e=>{e.next()}))}var Jo,Zu;(Zu=Jo||(Jo={})).Ma="default",Zu.Cache="cache";class Id{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new pr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Jo.Cache}}class wd{constructor(e){this.key=e}}class Ad{constructor(e){this.key=e}}class AE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=te(),this.mutatedKeys=te(),this.eu=Bh(e),this.tu=new or(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Xu,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,y)=>{const T=s.get(p),R=Di(this.query,y)?y:null,C=!!T&&this.mutatedKeys.has(T.key),V=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let k=!1;T&&R?T.data.isEqual(R.data)?C!==V&&(r.track({type:3,doc:R}),k=!0):this.su(T,R)||(r.track({type:2,doc:R}),k=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!T&&R?(r.track({type:0,doc:R}),k=!0):T&&!R&&(r.track({type:1,doc:T}),k=!0,(h||d)&&(u=!0)),k&&(R?(a=a.add(R),o=V?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,y)=>(function(R,C){const V=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:k})}};return V(R)-V(C)})(p.type,y.type)||this.eu(p.doc,y.doc))),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new pr(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Xu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=te(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Ad(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new wd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=te();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const xa="SyncEngine";class RE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class bE{constructor(e){this.key=e,this.hu=!1}}class SE{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new $n((u=>Uh(u)),ki),this.Iu=new Map,this.Eu=new Set,this.du=new ve(B.comparator),this.Au=new Map,this.Ru=new ba,this.Vu={},this.mu=new Map,this.fu=fr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function CE(n,e,t=!0){const r=kd(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Rd(r,e,t,!0),s}async function PE(n,e){const t=kd(n);await Rd(t,e,!0,!1)}async function Rd(n,e,t,r){const s=await Qv(n.localStore,Pt(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await kE(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&pd(n.remoteStore,s),u}async function kE(n,e,t,r,s){n.pu=(y,T,R)=>(async function(V,k,U,F){let M=k.view.ru(U);M.Cs&&(M=await Hu(V.localStore,k.query,!1).then((({documents:I})=>k.view.ru(I,M))));const H=F&&F.targetChanges.get(k.targetId),G=F&&F.targetMismatches.get(k.targetId)!=null,J=k.view.applyChanges(M,V.isPrimaryClient,H,G);return tl(V,k.targetId,J.au),J.snapshot})(n,y,T,R);const o=await Hu(n.localStore,e,!0),a=new AE(e,o.Qs),u=a.ru(o.documents),h=ps.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);tl(n,t,d.au);const p=new RE(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function DE(n,e,t){const r=Q(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!ki(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Yo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ka(r.remoteStore,s.targetId),Zo(r,s.targetId)})).catch(yr)):(Zo(r,s.targetId),await Yo(r.localStore,s.targetId,!0))}async function VE(n,e){const t=Q(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ka(t.remoteStore,r.targetId))}async function NE(n,e,t){const r=BE(n);try{const s=await(function(a,u){const h=Q(a),d=me.now(),p=u.reduce(((R,C)=>R.add(C.key)),te());let y,T;return h.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let C=Gt(),V=te();return h.Ns.getEntries(R,p).next((k=>{C=k,C.forEach(((U,F)=>{F.isValidDocument()||(V=V.add(U))}))})).next((()=>h.localDocuments.getOverlayedDocuments(R,C))).next((k=>{y=k;const U=[];for(const F of u){const M=Ky(F,y.get(F.key).overlayedDocument);M!=null&&U.push(new An(F.key,M,Vh(M.value.mapValue),kt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,U,u)})).next((k=>{T=k;const U=k.applyToLocalDocumentSet(y,V);return h.documentOverlayCache.saveOverlays(R,k.batchId,U)}))})).then((()=>({batchId:T.batchId,changes:qh(y)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new ve(ee)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await gs(r,s.changes),await xi(r.remoteStore)}catch(s){const o=Ma(s,"Failed to persist write");t.reject(o)}}async function bd(n,e){const t=Q(n);try{const r=await Wv(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(ae(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?ae(a.hu,14607):s.removedDocuments.size>0&&(ae(a.hu,42227),a.hu=!1))})),await gs(t,r,e)}catch(r){await yr(r)}}function el(n,e,t){const r=Q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=Q(a);h.onlineState=u;let d=!1;h.queries.forEach(((p,y)=>{for(const T of y.Sa)T.va(u)&&(d=!0)})),d&&La(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function OE(n,e,t){const r=Q(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new ve(B.comparator);a=a.insert(o,et.newNoDocument(o,W.min()));const u=te().add(o),h=new Oi(W.min(),new Map,new ve(ee),a,u);await bd(r,h),r.du=r.du.remove(o),r.Au.delete(e),Fa(r)}else await Yo(r.localStore,e,!1).then((()=>Zo(r,e,t))).catch(yr)}async function ME(n,e){const t=Q(n),r=e.batch.batchId;try{const s=await Hv(t.localStore,e);Cd(t,r,null),Sd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await gs(t,s)}catch(s){await yr(s)}}async function LE(n,e,t){const r=Q(n);try{const s=await(function(a,u){const h=Q(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next((y=>(ae(y!==null,37113),p=y.keys(),h.mutationQueue.removeMutationBatch(d,y)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);Cd(r,e,t),Sd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await gs(r,s)}catch(s){await yr(s)}}function Sd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Cd(n,e,t){const r=Q(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Zo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||Pd(n,r)}))}function Pd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ka(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Fa(n))}function tl(n,e,t){for(const r of t)r instanceof wd?(n.Ru.addReference(r.key,e),xE(n,r)):r instanceof Ad?(L(xa,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||Pd(n,r.key)):$(19791,{wu:r})}function xE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(L(xa,"New document in limbo: "+t),n.Eu.add(r),Fa(n))}function Fa(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new B(pe.fromString(e)),r=n.fu.next();n.Au.set(r,new bE(t)),n.du=n.du.insert(t,r),pd(n.remoteStore,new un(Pt(Ta(t.path)),r,"TargetPurposeLimboResolution",bi.ce))}}async function gs(n,e,t){const r=Q(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=Ca.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=Q(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(y=>P.forEach(d,(T=>P.forEach(T.Es,(R=>p.persistence.referenceDelegate.addReference(y,T.targetId,R))).next((()=>P.forEach(T.ds,(R=>p.persistence.referenceDelegate.removeReference(y,T.targetId,R)))))))))}catch(y){if(!vr(y))throw y;L(Pa,"Failed to update sequence numbers: "+y)}for(const y of d){const T=y.targetId;if(!y.fromCache){const R=p.Ms.get(T),C=R.snapshotVersion,V=R.withLastLimboFreeSnapshotVersion(C);p.Ms=p.Ms.insert(T,V)}}})(r.localStore,o))}async function FE(n,e){const t=Q(n);if(!t.currentUser.isEqual(e)){L(xa,"User change. New user:",e.toKey());const r=await ld(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new x(D.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await gs(t,r.Ls)}}function UE(n,e){const t=Q(n),r=t.Au.get(e);if(r&&r.hu)return te().add(r.key);{let s=te();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function kd(n){const e=Q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=bd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=UE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OE.bind(null,e),e.Pu.H_=IE.bind(null,e.eventManager),e.Pu.yu=wE.bind(null,e.eventManager),e}function BE(n){const e=Q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ME.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=LE.bind(null,e),e}class mi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Mi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return zv(this.persistence,new jv,e.initialUser,this.serializer)}Cu(e){return new ud(Sa.mi,this.serializer)}Du(e){return new Xv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}mi.provider={build:()=>new mi};class jE extends mi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ae(this.persistence.referenceDelegate instanceof fi,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new bv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ot.withCacheSize(this.cacheSizeBytes):ot.DEFAULT;return new ud((r=>fi.mi(r,t)),this.serializer)}}class ea{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>el(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=FE.bind(null,this.syncEngine),await vE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new TE})()}createDatastore(e){const t=Mi(e.databaseInfo.databaseId),r=(function(o){return new nE(o)})(e.databaseInfo);return(function(o,a,u,h){return new oE(o,a,u,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,u){return new cE(r,s,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>el(this.syncEngine,t,0)),(function(){return Ku.v()?new Ku:new Jv})())}createSyncEngine(e,t){return(function(s,o,a,u,h,d,p){const y=new SE(s,o,a,u,h,d);return p&&(y.gu=!0),y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=Q(t);L(Bn,"RemoteStore shutting down."),r.Ea.add(5),await ms(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}ea.provider={build:()=>new ea};class Dd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ht("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const En="FirestoreClient";class qE{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Ze.UNAUTHENTICATED,this.clientId=pa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{L(En,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(L(En,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ma(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ro(n,e){n.asyncQueue.verifyOperationInProgress(),L(En,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await ld(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function nl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await $E(n);L(En,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Yu(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Yu(e.remoteStore,s))),n._onlineComponents=e}async function $E(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(En,"Using user provided OfflineComponentProvider");try{await Ro(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;ur("Error using user provided cache. Falling back to memory cache: "+t),await Ro(n,new mi)}}else L(En,"Using default OfflineComponentProvider"),await Ro(n,new jE(void 0));return n._offlineComponents}async function Vd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(En,"Using user provided OnlineComponentProvider"),await nl(n,n._uninitializedComponentsProvider._online)):(L(En,"Using default OnlineComponentProvider"),await nl(n,new ea))),n._onlineComponents}function zE(n){return Vd(n).then((e=>e.syncEngine))}async function Nd(n){const e=await Vd(n),t=e.eventManager;return t.onListen=CE.bind(null,e.syncEngine),t.onUnlisten=DE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=PE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=VE.bind(null,e.syncEngine),t}function HE(n,e,t={}){const r=new qt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new Dd({next:T=>{p.Nu(),a.enqueueAndForget((()=>Td(o,y)));const R=T.docs.has(u);!R&&T.fromCache?d.reject(new x(D.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&T.fromCache&&h&&h.source==="server"?d.reject(new x(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(T)},error:T=>d.reject(T)}),y=new Id(Ta(u.path),p,{includeMetadataChanges:!0,qa:!0});return Ed(o,y)})(await Nd(n),n.asyncQueue,e,t,r))),r.promise}function WE(n,e,t={}){const r=new qt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new Dd({next:T=>{p.Nu(),a.enqueueAndForget((()=>Td(o,y))),T.fromCache&&h.source==="server"?d.reject(new x(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(T)},error:T=>d.reject(T)}),y=new Id(u,p,{includeMetadataChanges:!0,qa:!0});return Ed(o,y)})(await Nd(n),n.asyncQueue,e,t,r))),r.promise}function Od(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const rl=new Map;const Md="firestore.googleapis.com",sl=!0;class il{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new x(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Md,this.ssl=sl}else this.host=e.host,this.ssl=e.ssl??sl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=cd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Av)throw new x(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ay("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Od(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new x(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new x(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new x(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Fi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new il({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new il(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new X_;switch(r.type){case"firstParty":return new ty(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=rl.get(t);r&&(L("ComponentProvider","Removing Datastore"),rl.delete(t),r.terminate())})(this),Promise.resolve()}}function GE(n,e,t,r={}){n=Wt(n,Fi);const s=mr(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(Al(`https://${u}`),Rl("Firestore",!0)),o.host!==Md&&o.host!==u&&ur("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Mn(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=Ze.MOCK_USER;else{d=ap(r.mockUserToken,n._app?.options.projectId);const y=r.mockUserToken.sub||r.mockUserToken.user_id;if(!y)throw new x(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Ze(y)}n._authCredentials=new J_(new Eh(d,p))}}class Ui{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ui(this.firestore,e,this._query)}}class Pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pe(this.firestore,e,this._key)}toJSON(){return{type:Pe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ds(t,Pe._jsonSchema))return new Pe(e,r||null,new B(pe.fromString(t.referencePath)))}}Pe._jsonSchemaVersion="firestore/documentReference/1.0",Pe._jsonSchema={type:Ce("string",Pe._jsonSchemaVersion),referencePath:Ce("string")};class pn extends Ui{constructor(e,t,r){super(e,t,Ta(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new B(e))}withConverter(e){return new pn(this.firestore,e,this._path)}}function KE(n,e,...t){if(n=ze(n),Th("collection","path",e),n instanceof Fi){const r=pe.fromString(e,...t);return vu(r),new pn(n,null,r)}{if(!(n instanceof Pe||n instanceof pn))throw new x(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(pe.fromString(e,...t));return vu(r),new pn(n.firestore,null,r)}}function Qs(n,e,...t){if(n=ze(n),arguments.length===1&&(e=pa.newId()),Th("doc","path",e),n instanceof Fi){const r=pe.fromString(e,...t);return yu(r),new Pe(n,null,new B(r))}{if(!(n instanceof Pe||n instanceof pn))throw new x(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(pe.fromString(e,...t));return yu(r),new Pe(n.firestore,n instanceof pn?n.converter:null,new B(r))}}const ol="AsyncQueue";class al{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new dd(this,"async_queue_retry"),this._c=()=>{const r=Ao();r&&L(ol,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Ao();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ao();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new qt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!vr(e))throw e;L(ol,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ht("INTERNAL UNHANDLED ERROR: ",cl(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Oa.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:cl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function cl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class _s extends Fi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new al,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new al(e),this._firestoreClient=void 0,await e}}}function QE(n,e){const t=typeof n=="object"?n:Pl(),r=typeof n=="string"?n:oi,s=sa(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=ip("firestore");o&&GE(s,...o)}return s}function Ua(n){if(n._terminated)throw new x(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||YE(n),n._firestoreClient}function YE(n){const e=n._freezeSettings(),t=(function(s,o,a,u){return new yy(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Od(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new qE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class gt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gt(Qe.fromBase64String(e))}catch(t){throw new x(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new gt(Qe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:gt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ds(e,gt._jsonSchema))return gt.fromBase64String(e.bytes)}}gt._jsonSchemaVersion="firestore/bytes/1.0",gt._jsonSchema={type:Ce("string",gt._jsonSchemaVersion),bytes:Ce("string")};class Bi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ba{constructor(e){this._methodName=e}}class Vt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Vt._jsonSchemaVersion}}static fromJSON(e){if(ds(e,Vt._jsonSchema))return new Vt(e.latitude,e.longitude)}}Vt._jsonSchemaVersion="firestore/geoPoint/1.0",Vt._jsonSchema={type:Ce("string",Vt._jsonSchemaVersion),latitude:Ce("number"),longitude:Ce("number")};class Nt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Nt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ds(e,Nt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Nt(e.vectorValues);throw new x(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Nt._jsonSchemaVersion="firestore/vectorValue/1.0",Nt._jsonSchema={type:Ce("string",Nt._jsonSchemaVersion),vectorValues:Ce("object")};const XE=/^__.*__$/;class JE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new An(e,this.data,this.fieldMask,t,this.fieldTransforms):new fs(e,this.data,t,this.fieldTransforms)}}class Ld{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new An(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function xd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class ja{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new ja({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return gi(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(xd(this.Ac)&&XE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class ZE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Mi(e)}Cc(e,t,r,s=!1){return new ja({Ac:e,methodName:t,Dc:r,path:Ke.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Fd(n){const e=n._freezeSettings(),t=Mi(n._databaseId);return new ZE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eT(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);qa("Data must be an object, but it was:",a,r);const u=Ud(r,a);let h,d;if(o.merge)h=new ht(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const y of o.mergeFields){const T=ta(e,y,t);if(!a.contains(T))throw new x(D.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);jd(p,T)||p.push(T)}h=new ht(p),d=a.fieldTransforms.filter((y=>h.covers(y.field)))}else h=null,d=a.fieldTransforms;return new JE(new at(u),h,d)}class ji extends Ba{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ji}}function tT(n,e,t,r){const s=n.Cc(1,e,t);qa("Data must be an object, but it was:",s,r);const o=[],a=at.empty();wn(r,((h,d)=>{const p=$a(e,h,t);d=ze(d);const y=s.yc(p);if(d instanceof ji)o.push(p);else{const T=qi(d,y);T!=null&&(o.push(p),a.set(p,T))}}));const u=new ht(o);return new Ld(a,u,s.fieldTransforms)}function nT(n,e,t,r,s,o){const a=n.Cc(1,e,t),u=[ta(e,r,t)],h=[s];if(o.length%2!=0)throw new x(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<o.length;T+=2)u.push(ta(e,o[T])),h.push(o[T+1]);const d=[],p=at.empty();for(let T=u.length-1;T>=0;--T)if(!jd(d,u[T])){const R=u[T];let C=h[T];C=ze(C);const V=a.yc(R);if(C instanceof ji)d.push(R);else{const k=qi(C,V);k!=null&&(d.push(R),p.set(R,k))}}const y=new ht(d);return new Ld(p,y,a.fieldTransforms)}function qi(n,e){if(Bd(n=ze(n)))return qa("Unsupported field value:",e,n),Ud(n,e);if(n instanceof Ba)return(function(r,s){if(!xd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=qi(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=ze(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return qy(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=me.fromDate(r);return{timestampValue:di(s.serializer,o)}}if(r instanceof me){const o=new me(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:di(s.serializer,o)}}if(r instanceof Vt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof gt)return{bytesValue:td(s.serializer,r._byteString)};if(r instanceof Pe){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ra(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Nt)return(function(a,u){return{mapValue:{fields:{[kh]:{stringValue:Dh},[ai]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return Ia(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${ma(r)}`)})(n,e)}function Ud(n,e){const t={};return Ah(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wn(n,((r,s)=>{const o=qi(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function Bd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof me||n instanceof Vt||n instanceof gt||n instanceof Pe||n instanceof Ba||n instanceof Nt)}function qa(n,e,t){if(!Bd(t)||!Ih(t)){const r=ma(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function ta(n,e,t){if((e=ze(e))instanceof Bi)return e._internalPath;if(typeof e=="string")return $a(n,e);throw gi("Field path arguments must be of type string or ",n,!1,void 0,t)}const rT=new RegExp("[~\\*/\\[\\]]");function $a(n,e,t){if(e.search(rT)>=0)throw gi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Bi(...e.split("."))._internalPath}catch{throw gi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function gi(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new x(D.INVALID_ARGUMENT,u+n+h)}function jd(n,e){return n.some((t=>t.isEqual(e)))}class qd{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new sT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($d("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class sT extends qd{data(){return super.data()}}function $d(n,e){return typeof e=="string"?$a(n,e):e instanceof Bi?e._internalPath:e._delegate._internalPath}function iT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oT{convertValue(e,t="none"){switch(yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return wn(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[ai].arrayValue?.values?.map((r=>we(r.doubleValue)));return new Nt(t)}convertGeoPoint(e){return new Vt(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ci(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ts(e));default:return null}}convertTimestamp(e){const t=gn(e);return new me(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=pe.fromString(e);ae(ad(r),9688,{name:e});const s=new ns(r.get(1),r.get(3)),o=new B(r.popFirst(5));return s.isEqual(t)||Ht(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function aT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class qr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class On extends qd{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ys(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field($d("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=On._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}On._jsonSchemaVersion="firestore/documentSnapshot/1.0",On._jsonSchema={type:Ce("string",On._jsonSchemaVersion),bundleSource:Ce("string","DocumentSnapshot"),bundleName:Ce("string"),bundle:Ce("string")};class Ys extends On{data(e={}){return super.data(e)}}class ar{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new qr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ys(this._firestore,this._userDataWriter,r.key,r,new qr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new Ys(s._firestore,s._userDataWriter,u.doc.key,u.doc,new qr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new Ys(s._firestore,s._userDataWriter,u.doc.key,u.doc,new qr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:cT(u.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ar._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=pa.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function cT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}function uT(n){n=Wt(n,Pe);const e=Wt(n.firestore,_s);return HE(Ua(e),n._key).then((t=>dT(e,n,t)))}ar._jsonSchemaVersion="firestore/querySnapshot/1.0",ar._jsonSchema={type:Ce("string",ar._jsonSchemaVersion),bundleSource:Ce("string","QuerySnapshot"),bundleName:Ce("string"),bundle:Ce("string")};class zd extends oT{constructor(e){super(),this.firestore=e}convertBytes(e){return new gt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}}function lT(n){n=Wt(n,Ui);const e=Wt(n.firestore,_s),t=Ua(e),r=new zd(e);return iT(n._query),WE(t,n._query).then((s=>new ar(e,r,n,s)))}function _i(n,e,t){n=Wt(n,Pe);const r=Wt(n.firestore,_s),s=aT(n.converter,e,t);return Hd(r,[eT(Fd(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,kt.none())])}function hT(n,e,t,...r){n=Wt(n,Pe);const s=Wt(n.firestore,_s),o=Fd(s);let a;return a=typeof(e=ze(e))=="string"||e instanceof Bi?nT(o,"updateDoc",n._key,e,t,r):tT(o,"updateDoc",n._key,e),Hd(s,[a.toMutation(n._key,kt.exists(!0))])}function Hd(n,e){return(function(r,s){const o=new qt;return r.asyncQueue.enqueueAndForget((async()=>NE(await zE(r),s,o))),o.promise})(Ua(n),e)}function dT(n,e,t){const r=t.docs.get(e._key),s=new zd(n);return new On(n,s,e._key,r,new qr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){_r=s})(gr),cr(new Ln("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new _s(new Z_(r.getProvider("auth-internal")),new ny(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ns(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),dn(pu,mu,e),dn(pu,mu,"esm2020")})();const fT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},Wd=Cl(fT),yi=Q_(Wd),Yr=QE(Wd),Lt=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var pT=_e(`<div class="login"><br/> <h2>The Good Calendar</h2> <p style="text-align: center; margin-top: 0px">Here, you can log the quality of your days and nights for posterity. Dedicated to my girlfriend and her chronic migranes.</p> <div style="top: 3rem; position:relative"><div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem;"><input type="text" placeholder="Username" class="login_input" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input" style="width: 200px;"/> <button style="
            position: absolute;
            right: -45px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 10%;
            font-size: 0.75rem;
            padding: 0.1rem 0.25rem;
            white-space: nowrap;
          "> </button></div></div></div> <div style="top: 3rem; position:relative"><div style="align-items: center"><button>Login</button> <button>Sign up</button></div></div> <div style="top: 3rem; position:relative"><!></div></div>`);function mT(n,e){Ei(e,!1),qf();let t=oe(""),r=oe(""),s=oe(""),o=oe(!0);async function a(){N(s,"");try{const g=`${A(t)}@tracker.app`,w=await Ng(yi,g,A(r))}catch(g){console.error(g),N(s,g.message)}}async function u(){N(s,"");try{const g=`${A(t)}@tracker.app`,w=await Og(yi,g,A(r))}catch(g){console.error(g),N(s,g.message)}}function h(g){switch(g){case"Firebase: Error (auth/invalid-credential).":return"Incorrect password or the account doesn't exist";case"Firebase: Missing password requirements: [Password must contain at least 6 characters] (auth/password-does-not-meet-requirements).":return"Password must contain at least 6 characters";case"Firebase: Error (auth/email-already-in-use).":return"This account already exists.";case"Firebase: Error (auth/invalid-email).":return"Your username cannot have any spaces";case"Firebase: Error (auth/missing-password).":return"Missing password";default:return g}}vi();var d=pT(),p=j(K(d),2),y=j(p,4),T=K(y),R=K(T);nr(R);var C=j(R,2),V=K(C);nr(V);var k=j(V,2),U=K(k,!0);z(k),z(C),z(T),z(y);var F=j(y,2),M=K(F),H=K(M),G=j(H,2);z(M),z(F);var J=j(F,2),I=K(J);{var _=g=>{var w=bo();Oe(v=>$e(w,v),[()=>h(A(s))]),ie(g,w)};Se(I,g=>{A(s)&&g(_)})}z(J),z(d),Oe(()=>{Bt(p,`background: url(${Lt}); no-repeat; background-size: cover; 
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),Co(V,"type",A(o)?"password":"text"),$e(U,A(o)?"show":"hide")}),Nn(R,()=>A(t),g=>N(t,g)),Nn(V,()=>A(r),g=>N(r,g)),ye("click",k,()=>N(o,!A(o))),ye("click",H,u),ye("click",G,a),ie(n,d),Ti()}var gT=_e("<h3>Entry logged!</h3>"),_T=_e('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),yT=_e('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Come back tomorrow!</h4>',1),vT=_e('<div class="overlay"><!> <button>Return</button></div>'),ET=_e('<br/> <div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3></div>',1),TT=_e('<div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..."></textarea><br/> <button> </button></div>'),IT=_e('<!> <button class="hiddencheck svelte-kkv8mu"></button>',1);function wT(n,e){Ei(e,!1);let t=bt(e,"user",8),r=bt(e,"externalEntry",8,null),s=bt(e,"onSaved",8,()=>{}),o=bt(e,"invert",8),a=bt(e,"selectedCalendar",8),u=new Date;const h=u.getFullYear(),d=u.getMonth(),p=u.getDate();function y(m){return m.toString().padStart(2,"0")}let T=t().uid;t().email?name=t().email.replace("@tracker.app","").charAt(0).toUpperCase()+t().email.replace("@tracker.app","").slice(1):name="Temp",`${h}${y(d+1)}${y(p)}`;let R=oe(5),C=oe(""),V=oe(!1),k=oe(""),U=oe(!1),F=oe(""),M=oe(""),H=oe(!1);function G(m){return o()&&(m=10-m),`hsl(${120*(m/10)}, 70%, 65%)`}function J(){return A(R)/10}async function I(m){if(A(V)&&!A(H))return;N(U,!0);const Y=Qs(Yr,"users",T,a(),m.key);m.period==="day"?(await _i(Y,{valueDay:A(R),textDay:A(C),timestamp:Date.now()},{merge:!0}),m.filledNight&&N(M,"Come back tomorrow!")):(await _i(Y,{valueNight:A(R),textNight:A(C),timestamp:Date.now()},{merge:!0}),m.filledDay&&N(M,"Come back tomorrow!")),console.log("Logged "+m.key+" at "+m.period),N(R,5),N(C,""),s()()}function _(){N(U,!1)}$r(()=>pt(r()),()=>{if(r()){let m=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&m?N(V,!0):!r().current&&!m?N(V,!0):r().current&&(N(V,!1),N(C,r().period==="day"?r().textDay:r().textNight),N(R,(r().period==="day"?r().valueDay:r().valueNight)||5))}}),$r(()=>(pt(o()),A(R)),()=>{o()?N(k,A(R)<=0?"celebrate":""):N(k,A(R)>=10?"celebrate":"")}),$r(()=>(pt(o()),A(R)),()=>{(o()||A(R))&&N(F,G(A(R)))}),fl(),vi();var g=IT(),w=xt(g);{var v=m=>{var Y=Us(),re=xt(Y);{var Ye=ce=>{var he=vT(),ke=K(he);{var it=ne=>{var le=gT();ie(ne,le)},ge=ne=>{var le=Us(),de=xt(le);{var xe=Xe=>{var dt=_T();Mc(2),ie(Xe,dt)},Te=Xe=>{var dt=yT();Mc(2),ie(Xe,dt)};Se(de,Xe=>{pt(r()),Ie(()=>r().period==="night"&&!r().filledDay)?Xe(xe):Xe(Te,!1)},!0)}ie(ne,le)};Se(ke,ne=>{pt(r()),Ie(()=>r().period==="day"&&!r().filledNight)?ne(it):ne(ge,!1)})}var Ae=j(ke,2);Ae.__click=_,z(he),ie(ce,he)},ct=ce=>{var he=Us(),ke=xt(he);{var it=Ae=>{var ne=ET(),le=j(xt(ne),2),de=K(le);de.textContent=`Welcome ${name??""}!`;var xe=j(de,2),Te=K(xe,!0);z(xe),z(le),Oe(()=>{Bt(de,`background: url(${Lt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),$e(Te,A(M)||"Viewing past entries")}),ie(Ae,ne)},ge=Ae=>{var ne=TT(),le=K(ne);le.textContent=`Welcome ${name??""}!`;var de=j(le,2),xe=K(de);z(de);var Te=j(de,2);nr(Te);var Xe=j(Te,2);Bf(Xe);var dt=j(Xe,3);dt.__click=()=>I(r());var Hn=K(dt);z(dt),z(ne),Oe((Tt,Qt)=>{Bt(le,`background: url(${Lt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),$e(xe,`Rate your ${pt(r()),Ie(()=>r().period==="day"?"day":"night")??""}`),Te.disabled=A(V)&&!A(H),Yf(Te,1,Gf(A(k)),"svelte-kkv8mu"),Bt(Te,`--fill-percentage: ${Tt??""}%; --slider-color: ${A(F)??""}`),dt.disabled=A(V)&&!A(H),$e(Hn,`Save (${Qt??""}/10)`)},[()=>Ie(J),()=>(A(R),Ie(()=>A(R).toFixed(1)))]),Nn(Te,()=>A(R),Tt=>N(R,Tt)),Nn(Xe,()=>A(C),Tt=>N(C,Tt)),ie(Ae,ne)};Se(ke,Ae=>{A(V)&&!A(H)?Ae(it):Ae(ge,!1)})}ie(ce,he)};Se(re,ce=>{A(U)?ce(Ye):ce(ct,!1)})}ie(m,Y)};Se(w,m=>{r()&&m(v)})}var E=j(w,2);E.__dblclick=()=>{console.log("Activated override!"),N(H,!A(H))},ie(n,g),Ti()}jf(["click","dblclick"]);var AT=_e('<div class="day svelte-dw9jm0"><div class="day-number svelte-dw9jm0"> </div> <div class="day-half top-half svelte-dw9jm0"></div> <div class="day-half bottom-half svelte-dw9jm0"></div></div>'),RT=_e("<!> <br/> <i> </i>",1),bT=_e("<!> <br/> <i> </i>",1),ST=_e('<div class="entry-info svelte-dw9jm0"><strong> </strong> <!></div>'),CT=_e('<div class="month-nav svelte-dw9jm0"><button class="nav-btn svelte-dw9jm0" aria-label="Previous month"></button> <p> </p> <button class="nav-btn svelte-dw9jm0" aria-label="Next month"></button></div> <div class="calendar svelte-dw9jm0"></div> <!>',1);function PT(n,e){Ei(e,!1);let t=bt(e,"user",8),r=bt(e,"onSelectEntry",8,v=>{}),s=bt(e,"reloadTrigger",8,0),o=bt(e,"invert",8),a=bt(e,"selectedCalendar",8),u=t().uid,h=oe([]),d=oe(null),p=oe(new Date),y=oe("");function T(v){return v==null?"#fff":`hsl(${120*(v/10)}, 70%, 65%)`}function R(v){return v.toString().padStart(2,"0")}async function C(){console.log("Loaded calendar entries");const v=A(p).getFullYear(),E=A(p).getMonth(),Y=new Date().getHours()<16?"day":"night",re=new Date,Ye=new Date(v,E+1,0).getDate();N(y,A(p).toLocaleString("default",{month:"long",year:"numeric"}));const ct=KE(Yr,"users",u,a()),ce=await lT(ct),he={};ce.forEach(ge=>{he[ge.id]=ge.data()});const ke=[],it=v===re.getFullYear()&&E===re.getMonth()?re.getDate():Ye;for(let ge=1;ge<=it;ge++){const Ae=`${v}-${R(E+1)}-${R(ge)}`,ne=he[Ae],le=v===re.getFullYear()&&E===re.getMonth()&&ge===re.getDate(),de={key:Ae,day:ge,filledDay:ne?.valueDay!=null,filledNight:ne?.valueNight!=null,valueDay:ne?.valueDay??null,valueNight:ne?.valueNight??null,textDay:ne?.textDay??null,textNight:ne?.textNight??null,current:le};le&&A(d)===null&&(de.period=Y,V(de)),ke.push(de)}N(h,ke)}function V(v){N(d,v),r()(v),console.log("Selected "+v.key)}function k(){const v=new Date(A(p));v.setMonth(v.getMonth()-1),N(p,v),C(),N(d,null)}function U(){const v=new Date,E=new Date(A(p));E.setMonth(E.getMonth()+1),!(E.getFullYear()>v.getFullYear()||E.getFullYear()===v.getFullYear()&&E.getMonth()>v.getMonth())&&(N(p,E),C(),N(d,null))}$f(C),$r(()=>pt(s()),()=>{s()&&C()}),$r(()=>pt(a()),()=>{a()&&(C(),N(d,null))}),fl(),vi();var F=CT(),M=xt(F),H=K(M),G=j(H,2),J=K(G,!0);z(G);var I=j(G,2);z(M);var _=j(M,2);ml(_,5,()=>A(h),pl,(v,E)=>{var m=AT(),Y=K(m),re=K(Y,!0);z(Y);var Ye=j(Y,2),ct=j(Ye,2);z(m),Oe((ce,he)=>{Bt(m,(A(E),A(d),Ie(()=>(A(E).current?"border: 1.5px solid #6E6E6E;":"")+(A(d)!=null&&A(d).key===A(E).key&&A(d).period==="day"?"border-top: 2.5px solid #6BCBFF;":A(d)!=null&&A(d).key===A(E).key?"border-bottom: 2.5px solid #0077BA;":"")))),$e(re,(A(E),Ie(()=>A(E).day))),Bt(Ye,ce),Bt(ct,he)},[()=>(pt(o()),A(E),pt(Lt),Ie(()=>!o()&&A(E).valueDay==10?`background: url('${Lt}'); background-size: cover;`:o()&&A(E).valueDay==0?`background: url('${Lt}'); background-size: cover;`:`background-color: ${T(A(E).valueDay!=null&&!o()?A(E).valueDay:A(E).valueDay!=null?10-A(E).valueDay:null)};`)),()=>(pt(o()),A(E),pt(Lt),Ie(()=>!o()&&A(E).valueNight==10?`background: url('${Lt}'); background-size: cover;`:o()&&A(E).valueNight==0?`background: url('${Lt}'); background-size: cover;`:`background-color: ${T(A(E).valueNight!=null&&!o()?A(E).valueNight:A(E).valueNight!=null?10-A(E).valueNight:null)};`))]),ye("click",Ye,()=>V({...A(E),period:"day"})),ye("click",ct,()=>V({...A(E),period:"night"})),ie(v,m)}),z(_);var g=j(_,2);{var w=v=>{var E=ST(),m=K(E),Y=K(m);z(m);var re=j(m,2);{var Ye=ce=>{var he=RT(),ke=xt(he);{var it=ne=>{var le=bo();Oe(()=>$e(le,` ${A(d),Ie(()=>A(d).valueDay)??""}/10`)),ie(ne,le)};Se(ke,ne=>{A(d),Ie(()=>A(d).filledDay)&&ne(it)})}var ge=j(ke,4),Ae=K(ge,!0);z(ge),Oe(()=>$e(Ae,(A(d),Ie(()=>A(d).textDay||"No Entry")))),ie(ce,he)},ct=ce=>{var he=bT(),ke=xt(he);{var it=ne=>{var le=bo();Oe(()=>$e(le,` ${A(d),Ie(()=>A(d).valueNight)??""}/10`)),ie(ne,le)};Se(ke,ne=>{A(d),Ie(()=>A(d).filledNight)&&ne(it)})}var ge=j(ke,4),Ae=K(ge,!0);z(ge),Oe(()=>$e(Ae,(A(d),Ie(()=>A(d).textNight||"No Entry")))),ie(ce,he)};Se(re,ce=>{A(d),Ie(()=>A(d).period==="day")?ce(Ye):ce(ct,!1)})}z(E),Oe(ce=>$e(Y,`${ce??""} ${A(d),Ie(()=>A(d).period==="day"?"Day":"Night")??""}`),[()=>(A(d),Ie(()=>new Date(new Date(A(d).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),ie(v,E)};Se(g,v=>{A(d),Ie(()=>A(d)&&!(A(d).period==="day"&&!A(d).filledDay&&A(d).current||A(d).period==="night"&&!A(d).filledNight&&A(d).current))&&v(w)})}Oe(v=>{$e(J,A(y)),I.disabled=v},[()=>(A(p),Ie(()=>A(p).getFullYear()===new Date().getFullYear()&&A(p).getMonth()===new Date().getMonth()))]),ye("click",H,k),ye("click",I,U),ie(n,F),Ti()}const kT="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20352%20512'%3e%3c!--!Font%20Awesome%20Free%205.15.4%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202025%20Fonticons,%20Inc.--%3e%3cpath%20d='M176%2080c-52.94%200-96%2043.06-96%2096%200%208.84%207.16%2016%2016%2016s16-7.16%2016-16c0-35.3%2028.72-64%2064-64%208.84%200%2016-7.16%2016-16s-7.16-16-16-16zM96.06%20459.17c0%203.15.93%206.22%202.68%208.84l24.51%2036.84c2.97%204.46%207.97%207.14%2013.32%207.14h78.85c5.36%200%2010.36-2.68%2013.32-7.14l24.51-36.84c1.74-2.62%202.67-5.7%202.68-8.84l.05-43.18H96.02l.04%2043.18zM176%200C73.72%200%200%2082.97%200%20176c0%2044.37%2016.45%2084.85%2043.56%20115.78%2016.64%2018.99%2042.74%2058.8%2052.42%2092.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64%2059.67-128%20127.95-128%2070.58%200%20128%2057.42%20128%20128%200%2030.97-11.24%2060.85-31.65%2084.14-39.11%2044.61-56.42%2091.47-62.1%20109.46a47.507%2047.507%200%200%200-2.22%2014.3v.1h48v-.05c9.68-33.37%2035.78-73.18%2052.42-92.16C335.55%20260.85%20352%20220.37%20352%20176%20352%2078.8%20273.2%200%20176%200z'/%3e%3c/svg%3e";var DT=_e("<button> </button>"),VT=_e('<div class="overlay"><span></span><br/><br/> <span style="margin-bottom: .5rem; flex-wrap: wrap; gap:.5rem;display: flex;"><button>Rename</button> <button>Delete</button> <button>New</button></span> <button>Back</button></div>'),NT=_e("<p> </p>"),OT=_e('<div class="overlay"><input type="text" class="login_input"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),MT=_e("<p> </p>"),LT=_e('<div class="overlay"><h3 style="margin-bottom: 0;"> </h3> <p><i>This action cannot be undone.</i></p><br/><br/> <input type="password" class="login_input" placeholder="Re-enter Password"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),xT=_e("<p> </p>"),FT=_e('<div class="overlay"><input type="text" class="login_input" placeholder="New Calendar"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),UT=_e('<div style="order: 1; flex-wrap: wrap; gap:.5rem;display: flex"><button style="padding: .4rem inherit; border: 2px dashed #339FFF;"><b> </b></button> <!> <!> <!> <!> <button>Invert</button></div>'),BT=_e('<div class="overlay"><div style="width: 65%; text-align:left">Welcome! <br/><br/> <span>Click on the <b>top half</b> of the current date to log an entry for today. Click on the <b>bottom half</b> to log an entry for tonight. You can save a rating (0-10) and, optionally, some text. Entries may be edited only on the current date. <br/><br/>To make a new calendar, click on <b>[current calendar]</b> in the bottom-left corner. You may add, delete, rename, and toggle between calendars to your liking. To reverse the red-green color scheme, click <b>Invert.</b> Your preferences will be saved for the next time you login!</span></div> <br/><br/> <button>Return</button></div>'),jT=_e(`<div style="display: flex;
  flex-direction: column;
  min-height: 100vh;"><div style="flex-grow: 1;"><!> <!></div> <div style="display: flex;
    justify-content: space-between;
    gap: .5rem;
    flex-wrap: wrap;
    padding-left: 5%;
    padding-right: 5%;
    margin-bottom: 5%;"><div style="order: 2; flex-wrap: wrap; gap:.5rem;display: flex"><button>Log Out</button> <button style="padding: .4rem inherit;"><img width="12px" style="transform: translateY(15%);"/></button></div> <!> <!></div></div>`);function XT(n,e){Ei(e,!1);let t=oe(null),r=oe(null),s=oe(0),o=oe(null),a=oe(!1),u=oe(null),h=oe(null),d=oe(""),p=oe(""),y=oe(""),T=oe(""),R=oe(""),C=oe(!1);xg(yi,E=>{I(E),N(t,E)});async function V(){if(!A(t))return;N(o,!A(o));const E=Qs(Yr,"users",A(t).uid);await _i(E,{colorPreference:A(o),timestamp:Date.now()},{merge:!0}),console.log("Saved user profile invert="+A(o))}function k(){A(p)===""?N(R,"New name cannot be empty!"):Object.values(A(u)).includes(A(p))?N(R,"New name cannot be a duplicate!"):(Vs(u,A(u)[A(h)]=A(p)),M(),N(p,""),N(R,""),N(y,""))}function U(){Vg(A(t),qn.credential(A(t).email,A(T))).then(()=>{Object.keys(A(u)).length===1?(N(R,"You cannot delete your last calendar!"),N(T,"")):(delete A(u)[A(h)],N(u,{...A(u)}),N(h,Object.keys(A(u)).sort()[0]),M(),N(T,""),N(R,""),N(y,""))}).catch(E=>{N(R,"Incorrect password!")})}function F(){if(A(d)==="")N(R,"New name cannot be empty!");else if(Object.values(A(u)).includes(A(d)))N(R,"New name cannot be a duplicate!");else{const E=Date.now().toString();Vs(u,A(u)[E]=A(d)),N(u,{...A(u)}),N(h,E),M(),N(R,""),N(d,""),N(y,"")}}async function M(){if(!A(t))return;const E=Date.now(),m=Qs(Yr,"users",A(t).uid),Y=A(t).email?A(t).email.replace("@tracker.app",""):"anonymous"+E.toString();m.calendars?await hT(m,{calendars:A(u),selectedCalendar:A(h),timestamp:E}):await _i(m,{calendars:A(u),selectedCalendar:A(h),name:Y,timestamp:E}),console.log("Saved calendars to database")}function H(){N(s,A(s)+1)}function G(){Fg(yi),N(t,null),N(r,null)}function J(E){N(r,E)}async function I(E){if(!E)return;const m=Qs(Yr,"users",E.uid),Y=await uT(m);if(Y.exists()){const re=Y.data();if(re.calendars)N(u,re.calendars),N(h,re.selectedCalendar),console.log("Loaded user calendars");else{N(u,{});const Ye=Date.now().toString();Vs(u,A(u)[Ye]="Calendar 1"),N(h,Ye),await M(),console.log("Initialized user calendars")}re.colorPreference?(N(o,re.colorPreference),console.log("Loaded user invert="+A(o))):(N(o,!1),console.log("Initialized user invert="+A(o)))}else{N(o,!1),N(u,{});const re=Date.now().toString();Vs(u,A(u)[re]="Calendar 1"),N(h,re),await M(),console.log("New user.")}}vi();var _=Us(),g=xt(_);{var w=E=>{mT(E,{})},v=E=>{var m=jT(),Y=K(m),re=K(Y);wT(re,{get user(){return A(t)},get externalEntry(){return A(r)},onSaved:H,get invert(){return A(o)},get selectedCalendar(){return A(h)}});var Ye=j(re,2);PT(Ye,{get user(){return A(t)},onSelectEntry:J,get reloadTrigger(){return A(s)},get invert(){return A(o)},get selectedCalendar(){return A(h)}}),z(Y);var ct=j(Y,2),ce=K(ct),he=K(ce),ke=j(he,2),it=K(ke);z(ke),z(ce);var ge=j(ce,2);{var Ae=de=>{var xe=UT(),Te=K(xe),Xe=K(Te),dt=K(Xe,!0);z(Xe),z(Te);var Hn=j(Te,2);{var Tt=Re=>{var He=VT(),Ve=K(He);ml(Ve,5,()=>Object.keys(A(u)).sort(),pl,(We,rt)=>{var Be=DT(),Yt=K(Be,!0);z(Be),Oe(()=>{Bt(Be,(A(h)===A(rt)?"border: 2px dashed #339FFF;":"border: 2px dashed #ccc;")+"margin: .5rem; font-size: 1.1rem"),$e(Yt,A(u)[A(rt)])}),ye("click",Be,()=>{N(h,A(rt)),M()}),ie(We,Be)}),z(Ve);var nt=j(Ve,4),Ue=K(nt),ut=j(Ue,2),_t=j(ut,2);z(nt);var yt=j(nt,2);z(He),ye("click",Ue,()=>{N(y,"rename")}),ye("click",ut,()=>{N(y,"delete")}),ye("click",_t,()=>{N(y,"new")}),ye("click",yt,()=>{N(C,!A(C))}),ie(Re,He)};Se(Hn,Re=>{A(C)&&Re(Tt)})}var Qt=j(Hn,2);{var ys=Re=>{var He=OT(),Ve=K(He);nr(Ve);var nt=j(Ve,3),Ue=K(nt),ut=j(Ue,2);z(nt);var _t=j(nt,2);{var yt=We=>{var rt=NT(),Be=K(rt,!0);z(rt),Oe(()=>$e(Be,A(R))),ie(We,rt)};Se(_t,We=>{A(R)!=""&&We(yt)})}z(He),Oe(()=>Co(Ve,"placeholder",`Renaming ${A(u)[A(h)]??""}`)),Nn(Ve,()=>A(p),We=>N(p,We)),ye("click",Ue,()=>{N(y,""),N(p,"")}),ye("click",ut,k),ie(Re,He)};Se(Qt,Re=>{A(y)==="rename"&&Re(ys)})}var vs=j(Qt,2);{var Tr=Re=>{var He=LT(),Ve=K(He),nt=K(Ve);z(Ve);var Ue=j(Ve,6);nr(Ue);var ut=j(Ue,3),_t=K(ut),yt=j(_t,2);z(ut);var We=j(ut,2);{var rt=Be=>{var Yt=MT(),Rn=K(Yt,!0);z(Yt),Oe(()=>$e(Rn,A(R))),ie(Be,Yt)};Se(We,Be=>{A(R)!=""&&Be(rt)})}z(He),Oe(()=>$e(nt,`Delete ${A(u)[A(h)]??""}?`)),Nn(Ue,()=>A(T),Be=>N(T,Be)),ye("click",_t,()=>{N(y,""),N(T,""),N(R,"")}),ye("click",yt,U),ie(Re,He)};Se(vs,Re=>{A(y)==="delete"&&Re(Tr)})}var Wn=j(vs,2);{var Es=Re=>{var He=FT(),Ve=K(He);nr(Ve);var nt=j(Ve,3),Ue=K(nt),ut=j(Ue,2);z(nt);var _t=j(nt,2);{var yt=We=>{var rt=xT(),Be=K(rt,!0);z(rt),Oe(()=>$e(Be,A(R))),ie(We,rt)};Se(_t,We=>{A(R)!=""&&We(yt)})}z(He),Nn(Ve,()=>A(d),We=>N(d,We)),ye("click",Ue,()=>{N(y,""),N(d,""),N(R,"")}),ye("click",ut,F),ie(Re,He)};Se(Wn,Re=>{A(y)==="new"&&Re(Es)})}var De=j(Wn,2);let Fe;z(xe),Oe(()=>{$e(dt,A(u)[A(h)]),Fe=Bt(De,"",Fe,{"background-color":A(o)?"hsl(0, 70%, 65%)":"hsl(120, 70%, 65%)"})}),ye("click",Te,()=>{N(C,!A(C))}),ye("click",De,V),ie(de,xe)};Se(ge,de=>{A(o)!=null&&de(Ae)})}var ne=j(ge,2);{var le=de=>{var xe=BT(),Te=j(K(xe),5);z(xe),ye("click",Te,()=>{N(a,!A(a))}),ie(de,xe)};Se(ne,de=>{A(a)&&de(le)})}z(ct),z(m),Oe(()=>Co(it,"src",kT)),ye("click",he,G),ye("click",ke,()=>{N(a,!A(a))}),ie(E,m)};Se(g,E=>{!A(t)||!A(h)?E(w):E(v,!1)})}ie(n,_),Ti()}export{XT as component};
