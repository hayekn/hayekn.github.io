import{f as he,a as se,t as Co,c as Hs}from"../chunks/DciB1r6Z.js";import{i as bi}from"../chunks/B7t73ZGp.js";import{P as lo,h as gt,a4 as wf,e as dl,I as Af,H as bf,t as w,U as Rf,K as Sf,M as Pf,O as Oc,Q as ho,i as Fr,aa as Cf,aF as kf,f as ko,s as Vf,c as Qn,aD as fl,z as Df,aI as ie,af as Mc,ao as Nf,r as pl,p as Of,aM as Mf,aN as fo,d as ml,aO as xf,aP as Lf,ab as Ff,aQ as Uf,aC as Bf,aR as jf,Y as gl,J as qf,aS as $f,aT as zf,ac as Hf,l as _e,aU as Wf,aV as Gf,aW as Kf,ax as _l,aX as Qf,q as Yf,aY as Ur,aZ as Xf,aK as Jf,ag as Zf,a_ as ep,A as Ri,G as $,E as Q,F as K,C as je,D as Si,W as N,a$ as Wr,b0 as yl,B as Ut,v as _t,b1 as tp,ap as xc,b2 as Ls}from"../chunks/CsOjD_qM.js";import{a as np,s as qe,e as le,d as rp}from"../chunks/GM-0-aUY.js";import{p as It,i as Te}from"../chunks/DsdCtteZ.js";import{r as tr,s as vl}from"../chunks/DlkKuvoK.js";import{c as sp,o as ip}from"../chunks/D-101bnd.js";import"../chunks/8UtF8RsF.js";function El(n,e){return e}function op(n,e,t){for(var r=n.items,s=[],o=e.length,a=0;a<o;a++)Uf(e[a].e,s,!0);var u=o>0&&s.length===0&&t!==null;if(u){var h=t.parentNode;Bf(h),h.append(t),r.clear(),Pt(n,e[0].prev,e[o-1].next)}jf(s,()=>{for(var d=0;d<o;d++){var p=e[d];u||(r.delete(p.k),Pt(n,p.prev,p.next)),ml(p.e,!u)}})}function Tl(n,e,t,r,s,o=null){var a=n,u={flags:e,items:new Map,first:null};{var h=n;a=gt?lo(wf(h)):h.appendChild(dl())}gt&&Af();var d=null,p=!1,y=new Map,v=Rf(()=>{var C=t();return Df(C)?C:C==null?[]:fl(C)}),b,P;function k(){ap(P,b,u,y,a,s,e,r,t),o!==null&&(b.length===0?d?pl(d):d=ko(()=>o(a)):d!==null&&Of(d,()=>{d=null}))}bf(()=>{P??=gl,b=w(v);var C=b.length;if(p&&C===0)return;p=C===0;let F=!1;if(gt){var M=Sf(a)===Pf;M!==(C===0)&&(a=Oc(),lo(a),ho(!1),F=!0)}if(gt){for(var x=null,G,q=0;q<C;q++){if(Fr.nodeType===Cf&&Fr.data===kf){a=Fr,F=!0,ho(!1);break}var J=b[q],I=r(J,q);G=Vo(Fr,u,x,null,J,I,q,s,e,t),u.items.set(I,G),x=G}C>0&&lo(Oc())}if(gt)C===0&&o&&(d=ko(()=>o(a)));else if(Vf()){var g=new Set,m=Qn;for(q=0;q<C;q+=1){J=b[q],I=r(J,q);var T=u.items.get(I)??y.get(I);T?Il(T,J,q):(G=Vo(null,u,null,null,J,I,q,s,e,t,!0),y.set(I,G)),g.add(I)}for(const[E,A]of u.items)g.has(E)||m.skipped_effects.add(A.e);m.oncommit(k)}else k();F&&ho(!0),w(v)}),gt&&(a=Fr)}function ap(n,e,t,r,s,o,a,u,h){var d=e.length,p=t.items,y=t.first,v=y,b,P=null,k=[],C=[],F,M,x,G;for(G=0;G<d;G+=1){if(F=e[G],M=u(F,G),x=p.get(M),x===void 0){var q=r.get(M);if(q!==void 0){r.delete(M),p.set(M,q);var J=P?P.next:v;Pt(t,P,q),Pt(t,q,J),po(q,J,s),P=q}else{var I=v?v.e.nodes_start:s;P=Vo(I,t,P,P===null?t.first:P.next,F,M,G,o,a,h)}p.set(M,P),k=[],C=[],v=P.next;continue}if(Il(x,F,G),(x.e.f&fo)!==0&&pl(x.e),x!==v){if(b!==void 0&&b.has(x)){if(k.length<C.length){var g=C[0],m;P=g.prev;var T=k[0],E=k[k.length-1];for(m=0;m<k.length;m+=1)po(k[m],g,s);for(m=0;m<C.length;m+=1)b.delete(C[m]);Pt(t,T.prev,E.next),Pt(t,P,T),Pt(t,E,g),v=g,P=E,G-=1,k=[],C=[]}else b.delete(x),po(x,v,s),Pt(t,x.prev,x.next),Pt(t,x,P===null?t.first:P.next),Pt(t,P,x),P=x;continue}for(k=[],C=[];v!==null&&v.k!==M;)(v.e.f&fo)===0&&(b??=new Set).add(v),C.push(v),v=v.next;if(v===null)continue;x=v}k.push(x),P=x,v=x.next}if(v!==null||b!==void 0){for(var A=b===void 0?[]:fl(b);v!==null;)(v.e.f&fo)===0&&A.push(v),v=v.next;var _=A.length;if(_>0){var j=d===0?s:null;op(t,A,j)}}n.first=t.first&&t.first.e,n.last=P&&P.e;for(var U of r.values())ml(U.e);r.clear()}function Il(n,e,t,r){Nf(n.v,e),n.i=t}function Vo(n,e,t,r,s,o,a,u,h,d,p){var y=(h&xf)!==0,v=(h&Lf)===0,b=y?v?ie(s,!1,!1):Mc(s):s,P=(h&Mf)===0?a:Mc(a),k={i:P,v:b,k:o,a:null,e:null,prev:t,next:r};try{if(n===null){var C=document.createDocumentFragment();C.append(n=dl())}return k.e=ko(()=>u(n,b,P,d),gt),k.e.prev=t&&t.e,k.e.next=r&&r.e,t===null?p||(e.first=k):(t.next=k,t.e.next=k.e),r!==null&&(r.prev=k,r.e.prev=k.e),k}finally{}}function po(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==r;){var a=Ff(o);s.before(o),o=a}}function Pt(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function wl(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=wl(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function cp(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=wl(n))&&(r&&(r+=" "),r+=e);return r}function up(n){return typeof n=="object"?cp(n):n??""}function lp(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function hp(n,e){return n==null?null:String(n)}function dp(n,e,t,r,s,o){var a=n.__className;if(gt||a!==t||a===void 0){var u=lp(t,r);(!gt||u!==n.getAttribute("class"))&&(u==null?n.removeAttribute("class"):n.className=u),n.__className=t}return o}function nr(n,e,t,r){var s=n.__style;if(gt||s!==e){var o=hp(e);(!gt||o!==n.getAttribute("style"))&&(o==null?n.removeAttribute("style"):n.style.cssText=o),n.__style=e}return r}const fp=()=>performance.now(),Bt={tick:n=>requestAnimationFrame(n),now:()=>fp(),tasks:new Set};function Al(){const n=Bt.now();Bt.tasks.forEach(e=>{e.c(n)||(Bt.tasks.delete(e),e.f())}),Bt.tasks.size!==0&&Bt.tick(Al)}function pp(n){let e;return Bt.tasks.size===0&&Bt.tick(Al),{promise:new Promise(t=>{Bt.tasks.add(e={c:n,f:t})}),abort(){Bt.tasks.delete(e)}}}function Fs(n,e){_l(()=>{n.dispatchEvent(new CustomEvent(e))})}function mp(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Lc(n){const e={},t=n.split(";");for(const r of t){const[s,o]=r.split(":");if(!s||o===void 0)break;const a=mp(s.trim());e[a]=o.trim()}return e}const gp=n=>n;function Fc(n,e,t,r){var s=(n&Gf)!==0,o=(n&Kf)!==0,a=s&&o,u=(n&Wf)!==0,h=a?"both":s?"in":"out",d,p=e.inert,y=e.style.overflow,v,b;function P(){return _l(()=>d??=t()(e,r?.()??{},{direction:h}))}var k={is_global:u,in(){if(e.inert=p,!s){b?.abort(),b?.reset?.();return}o||v?.abort(),Fs(e,"introstart"),v=Do(e,P(),b,1,()=>{Fs(e,"introend"),v?.abort(),v=d=void 0,e.style.overflow=y})},out(x){if(!o){x?.(),d=void 0;return}e.inert=!0,Fs(e,"outrostart"),b=Do(e,P(),v,0,()=>{Fs(e,"outroend"),x?.()})},stop:()=>{v?.abort(),b?.abort()}},C=gl;if((C.transitions??=[]).push(k),s&&np){var F=u;if(!F){for(var M=C.parent;M&&(M.f&qf)!==0;)for(;(M=M.parent)&&(M.f&$f)===0;);F=!M||(M.f&zf)!==0}F&&Hf(()=>{_e(()=>k.in())})}}function Do(n,e,t,r,s){var o=r===1;if(Qf(e)){var a,u=!1;return Yf(()=>{if(!u){var C=e({direction:o?"in":"out"});a=Do(n,C,t,r,s)}}),{abort:()=>{u=!0,a?.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(t?.deactivate(),!e?.duration)return s(),{abort:Ur,deactivate:Ur,reset:Ur,t:()=>r};const{delay:h=0,css:d,tick:p,easing:y=gp}=e;var v=[];if(o&&t===void 0&&(p&&p(0,1),d)){var b=Lc(d(0,1));v.push(b,b)}var P=()=>1-r,k=n.animate(v,{duration:h,fill:"forwards"});return k.onfinish=()=>{k.cancel();var C=t?.t()??1-r;t?.abort();var F=r-C,M=e.duration*Math.abs(F),x=[];if(M>0){var G=!1;if(d)for(var q=Math.ceil(M/16.666666666666668),J=0;J<=q;J+=1){var I=C+F*y(J/q),g=Lc(d(I,1-I));x.push(g),G||=g.overflow==="hidden"}G&&(n.style.overflow="hidden"),P=()=>{var m=k.currentTime;return C+F*y(m/M)},p&&pp(()=>{if(k.playState!=="running")return!1;var m=P();return p(m,1-m),!0})}k=n.animate(x,{duration:M,fill:"forwards"}),k.onfinish=()=>{P=()=>r,p?.(r,1-r),s()}},{abort:()=>{k&&(k.cancel(),k.effect=null,k.onfinish=Ur)},deactivate:()=>{s=Ur},reset:()=>{r===0&&p?.(1,0)},t:()=>P()}}function Dn(n,e,t=e){var r=new WeakSet;Xf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=mo(n)?go(o):o,t(o),Qn!==null&&r.add(Qn),await Jf(),o!==(o=e())){var a=n.selectionStart,u=n.selectionEnd,h=n.value.length;if(n.value=o??"",u!==null){var d=n.value.length;a===u&&u===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(u,d))}}}),(gt&&n.defaultValue!==n.value||_e(e)==null&&n.value)&&(t(mo(n)?go(n.value):n.value),Qn!==null&&r.add(Qn)),Zf(()=>{var s=e();if(n===document.activeElement){var o=ep??Qn;if(r.has(o))return}mo(n)&&s===go(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function mo(n){var e=n.type;return e==="number"||e==="range"}function go(n){return n===""?null:+n}const _p=()=>{};var Uc={};const bl=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},yp=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Rl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,y=(o&3)<<4|u>>4;let v=(u&15)<<2|d>>6,b=d&63;h||(b=64,a||(v=64)),r.push(t[p],t[y],t[v],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(bl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):yp(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const y=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||y==null)throw new vp;const v=o<<2|u>>4;if(r.push(v),d!==64){const b=u<<4&240|d>>2;if(r.push(b),y!==64){const P=d<<6&192|y;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vp extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ep=function(n){const e=bl(n);return Rl.encodeByteArray(e,!0)},ri=function(n){return Ep(n).replace(/\./g,"")},Sl=function(n){try{return Rl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Tp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Ip=()=>Tp().__FIREBASE_DEFAULTS__,wp=()=>{if(typeof process>"u"||typeof Uc>"u")return;const n=Uc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ap=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Sl(n[1]);return e&&JSON.parse(e)},Pi=()=>{try{return _p()||Ip()||wp()||Ap()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Pl=n=>Pi()?.emulatorHosts?.[n],bp=n=>{const e=Pl(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Cl=()=>Pi()?.config,kl=n=>Pi()?.[`_${n}`];class Rp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function mr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Vl(n){return(await fetch(n,{credentials:"include"})).ok}function Sp(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[ri(JSON.stringify(t)),ri(JSON.stringify(a)),""].join(".")}const Gr={};function Pp(){const n={prod:[],emulator:[]};for(const e of Object.keys(Gr))Gr[e]?n.emulator.push(e):n.prod.push(e);return n}function Cp(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Bc=!1;function Dl(n,e){if(typeof window>"u"||typeof document>"u"||!mr(window.location.host)||Gr[n]===e||Gr[n]||Bc)return;Gr[n]=e;function t(v){return`__firebase__banner__${v}`}const r="__firebase__banner",o=Pp().prod.length>0;function a(){const v=document.getElementById(r);v&&v.remove()}function u(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,b){v.setAttribute("width","24"),v.setAttribute("id",b),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Bc=!0,a()},v}function p(v,b){v.setAttribute("id",b),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function y(){const v=Cp(r),b=t("text"),P=document.getElementById(b)||document.createElement("span"),k=t("learnmore"),C=document.getElementById(k)||document.createElement("a"),F=t("preprendIcon"),M=document.getElementById(F)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const x=v.element;u(x),p(C,k);const G=d();h(M,F),x.append(M,P,C,G),document.body.appendChild(x)}o?(P.innerText="Preview backend disconnected.",M.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(M.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function nt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nt())}function Vp(){const n=Pi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Dp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Np(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Op(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Mp(){const n=nt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function xp(){return!Vp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Lp(){try{return typeof indexedDB=="object"}catch{return!1}}function Fp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const Up="FirebaseError";class Yt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Up,Object.setPrototypeOf(this,Yt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ls.prototype.create)}}class ls{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Bp(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Yt(s,u,r)}}function Bp(n,e){return n.replace(jp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const jp=/\{\$([^}]+)}/g;function qp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function On(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(jc(o)&&jc(a)){if(!On(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function jc(n){return n!==null&&typeof n=="object"}function hs(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Br(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function jr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function $p(n,e){const t=new zp(n,e);return t.subscribe.bind(t)}class zp{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Hp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=_o),s.error===void 0&&(s.error=_o),s.complete===void 0&&(s.complete=_o);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Hp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function _o(){}function $e(n){return n&&n._delegate?n._delegate:n}class Mn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const kn="[DEFAULT]";class Wp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Rp;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Kp(e))try{this.getOrInitializeService({instanceIdentifier:kn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=kn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=kn){return this.instances.has(e)}getOptions(e=kn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Gp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=kn){return this.component?this.component.multipleInstances?e:kn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Gp(n){return n===kn?void 0:n}function Kp(n){return n.instantiationMode==="EAGER"}class Qp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Wp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var ee;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ee||(ee={}));const Yp={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},Xp=ee.INFO,Jp={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},Zp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Jp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class sa{constructor(e){this.name=e,this._logLevel=Xp,this._logHandler=Zp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ee))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Yp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...e),this._logHandler(this,ee.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...e),this._logHandler(this,ee.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ee.INFO,...e),this._logHandler(this,ee.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ee.WARN,...e),this._logHandler(this,ee.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...e),this._logHandler(this,ee.ERROR,...e)}}const em=(n,e)=>e.some(t=>n instanceof t);let qc,$c;function tm(){return qc||(qc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nm(){return $c||($c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Nl=new WeakMap,No=new WeakMap,Ol=new WeakMap,yo=new WeakMap,ia=new WeakMap;function rm(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(dn(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Nl.set(t,n)}).catch(()=>{}),ia.set(e,n),e}function sm(n){if(No.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});No.set(n,e)}let Oo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return No.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ol.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return dn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function im(n){Oo=n(Oo)}function om(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(vo(this),e,...t);return Ol.set(r,e.sort?e.sort():[e]),dn(r)}:nm().includes(n)?function(...e){return n.apply(vo(this),e),dn(Nl.get(this))}:function(...e){return dn(n.apply(vo(this),e))}}function am(n){return typeof n=="function"?om(n):(n instanceof IDBTransaction&&sm(n),em(n,tm())?new Proxy(n,Oo):n)}function dn(n){if(n instanceof IDBRequest)return rm(n);if(yo.has(n))return yo.get(n);const e=am(n);return e!==n&&(yo.set(n,e),ia.set(e,n)),e}const vo=n=>ia.get(n);function cm(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=dn(a);return r&&a.addEventListener("upgradeneeded",h=>{r(dn(a.result),h.oldVersion,h.newVersion,dn(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const um=["get","getKey","getAll","getAllKeys","count"],lm=["put","add","delete","clear"],Eo=new Map;function zc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Eo.get(e))return Eo.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=lm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||um.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),s&&h.done]))[0]};return Eo.set(e,o),o}im(n=>({...n,get:(e,t,r)=>zc(e,t)||n.get(e,t,r),has:(e,t)=>!!zc(e,t)||n.has(e,t)}));class hm{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(dm(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function dm(n){return n.getComponent()?.type==="VERSION"}const Mo="@firebase/app",Hc="0.14.5";const Ht=new sa("@firebase/app"),fm="@firebase/app-compat",pm="@firebase/analytics-compat",mm="@firebase/analytics",gm="@firebase/app-check-compat",_m="@firebase/app-check",ym="@firebase/auth",vm="@firebase/auth-compat",Em="@firebase/database",Tm="@firebase/data-connect",Im="@firebase/database-compat",wm="@firebase/functions",Am="@firebase/functions-compat",bm="@firebase/installations",Rm="@firebase/installations-compat",Sm="@firebase/messaging",Pm="@firebase/messaging-compat",Cm="@firebase/performance",km="@firebase/performance-compat",Vm="@firebase/remote-config",Dm="@firebase/remote-config-compat",Nm="@firebase/storage",Om="@firebase/storage-compat",Mm="@firebase/firestore",xm="@firebase/ai",Lm="@firebase/firestore-compat",Fm="firebase",Um="12.5.0";const xo="[DEFAULT]",Bm={[Mo]:"fire-core",[fm]:"fire-core-compat",[mm]:"fire-analytics",[pm]:"fire-analytics-compat",[_m]:"fire-app-check",[gm]:"fire-app-check-compat",[ym]:"fire-auth",[vm]:"fire-auth-compat",[Em]:"fire-rtdb",[Tm]:"fire-data-connect",[Im]:"fire-rtdb-compat",[wm]:"fire-fn",[Am]:"fire-fn-compat",[bm]:"fire-iid",[Rm]:"fire-iid-compat",[Sm]:"fire-fcm",[Pm]:"fire-fcm-compat",[Cm]:"fire-perf",[km]:"fire-perf-compat",[Vm]:"fire-rc",[Dm]:"fire-rc-compat",[Nm]:"fire-gcs",[Om]:"fire-gcs-compat",[Mm]:"fire-fst",[Lm]:"fire-fst-compat",[xm]:"fire-vertex","fire-js":"fire-js",[Fm]:"fire-js-all"};const si=new Map,jm=new Map,Lo=new Map;function Wc(n,e){try{n.container.addComponent(e)}catch(t){Ht.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cr(n){const e=n.name;if(Lo.has(e))return Ht.debug(`There were multiple attempts to register component ${e}.`),!1;Lo.set(e,n);for(const t of si.values())Wc(t,n);for(const t of jm.values())Wc(t,n);return!0}function oa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function yt(n){return n==null?!1:n.settings!==void 0}const qm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fn=new ls("app","Firebase",qm);class $m{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Mn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fn.create("app-deleted",{appName:this._name})}}const gr=Um;function Ml(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:xo,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw fn.create("bad-app-name",{appName:String(s)});if(t||(t=Cl()),!t)throw fn.create("no-options");const o=si.get(s);if(o){if(On(t,o.options)&&On(r,o.config))return o;throw fn.create("duplicate-app",{appName:s})}const a=new Qp(s);for(const h of Lo.values())a.addComponent(h);const u=new $m(t,r,a);return si.set(s,u),u}function xl(n=xo){const e=si.get(n);if(!e&&n===xo&&Cl())return Ml();if(!e)throw fn.create("no-app",{appName:n});return e}function pn(n,e,t){let r=Bm[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ht.warn(a.join(" "));return}cr(new Mn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const zm="firebase-heartbeat-database",Hm=1,ts="firebase-heartbeat-store";let To=null;function Ll(){return To||(To=cm(zm,Hm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ts)}catch(t){console.warn(t)}}}}).catch(n=>{throw fn.create("idb-open",{originalErrorMessage:n.message})})),To}async function Wm(n){try{const t=(await Ll()).transaction(ts),r=await t.objectStore(ts).get(Fl(n));return await t.done,r}catch(e){if(e instanceof Yt)Ht.warn(e.message);else{const t=fn.create("idb-get",{originalErrorMessage:e?.message});Ht.warn(t.message)}}}async function Gc(n,e){try{const r=(await Ll()).transaction(ts,"readwrite");await r.objectStore(ts).put(e,Fl(n)),await r.done}catch(t){if(t instanceof Yt)Ht.warn(t.message);else{const r=fn.create("idb-set",{originalErrorMessage:t?.message});Ht.warn(r.message)}}}function Fl(n){return`${n.name}!${n.options.appId}`}const Gm=1024,Km=30;class Qm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Xm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Kc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Km){const s=Jm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ht.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Kc(),{heartbeatsToSend:t,unsentEntries:r}=Ym(this._heartbeatsCache.heartbeats),s=ri(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Ht.warn(e),""}}}function Kc(){return new Date().toISOString().substring(0,10)}function Ym(n,e=Gm){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Qc(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Qc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Xm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Lp()?Fp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Wm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Gc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Gc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Qc(n){return ri(JSON.stringify({version:2,heartbeats:n})).length}function Jm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Zm(n){cr(new Mn("platform-logger",e=>new hm(e),"PRIVATE")),cr(new Mn("heartbeat",e=>new Qm(e),"PRIVATE")),pn(Mo,Hc,n),pn(Mo,Hc,"esm2020"),pn("fire-js","")}Zm("");var eg="firebase",tg="12.5.0";pn(eg,tg,"app");function Ul(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ng=Ul,Bl=new ls("auth","Firebase",Ul());const ii=new sa("@firebase/auth");function rg(n,...e){ii.logLevel<=ee.WARN&&ii.warn(`Auth (${gr}): ${n}`,...e)}function Ws(n,...e){ii.logLevel<=ee.ERROR&&ii.error(`Auth (${gr}): ${n}`,...e)}function At(n,...e){throw aa(n,...e)}function kt(n,...e){return aa(n,...e)}function jl(n,e,t){const r={...ng(),[e]:t};return new ls("auth","Firebase",r).create(e,{appName:n.name})}function $t(n){return jl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function aa(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Bl.create(n,...e)}function H(n,e,...t){if(!n)throw aa(e,...t)}function jt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ws(e),new Error(e)}function Wt(n,e){n||jt(e)}function Fo(){return typeof self<"u"&&self.location?.href||""}function sg(){return Yc()==="http:"||Yc()==="https:"}function Yc(){return typeof self<"u"&&self.location?.protocol||null}function ig(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sg()||Np()||"connection"in navigator)?navigator.onLine:!0}function og(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class ds{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wt(t>e,"Short delay should be less than long delay!"),this.isMobile=kp()||Op()}get(){return ig()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function ca(n,e){Wt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class ql{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ag={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const cg=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ug=new ds(3e4,6e4);function Xt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Jt(n,e,t,r,s={}){return $l(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const u=hs({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return Dp()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&mr(n.emulatorConfig.host)&&(d.credentials="include"),ql.fetch()(await zl(n,n.config.apiHost,t,u),d)})}async function $l(n,e,t){n._canInitEmulator=!1;const r={...ag,...e};try{const s=new hg(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw Us(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Us(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Us(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Us(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw jl(n,p,d);At(n,p)}}catch(s){if(s instanceof Yt)throw s;At(n,"network-request-failed",{message:String(s)})}}async function fs(n,e,t,r,s={}){const o=await Jt(n,e,t,r,s);return"mfaPendingCredential"in o&&At(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function zl(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?ca(n.config,s):`${n.config.apiScheme}://${s}`;return cg.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function lg(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class hg{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(kt(this.auth,"network-request-failed")),ug.get())})}}function Us(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=kt(n,e,r);return s.customData._tokenResponse=t,s}function Xc(n){return n!==void 0&&n.enterprise!==void 0}class dg{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return lg(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fg(n,e){return Jt(n,"GET","/v2/recaptchaConfig",Xt(n,e))}async function pg(n,e){return Jt(n,"POST","/v1/accounts:delete",e)}async function oi(n,e){return Jt(n,"POST","/v1/accounts:lookup",e)}function Kr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mg(n,e=!1){const t=$e(n),r=await t.getIdToken(e),s=ua(r);H(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:Kr(Io(s.auth_time)),issuedAtTime:Kr(Io(s.iat)),expirationTime:Kr(Io(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Io(n){return Number(n)*1e3}function ua(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ws("JWT malformed, contained fewer than 3 sections"),null;try{const s=Sl(t);return s?JSON.parse(s):(Ws("Failed to decode base64 JWT payload"),null)}catch(s){return Ws("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Jc(n){const e=ua(n);return H(e,"internal-error"),H(typeof e.exp<"u","internal-error"),H(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function ns(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Yt&&gg(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function gg({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class _g{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Uo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Kr(this.lastLoginAt),this.creationTime=Kr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ai(n){const e=n.auth,t=await n.getIdToken(),r=await ns(n,oi(e,{idToken:t}));H(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Hl(s.providerUserInfo):[],a=vg(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=u?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Uo(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function yg(n){const e=$e(n);await ai(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function vg(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Hl(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Eg(n,e){const t=await $l(n,{},async()=>{const r=hs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await zl(n,s,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return n.emulatorConfig&&mr(n.emulatorConfig.host)&&(h.credentials="include"),ql.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Tg(n,e){return Jt(n,"POST","/v2/accounts:revokeToken",Xt(n,e))}class rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){H(e.idToken,"internal-error"),H(typeof e.idToken<"u","internal-error"),H(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Jc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){H(e.length!==0,"internal-error");const t=Jc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(H(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await Eg(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new rr;return r&&(H(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(H(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(H(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rr,this.toJSON())}_performRefresh(){return jt("not implemented")}}function on(n,e){H(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class wt{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new _g(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Uo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await ns(this,this.stsTokenManager.getToken(this.auth,e));return H(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return mg(this,e)}reload(){return yg(this)}_assign(e){this!==e&&(H(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new wt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){H(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ai(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(yt(this.auth.app))return Promise.reject($t(this.auth));const e=await this.getIdToken();return await ns(this,pg(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:y,emailVerified:v,isAnonymous:b,providerData:P,stsTokenManager:k}=t;H(y&&k,e,"internal-error");const C=rr.fromJSON(this.name,k);H(typeof y=="string",e,"internal-error"),on(r,e.name),on(s,e.name),H(typeof v=="boolean",e,"internal-error"),H(typeof b=="boolean",e,"internal-error"),on(o,e.name),on(a,e.name),on(u,e.name),on(h,e.name),on(d,e.name),on(p,e.name);const F=new wt({uid:y,auth:e,email:s,emailVerified:v,displayName:r,isAnonymous:b,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:C,createdAt:d,lastLoginAt:p});return P&&Array.isArray(P)&&(F.providerData=P.map(M=>({...M}))),h&&(F._redirectEventId=h),F}static async _fromIdTokenResponse(e,t,r=!1){const s=new rr;s.updateFromServerResponse(t);const o=new wt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ai(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];H(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Hl(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,u=new rr;u.updateFromIdToken(r);const h=new wt({uid:s.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Uo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Zc=new Map;function qt(n){Wt(n instanceof Function,"Expected a class definition");let e=Zc.get(n);return e?(Wt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Zc.set(n,e),e)}class Wl{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Wl.type="NONE";const eu=Wl;function Gs(n,e,t){return`firebase:${n}:${e}:${t}`}class sr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=Gs(this.userKey,s.apiKey,o),this.fullPersistenceKey=Gs("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await oi(this.auth,{idToken:e}).catch(()=>{});return t?wt._fromGetAccountInfoResponse(this.auth,t,e):null}return wt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new sr(qt(eu),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||qt(eu);const a=Gs(r,e.config.apiKey,e.name);let u=null;for(const d of t)try{const p=await d._get(a);if(p){let y;if(typeof p=="string"){const v=await oi(e,{idToken:p}).catch(()=>{});if(!v)break;y=await wt._fromGetAccountInfoResponse(e,v,p)}else y=wt._fromJSON(e,p);d!==o&&(u=y),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new sr(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new sr(o,e,r))}}function tu(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Yl(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Gl(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Jl(e))return"Blackberry";if(Zl(e))return"Webos";if(Kl(e))return"Safari";if((e.includes("chrome/")||Ql(e))&&!e.includes("edge/"))return"Chrome";if(Xl(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Gl(n=nt()){return/firefox\//i.test(n)}function Kl(n=nt()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ql(n=nt()){return/crios\//i.test(n)}function Yl(n=nt()){return/iemobile/i.test(n)}function Xl(n=nt()){return/android/i.test(n)}function Jl(n=nt()){return/blackberry/i.test(n)}function Zl(n=nt()){return/webos/i.test(n)}function la(n=nt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Ig(n=nt()){return la(n)&&!!window.navigator?.standalone}function wg(){return Mp()&&document.documentMode===10}function eh(n=nt()){return la(n)||Xl(n)||Zl(n)||Jl(n)||/windows phone/i.test(n)||Yl(n)}function th(n,e=[]){let t;switch(n){case"Browser":t=tu(nt());break;case"Worker":t=`${tu(nt())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gr}/${r}`}class Ag{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,u)=>{try{const h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function bg(n,e={}){return Jt(n,"GET","/v2/passwordPolicy",Xt(n,e))}const Rg=6;class Sg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Rg,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class Pg{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nu(this),this.idTokenSubscription=new nu(this),this.beforeStateQueue=new Ag(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Bl,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await sr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await oi(this,{idToken:e}),r=await wt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(yt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return H(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ai(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=og()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(yt(this.app))return Promise.reject($t(this));const t=e?$e(e):null;return t&&H(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&H(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return yt(this.app)?Promise.reject($t(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return yt(this.app)?Promise.reject($t(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await bg(this),t=new Sg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ls("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Tg(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qt(e)||this._popupRedirectResolver;H(t,this,"argument-error"),this.redirectPersistenceManager=await sr.create(this,[qt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(H(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return H(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=th(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(yt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&rg(`Error while retrieving App Check token: ${e.error}`),e?.token}}function wn(n){return $e(n)}class nu{constructor(e){this.auth=e,this.observer=null,this.addObserver=$p(t=>this.observer=t)}get next(){return H(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ci={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Cg(n){Ci=n}function nh(n){return Ci.loadJS(n)}function kg(){return Ci.recaptchaEnterpriseScript}function Vg(){return Ci.gapiScript}function Dg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Ng{constructor(){this.enterprise=new Og}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Og{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Mg="recaptcha-enterprise",rh="NO_RECAPTCHA";class xg{constructor(e){this.type=Mg,this.auth=wn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,u)=>{fg(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const d=new dg(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{u(h)})})}function s(o,a,u){const h=window.grecaptcha;Xc(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(rh)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Ng().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(u=>{if(!t&&Xc(window.grecaptcha))s(u,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=kg();h.length!==0&&(h+=u),nh(h).then(()=>{s(u,o,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})}}async function ru(n,e,t,r=!1,s=!1){const o=new xg(n);let a;if(s)a=rh;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function ci(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await ru(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await ru(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}function Lg(n,e){const t=oa(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(On(o,e??{}))return s;At(s,"already-initialized")}return t.initialize({options:e})}function Fg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(qt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Ug(n,e,t){const r=wn(n);H(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=sh(e),{host:a,port:u}=Bg(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){H(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),H(On(d,r.config.emulator)&&On(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,mr(a)?(Vl(`${o}//${a}${h}`),Dl("Auth",!0)):jg()}function sh(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Bg(n){const e=sh(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:su(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:su(a)}}}function su(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function jg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class ha{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return jt("not implemented")}_getIdTokenResponse(e){return jt("not implemented")}_linkToIdToken(e,t){return jt("not implemented")}_getReauthenticationResolver(e){return jt("not implemented")}}async function qg(n,e){return Jt(n,"POST","/v1/accounts:signUp",e)}async function $g(n,e){return fs(n,"POST","/v1/accounts:signInWithPassword",Xt(n,e))}async function zg(n,e){return Jt(n,"POST","/v1/accounts:sendOobCode",Xt(n,e))}async function Hg(n,e){return zg(n,e)}async function Wg(n,e){return fs(n,"POST","/v1/accounts:signInWithEmailLink",Xt(n,e))}async function Gg(n,e){return fs(n,"POST","/v1/accounts:signInWithEmailLink",Xt(n,e))}class rs extends ha{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new rs(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new rs(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ci(e,t,"signInWithPassword",$g);case"emailLink":return Wg(e,{email:this._email,oobCode:this._password});default:At(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ci(e,r,"signUpPassword",qg);case"emailLink":return Gg(e,{idToken:t,email:this._email,oobCode:this._password});default:At(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ir(n,e){return fs(n,"POST","/v1/accounts:signInWithIdp",Xt(n,e))}const Kg="http://localhost";class xn extends ha{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):At("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new xn(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ir(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ir(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ir(e,t)}buildRequest(){const e={requestUri:Kg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=hs(t)}return e}}function Qg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Yg(n){const e=Br(jr(n)).link,t=e?Br(jr(e)).deep_link_id:null,r=Br(jr(n)).deep_link_id;return(r?Br(jr(r)).link:null)||r||t||e||n}class da{constructor(e){const t=Br(jr(e)),r=t.apiKey??null,s=t.oobCode??null,o=Qg(t.mode??null);H(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Yg(e);try{return new da(t)}catch{return null}}}class Bn{constructor(){this.providerId=Bn.PROVIDER_ID}static credential(e,t){return rs._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=da.parseLink(t);return H(r,"argument-error"),rs._fromEmailAndCode(e,r.code,r.tenantId)}}Bn.PROVIDER_ID="password";Bn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ih{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ps extends ih{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class an extends ps{constructor(){super("facebook.com")}static credential(e){return xn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.FACEBOOK_SIGN_IN_METHOD="facebook.com";an.PROVIDER_ID="facebook.com";class cn extends ps{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return xn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return cn.credential(t,r)}catch{return null}}}cn.GOOGLE_SIGN_IN_METHOD="google.com";cn.PROVIDER_ID="google.com";class un extends ps{constructor(){super("github.com")}static credential(e){return xn._fromParams({providerId:un.PROVIDER_ID,signInMethod:un.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return un.credentialFromTaggedObject(e)}static credentialFromError(e){return un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return un.credential(e.oauthAccessToken)}catch{return null}}}un.GITHUB_SIGN_IN_METHOD="github.com";un.PROVIDER_ID="github.com";class ln extends ps{constructor(){super("twitter.com")}static credential(e,t){return xn._fromParams({providerId:ln.PROVIDER_ID,signInMethod:ln.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ln.credentialFromTaggedObject(e)}static credentialFromError(e){return ln.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ln.credential(t,r)}catch{return null}}}ln.TWITTER_SIGN_IN_METHOD="twitter.com";ln.PROVIDER_ID="twitter.com";async function Xg(n,e){return fs(n,"POST","/v1/accounts:signUp",Xt(n,e))}class Ln{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await wt._fromIdTokenResponse(e,r,s),a=iu(r);return new Ln({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=iu(r);return new Ln({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function iu(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class ui extends Yt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ui.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ui(e,t,r,s)}}function oh(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?ui._fromErrorAndOperation(n,o,e,r):o})}async function Jg(n,e,t=!1){const r=await ns(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ln._forOperation(n,"link",r)}async function ah(n,e,t=!1){const{auth:r}=n;if(yt(r.app))return Promise.reject($t(r));const s="reauthenticate";try{const o=await ns(n,oh(r,s,e,n),t);H(o.idToken,r,"internal-error");const a=ua(o.idToken);H(a,r,"internal-error");const{sub:u}=a;return H(n.uid===u,r,"user-mismatch"),Ln._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&At(r,"user-mismatch"),o}}async function ch(n,e,t=!1){if(yt(n.app))return Promise.reject($t(n));const r="signIn",s=await oh(n,r,e),o=await Ln._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}async function Zg(n,e){return ch(wn(n),e)}async function e_(n,e){return ah($e(n),e)}async function uh(n){const e=wn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function t_(n,e,t){const r=wn(n);await ci(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Hg)}async function n_(n,e,t){if(yt(n.app))return Promise.reject($t(n));const r=wn(n),a=await ci(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Xg).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&uh(n),h}),u=await Ln._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function r_(n,e,t){return yt(n.app)?Promise.reject($t(n)):Zg($e(n),Bn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&uh(n),r})}function s_(n,e,t,r){return $e(n).onIdTokenChanged(e,t,r)}function i_(n,e,t){return $e(n).beforeAuthStateChanged(e,t)}function o_(n,e,t,r){return $e(n).onAuthStateChanged(e,t,r)}function a_(n){return $e(n).signOut()}const li="__sak";class lh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(li,"1"),this.storage.removeItem(li),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const c_=1e3,u_=10;class hh extends lh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=eh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,u,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);wg()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,u_):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},c_)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}hh.type="LOCAL";const l_=hh;class dh extends lh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}dh.type="SESSION";const fh=dh;function h_(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ki{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ki(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const u=Array.from(a).map(async d=>d(t.origin,o)),h=await h_(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ki.receivers=[];function fa(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class d_{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{const d=fa("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(y){const v=y;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(v.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Vt(){return window}function f_(n){Vt().location.href=n}function ph(){return typeof Vt().WorkerGlobalScope<"u"&&typeof Vt().importScripts=="function"}async function p_(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function m_(){return navigator?.serviceWorker?.controller||null}function g_(){return ph()?self:null}const mh="firebaseLocalStorageDb",__=1,hi="firebaseLocalStorage",gh="fbase_key";class ms{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Vi(n,e){return n.transaction([hi],e?"readwrite":"readonly").objectStore(hi)}function y_(){const n=indexedDB.deleteDatabase(mh);return new ms(n).toPromise()}function Bo(){const n=indexedDB.open(mh,__);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(hi,{keyPath:gh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(hi)?e(r):(r.close(),await y_(),e(await Bo()))})})}async function ou(n,e,t){const r=Vi(n,!0).put({[gh]:e,value:t});return new ms(r).toPromise()}async function v_(n,e){const t=Vi(n,!1).get(e),r=await new ms(t).toPromise();return r===void 0?null:r.value}function au(n,e){const t=Vi(n,!0).delete(e);return new ms(t).toPromise()}const E_=800,T_=3;class _h{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Bo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>T_)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ph()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ki._getInstance(g_()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await p_(),!this.activeServiceWorker)return;this.sender=new d_(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||m_()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Bo();return await ou(e,li,"1"),await au(e,li),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ou(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>v_(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>au(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=Vi(s,!1).getAll();return new ms(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),E_)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_h.type="LOCAL";const I_=_h;new ds(3e4,6e4);function w_(n,e){return e?qt(e):(H(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class pa extends ha{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ir(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ir(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ir(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function A_(n){return ch(n.auth,new pa(n),n.bypassAuthState)}function b_(n){const{auth:e,user:t}=n;return H(t,e,"internal-error"),ah(t,new pa(n),n.bypassAuthState)}async function R_(n){const{auth:e,user:t}=n;return H(t,e,"internal-error"),Jg(t,new pa(n),n.bypassAuthState)}class yh{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return A_;case"linkViaPopup":case"linkViaRedirect":return R_;case"reauthViaPopup":case"reauthViaRedirect":return b_;default:At(this.auth,"internal-error")}}resolve(e){Wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const S_=new ds(2e3,1e4);class er extends yh{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,er.currentPopupAction&&er.currentPopupAction.cancel(),er.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return H(e,this.auth,"internal-error"),e}async onExecution(){Wt(this.filter.length===1,"Popup operations only handle one event");const e=fa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(kt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(kt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,er.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,S_.get())};e()}}er.currentPopupAction=null;const P_="pendingRedirect",Ks=new Map;class C_ extends yh{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ks.get(this.auth._key());if(!e){try{const r=await k_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ks.set(this.auth._key(),e)}return this.bypassAuthState||Ks.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function k_(n,e){const t=N_(e),r=D_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function V_(n,e){Ks.set(n._key(),e)}function D_(n){return qt(n._redirectPersistence)}function N_(n){return Gs(P_,n.config.apiKey,n.name)}async function O_(n,e,t=!1){if(yt(n.app))return Promise.reject($t(n));const r=wn(n),s=w_(r,e),a=await new C_(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const M_=600*1e3;class x_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!L_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!vh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(kt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=M_&&this.cachedEventUids.clear(),this.cachedEventUids.has(cu(e))}saveEventToCache(e){this.cachedEventUids.add(cu(e)),this.lastProcessedEventTime=Date.now()}}function cu(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function vh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function L_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vh(n);default:return!1}}async function F_(n,e={}){return Jt(n,"GET","/v1/projects",e)}const U_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,B_=/^https?/;async function j_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await F_(n);for(const t of e)try{if(q_(t))return}catch{}At(n,"unauthorized-domain")}function q_(n){const e=Fo(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!B_.test(t))return!1;if(U_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const $_=new ds(3e4,6e4);function uu(){const n=Vt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function z_(n){return new Promise((e,t)=>{function r(){uu(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{uu(),t(kt(n,"network-request-failed"))},timeout:$_.get()})}if(Vt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Vt().gapi?.load)r();else{const s=Dg("iframefcb");return Vt()[s]=()=>{gapi.load?r():t(kt(n,"network-request-failed"))},nh(`${Vg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw Qs=null,e})}let Qs=null;function H_(n){return Qs=Qs||z_(n),Qs}const W_=new ds(5e3,15e3),G_="__/auth/iframe",K_="emulator/auth/iframe",Q_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Y_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function X_(n){const e=n.config;H(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?ca(e,K_):`https://${n.config.authDomain}/${G_}`,r={apiKey:e.apiKey,appName:n.name,v:gr},s=Y_.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${hs(r).slice(1)}`}async function J_(n){const e=await H_(n),t=Vt().gapi;return H(t,n,"internal-error"),e.open({where:document.body,url:X_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Q_,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=kt(n,"network-request-failed"),u=Vt().setTimeout(()=>{o(a)},W_.get());function h(){Vt().clearTimeout(u),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const Z_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ey=500,ty=600,ny="_blank",ry="http://localhost";class lu{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function sy(n,e,t,r=ey,s=ty){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...Z_,width:r.toString(),height:s.toString(),top:o,left:a},d=nt().toLowerCase();t&&(u=Ql(d)?ny:t),Gl(d)&&(e=e||ry,h.scrollbars="yes");const p=Object.entries(h).reduce((v,[b,P])=>`${v}${b}=${P},`,"");if(Ig(d)&&u!=="_self")return iy(e||"",u),new lu(null);const y=window.open(e||"",u,p);H(y,n,"popup-blocked");try{y.focus()}catch{}return new lu(y)}function iy(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const oy="__/auth/handler",ay="emulator/auth/handler",cy=encodeURIComponent("fac");async function hu(n,e,t,r,s,o){H(n.config.authDomain,n,"auth-domain-config-required"),H(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:gr,eventId:s};if(e instanceof ih){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",qp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,y]of Object.entries({}))a[p]=y}if(e instanceof ps){const p=e.getScopes().filter(y=>y!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const u=a;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await n._getAppCheckToken(),d=h?`#${cy}=${encodeURIComponent(h)}`:"";return`${uy(n)}?${hs(u).slice(1)}${d}`}function uy({config:n}){return n.emulator?ca(n,ay):`https://${n.authDomain}/${oy}`}const wo="webStorageSupport";class ly{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fh,this._completeRedirectFn=O_,this._overrideRedirectResult=V_}async _openPopup(e,t,r,s){Wt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await hu(e,t,r,Fo(),s);return sy(e,o,fa())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await hu(e,t,r,Fo(),s);return f_(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(Wt(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await J_(e),r=new x_(e);return t.register("authEvent",s=>(H(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(wo,{type:wo},s=>{const o=s?.[0]?.[wo];o!==void 0&&t(!!o),At(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=j_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return eh()||Kl()||la()}}const hy=ly;var du="@firebase/auth",fu="1.11.1";class dy{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){H(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function fy(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function py(n){cr(new Mn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;H(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:th(n)},d=new Pg(r,s,o,h);return Fg(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),cr(new Mn("auth-internal",e=>{const t=wn(e.getProvider("auth").getImmediate());return(r=>new dy(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),pn(du,fu,fy(n)),pn(du,fu,"esm2020")}const my=300,gy=kl("authIdTokenMaxAge")||my;let pu=null;const _y=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>gy)return;const s=t?.token;pu!==s&&(pu=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function yy(n=xl()){const e=oa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Lg(n,{popupRedirectResolver:hy,persistence:[I_,l_,fh]}),r=kl("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=_y(o.toString());i_(t,a,()=>a(t.currentUser)),s_(t,u=>a(u))}}const s=Pl("auth");return s&&Ug(t,`http://${s}`),t}function vy(){return document.getElementsByTagName("head")?.[0]??document}Cg({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=kt("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",vy().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});py("Browser");var mu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var mn,Eh;(function(){var n;function e(I,g){function m(){}m.prototype=g.prototype,I.F=g.prototype,I.prototype=new m,I.prototype.constructor=I,I.D=function(T,E,A){for(var _=Array(arguments.length-2),j=2;j<arguments.length;j++)_[j-2]=arguments[j];return g.prototype[E].apply(T,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,g,m){m||(m=0);const T=Array(16);if(typeof g=="string")for(var E=0;E<16;++E)T[E]=g.charCodeAt(m++)|g.charCodeAt(m++)<<8|g.charCodeAt(m++)<<16|g.charCodeAt(m++)<<24;else for(E=0;E<16;++E)T[E]=g[m++]|g[m++]<<8|g[m++]<<16|g[m++]<<24;g=I.g[0],m=I.g[1],E=I.g[2];let A=I.g[3],_;_=g+(A^m&(E^A))+T[0]+3614090360&4294967295,g=m+(_<<7&4294967295|_>>>25),_=A+(E^g&(m^E))+T[1]+3905402710&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(m^A&(g^m))+T[2]+606105819&4294967295,E=A+(_<<17&4294967295|_>>>15),_=m+(g^E&(A^g))+T[3]+3250441966&4294967295,m=E+(_<<22&4294967295|_>>>10),_=g+(A^m&(E^A))+T[4]+4118548399&4294967295,g=m+(_<<7&4294967295|_>>>25),_=A+(E^g&(m^E))+T[5]+1200080426&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(m^A&(g^m))+T[6]+2821735955&4294967295,E=A+(_<<17&4294967295|_>>>15),_=m+(g^E&(A^g))+T[7]+4249261313&4294967295,m=E+(_<<22&4294967295|_>>>10),_=g+(A^m&(E^A))+T[8]+1770035416&4294967295,g=m+(_<<7&4294967295|_>>>25),_=A+(E^g&(m^E))+T[9]+2336552879&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(m^A&(g^m))+T[10]+4294925233&4294967295,E=A+(_<<17&4294967295|_>>>15),_=m+(g^E&(A^g))+T[11]+2304563134&4294967295,m=E+(_<<22&4294967295|_>>>10),_=g+(A^m&(E^A))+T[12]+1804603682&4294967295,g=m+(_<<7&4294967295|_>>>25),_=A+(E^g&(m^E))+T[13]+4254626195&4294967295,A=g+(_<<12&4294967295|_>>>20),_=E+(m^A&(g^m))+T[14]+2792965006&4294967295,E=A+(_<<17&4294967295|_>>>15),_=m+(g^E&(A^g))+T[15]+1236535329&4294967295,m=E+(_<<22&4294967295|_>>>10),_=g+(E^A&(m^E))+T[1]+4129170786&4294967295,g=m+(_<<5&4294967295|_>>>27),_=A+(m^E&(g^m))+T[6]+3225465664&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^m&(A^g))+T[11]+643717713&4294967295,E=A+(_<<14&4294967295|_>>>18),_=m+(A^g&(E^A))+T[0]+3921069994&4294967295,m=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(m^E))+T[5]+3593408605&4294967295,g=m+(_<<5&4294967295|_>>>27),_=A+(m^E&(g^m))+T[10]+38016083&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^m&(A^g))+T[15]+3634488961&4294967295,E=A+(_<<14&4294967295|_>>>18),_=m+(A^g&(E^A))+T[4]+3889429448&4294967295,m=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(m^E))+T[9]+568446438&4294967295,g=m+(_<<5&4294967295|_>>>27),_=A+(m^E&(g^m))+T[14]+3275163606&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^m&(A^g))+T[3]+4107603335&4294967295,E=A+(_<<14&4294967295|_>>>18),_=m+(A^g&(E^A))+T[8]+1163531501&4294967295,m=E+(_<<20&4294967295|_>>>12),_=g+(E^A&(m^E))+T[13]+2850285829&4294967295,g=m+(_<<5&4294967295|_>>>27),_=A+(m^E&(g^m))+T[2]+4243563512&4294967295,A=g+(_<<9&4294967295|_>>>23),_=E+(g^m&(A^g))+T[7]+1735328473&4294967295,E=A+(_<<14&4294967295|_>>>18),_=m+(A^g&(E^A))+T[12]+2368359562&4294967295,m=E+(_<<20&4294967295|_>>>12),_=g+(m^E^A)+T[5]+4294588738&4294967295,g=m+(_<<4&4294967295|_>>>28),_=A+(g^m^E)+T[8]+2272392833&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^m)+T[11]+1839030562&4294967295,E=A+(_<<16&4294967295|_>>>16),_=m+(E^A^g)+T[14]+4259657740&4294967295,m=E+(_<<23&4294967295|_>>>9),_=g+(m^E^A)+T[1]+2763975236&4294967295,g=m+(_<<4&4294967295|_>>>28),_=A+(g^m^E)+T[4]+1272893353&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^m)+T[7]+4139469664&4294967295,E=A+(_<<16&4294967295|_>>>16),_=m+(E^A^g)+T[10]+3200236656&4294967295,m=E+(_<<23&4294967295|_>>>9),_=g+(m^E^A)+T[13]+681279174&4294967295,g=m+(_<<4&4294967295|_>>>28),_=A+(g^m^E)+T[0]+3936430074&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^m)+T[3]+3572445317&4294967295,E=A+(_<<16&4294967295|_>>>16),_=m+(E^A^g)+T[6]+76029189&4294967295,m=E+(_<<23&4294967295|_>>>9),_=g+(m^E^A)+T[9]+3654602809&4294967295,g=m+(_<<4&4294967295|_>>>28),_=A+(g^m^E)+T[12]+3873151461&4294967295,A=g+(_<<11&4294967295|_>>>21),_=E+(A^g^m)+T[15]+530742520&4294967295,E=A+(_<<16&4294967295|_>>>16),_=m+(E^A^g)+T[2]+3299628645&4294967295,m=E+(_<<23&4294967295|_>>>9),_=g+(E^(m|~A))+T[0]+4096336452&4294967295,g=m+(_<<6&4294967295|_>>>26),_=A+(m^(g|~E))+T[7]+1126891415&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~m))+T[14]+2878612391&4294967295,E=A+(_<<15&4294967295|_>>>17),_=m+(A^(E|~g))+T[5]+4237533241&4294967295,m=E+(_<<21&4294967295|_>>>11),_=g+(E^(m|~A))+T[12]+1700485571&4294967295,g=m+(_<<6&4294967295|_>>>26),_=A+(m^(g|~E))+T[3]+2399980690&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~m))+T[10]+4293915773&4294967295,E=A+(_<<15&4294967295|_>>>17),_=m+(A^(E|~g))+T[1]+2240044497&4294967295,m=E+(_<<21&4294967295|_>>>11),_=g+(E^(m|~A))+T[8]+1873313359&4294967295,g=m+(_<<6&4294967295|_>>>26),_=A+(m^(g|~E))+T[15]+4264355552&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~m))+T[6]+2734768916&4294967295,E=A+(_<<15&4294967295|_>>>17),_=m+(A^(E|~g))+T[13]+1309151649&4294967295,m=E+(_<<21&4294967295|_>>>11),_=g+(E^(m|~A))+T[4]+4149444226&4294967295,g=m+(_<<6&4294967295|_>>>26),_=A+(m^(g|~E))+T[11]+3174756917&4294967295,A=g+(_<<10&4294967295|_>>>22),_=E+(g^(A|~m))+T[2]+718787259&4294967295,E=A+(_<<15&4294967295|_>>>17),_=m+(A^(E|~g))+T[9]+3951481745&4294967295,I.g[0]=I.g[0]+g&4294967295,I.g[1]=I.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,I.g[2]=I.g[2]+E&4294967295,I.g[3]=I.g[3]+A&4294967295}r.prototype.v=function(I,g){g===void 0&&(g=I.length);const m=g-this.blockSize,T=this.C;let E=this.h,A=0;for(;A<g;){if(E==0)for(;A<=m;)s(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<g;)if(T[E++]=I.charCodeAt(A++),E==this.blockSize){s(this,T),E=0;break}}else for(;A<g;)if(T[E++]=I[A++],E==this.blockSize){s(this,T),E=0;break}}this.h=E,this.o+=g},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var g=1;g<I.length-8;++g)I[g]=0;g=this.o*8;for(var m=I.length-8;m<I.length;++m)I[m]=g&255,g/=256;for(this.v(I),I=Array(16),g=0,m=0;m<4;++m)for(let T=0;T<32;T+=8)I[g++]=this.g[m]>>>T&255;return I};function o(I,g){var m=u;return Object.prototype.hasOwnProperty.call(m,I)?m[I]:m[I]=g(I)}function a(I,g){this.h=g;const m=[];let T=!0;for(let E=I.length-1;E>=0;E--){const A=I[E]|0;T&&A==g||(m[E]=A,T=!1)}this.g=m}var u={};function h(I){return-128<=I&&I<128?o(I,function(g){return new a([g|0],g<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return y;if(I<0)return C(d(-I));const g=[];let m=1;for(let T=0;I>=m;T++)g[T]=I/m|0,m*=4294967296;return new a(g,0)}function p(I,g){if(I.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(I.charAt(0)=="-")return C(p(I.substring(1),g));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const m=d(Math.pow(g,8));let T=y;for(let A=0;A<I.length;A+=8){var E=Math.min(8,I.length-A);const _=parseInt(I.substring(A,A+E),g);E<8?(E=d(Math.pow(g,E)),T=T.j(E).add(d(_))):(T=T.j(m),T=T.add(d(_)))}return T}var y=h(0),v=h(1),b=h(16777216);n=a.prototype,n.m=function(){if(k(this))return-C(this).m();let I=0,g=1;for(let m=0;m<this.g.length;m++){const T=this.i(m);I+=(T>=0?T:4294967296+T)*g,g*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(P(this))return"0";if(k(this))return"-"+C(this).toString(I);const g=d(Math.pow(I,6));var m=this;let T="";for(;;){const E=G(m,g).g;m=F(m,E.j(g));let A=((m.g.length>0?m.g[0]:m.h)>>>0).toString(I);if(m=E,P(m))return A+T;for(;A.length<6;)A="0"+A;T=A+T}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function P(I){if(I.h!=0)return!1;for(let g=0;g<I.g.length;g++)if(I.g[g]!=0)return!1;return!0}function k(I){return I.h==-1}n.l=function(I){return I=F(this,I),k(I)?-1:P(I)?0:1};function C(I){const g=I.g.length,m=[];for(let T=0;T<g;T++)m[T]=~I.g[T];return new a(m,~I.h).add(v)}n.abs=function(){return k(this)?C(this):this},n.add=function(I){const g=Math.max(this.g.length,I.g.length),m=[];let T=0;for(let E=0;E<=g;E++){let A=T+(this.i(E)&65535)+(I.i(E)&65535),_=(A>>>16)+(this.i(E)>>>16)+(I.i(E)>>>16);T=_>>>16,A&=65535,_&=65535,m[E]=_<<16|A}return new a(m,m[m.length-1]&-2147483648?-1:0)};function F(I,g){return I.add(C(g))}n.j=function(I){if(P(this)||P(I))return y;if(k(this))return k(I)?C(this).j(C(I)):C(C(this).j(I));if(k(I))return C(this.j(C(I)));if(this.l(b)<0&&I.l(b)<0)return d(this.m()*I.m());const g=this.g.length+I.g.length,m=[];for(var T=0;T<2*g;T++)m[T]=0;for(T=0;T<this.g.length;T++)for(let E=0;E<I.g.length;E++){const A=this.i(T)>>>16,_=this.i(T)&65535,j=I.i(E)>>>16,U=I.i(E)&65535;m[2*T+2*E]+=_*U,M(m,2*T+2*E),m[2*T+2*E+1]+=A*U,M(m,2*T+2*E+1),m[2*T+2*E+1]+=_*j,M(m,2*T+2*E+1),m[2*T+2*E+2]+=A*j,M(m,2*T+2*E+2)}for(I=0;I<g;I++)m[I]=m[2*I+1]<<16|m[2*I];for(I=g;I<2*g;I++)m[I]=0;return new a(m,0)};function M(I,g){for(;(I[g]&65535)!=I[g];)I[g+1]+=I[g]>>>16,I[g]&=65535,g++}function x(I,g){this.g=I,this.h=g}function G(I,g){if(P(g))throw Error("division by zero");if(P(I))return new x(y,y);if(k(I))return g=G(C(I),g),new x(C(g.g),C(g.h));if(k(g))return g=G(I,C(g)),new x(C(g.g),g.h);if(I.g.length>30){if(k(I)||k(g))throw Error("slowDivide_ only works with positive integers.");for(var m=v,T=g;T.l(I)<=0;)m=q(m),T=q(T);var E=J(m,1),A=J(T,1);for(T=J(T,2),m=J(m,2);!P(T);){var _=A.add(T);_.l(I)<=0&&(E=E.add(m),A=_),T=J(T,1),m=J(m,1)}return g=F(I,E.j(g)),new x(E,g)}for(E=y;I.l(g)>=0;){for(m=Math.max(1,Math.floor(I.m()/g.m())),T=Math.ceil(Math.log(m)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),A=d(m),_=A.j(g);k(_)||_.l(I)>0;)m-=T,A=d(m),_=A.j(g);P(A)&&(A=v),E=E.add(A),I=F(I,_)}return new x(E,I)}n.B=function(I){return G(this,I).h},n.and=function(I){const g=Math.max(this.g.length,I.g.length),m=[];for(let T=0;T<g;T++)m[T]=this.i(T)&I.i(T);return new a(m,this.h&I.h)},n.or=function(I){const g=Math.max(this.g.length,I.g.length),m=[];for(let T=0;T<g;T++)m[T]=this.i(T)|I.i(T);return new a(m,this.h|I.h)},n.xor=function(I){const g=Math.max(this.g.length,I.g.length),m=[];for(let T=0;T<g;T++)m[T]=this.i(T)^I.i(T);return new a(m,this.h^I.h)};function q(I){const g=I.g.length+1,m=[];for(let T=0;T<g;T++)m[T]=I.i(T)<<1|I.i(T-1)>>>31;return new a(m,I.h)}function J(I,g){const m=g>>5;g%=32;const T=I.g.length-m,E=[];for(let A=0;A<T;A++)E[A]=g>0?I.i(A+m)>>>g|I.i(A+m+1)<<32-g:I.i(A+m);return new a(E,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Eh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,mn=a}).apply(typeof mu<"u"?mu:typeof self<"u"?self:typeof window<"u"?window:{});var Bs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Th,qr,Ih,Ys,jo,wh,Ah,bh;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bs=="object"&&Bs];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var R=i[f];if(!(R in l))break e;l=l[R]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&e(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function p(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function y(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,R,S){for(var O=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)O[Z-2]=arguments[Z];return c.prototype[R].apply(f,O)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function b(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function P(i,c){for(let f=1;f<arguments.length;f++){const R=arguments[f];var l=typeof R;if(l=l!="object"?l:R?Array.isArray(R)?"array":l:"null",l=="array"||l=="object"&&typeof R.length=="number"){l=i.length||0;const S=R.length||0;i.length=l+S;for(let O=0;O<S;O++)i[l+O]=R[O]}else i.push(R)}}class k{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function C(i){a.setTimeout(()=>{throw i},0)}function F(){var i=I;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class M{constructor(){this.h=this.g=null}add(c,l){const f=x.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var x=new k(()=>new G,i=>i.reset());class G{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let q,J=!1,I=new M,g=()=>{const i=Promise.resolve(void 0);q=()=>{i.then(m)}};function m(){for(var i;i=F();){try{i.h.call(i.g)}catch(l){C(l)}var c=x;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}J=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function _(i){return/^[\s\xa0]*$/.test(i)}function j(i,c){E.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}y(j,E),j.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&j.Z.h.call(this)},j.prototype.h=function(){j.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var U="closure_listenable_"+(Math.random()*1e6|0),de=0;function ue(i,c,l,f,R){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=R,this.key=++de,this.da=this.fa=!1}function ve(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function ae(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function ze(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function fe(i){const c={};for(const l in i)c[l]=i[l];return c}const Ce="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ke(i,c){let l,f;for(let R=1;R<arguments.length;R++){f=arguments[R];for(l in f)i[l]=f[l];for(let S=0;S<Ce.length;S++)l=Ce[S],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function Ie(i){this.src=i,this.g={},this.h=0}Ie.prototype.add=function(i,c,l,f,R){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const O=it(i,c,f,R);return O>-1?(c=i[O],l||(c.fa=!1)):(c=new ue(c,this.src,S,!!f,R),c.fa=l,i.push(c)),c};function He(i,c){const l=c.type;if(l in i.g){var f=i.g[l],R=Array.prototype.indexOf.call(f,c,void 0),S;(S=R>=0)&&Array.prototype.splice.call(f,R,1),S&&(ve(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function it(i,c,l,f){for(let R=0;R<i.length;++R){const S=i[R];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return R}return-1}var ut="closure_lm_"+(Math.random()*1e6|0),Xe={};function rt(i,c,l,f,R){if(Array.isArray(c)){for(let S=0;S<c.length;S++)rt(i,c[S],l,f,R);return null}return l=wr(l),i&&i[U]?i.J(c,l,u(f)?!!f.capture:!1,R):ft(i,c,l,!1,f,R)}function ft(i,c,l,f,R,S){if(!c)throw Error("Invalid event type");const O=u(R)?!!R.capture:!!R;let Z=$n(i);if(Z||(i[ut]=Z=new Ie(i)),l=Z.add(c,l,f,O,S),l.proxy)return l;if(f=Et(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)A||(R=O),R===void 0&&(R=!1),i.addEventListener(c.toString(),f,R);else if(i.attachEvent)i.attachEvent(Tr(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Et(){function i(l){return c.call(i.src,i.listener,l)}const c=Qi;return i}function Je(i,c,l,f,R){if(Array.isArray(c))for(var S=0;S<c.length;S++)Je(i,c[S],l,f,R);else f=u(f)?!!f.capture:!!f,l=wr(l),i&&i[U]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],l=it(c,l,f,R),l>-1&&(ve(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=$n(i))&&(c=i.g[c.toString()],i=-1,c&&(i=it(c,l,f,R)),(l=i>-1?c[i]:null)&&pt(l))}function pt(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[U])He(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(Tr(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=$n(c))?(He(l,i),l.h==0&&(l.src=null,c[ut]=null)):ve(i)}}}function Tr(i){return i in Xe?Xe[i]:Xe[i]="on"+i}function Qi(i,c){if(i.da)i=!0;else{c=new j(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&pt(i),i=l.call(f,c)}return i}function $n(i){return i=i[ut],i instanceof Ie?i:null}var Ir="__closure_events_fn_"+(Math.random()*1e9>>>0);function wr(i){return typeof i=="function"?i:(i[Ir]||(i[Ir]=function(c){return i.handleEvent(c)}),i[Ir])}function xe(){T.call(this),this.i=new Ie(this),this.M=this,this.G=null}y(xe,T),xe.prototype[U]=!0,xe.prototype.removeEventListener=function(i,c,l,f){Je(this,i,c,l,f)};function Le(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new E(c,i);else if(c instanceof E)c.target=c.target||i;else{var R=c;c=new E(f,i),ke(c,R)}R=!0;let S,O;if(l)for(O=l.length-1;O>=0;O--)S=c.g=l[O],R=zn(S,f,!0,c)&&R;if(S=c.g=i,R=zn(S,f,!0,c)&&R,R=zn(S,f,!1,c)&&R,l)for(O=0;O<l.length;O++)S=c.g=l[O],R=zn(S,f,!1,c)&&R}xe.prototype.N=function(){if(xe.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)ve(l[f]);delete i.g[c],i.h--}}this.G=null},xe.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},xe.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function zn(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let R=!0;for(let S=0;S<c.length;++S){const O=c[S];if(O&&!O.da&&O.capture==l){const Z=O.listener,Ne=O.ha||O.src;O.fa&&He(i.i,O),R=Z.call(Ne,f)!==!1&&R}}return R&&!f.defaultPrevented}function Is(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function ws(i){i.g=Is(()=>{i.g=null,i.i&&(i.i=!1,ws(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class As extends T{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:ws(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function we(i){T.call(this),this.h=i,this.g={}}y(we,T);var Fe=[];function Ve(i){ae(i.g,function(c,l){this.g.hasOwnProperty(l)&&pt(c)},i),i.g={}}we.prototype.N=function(){we.Z.N.call(this),Ve(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var We=a.JSON.stringify,ot=a.JSON.parse,mt=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Tt(){}function bt(){}var Ae={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ge(){E.call(this,"d")}y(Ge,E);function De(){E.call(this,"c")}y(De,E);var lt={},bs=null;function Rs(){return bs=bs||new xe}lt.Ia="serverreachability";function Wa(i){E.call(this,lt.Ia,i)}y(Wa,E);function Ar(i){const c=Rs();Le(c,new Wa(c))}lt.STAT_EVENT="statevent";function Ga(i,c){E.call(this,lt.STAT_EVENT,i),this.stat=c}y(Ga,E);function st(i){const c=Rs();Le(c,new Ga(c,i))}lt.Ja="timingevent";function Ka(i,c){E.call(this,lt.Ja,i),this.size=c}y(Ka,E);function br(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function Rr(){this.g=!0}Rr.prototype.ua=function(){this.g=!1};function ef(i,c,l,f,R,S){i.info(function(){if(i.g)if(S){var O="",Z=S.split("&");for(let ce=0;ce<Z.length;ce++){var Ne=Z[ce].split("=");if(Ne.length>1){const Ue=Ne[0];Ne=Ne[1];const St=Ue.split("_");O=St.length>=2&&St[1]=="type"?O+(Ue+"="+Ne+"&"):O+(Ue+"=redacted&")}}}else O=null;else O=S;return"XMLHTTP REQ ("+f+") [attempt "+R+"]: "+c+`
`+l+`
`+O})}function tf(i,c,l,f,R,S,O){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+R+"]: "+c+`
`+l+`
`+S+" "+O})}function Hn(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+rf(i,l)+(f?" "+f:"")})}function nf(i,c){i.info(function(){return"TIMEOUT: "+c})}Rr.prototype.info=function(){};function rf(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var l=S[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var R=f[0];if(R!="noop"&&R!="stop"&&R!="close")for(let O=1;O<f.length;O++)f[O]=""}}}}return We(S)}catch{return c}}var Ss={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Qa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ya;function Yi(){}y(Yi,Tt),Yi.prototype.g=function(){return new XMLHttpRequest},Ya=new Yi;function Sr(i){return encodeURIComponent(String(i))}function sf(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Zt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new we(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Xa}function Xa(){this.i=null,this.g="",this.h=!1}var Ja={},Xi={};function Ji(i,c,l){i.M=1,i.A=Cs(Rt(c)),i.u=l,i.R=!0,Za(i,null)}function Za(i,c){i.F=Date.now(),Ps(i),i.B=Rt(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),dc(l.i,"t",f),i.C=0,l=i.j.L,i.h=new Xa,i.g=kc(i.j,l?c:null,!i.u),i.P>0&&(i.O=new As(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var R="readystatechange";Array.isArray(R)||(R&&(Fe[0]=R.toString()),R=Fe);for(let S=0;S<R.length;S++){const O=rt(l,R[S],f||c.handleEvent,!1,c.h||c);if(!O)break;c.g[O.key]=O}c=i.J?fe(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),Ar(),ef(i.i,i.v,i.B,i.l,i.S,i.u)}Zt.prototype.ba=function(i){i=i.target;const c=this.O;c&&nn(i)==3?c.j():this.Y(i)},Zt.prototype.Y=function(i){try{if(i==this.g)e:{const Z=nn(this.g),Ne=this.g.ya(),ce=this.g.ca();if(!(Z<3)&&(Z!=3||this.g&&(this.h.h||this.g.la()||vc(this.g)))){this.K||Z!=4||Ne==7||(Ne==8||ce<=0?Ar(3):Ar(2)),Zi(this);var c=this.g.ca();this.X=c;var l=of(this);if(this.o=c==200,tf(this.i,this.v,this.B,this.l,this.S,Z,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,R=this.g;if((f=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var S=f;break t}}S=null}if(i=S)Hn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eo(this,i);else{this.o=!1,this.m=3,st(12),Rn(this),Pr(this);break e}}if(this.R){i=!0;let Ue;for(;!this.K&&this.C<l.length;)if(Ue=af(this,l),Ue==Xi){Z==4&&(this.m=4,st(14),i=!1),Hn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ue==Ja){this.m=4,st(15),Hn(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Hn(this.i,this.l,Ue,null),eo(this,Ue);if(ec(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Z!=4||l.length!=0||this.h.h||(this.m=1,st(16),i=!1),this.o=this.o&&i,!i)Hn(this.i,this.l,l,"[Invalid Chunked Response]"),Rn(this),Pr(this);else if(l.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),co(O),O.P=!0,st(11))}}else Hn(this.i,this.l,l,null),eo(this,l);Z==4&&Rn(this),this.o&&!this.K&&(Z==4?Rc(this.j,this):(this.o=!1,Ps(this)))}else Tf(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,st(12)):(this.m=0,st(13)),Rn(this),Pr(this)}}}catch{}finally{}};function of(i){if(!ec(i))return i.g.la();const c=vc(i.g);if(c==="")return"";let l="";const f=c.length,R=nn(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Rn(i),Pr(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,l+=i.h.i.decode(c[S],{stream:!(R&&S==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function ec(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function af(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?Xi:(l=Number(c.substring(l,f)),isNaN(l)?Ja:(f+=1,f+l>c.length?Xi:(c=c.slice(f,f+l),i.C=f+l,c)))}Zt.prototype.cancel=function(){this.K=!0,Rn(this)};function Ps(i){i.T=Date.now()+i.H,tc(i,i.H)}function tc(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=br(d(i.aa,i),c)}function Zi(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Zt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(nf(this.i,this.B),this.M!=2&&(Ar(),st(17)),Rn(this),this.m=2,Pr(this)):tc(this,this.T-i)};function Pr(i){i.j.I==0||i.K||Rc(i.j,i)}function Rn(i){Zi(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Ve(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function eo(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||to(l.h,i))){if(!i.L&&to(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var R=f;if(R[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)Os(l),Ds(l);else break e;ao(l),st(18)}}else l.xa=R[1],0<l.xa-l.K&&R[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=br(d(l.Va,l),6e3));sc(l.h)<=1&&l.ta&&(l.ta=void 0)}else Pn(l,11)}else if((i.L||l.g==i)&&Os(l),!_(c))for(R=l.Ba.g.parse(c),c=0;c<R.length;c++){let ce=R[c];const Ue=ce[0];if(!(Ue<=l.K))if(l.K=Ue,ce=ce[1],l.I==2)if(ce[0]=="c"){l.M=ce[1],l.ba=ce[2];const St=ce[3];St!=null&&(l.ka=St,l.j.info("VER="+l.ka));const Cn=ce[4];Cn!=null&&(l.za=Cn,l.j.info("SVER="+l.za));const rn=ce[5];rn!=null&&typeof rn=="number"&&rn>0&&(f=1.5*rn,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const sn=i.g;if(sn){const xs=sn.g?sn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xs){var S=f.h;S.g||xs.indexOf("spdy")==-1&&xs.indexOf("quic")==-1&&xs.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(no(S,S.h),S.h=null))}if(f.G){const uo=sn.g?sn.g.getResponseHeader("X-HTTP-Session-Id"):null;uo&&(f.wa=uo,pe(f.J,f.G,uo))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var O=i;if(f.na=Cc(f,f.L?f.ba:null,f.W),O.L){ic(f.h,O);var Z=O,Ne=f.O;Ne&&(Z.H=Ne),Z.D&&(Zi(Z),Ps(Z)),f.g=O}else Ac(f);l.i.length>0&&Ns(l)}else ce[0]!="stop"&&ce[0]!="close"||Pn(l,7);else l.I==3&&(ce[0]=="stop"||ce[0]=="close"?ce[0]=="stop"?Pn(l,7):oo(l):ce[0]!="noop"&&l.l&&l.l.qa(ce),l.A=0)}}Ar(4)}catch{}}var cf=class{constructor(i,c){this.g=i,this.map=c}};function nc(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function rc(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function sc(i){return i.h?1:i.g?i.g.size:0}function to(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function no(i,c){i.g?i.g.add(c):i.h=c}function ic(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}nc.prototype.cancel=function(){if(this.i=oc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function oc(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return b(i.i)}var ac=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function uf(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let R,S=null;f>=0?(R=i[l].substring(0,f),S=i[l].substring(f+1)):R=i[l],c(R,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function en(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof en?(this.l=i.l,Cr(this,i.j),this.o=i.o,this.g=i.g,kr(this,i.u),this.h=i.h,ro(this,fc(i.i)),this.m=i.m):i&&(c=String(i).match(ac))?(this.l=!1,Cr(this,c[1]||"",!0),this.o=Vr(c[2]||""),this.g=Vr(c[3]||"",!0),kr(this,c[4]),this.h=Vr(c[5]||"",!0),ro(this,c[6]||"",!0),this.m=Vr(c[7]||"")):(this.l=!1,this.i=new Nr(null,this.l))}en.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Dr(c,cc,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Dr(c,cc,!0),"@"),i.push(Sr(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(Dr(l,l.charAt(0)=="/"?df:hf,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",Dr(l,pf)),i.join("")},en.prototype.resolve=function(i){const c=Rt(this);let l=!!i.j;l?Cr(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)kr(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var R=c.h.lastIndexOf("/");R!=-1&&(f=c.h.slice(0,R+1)+f)}if(R=f,R==".."||R==".")f="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){f=R.lastIndexOf("/",0)==0,R=R.split("/");const S=[];for(let O=0;O<R.length;){const Z=R[O++];Z=="."?f&&O==R.length&&S.push(""):Z==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&O==R.length&&S.push("")):(S.push(Z),f=!0)}f=S.join("/")}else f=R}return l?c.h=f:l=i.i.toString()!=="",l?ro(c,fc(i.i)):l=!!i.m,l&&(c.m=i.m),c};function Rt(i){return new en(i)}function Cr(i,c,l){i.j=l?Vr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function kr(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function ro(i,c,l){c instanceof Nr?(i.i=c,mf(i.i,i.l)):(l||(c=Dr(c,ff)),i.i=new Nr(c,i.l))}function pe(i,c,l){i.i.set(c,l)}function Cs(i){return pe(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function Vr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Dr(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,lf),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function lf(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var cc=/[#\/\?@]/g,hf=/[#\?:]/g,df=/[#\?]/g,ff=/[#\?@]/g,pf=/#/g;function Nr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Sn(i){i.g||(i.g=new Map,i.h=0,i.i&&uf(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=Nr.prototype,n.add=function(i,c){Sn(this),this.i=null,i=Wn(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function uc(i,c){Sn(i),c=Wn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function lc(i,c){return Sn(i),c=Wn(i,c),i.g.has(c)}n.forEach=function(i,c){Sn(this),this.g.forEach(function(l,f){l.forEach(function(R){i.call(c,R,f,this)},this)},this)};function hc(i,c){Sn(i);let l=[];if(typeof c=="string")lc(i,c)&&(l=l.concat(i.g.get(Wn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return Sn(this),this.i=null,i=Wn(this,i),lc(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=hc(this,i),i.length>0?String(i[0]):c):c};function dc(i,c,l){uc(i,c),l.length>0&&(i.i=null,i.g.set(Wn(i,c),b(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const R=Sr(l);l=hc(this,l);for(let S=0;S<l.length;S++){let O=R;l[S]!==""&&(O+="="+Sr(l[S])),i.push(O)}}return this.i=i.join("&")};function fc(i){const c=new Nr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Wn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function mf(i,c){c&&!i.j&&(Sn(i),i.i=null,i.g.forEach(function(l,f){const R=f.toLowerCase();f!=R&&(uc(this,f),dc(this,R,l))},i)),i.j=c}function gf(i,c){const l=new Rr;if(a.Image){const f=new Image;f.onload=p(tn,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(tn,l,"TestLoadImage: error",!1,c,f),f.onabort=p(tn,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(tn,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function _f(i,c){const l=new Rr,f=new AbortController,R=setTimeout(()=>{f.abort(),tn(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(R),S.ok?tn(l,"TestPingServer: ok",!0,c):tn(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(R),tn(l,"TestPingServer: error",!1,c)})}function tn(i,c,l,f,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),f(l)}catch{}}function yf(){this.g=new mt}function so(i){this.i=i.Sb||null,this.h=i.ab||!1}y(so,Tt),so.prototype.g=function(){return new ks(this.i,this.h)};function ks(i,c){xe.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}y(ks,xe),n=ks.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Mr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Or(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Mr(this)),this.g&&(this.readyState=3,Mr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;pc(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function pc(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Or(this):Mr(this),this.readyState==3&&pc(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Or(this))},n.Na=function(i){this.g&&(this.response=i,Or(this))},n.ga=function(){this.g&&Or(this)};function Or(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Mr(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function Mr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(ks.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function mc(i){let c="";return ae(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function io(i,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=mc(l),typeof i=="string"?l!=null&&Sr(l):pe(i,c,l))}function Ee(i){xe.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}y(Ee,xe);var vf=/^https?$/i,Ef=["POST","PUT"];n=Ee.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ya.g(),this.g.onreadystatechange=v(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){gc(this,S);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var R in f)l.set(R,f[R]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),R=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Ef,c,void 0)>=0)||f||R||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,O]of l)this.g.setRequestHeader(S,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){gc(this,S)}};function gc(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,_c(i),Vs(i)}function _c(i){i.A||(i.A=!0,Le(i,"complete"),Le(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Le(this,"complete"),Le(this,"abort"),Vs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vs(this,!0)),Ee.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?yc(this):this.Xa())},n.Xa=function(){yc(this)};function yc(i){if(i.h&&typeof o<"u"){if(i.v&&nn(i)==4)setTimeout(i.Ca.bind(i),0);else if(Le(i,"readystatechange"),nn(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let O=String(i.D).match(ac)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),f=!vf.test(O?O.toLowerCase():"")}l=f}if(l)Le(i,"complete"),Le(i,"success");else{i.o=6;try{var R=nn(i)>2?i.g.statusText:""}catch{R=""}i.l=R+" ["+i.ca()+"]",_c(i)}}finally{Vs(i)}}}}function Vs(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||Le(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function nn(i){return i.g?i.g.readyState:0}n.ca=function(){try{return nn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),ot(c)}};function vc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Tf(i){const c={};i=(i.g&&nn(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(_(i[f]))continue;var l=sf(i[f]);const R=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const S=c[R]||[];c[R]=S,S.push(l)}ze(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function xr(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function Ec(i){this.za=0,this.i=[],this.j=new Rr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=xr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=xr("baseRetryDelayMs",5e3,i),this.Za=xr("retryDelaySeedMs",1e4,i),this.Ta=xr("forwardChannelMaxRetries",2,i),this.va=xr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new nc(i&&i.concurrentRequestLimit),this.Ba=new yf,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ec.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){st(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=Cc(this,null,this.W),Ns(this)};function oo(i){if(Tc(i),i.I==3){var c=i.V++,l=Rt(i.J);if(pe(l,"SID",i.M),pe(l,"RID",c),pe(l,"TYPE","terminate"),Lr(i,l),c=new Zt(i,i.j,c),c.M=2,c.A=Cs(Rt(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=kc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Ps(c)}Pc(i)}function Ds(i){i.g&&(co(i),i.g.cancel(),i.g=null)}function Tc(i){Ds(i),i.v&&(a.clearTimeout(i.v),i.v=null),Os(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Ns(i){if(!rc(i.h)&&!i.m){i.m=!0;var c=i.Ea;q||g(),J||(q(),J=!0),I.add(c,i),i.D=0}}function If(i,c){return sc(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=br(d(i.Ea,i,c),Sc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const R=new Zt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=fe(S),ke(S,this.U)):S=this.U),this.u!==null||this.R||(R.J=S,S=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=wc(this,R,c),l=Rt(this.J),pe(l,"RID",i),pe(l,"CVER",22),this.G&&pe(l,"X-HTTP-Session-Id",this.G),Lr(this,l),S&&(this.R?c="headers="+Sr(mc(S))+"&"+c:this.u&&io(l,this.u,S)),no(this.h,R),this.Ra&&pe(l,"TYPE","init"),this.S?(pe(l,"$req",c),pe(l,"SID","null"),R.U=!0,Ji(R,l,null)):Ji(R,l,c),this.I=2}}else this.I==3&&(i?Ic(this,i):this.i.length==0||rc(this.h)||Ic(this))};function Ic(i,c){var l;c?l=c.l:l=i.V++;const f=Rt(i.J);pe(f,"SID",i.M),pe(f,"RID",l),pe(f,"AID",i.K),Lr(i,f),i.u&&i.o&&io(f,i.u,i.o),l=new Zt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=wc(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),no(i.h,l),Ji(l,f,c)}function Lr(i,c){i.H&&ae(i.H,function(l,f){pe(c,f,l)}),i.l&&ae({},function(l,f){pe(c,f,l)})}function wc(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var R=i.i;let Z=-1;for(;;){const Ne=["count="+l];Z==-1?l>0?(Z=R[0].g,Ne.push("ofs="+Z)):Z=0:Ne.push("ofs="+Z);let ce=!0;for(let Ue=0;Ue<l;Ue++){var S=R[Ue].g;const St=R[Ue].map;if(S-=Z,S<0)Z=Math.max(0,R[Ue].g-100),ce=!1;else try{S="req"+S+"_"||"";try{var O=St instanceof Map?St:Object.entries(St);for(const[Cn,rn]of O){let sn=rn;u(rn)&&(sn=We(rn)),Ne.push(S+Cn+"="+encodeURIComponent(sn))}}catch(Cn){throw Ne.push(S+"type="+encodeURIComponent("_badmap")),Cn}}catch{f&&f(St)}}if(ce){O=Ne.join("&");break e}}O=void 0}return i=i.i.splice(0,l),c.G=i,O}function Ac(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;q||g(),J||(q(),J=!0),I.add(c,i),i.A=0}}function ao(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=br(d(i.Da,i),Sc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,bc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=br(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,st(10),Ds(this),bc(this))};function co(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function bc(i){i.g=new Zt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Rt(i.na);pe(c,"RID","rpc"),pe(c,"SID",i.M),pe(c,"AID",i.K),pe(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&pe(c,"TO",i.ia),pe(c,"TYPE","xmlhttp"),Lr(i,c),i.u&&i.o&&io(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=Cs(Rt(c)),l.u=null,l.R=!0,Za(l,i)}n.Va=function(){this.C!=null&&(this.C=null,Ds(this),ao(this),st(19))};function Os(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Rc(i,c){var l=null;if(i.g==c){Os(i),co(i),i.g=null;var f=2}else if(to(i.h,c))l=c.G,ic(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var R=i.D;f=Rs(),Le(f,new Ka(f,l)),Ns(i)}else Ac(i);else if(R=c.m,R==3||R==0&&c.X>0||!(f==1&&If(i,c)||f==2&&ao(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),R){case 1:Pn(i,5);break;case 4:Pn(i,10);break;case 3:Pn(i,6);break;default:Pn(i,2)}}}function Sc(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function Pn(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const R=!f;f=new en(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Cr(f,"https"),Cs(f),R?gf(f.toString(),l):_f(f.toString(),l)}else st(2);i.I=0,i.l&&i.l.pa(c),Pc(i),Tc(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),st(2)):(this.j.info("Failed to ping google.com"),st(1))};function Pc(i){if(i.I=0,i.ja=[],i.l){const c=oc(i.h);(c.length!=0||i.i.length!=0)&&(P(i.ja,c),P(i.ja,i.i),i.h.i.length=0,b(i.i),i.i.length=0),i.l.oa()}}function Cc(i,c,l){var f=l instanceof en?Rt(l):new en(l);if(f.g!="")c&&(f.g=c+"."+f.g),kr(f,f.u);else{var R=a.location;f=R.protocol,c=c?c+"."+R.hostname:R.hostname,R=+R.port;const S=new en(null);f&&Cr(S,f),c&&(S.g=c),R&&kr(S,R),l&&(S.h=l),f=S}return l=i.G,c=i.wa,l&&c&&pe(f,l,c),pe(f,"VER",i.ka),Lr(i,f),f}function kc(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Ee(new so({ab:l})):new Ee(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vc(){}n=Vc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ms(){}Ms.prototype.g=function(i,c){return new ht(i,c)};function ht(i,c){xe.call(this),this.g=new Ec(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!_(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Gn(this)}y(ht,xe),ht.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ht.prototype.close=function(){oo(this.g)},ht.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=We(i),i=l);c.i.push(new cf(c.Ya++,i)),c.I==3&&Ns(c)},ht.prototype.N=function(){this.g.l=null,delete this.j,oo(this.g),delete this.g,ht.Z.N.call(this)};function Dc(i){Ge.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const l in c){i=l;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}y(Dc,Ge);function Nc(){De.call(this),this.status=1}y(Nc,De);function Gn(i){this.g=i}y(Gn,Vc),Gn.prototype.ra=function(){Le(this.g,"a")},Gn.prototype.qa=function(i){Le(this.g,new Dc(i))},Gn.prototype.pa=function(i){Le(this.g,new Nc)},Gn.prototype.oa=function(){Le(this.g,"b")},Ms.prototype.createWebChannel=Ms.prototype.g,ht.prototype.send=ht.prototype.o,ht.prototype.open=ht.prototype.m,ht.prototype.close=ht.prototype.close,bh=function(){return new Ms},Ah=function(){return Rs()},wh=lt,jo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ss.NO_ERROR=0,Ss.TIMEOUT=8,Ss.HTTP_ERROR=6,Ys=Ss,Qa.COMPLETE="complete",Ih=Qa,bt.EventType=Ae,Ae.OPEN="a",Ae.CLOSE="b",Ae.ERROR="c",Ae.MESSAGE="d",xe.prototype.listen=xe.prototype.J,qr=bt,Ee.prototype.listenOnce=Ee.prototype.K,Ee.prototype.getLastError=Ee.prototype.Ha,Ee.prototype.getLastErrorCode=Ee.prototype.ya,Ee.prototype.getStatus=Ee.prototype.ca,Ee.prototype.getResponseJson=Ee.prototype.La,Ee.prototype.getResponseText=Ee.prototype.la,Ee.prototype.send=Ee.prototype.ea,Ee.prototype.setWithCredentials=Ee.prototype.Fa,Th=Ee}).apply(typeof Bs<"u"?Bs:typeof self<"u"?self:typeof window<"u"?window:{});const gu="@firebase/firestore",_u="4.9.2";class et{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}et.UNAUTHENTICATED=new et(null),et.GOOGLE_CREDENTIALS=new et("google-credentials-uid"),et.FIRST_PARTY=new et("first-party-uid"),et.MOCK_USER=new et("mock-user");let _r="12.3.0";const Fn=new sa("@firebase/firestore");function Yn(){return Fn.logLevel}function L(n,...e){if(Fn.logLevel<=ee.DEBUG){const t=e.map(ma);Fn.debug(`Firestore (${_r}): ${n}`,...t)}}function Gt(n,...e){if(Fn.logLevel<=ee.ERROR){const t=e.map(ma);Fn.error(`Firestore (${_r}): ${n}`,...t)}}function ur(n,...e){if(Fn.logLevel<=ee.WARN){const t=e.map(ma);Fn.warn(`Firestore (${_r}): ${n}`,...t)}}function ma(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function W(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Rh(n,r,t)}function Rh(n,e,t){let r=`FIRESTORE (${_r}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Gt(r),new Error(r)}function oe(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Rh(e,s,r)}function X(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends Yt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class zt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Sh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ey{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(et.UNAUTHENTICATED)))}shutdown(){}}class Ty{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Iy{constructor(e){this.t=e,this.currentUser=et.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){oe(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new zt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new zt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new zt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(oe(typeof r.accessToken=="string",31837,{l:r}),new Sh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return oe(e===null||typeof e=="string",2055,{h:e}),new et(e)}}class wy{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=et.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ay{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new wy(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(et.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class yu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class by{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,yt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){oe(this.o===void 0,3512);const r=o=>{o.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new yu(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(oe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new yu(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ry(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class ga{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Ry(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function te(n,e){return n<e?-1:n>e?1:0}function qo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Ao(s)===Ao(o)?te(s,o):Ao(s)?1:-1}return te(n.length,e.length)}const Sy=55296,Py=57343;function Ao(n){const e=n.charCodeAt(0);return e>=Sy&&e<=Py}function lr(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const vu="__name__";class Ct{constructor(e,t,r){t===void 0?t=0:t>e.length&&W(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&W(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ct.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ct?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=Ct.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return te(e.length,t.length)}static compareSegments(e,t){const r=Ct.isNumericId(e),s=Ct.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ct.extractNumericId(e).compare(Ct.extractNumericId(t)):qo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mn.fromString(e.substring(4,e.length-2))}}class me extends Ct{construct(e,t,r){return new me(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new B(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new me(t)}static emptyPath(){return new me([])}}const Cy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qe extends Ct{construct(e,t,r){return new Qe(e,t,r)}static isValidIdentifier(e){return Cy.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===vu}static keyField(){return new Qe([vu])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new B(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new B(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new B(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new B(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Qe(t)}static emptyPath(){return new Qe([])}}class z{constructor(e){this.path=e}static fromPath(e){return new z(me.fromString(e))}static fromName(e){return new z(me.fromString(e).popFirst(5))}static empty(){return new z(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&me.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new z(new me(e.slice()))}}function Ph(n,e,t){if(!t)throw new B(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ky(n,e,t,r){if(e===!0&&r===!0)throw new B(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Eu(n){if(!z.isDocumentKey(n))throw new B(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Tu(n){if(z.isDocumentKey(n))throw new B(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ch(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function _a(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":W(12329,{type:typeof n})}function Kt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new B(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_a(n);throw new B(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Se(n,e){const t={typeString:n};return e&&(t.value=e),t}function gs(n,e){if(!Ch(n))throw new B(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new B(D.INVALID_ARGUMENT,t);return!0}const Iu=-62135596800,wu=1e6;class ge{static now(){return ge.fromMillis(Date.now())}static fromDate(e){return ge.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*wu);return new ge(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Iu)throw new B(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/wu}_compareTo(e){return this.seconds===e.seconds?te(this.nanoseconds,e.nanoseconds):te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ge._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(gs(e,ge._jsonSchema))return new ge(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Iu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ge._jsonSchemaVersion="firestore/timestamp/1.0",ge._jsonSchema={type:Se("string",ge._jsonSchemaVersion),seconds:Se("number"),nanoseconds:Se("number")};class Y{static fromTimestamp(e){return new Y(e)}static min(){return new Y(new ge(0,0))}static max(){return new Y(new ge(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ss=-1;function Vy(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Y.fromTimestamp(r===1e9?new ge(t+1,0):new ge(t,r));return new _n(s,z.empty(),e)}function Dy(n){return new _n(n.readTime,n.key,ss)}class _n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new _n(Y.min(),z.empty(),ss)}static max(){return new _n(Y.max(),z.empty(),ss)}}function Ny(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=z.comparator(n.documentKey,e.documentKey),t!==0?t:te(n.largestBatchId,e.largestBatchId))}const Oy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class My{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function yr(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==Oy)throw n;L("LocalStore","Unexpectedly lost primary lease")}class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):V.reject(t)}static resolve(e){return new V(((t,r)=>{t(e)}))}static reject(e){return new V(((t,r)=>{r(e)}))}static waitFor(e){return new V(((t,r)=>{let s=0,o=0,a=!1;e.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next((s=>s?V.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new V(((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++u,u===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new V(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function xy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function vr(n){return n.name==="IndexedDbTransactionError"}class Di{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Di.ce=-1;const ya=-1;function Ni(n){return n==null}function di(n){return n===0&&1/n==-1/0}function Ly(n){return typeof n=="number"&&Number.isInteger(n)&&!di(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const kh="";function Fy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Au(e)),e=Uy(n.get(t),e);return Au(e)}function Uy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case kh:t+="";break;default:t+=o}}return t}function Au(n){return n+kh+""}function bu(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function An(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Vh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ye{constructor(e,t){this.comparator=e,this.root=t||Ke.EMPTY}insert(e,t){return new ye(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ke.BLACK,null,null))}remove(e){return new ye(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ke.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new js(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new js(this.root,e,this.comparator,!1)}getReverseIterator(){return new js(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new js(this.root,e,this.comparator,!0)}}class js{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ke{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Ke.RED,this.left=s??Ke.EMPTY,this.right=o??Ke.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Ke(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ke.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ke.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ke.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ke.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw W(27949);return e+(this.isRed()?0:1)}}Ke.EMPTY=null,Ke.RED=!0,Ke.BLACK=!1;Ke.EMPTY=new class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Ke(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Me{constructor(e){this.comparator=e,this.data=new ye(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ru(this.data.getIterator())}getIteratorFrom(e){return new Ru(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Me)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Me(this.comparator);return t.data=e,t}}class Ru{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class dt{constructor(e){this.fields=e,e.sort(Qe.comparator)}static empty(){return new dt([])}unionWith(e){let t=new Me(Qe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new dt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lr(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Dh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ye{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Dh("Invalid base64 string: "+o):o}})(e);return new Ye(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Ye(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ye.EMPTY_BYTE_STRING=new Ye("");const By=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yn(n){if(oe(!!n,39018),typeof n=="string"){let e=0;const t=By.exec(n);if(oe(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:be(n.seconds),nanos:be(n.nanos)}}function be(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function vn(n){return typeof n=="string"?Ye.fromBase64String(n):Ye.fromUint8Array(n)}const Nh="server_timestamp",Oh="__type__",Mh="__previous_value__",xh="__local_write_time__";function va(n){return(n?.mapValue?.fields||{})[Oh]?.stringValue===Nh}function Oi(n){const e=n.mapValue.fields[Mh];return va(e)?Oi(e):e}function is(n){const e=yn(n.mapValue.fields[xh].timestampValue);return new ge(e.seconds,e.nanos)}class jy{constructor(e,t,r,s,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const fi="(default)";class os{constructor(e,t){this.projectId=e,this.database=t||fi}static empty(){return new os("","")}get isDefaultDatabase(){return this.database===fi}isEqual(e){return e instanceof os&&e.projectId===this.projectId&&e.database===this.database}}const Lh="__type__",qy="__max__",qs={mapValue:{}},Fh="__vector__",pi="value";function En(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?va(n)?4:zy(n)?9007199254740991:$y(n)?10:11:W(28295,{value:n})}function Lt(n,e){if(n===e)return!0;const t=En(n);if(t!==En(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return is(n).isEqual(is(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=yn(s.timestampValue),u=yn(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return vn(s.bytesValue).isEqual(vn(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return be(s.geoPointValue.latitude)===be(o.geoPointValue.latitude)&&be(s.geoPointValue.longitude)===be(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return be(s.integerValue)===be(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=be(s.doubleValue),u=be(o.doubleValue);return a===u?di(a)===di(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return lr(n.arrayValue.values||[],e.arrayValue.values||[],Lt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(bu(a)!==bu(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Lt(a[h],u[h])))return!1;return!0})(n,e);default:return W(52216,{left:n})}}function as(n,e){return(n.values||[]).find((t=>Lt(t,e)))!==void 0}function hr(n,e){if(n===e)return 0;const t=En(n),r=En(e);if(t!==r)return te(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return te(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=be(o.integerValue||o.doubleValue),h=be(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return Su(n.timestampValue,e.timestampValue);case 4:return Su(is(n),is(e));case 5:return qo(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=vn(o),h=vn(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const p=te(u[d],h[d]);if(p!==0)return p}return te(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=te(be(o.latitude),be(a.latitude));return u!==0?u:te(be(o.longitude),be(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Pu(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[pi]?.arrayValue,p=h[pi]?.arrayValue,y=te(d?.values?.length||0,p?.values?.length||0);return y!==0?y:Pu(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===qs.mapValue&&a===qs.mapValue)return 0;if(o===qs.mapValue)return 1;if(a===qs.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let y=0;y<h.length&&y<p.length;++y){const v=qo(h[y],p[y]);if(v!==0)return v;const b=hr(u[h[y]],d[p[y]]);if(b!==0)return b}return te(h.length,p.length)})(n.mapValue,e.mapValue);default:throw W(23264,{he:t})}}function Su(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return te(n,e);const t=yn(n),r=yn(e),s=te(t.seconds,r.seconds);return s!==0?s:te(t.nanos,r.nanos)}function Pu(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=hr(t[s],r[s]);if(o)return o}return te(t.length,r.length)}function dr(n){return $o(n)}function $o(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=yn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return vn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return z.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=$o(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${$o(t.fields[a])}`;return s+"}"})(n.mapValue):W(61005,{value:n})}function Xs(n){switch(En(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Oi(n);return e?16+Xs(e):16;case 5:return 2*n.stringValue.length;case 6:return vn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Xs(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return An(r.fields,((o,a)=>{s+=o.length+Xs(a)})),s})(n.mapValue);default:throw W(13486,{value:n})}}function zo(n){return!!n&&"integerValue"in n}function Ea(n){return!!n&&"arrayValue"in n}function Cu(n){return!!n&&"nullValue"in n}function ku(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Js(n){return!!n&&"mapValue"in n}function $y(n){return(n?.mapValue?.fields||{})[Lh]?.stringValue===Fh}function Qr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return An(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Qr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qr(n.arrayValue.values[t]);return e}return{...n}}function zy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qy}class ct{constructor(e){this.value=e}static empty(){return new ct({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Js(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qr(t)}setAll(e){let t=Qe.emptyPath(),r={},s=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=Qr(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Js(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Lt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Js(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){An(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new ct(Qr(this.value))}}function Uh(n){const e=[];return An(n.fields,((t,r)=>{const s=new Qe([t]);if(Js(r)){const o=Uh(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new dt(e)}class tt{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new tt(e,0,Y.min(),Y.min(),Y.min(),ct.empty(),0)}static newFoundDocument(e,t,r,s){return new tt(e,1,t,Y.min(),r,s,0)}static newNoDocument(e,t){return new tt(e,2,t,Y.min(),Y.min(),ct.empty(),0)}static newUnknownDocument(e,t){return new tt(e,3,t,Y.min(),Y.min(),ct.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Y.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ct.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ct.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class mi{constructor(e,t){this.position=e,this.inclusive=t}}function Vu(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=z.comparator(z.fromName(a.referenceValue),t.key):r=hr(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Du(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Lt(n.position[t],e.position[t]))return!1;return!0}class gi{constructor(e,t="asc"){this.field=e,this.dir=t}}function Hy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Bh{}class Oe extends Bh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Gy(e,t,r):t==="array-contains"?new Yy(e,r):t==="in"?new Xy(e,r):t==="not-in"?new Jy(e,r):t==="array-contains-any"?new Zy(e,r):new Oe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Ky(e,r):new Qy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(hr(t,this.value)):t!==null&&En(this.value)===En(t)&&this.matchesComparison(hr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ft extends Bh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ft(e,t)}matches(e){return jh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function jh(n){return n.op==="and"}function qh(n){return Wy(n)&&jh(n)}function Wy(n){for(const e of n.filters)if(e instanceof Ft)return!1;return!0}function Ho(n){if(n instanceof Oe)return n.field.canonicalString()+n.op.toString()+dr(n.value);if(qh(n))return n.filters.map((e=>Ho(e))).join(",");{const e=n.filters.map((t=>Ho(t))).join(",");return`${n.op}(${e})`}}function $h(n,e){return n instanceof Oe?(function(r,s){return s instanceof Oe&&r.op===s.op&&r.field.isEqual(s.field)&&Lt(r.value,s.value)})(n,e):n instanceof Ft?(function(r,s){return s instanceof Ft&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&$h(a,s.filters[u])),!0):!1})(n,e):void W(19439)}function zh(n){return n instanceof Oe?(function(t){return`${t.field.canonicalString()} ${t.op} ${dr(t.value)}`})(n):n instanceof Ft?(function(t){return t.op.toString()+" {"+t.getFilters().map(zh).join(" ,")+"}"})(n):"Filter"}class Gy extends Oe{constructor(e,t,r){super(e,t,r),this.key=z.fromName(r.referenceValue)}matches(e){const t=z.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ky extends Oe{constructor(e,t){super(e,"in",t),this.keys=Hh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Qy extends Oe{constructor(e,t){super(e,"not-in",t),this.keys=Hh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Hh(n,e){return(e.arrayValue?.values||[]).map((t=>z.fromName(t.referenceValue)))}class Yy extends Oe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ea(t)&&as(t.arrayValue,this.value)}}class Xy extends Oe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&as(this.value.arrayValue,t)}}class Jy extends Oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(as(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!as(this.value.arrayValue,t)}}class Zy extends Oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ea(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>as(this.value.arrayValue,r)))}}class ev{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Nu(n,e=null,t=[],r=[],s=null,o=null,a=null){return new ev(n,e,t,r,s,o,a)}function Ta(n){const e=X(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Ho(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Ni(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>dr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>dr(r))).join(",")),e.Te=t}return e.Te}function Ia(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Hy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!$h(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Du(n.startAt,e.startAt)&&Du(n.endAt,e.endAt)}function Wo(n){return z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Mi{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function tv(n,e,t,r,s,o,a,u){return new Mi(n,e,t,r,s,o,a,u)}function wa(n){return new Mi(n)}function Ou(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function nv(n){return n.collectionGroup!==null}function Yr(n){const e=X(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Me(Qe.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new gi(o,r))})),t.has(Qe.keyField().canonicalString())||e.Ie.push(new gi(Qe.keyField(),r))}return e.Ie}function Dt(n){const e=X(n);return e.Ee||(e.Ee=rv(e,Yr(n))),e.Ee}function rv(n,e){if(n.limitType==="F")return Nu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new gi(s.field,o)}));const t=n.endAt?new mi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new mi(n.startAt.position,n.startAt.inclusive):null;return Nu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Go(n,e,t){return new Mi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function xi(n,e){return Ia(Dt(n),Dt(e))&&n.limitType===e.limitType}function Wh(n){return`${Ta(Dt(n))}|lt:${n.limitType}`}function Xn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>zh(s))).join(", ")}]`),Ni(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>dr(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>dr(s))).join(",")),`Target(${r})`})(Dt(n))}; limitType=${n.limitType})`}function Li(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):z.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Yr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=Vu(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Yr(r),s)||r.endAt&&!(function(a,u,h){const d=Vu(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Yr(r),s))})(n,e)}function sv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Gh(n){return(e,t)=>{let r=!1;for(const s of Yr(n)){const o=iv(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function iv(n,e,t){const r=n.field.isKeyField()?z.comparator(e.key,t.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?hr(h,d):W(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return W(19790,{direction:n.dir})}}class jn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){An(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return Vh(this.inner)}size(){return this.innerSize}}const ov=new ye(z.comparator);function Qt(){return ov}const Kh=new ye(z.comparator);function $r(...n){let e=Kh;for(const t of n)e=e.insert(t.key,t);return e}function Qh(n){let e=Kh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Vn(){return Xr()}function Yh(){return Xr()}function Xr(){return new jn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const av=new ye(z.comparator),cv=new Me(z.comparator);function ne(...n){let e=cv;for(const t of n)e=e.add(t);return e}const uv=new Me(te);function lv(){return uv}function Aa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:di(e)?"-0":e}}function Xh(n){return{integerValue:""+n}}function hv(n,e){return Ly(e)?Xh(e):Aa(n,e)}class Fi{constructor(){this._=void 0}}function dv(n,e,t){return n instanceof _i?(function(s,o){const a={fields:{[Oh]:{stringValue:Nh},[xh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&va(o)&&(o=Oi(o)),o&&(a.fields[Mh]=o),{mapValue:a}})(t,e):n instanceof cs?Zh(n,e):n instanceof us?ed(n,e):(function(s,o){const a=Jh(s,o),u=Mu(a)+Mu(s.Ae);return zo(a)&&zo(s.Ae)?Xh(u):Aa(s.serializer,u)})(n,e)}function fv(n,e,t){return n instanceof cs?Zh(n,e):n instanceof us?ed(n,e):t}function Jh(n,e){return n instanceof yi?(function(r){return zo(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class _i extends Fi{}class cs extends Fi{constructor(e){super(),this.elements=e}}function Zh(n,e){const t=td(e);for(const r of n.elements)t.some((s=>Lt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class us extends Fi{constructor(e){super(),this.elements=e}}function ed(n,e){let t=td(e);for(const r of n.elements)t=t.filter((s=>!Lt(s,r)));return{arrayValue:{values:t}}}class yi extends Fi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Mu(n){return be(n.integerValue||n.doubleValue)}function td(n){return Ea(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function pv(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof cs&&s instanceof cs||r instanceof us&&s instanceof us?lr(r.elements,s.elements,Lt):r instanceof yi&&s instanceof yi?Lt(r.Ae,s.Ae):r instanceof _i&&s instanceof _i})(n.transform,e.transform)}class mv{constructor(e,t){this.version=e,this.transformResults=t}}class Nt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Nt}static exists(e){return new Nt(void 0,e)}static updateTime(e){return new Nt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ui{}function nd(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new sd(n.key,Nt.none()):new _s(n.key,n.data,Nt.none());{const t=n.data,r=ct.empty();let s=new Me(Qe.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new bn(n.key,r,new dt(s.toArray()),Nt.none())}}function gv(n,e,t){n instanceof _s?(function(s,o,a){const u=s.value.clone(),h=Lu(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof bn?(function(s,o,a){if(!Zs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Lu(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(rd(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Jr(n,e,t,r){return n instanceof _s?(function(o,a,u,h){if(!Zs(o.precondition,a))return u;const d=o.value.clone(),p=Fu(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof bn?(function(o,a,u,h){if(!Zs(o.precondition,a))return u;const d=Fu(o.fieldTransforms,h,a),p=a.data;return p.setAll(rd(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((y=>y.field)))})(n,e,t,r):(function(o,a,u){return Zs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function _v(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=Jh(r.transform,s||null);o!=null&&(t===null&&(t=ct.empty()),t.set(r.field,o))}return t||null}function xu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&lr(r,s,((o,a)=>pv(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class _s extends Ui{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class bn extends Ui{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function rd(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Lu(n,e,t){const r=new Map;oe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,fv(a,u,t[s]))}return r}function Fu(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,dv(o,a,e))}return r}class sd extends Ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class yv extends Ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class vv{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&gv(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Jr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Jr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Yh();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=nd(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(Y.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ne())}isEqual(e){return this.batchId===e.batchId&&lr(this.mutations,e.mutations,((t,r)=>xu(t,r)))&&lr(this.baseMutations,e.baseMutations,((t,r)=>xu(t,r)))}}class ba{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){oe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return av})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new ba(e,t,r,s)}}class Ev{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Tv{constructor(e,t){this.count=e,this.unchangedNames=t}}var Re,re;function Iv(n){switch(n){case D.OK:return W(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return W(15467,{code:n})}}function id(n){if(n===void 0)return Gt("GRPC error has no .code"),D.UNKNOWN;switch(n){case Re.OK:return D.OK;case Re.CANCELLED:return D.CANCELLED;case Re.UNKNOWN:return D.UNKNOWN;case Re.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case Re.INTERNAL:return D.INTERNAL;case Re.UNAVAILABLE:return D.UNAVAILABLE;case Re.UNAUTHENTICATED:return D.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case Re.NOT_FOUND:return D.NOT_FOUND;case Re.ALREADY_EXISTS:return D.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return D.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case Re.ABORTED:return D.ABORTED;case Re.OUT_OF_RANGE:return D.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return D.UNIMPLEMENTED;case Re.DATA_LOSS:return D.DATA_LOSS;default:return W(39323,{code:n})}}(re=Re||(Re={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";function wv(){return new TextEncoder}const Av=new mn([4294967295,4294967295],0);function Uu(n){const e=wv().encode(n),t=new Eh;return t.update(e),new Uint8Array(t.digest())}function Bu(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new mn([t,r],0),new mn([s,o],0)]}class Ra{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new zr(`Invalid padding: ${t}`);if(r<0)throw new zr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new zr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new zr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=mn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(mn.fromNumber(r)));return s.compare(Av)===1&&(s=new mn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Uu(e),[r,s]=Bu(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Ra(o,s,t);return r.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=Uu(e),[r,s]=Bu(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class zr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Bi{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ys.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Bi(Y.min(),s,new ye(te),Qt(),ne())}}class ys{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ys(r,t,ne(),ne(),ne())}}class ei{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class od{constructor(e,t){this.targetId=e,this.Ce=t}}class ad{constructor(e,t,r=Ye.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class ju{constructor(){this.ve=0,this.Fe=qu(),this.Me=Ye.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ne(),t=ne(),r=ne();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:W(38017,{changeType:o})}})),new ys(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=qu()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,oe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class bv{constructor(e){this.Ge=e,this.ze=new Map,this.je=Qt(),this.Je=$s(),this.He=$s(),this.Ye=new ye(te)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:W(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(Wo(o))if(r===0){const a=new z(o.path);this.et(t,a,tt.newNoDocument(a,Y.min()))}else oe(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=vn(r).toUint8Array()}catch(h){if(h instanceof Dh)return ur("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Ra(a,s,o)}catch(h){return ur(h instanceof zr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&Wo(u.target)){const h=new z(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,tt.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=ne();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new Bi(e,t,this.Ye,this.je,r);return this.je=Qt(),this.Je=$s(),this.He=$s(),this.Ye=new ye(te),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ju,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Me(te),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Me(te),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ju),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function $s(){return new ye(z.comparator)}function qu(){return new ye(z.comparator)}const Rv={asc:"ASCENDING",desc:"DESCENDING"},Sv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Pv={and:"AND",or:"OR"};class Cv{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ko(n,e){return n.useProto3Json||Ni(e)?e:{value:e}}function vi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function kv(n,e){return vi(n,e.toTimestamp())}function Ot(n){return oe(!!n,49232),Y.fromTimestamp((function(t){const r=yn(t);return new ge(r.seconds,r.nanos)})(n))}function Sa(n,e){return Qo(n,e).canonicalString()}function Qo(n,e){const t=(function(s){return new me(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function ud(n){const e=me.fromString(n);return oe(pd(e),10190,{key:e.toString()}),e}function Yo(n,e){return Sa(n.databaseId,e.path)}function bo(n,e){const t=ud(e);if(t.get(1)!==n.databaseId.projectId)throw new B(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new B(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new z(hd(t))}function ld(n,e){return Sa(n.databaseId,e)}function Vv(n){const e=ud(n);return e.length===4?me.emptyPath():hd(e)}function Xo(n){return new me(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function hd(n){return oe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function $u(n,e,t){return{name:Yo(n,e),fields:t.value.mapValue.fields}}function Dv(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:W(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(oe(p===void 0||typeof p=="string",58123),Ye.fromBase64String(p||"")):(oe(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Ye.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){const p=d.code===void 0?D.UNKNOWN:id(d.code);return new B(p,d.message||"")})(a);t=new ad(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=bo(n,r.document.name),o=Ot(r.document.updateTime),a=r.document.createTime?Ot(r.document.createTime):Y.min(),u=new ct({mapValue:{fields:r.document.fields}}),h=tt.newFoundDocument(s,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new ei(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=bo(n,r.document),o=r.readTime?Ot(r.readTime):Y.min(),a=tt.newNoDocument(s,o),u=r.removedTargetIds||[];t=new ei([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=bo(n,r.document),o=r.removedTargetIds||[];t=new ei([],o,s,null)}else{if(!("filter"in e))return W(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new Tv(s,o),u=r.targetId;t=new od(u,a)}}return t}function Nv(n,e){let t;if(e instanceof _s)t={update:$u(n,e.key,e.value)};else if(e instanceof sd)t={delete:Yo(n,e.key)};else if(e instanceof bn)t={update:$u(n,e.key,e.data),updateMask:qv(e.fieldMask)};else{if(!(e instanceof yv))return W(16599,{Vt:e.type});t={verify:Yo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof _i)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof cs)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof us)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof yi)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw W(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:kv(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:W(27497)})(n,e.precondition)),t}function Ov(n,e){return n&&n.length>0?(oe(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Ot(s.updateTime):Ot(o);return a.isEqual(Y.min())&&(a=Ot(o)),new mv(a,s.transformResults||[])})(t,e)))):[]}function Mv(n,e){return{documents:[ld(n,e.path)]}}function xv(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ld(n,s);const o=(function(d){if(d.length!==0)return fd(Ft.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(v){return{field:Jn(v.field),direction:Uv(v.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Ko(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function Lv(n){let e=Vv(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){oe(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(y){const v=dd(y);return v instanceof Ft&&qh(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(y){return y.map((v=>(function(P){return new gi(Zn(P.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(P.direction))})(v)))})(t.orderBy));let u=null;t.limit&&(u=(function(y){let v;return v=typeof y=="object"?y.value:y,Ni(v)?null:v})(t.limit));let h=null;t.startAt&&(h=(function(y){const v=!!y.before,b=y.values||[];return new mi(b,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(y){const v=!y.before,b=y.values||[];return new mi(b,v)})(t.endAt)),tv(e,s,a,o,u,"F",h,d)}function Fv(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function dd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Zn(t.unaryFilter.field);return Oe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Zn(t.unaryFilter.field);return Oe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Zn(t.unaryFilter.field);return Oe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Zn(t.unaryFilter.field);return Oe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Oe.create(Zn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ft.create(t.compositeFilter.filters.map((r=>dd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return W(1026)}})(t.compositeFilter.op))})(n):W(30097,{filter:n})}function Uv(n){return Rv[n]}function Bv(n){return Sv[n]}function jv(n){return Pv[n]}function Jn(n){return{fieldPath:n.canonicalString()}}function Zn(n){return Qe.fromServerFormat(n.fieldPath)}function fd(n){return n instanceof Oe?(function(t){if(t.op==="=="){if(ku(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NAN"}};if(Cu(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ku(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NOT_NAN"}};if(Cu(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Jn(t.field),op:Bv(t.op),value:t.value}}})(n):n instanceof Ft?(function(t){const r=t.getFilters().map((s=>fd(s)));return r.length===1?r[0]:{compositeFilter:{op:jv(t.op),filters:r}}})(n):W(54877,{filter:n})}function qv(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function pd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class hn{constructor(e,t,r,s,o=Y.min(),a=Y.min(),u=Ye.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new hn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class $v{constructor(e){this.yt=e}}function zv(n){const e=Lv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Go(e,e.limit,"L"):e}class Hv{constructor(){this.Cn=new Wv}addToCollectionParentIndex(e,t){return this.Cn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(_n.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(_n.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class Wv{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Me(me.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Me(me.comparator)).toArray()}}const zu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},md=41943040;class at{static withCacheSize(e){return new at(e,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}at.DEFAULT_COLLECTION_PERCENTILE=10,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,at.DEFAULT=new at(md,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),at.DISABLED=new at(-1,0,0);class fr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new fr(0)}static cr(){return new fr(-1)}}const Hu="LruGarbageCollector",Gv=1048576;function Wu([n,e],[t,r]){const s=te(n,t);return s===0?te(e,r):s}class Kv{constructor(e){this.Ir=e,this.buffer=new Me(Wu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Wu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){L(Hu,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vr(t)?L(Hu,"Ignoring IndexedDB error during garbage collection: ",t):await yr(t)}await this.Vr(3e5)}))}}class Yv{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return V.resolve(Di.ce);const r=new Kv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(zu)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zu):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,u,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((y=>(y>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),s=this.params.maximumSequenceNumbersToCollect):s=y,a=Date.now(),this.nthSequenceNumber(e,s)))).next((y=>(r=y,u=Date.now(),this.removeTargets(e,r,t)))).next((y=>(o=y,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((y=>(d=Date.now(),Yn()<=ee.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${y} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:y}))))}}function Xv(n,e){return new Yv(n,e)}class Jv{constructor(){this.changes=new jn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,tt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Zv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class eE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Jr(r.mutation,s,dt.empty(),ge.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,ne()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=ne()){const s=Vn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=$r();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Vn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,ne())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,r,s){let o=Qt();const a=Xr(),u=(function(){return Xr()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof bn)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Jr(p.mutation,d,p.mutation.getFieldMask(),ge.now())):a.set(d.key,dt.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>u.set(d,new Zv(p,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=Xr();let s=new ye(((a,u)=>a-u)),o=ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||dt.empty();p=u.applyToLocalView(d,p),r.set(h,p);const y=(s.get(u.batchId)||ne()).add(h);s=s.insert(u.batchId,y)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,p=h.value,y=Yh();p.forEach((v=>{if(!o.has(v)){const b=nd(t.get(v),r.get(v));b!==null&&y.set(v,b),o=o.add(v)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,y))}return V.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return z.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):nv(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):V.resolve(Vn());let u=ss,h=o;return a.next((d=>V.forEach(d,((p,y)=>(u<y.largestBatchId&&(u=y.largestBatchId),o.get(p)?V.resolve():this.remoteDocumentCache.getEntry(e,p).next((v=>{h=h.insert(p,v)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,ne()))).next((p=>({batchId:u,changes:Qh(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next((r=>{let s=$r();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=$r();return this.indexManager.getCollectionParents(e,o).next((u=>V.forEach(u,(h=>{const d=(function(y,v){return new Mi(v,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((y,v)=>{a=a.insert(y,v)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,tt.newInvalidDocument(p)))}));let u=$r();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Jr(p.mutation,d,dt.empty(),ge.now()),Li(t,d)&&(u=u.insert(h,d))})),u}))}}class tE{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return V.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Ot(s.createTime)}})(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:zv(s.bundledQuery),readTime:Ot(s.readTime)}})(t)),V.resolve()}}class nE{constructor(){this.overlays=new ye(z.comparator),this.qr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vn();return V.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),V.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const s=Vn(),o=t.length+1,a=new z(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return V.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new ye(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Vn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const u=Vn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>u.set(d,p))),!(u.size()>=s)););return V.resolve(u)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Ev(t,r));let o=this.qr.get(t);o===void 0&&(o=ne(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class rE{constructor(){this.sessionToken=Ye.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}class Pa{constructor(){this.Qr=new Me(Be.$r),this.Ur=new Me(Be.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Be(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Be(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new z(new me([])),r=new Be(t,e),s=new Be(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new z(new me([])),r=new Be(t,e),s=new Be(t,e+1);let o=ne();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new Be(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Be{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return z.comparator(e.key,t.key)||te(e.Yr,t.Yr)}static Kr(e,t){return te(e.Yr,t.Yr)||z.comparator(e.key,t.key)}}class sE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Me(Be.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new vv(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new Be(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return V.resolve(a)}lookupMutationBatch(e,t){return V.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return V.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?ya:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Be(t,0),s=new Be(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),V.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Me(te);return t.forEach((s=>{const o=new Be(s,0),a=new Be(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),V.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;z.isDocumentKey(o)||(o=o.child(""));const a=new Be(new z(o),0);let u=new Me(te);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),V.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){oe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return V.forEach(t.mutations,(s=>{const o=new Be(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Be(t,0),s=this.Zr.firstAfterOrEqual(r);return V.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class iE{constructor(e){this.ri=e,this.docs=(function(){return new ye(z.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():tt.newInvalidDocument(t))}getEntries(e,t){let r=Qt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():tt.newInvalidDocument(s))})),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=Qt();const a=t.path,u=new z(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Ny(Dy(p),r)<=0||(s.has(p.key)||Li(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return V.resolve(o)}getAllFromCollectionGroup(e,t,r,s){W(9500)}ii(e,t){return V.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new oE(this)}getSize(e){return V.resolve(this.size)}}class oE extends Jv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),V.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class aE{constructor(e){this.persistence=e,this.si=new jn((t=>Ta(t)),Ia),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.oi=0,this._i=new Pa,this.targetCount=0,this.ai=fr.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),V.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new fr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Pr(t),V.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)})),V.waitFor(o).next((()=>s))}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),V.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),V.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this._i.containsKey(t))}}class gd{constructor(e,t){this.ui={},this.overlays={},this.ci=new Di(0),this.li=!1,this.li=!0,this.hi=new rE,this.referenceDelegate=e(this),this.Pi=new aE(this),this.indexManager=new Hv,this.remoteDocumentCache=(function(s){return new iE(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new $v(t),this.Ii=new tE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new sE(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);const s=new cE(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return V.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class cE extends My{constructor(e){super(),this.currentSequenceNumber=e}}class Ca{constructor(e){this.persistence=e,this.Ri=new Pa,this.Vi=null}static mi(e){return new Ca(e)}get fi(){if(this.Vi)return this.Vi;throw W(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,(r=>{const s=z.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,Y.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return V.or([()=>V.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Ei{constructor(e,t){this.persistence=e,this.pi=new jn((r=>Fy(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Xv(this,t)}static mi(e,t){return new Ei(e,t)}Ei(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return V.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?V.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((u=>{u||(r++,o.removeEntry(a,Y.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Xs(e.data.value)),t}br(e,t,r){return V.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ka{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=ne(),s=ne();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new ka(e,t.fromCache,r,s)}}class uE{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return xp()?8:xy(nt())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new uE;return this.Ss(e,t,a).next((u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Yn()<=ee.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",Xn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(Yn()<=ee.DEBUG&&L("QueryEngine","Query:",Xn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Yn()<=ee.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",Xn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Dt(t))):V.resolve())}ys(e,t){if(Ou(t))return V.resolve(null);let r=Dt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Go(t,null,"F"),r=Dt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=ne(...o);return this.ps.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,Go(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ws(e,t,r,s){return Ou(t)||s.isEqual(Y.min())?V.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?V.resolve(null):(Yn()<=ee.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Xn(t)),this.vs(e,a,t,Vy(s,ss)).next((u=>u)))}))}Ds(e,t){let r=new Me(Gh(e));return t.forEach(((s,o)=>{Li(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Yn()<=ee.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",Xn(t)),this.ps.getDocumentsMatchingQuery(e,t,_n.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Va="LocalStore",hE=3e8;class dE{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ye(te),this.xs=new jn((o=>Ta(o)),Ia),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new eE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function fE(n,e,t,r){return new dE(n,e,t,r)}async function _d(n,e){const t=X(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=ne();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){u.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function pE(n,e){const t=X(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){const y=d.batch,v=y.keys();let b=V.resolve();return v.forEach((P=>{b=b.next((()=>p.getEntry(h,P))).next((k=>{const C=d.docVersions.get(P);oe(C!==null,48541),k.version.compareTo(C)<0&&(y.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),p.addEntry(k)))}))})),b.next((()=>u.mutationQueue.removeMutationBatch(h,y)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=ne();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function yd(n){const e=X(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function mE(n,e){const t=X(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const u=[];e.targetChanges.forEach(((p,y)=>{const v=s.get(y);if(!v)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,y).next((()=>t.Pi.addMatchingKeys(o,p.addedDocuments,y))));let b=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?b=b.withResumeToken(Ye.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):p.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(p.resumeToken,r)),s=s.insert(y,b),(function(k,C,F){return k.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=hE?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0})(v,b,p)&&u.push(t.Pi.updateTargetData(o,b))}));let h=Qt(),d=ne();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(gE(o,a,e.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(Y.min())){const p=t.Pi.getLastRemoteSnapshotVersion(o).next((y=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return V.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function gE(n,e,t){let r=ne(),s=ne();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=Qt();return t.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(Y.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):L(Va,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function _E(n,e){const t=X(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=ya),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function yE(n,e){const t=X(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,V.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new hn(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Jo(n,e,t){const r=X(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!vr(a))throw a;L(Va,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Gu(n,e,t){const r=X(n);let s=Y.min(),o=ne();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const y=X(h),v=y.xs.get(p);return v!==void 0?V.resolve(y.Ms.get(v)):y.Pi.getTargetData(d,p)})(r,a,Dt(e)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:Y.min(),t?o:ne()))).next((u=>(vE(r,sv(e),u),{documents:u,Qs:o})))))}function vE(n,e,t){let r=n.Os.get(e)||Y.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class Ku{constructor(){this.activeTargetIds=lv()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class EE{constructor(){this.Mo=new Ku,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ku,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class TE{Oo(e){}shutdown(){}}const Qu="ConnectivityMonitor";class Yu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){L(Qu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){L(Qu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let zs=null;function Zo(){return zs===null?zs=(function(){return 268435456+Math.round(2147483648*Math.random())})():zs++,"0x"+zs.toString(16)}const Ro="RestConnection",IE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class wE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===fi?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=Zo(),u=this.zo(e,t.toUriEncodedString());L(Ro,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),p=mr(d);return this.Jo(e,u,h,r,p).then((y=>(L(Ro,`Received RPC '${e}' ${a}: `,y),y)),(y=>{throw ur(Ro,`RPC '${e}' ${a} failed with error: `,y,"url: ",u,"request:",r),y}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+_r})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=IE[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class AE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ze="WebChannelConnection";class bE extends wE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=Zo();return new Promise(((u,h)=>{const d=new Th;d.setWithCredentials(!0),d.listenOnce(Ih.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Ys.NO_ERROR:const y=d.getResponseJson();L(Ze,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),u(y);break;case Ys.TIMEOUT:L(Ze,`RPC '${e}' ${a} timed out`),h(new B(D.DEADLINE_EXCEEDED,"Request time out"));break;case Ys.HTTP_ERROR:const v=d.getStatus();if(L(Ze,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);const P=b?.error;if(P&&P.status&&P.message){const k=(function(F){const M=F.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(M)>=0?M:D.UNKNOWN})(P.status);h(new B(k,P.message))}else h(new B(D.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new B(D.UNAVAILABLE,"Connection failed."));break;default:W(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{L(Ze,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);L(Ze,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=Zo(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=bh(),u=Ah(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=o.join("");L(Ze,`Creating RPC '${e}' stream ${s}: ${p}`,h);const y=a.createWebChannel(p,h);this.I_(y);let v=!1,b=!1;const P=new AE({Yo:C=>{b?L(Ze,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(v||(L(Ze,`Opening RPC '${e}' stream ${s} transport.`),y.open(),v=!0),L(Ze,`RPC '${e}' stream ${s} sending:`,C),y.send(C))},Zo:()=>y.close()}),k=(C,F,M)=>{C.listen(F,(x=>{try{M(x)}catch(G){setTimeout((()=>{throw G}),0)}}))};return k(y,qr.EventType.OPEN,(()=>{b||(L(Ze,`RPC '${e}' stream ${s} transport opened.`),P.o_())})),k(y,qr.EventType.CLOSE,(()=>{b||(b=!0,L(Ze,`RPC '${e}' stream ${s} transport closed`),P.a_(),this.E_(y))})),k(y,qr.EventType.ERROR,(C=>{b||(b=!0,ur(Ze,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),P.a_(new B(D.UNAVAILABLE,"The operation could not be completed")))})),k(y,qr.EventType.MESSAGE,(C=>{if(!b){const F=C.data[0];oe(!!F,16349);const M=F,x=M?.error||M[0]?.error;if(x){L(Ze,`RPC '${e}' stream ${s} received error:`,x);const G=x.status;let q=(function(g){const m=Re[g];if(m!==void 0)return id(m)})(G),J=x.message;q===void 0&&(q=D.INTERNAL,J="Unknown error status: "+G+" with message "+x.message),b=!0,P.a_(new B(q,J)),y.close()}else L(Ze,`RPC '${e}' stream ${s} received:`,F),P.u_(F)}})),k(u,wh.STAT_EVENT,(C=>{C.stat===jo.PROXY?L(Ze,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===jo.NOPROXY&&L(Ze,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{P.__()}),0),P}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function So(){return typeof document<"u"?document:null}function ji(n){return new Cv(n,!0)}class vd{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&L("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Xu="PersistentStream";class Ed{constructor(e,t,r,s,o,a,u,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new vd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Gt(t.toString()),Gt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new B(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return L(Xu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(L(Xu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class RE extends Ed{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Dv(this.serializer,e),r=(function(o){if(!("targetChange"in o))return Y.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Y.min():a.readTime?Ot(a.readTime):Y.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Xo(this.serializer),t.addTarget=(function(o,a){let u;const h=a.target;if(u=Wo(h)?{documents:Mv(o,h)}:{query:xv(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=cd(o,a.resumeToken);const d=Ko(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(Y.min())>0){u.readTime=vi(o,a.snapshotVersion.toTimestamp());const d=Ko(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);const r=Fv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Xo(this.serializer),t.removeTarget=e,this.q_(t)}}class SE extends Ed{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return oe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,oe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){oe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Ov(e.writeResults,e.commitTime),r=Ot(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Xo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>Nv(this.serializer,r)))};this.q_(t)}}class PE{}class CE extends PE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new B(D.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,Qo(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new B(D.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(e,Qo(t,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new B(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class kE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Gt(t),this.aa=!1):L("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Un="RemoteStore";class VE{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{qn(this)&&(L(Un,"Restarting streams for network reachability change."),await(async function(h){const d=X(h);d.Ea.add(4),await vs(d),d.Ra.set("Unknown"),d.Ea.delete(4),await qi(d)})(this))}))})),this.Ra=new kE(r,s)}}async function qi(n){if(qn(n))for(const e of n.da)await e(!0)}async function vs(n){for(const e of n.da)await e(!1)}function Td(n,e){const t=X(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ma(t)?Oa(t):Er(t).O_()&&Na(t,e))}function Da(n,e){const t=X(n),r=Er(t);t.Ia.delete(e),r.O_()&&Id(t,e),t.Ia.size===0&&(r.O_()?r.L_():qn(t)&&t.Ra.set("Unknown"))}function Na(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Er(n).Y_(e)}function Id(n,e){n.Va.Ue(e),Er(n).Z_(e)}function Oa(n){n.Va=new bv({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Er(n).start(),n.Ra.ua()}function Ma(n){return qn(n)&&!Er(n).x_()&&n.Ia.size>0}function qn(n){return X(n).Ea.size===0}function wd(n){n.Va=void 0}async function DE(n){n.Ra.set("Online")}async function NE(n){n.Ia.forEach(((e,t)=>{Na(n,e)}))}async function OE(n,e){wd(n),Ma(n)?(n.Ra.ha(e),Oa(n)):n.Ra.set("Unknown")}async function ME(n,e,t){if(n.Ra.set("Online"),e instanceof ad&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,e)}catch(r){L(Un,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ti(n,r)}else if(e instanceof ei?n.Va.Ze(e):e instanceof od?n.Va.st(e):n.Va.tt(e),!t.isEqual(Y.min()))try{const r=await yd(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Ye.EMPTY_BYTE_STRING,p.snapshotVersion)),Id(o,h);const y=new hn(p.target,h,d,p.sequenceNumber);Na(o,y)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){L(Un,"Failed to raise snapshot:",r),await Ti(n,r)}}async function Ti(n,e,t){if(!vr(e))throw e;n.Ea.add(1),await vs(n),n.Ra.set("Offline"),t||(t=()=>yd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{L(Un,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await qi(n)}))}function Ad(n,e){return e().catch((t=>Ti(n,t,e)))}async function $i(n){const e=X(n),t=Tn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:ya;for(;xE(e);)try{const s=await _E(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,LE(e,s)}catch(s){await Ti(e,s)}bd(e)&&Rd(e)}function xE(n){return qn(n)&&n.Ta.length<10}function LE(n,e){n.Ta.push(e);const t=Tn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function bd(n){return qn(n)&&!Tn(n).x_()&&n.Ta.length>0}function Rd(n){Tn(n).start()}async function FE(n){Tn(n).ra()}async function UE(n){const e=Tn(n);for(const t of n.Ta)e.ea(t.mutations)}async function BE(n,e,t){const r=n.Ta.shift(),s=ba.from(r,e,t);await Ad(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await $i(n)}async function jE(n,e){e&&Tn(n).X_&&await(async function(r,s){if((function(a){return Iv(a)&&a!==D.ABORTED})(s.code)){const o=r.Ta.shift();Tn(r).B_(),await Ad(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await $i(r)}})(n,e),bd(n)&&Rd(n)}async function Ju(n,e){const t=X(n);t.asyncQueue.verifyOperationInProgress(),L(Un,"RemoteStore received new credentials");const r=qn(t);t.Ea.add(3),await vs(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await qi(t)}async function qE(n,e){const t=X(n);e?(t.Ea.delete(2),await qi(t)):e||(t.Ea.add(2),await vs(t),t.Ra.set("Unknown"))}function Er(n){return n.ma||(n.ma=(function(t,r,s){const o=X(t);return o.sa(),new RE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:DE.bind(null,n),t_:NE.bind(null,n),r_:OE.bind(null,n),H_:ME.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Ma(n)?Oa(n):n.Ra.set("Unknown")):(await n.ma.stop(),wd(n))}))),n.ma}function Tn(n){return n.fa||(n.fa=(function(t,r,s){const o=X(t);return o.sa(),new SE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:FE.bind(null,n),r_:jE.bind(null,n),ta:UE.bind(null,n),na:BE.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await $i(n)):(await n.fa.stop(),n.Ta.length>0&&(L(Un,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class xa{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new zt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new xa(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function La(n,e){if(Gt("AsyncQueue",`${e}: ${n}`),vr(n))return new B(D.UNAVAILABLE,`${e}: ${n}`);throw n}class or{static emptySet(e){return new or(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||z.comparator(t.key,r.key):(t,r)=>z.comparator(t.key,r.key),this.keyedMap=$r(),this.sortedSet=new ye(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof or)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new or;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Zu{constructor(){this.ga=new ye(z.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):W(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class pr{constructor(e,t,r,s,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new pr(e,t,or.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class $E{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class zE{constructor(){this.queries=el(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=X(t),o=s.queries;s.queries=el(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new B(D.ABORTED,"Firestore shutting down"))}}function el(){return new jn((n=>Wh(n)),xi)}async function Sd(n,e){const t=X(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new $E,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=La(a,`Initialization of query '${Xn(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Fa(t)}async function Pd(n,e){const t=X(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function HE(n,e){const t=X(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&Fa(t)}function WE(n,e,t){const r=X(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function Fa(n){n.Ca.forEach((e=>{e.next()}))}var ea,tl;(tl=ea||(ea={})).Ma="default",tl.Cache="cache";class Cd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new pr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ea.Cache}}class kd{constructor(e){this.key=e}}class Vd{constructor(e){this.key=e}}class GE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ne(),this.mutatedKeys=ne(),this.eu=Gh(e),this.tu=new or(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Zu,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,y)=>{const v=s.get(p),b=Li(this.query,y)?y:null,P=!!v&&this.mutatedKeys.has(v.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let C=!1;v&&b?v.data.isEqual(b.data)?P!==k&&(r.track({type:3,doc:b}),C=!0):this.su(v,b)||(r.track({type:2,doc:b}),C=!0,(h&&this.eu(b,h)>0||d&&this.eu(b,d)<0)&&(u=!0)):!v&&b?(r.track({type:0,doc:b}),C=!0):v&&!b&&(r.track({type:1,doc:v}),C=!0,(h||d)&&(u=!0)),C&&(b?(a=a.add(b),o=k?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,y)=>(function(b,P){const k=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W(20277,{Rt:C})}};return k(b)-k(P)})(p.type,y.type)||this.eu(p.doc,y.doc))),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new pr(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Zu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ne(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Vd(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new kd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=ne();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ua="SyncEngine";class KE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class QE{constructor(e){this.key=e,this.hu=!1}}class YE{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new jn((u=>Wh(u)),xi),this.Iu=new Map,this.Eu=new Set,this.du=new ye(z.comparator),this.Au=new Map,this.Ru=new Pa,this.Vu={},this.mu=new Map,this.fu=fr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function XE(n,e,t=!0){const r=Ld(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Dd(r,e,t,!0),s}async function JE(n,e){const t=Ld(n);await Dd(t,e,!0,!1)}async function Dd(n,e,t,r){const s=await yE(n.localStore,Dt(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await ZE(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Td(n.remoteStore,s),u}async function ZE(n,e,t,r,s){n.pu=(y,v,b)=>(async function(k,C,F,M){let x=C.view.ru(F);x.Cs&&(x=await Gu(k.localStore,C.query,!1).then((({documents:I})=>C.view.ru(I,x))));const G=M&&M.targetChanges.get(C.targetId),q=M&&M.targetMismatches.get(C.targetId)!=null,J=C.view.applyChanges(x,k.isPrimaryClient,G,q);return rl(k,C.targetId,J.au),J.snapshot})(n,y,v,b);const o=await Gu(n.localStore,e,!0),a=new GE(e,o.Qs),u=a.ru(o.documents),h=ys.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);rl(n,t,d.au);const p=new KE(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function eT(n,e,t){const r=X(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!xi(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Jo(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Da(r.remoteStore,s.targetId),ta(r,s.targetId)})).catch(yr)):(ta(r,s.targetId),await Jo(r.localStore,s.targetId,!0))}async function tT(n,e){const t=X(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Da(t.remoteStore,r.targetId))}async function nT(n,e,t){const r=uT(n);try{const s=await(function(a,u){const h=X(a),d=ge.now(),p=u.reduce(((b,P)=>b.add(P.key)),ne());let y,v;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let P=Qt(),k=ne();return h.Ns.getEntries(b,p).next((C=>{P=C,P.forEach(((F,M)=>{M.isValidDocument()||(k=k.add(F))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,P))).next((C=>{y=C;const F=[];for(const M of u){const x=_v(M,y.get(M.key).overlayedDocument);x!=null&&F.push(new bn(M.key,x,Uh(x.value.mapValue),Nt.exists(!0)))}return h.mutationQueue.addMutationBatch(b,d,F,u)})).next((C=>{v=C;const F=C.applyToLocalDocumentSet(y,k);return h.documentOverlayCache.saveOverlays(b,C.batchId,F)}))})).then((()=>({batchId:v.batchId,changes:Qh(y)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new ye(te)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await Es(r,s.changes),await $i(r.remoteStore)}catch(s){const o=La(s,"Failed to persist write");t.reject(o)}}async function Nd(n,e){const t=X(n);try{const r=await mE(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(oe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?oe(a.hu,14607):s.removedDocuments.size>0&&(oe(a.hu,42227),a.hu=!1))})),await Es(t,r,e)}catch(r){await yr(r)}}function nl(n,e,t){const r=X(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=X(a);h.onlineState=u;let d=!1;h.queries.forEach(((p,y)=>{for(const v of y.Sa)v.va(u)&&(d=!0)})),d&&Fa(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function rT(n,e,t){const r=X(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new ye(z.comparator);a=a.insert(o,tt.newNoDocument(o,Y.min()));const u=ne().add(o),h=new Bi(Y.min(),new Map,new ye(te),a,u);await Nd(r,h),r.du=r.du.remove(o),r.Au.delete(e),Ba(r)}else await Jo(r.localStore,e,!1).then((()=>ta(r,e,t))).catch(yr)}async function sT(n,e){const t=X(n),r=e.batch.batchId;try{const s=await pE(t.localStore,e);Md(t,r,null),Od(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Es(t,s)}catch(s){await yr(s)}}async function iT(n,e,t){const r=X(n);try{const s=await(function(a,u){const h=X(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next((y=>(oe(y!==null,37113),p=y.keys(),h.mutationQueue.removeMutationBatch(d,y)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);Md(r,e,t),Od(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Es(r,s)}catch(s){await yr(s)}}function Od(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Md(n,e,t){const r=X(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function ta(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||xd(n,r)}))}function xd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Da(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Ba(n))}function rl(n,e,t){for(const r of t)r instanceof kd?(n.Ru.addReference(r.key,e),oT(n,r)):r instanceof Vd?(L(Ua,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||xd(n,r.key)):W(19791,{wu:r})}function oT(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(L(Ua,"New document in limbo: "+t),n.Eu.add(r),Ba(n))}function Ba(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new z(me.fromString(e)),r=n.fu.next();n.Au.set(r,new QE(t)),n.du=n.du.insert(t,r),Td(n.remoteStore,new hn(Dt(wa(t.path)),r,"TargetPurposeLimboResolution",Di.ce))}}async function Es(n,e,t){const r=X(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=ka.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=X(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(y=>V.forEach(d,(v=>V.forEach(v.Es,(b=>p.persistence.referenceDelegate.addReference(y,v.targetId,b))).next((()=>V.forEach(v.ds,(b=>p.persistence.referenceDelegate.removeReference(y,v.targetId,b)))))))))}catch(y){if(!vr(y))throw y;L(Va,"Failed to update sequence numbers: "+y)}for(const y of d){const v=y.targetId;if(!y.fromCache){const b=p.Ms.get(v),P=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(P);p.Ms=p.Ms.insert(v,k)}}})(r.localStore,o))}async function aT(n,e){const t=X(n);if(!t.currentUser.isEqual(e)){L(Ua,"User change. New user:",e.toKey());const r=await _d(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new B(D.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Es(t,r.Ls)}}function cT(n,e){const t=X(n),r=t.Au.get(e);if(r&&r.hu)return ne().add(r.key);{let s=ne();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function Ld(n){const e=X(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Nd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=cT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=rT.bind(null,e),e.Pu.H_=HE.bind(null,e.eventManager),e.Pu.yu=WE.bind(null,e.eventManager),e}function uT(n){const e=X(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iT.bind(null,e),e}class Ii{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ji(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return fE(this.persistence,new lE,e.initialUser,this.serializer)}Cu(e){return new gd(Ca.mi,this.serializer)}Du(e){return new EE}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ii.provider={build:()=>new Ii};class lT extends Ii{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){oe(this.persistence.referenceDelegate instanceof Ei,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Qv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?at.withCacheSize(this.cacheSizeBytes):at.DEFAULT;return new gd((r=>Ei.mi(r,t)),this.serializer)}}class na{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>nl(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=aT.bind(null,this.syncEngine),await qE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new zE})()}createDatastore(e){const t=ji(e.databaseInfo.databaseId),r=(function(o){return new bE(o)})(e.databaseInfo);return(function(o,a,u,h){return new CE(o,a,u,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,u){return new VE(r,s,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>nl(this.syncEngine,t,0)),(function(){return Yu.v()?new Yu:new TE})())}createSyncEngine(e,t){return(function(s,o,a,u,h,d,p){const y=new YE(s,o,a,u,h,d);return p&&(y.gu=!0),y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=X(t);L(Un,"RemoteStore shutting down."),r.Ea.add(5),await vs(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}na.provider={build:()=>new na};class Fd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Gt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const In="FirestoreClient";class hT{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=et.UNAUTHENTICATED,this.clientId=ga.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{L(In,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(L(In,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=La(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Po(n,e){n.asyncQueue.verifyOperationInProgress(),L(In,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await _d(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function sl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await dT(n);L(In,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Ju(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Ju(e.remoteStore,s))),n._onlineComponents=e}async function dT(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(In,"Using user provided OfflineComponentProvider");try{await Po(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;ur("Error using user provided cache. Falling back to memory cache: "+t),await Po(n,new Ii)}}else L(In,"Using default OfflineComponentProvider"),await Po(n,new lT(void 0));return n._offlineComponents}async function Ud(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(In,"Using user provided OnlineComponentProvider"),await sl(n,n._uninitializedComponentsProvider._online)):(L(In,"Using default OnlineComponentProvider"),await sl(n,new na))),n._onlineComponents}function fT(n){return Ud(n).then((e=>e.syncEngine))}async function Bd(n){const e=await Ud(n),t=e.eventManager;return t.onListen=XE.bind(null,e.syncEngine),t.onUnlisten=eT.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=JE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=tT.bind(null,e.syncEngine),t}function pT(n,e,t={}){const r=new zt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new Fd({next:v=>{p.Nu(),a.enqueueAndForget((()=>Pd(o,y)));const b=v.docs.has(u);!b&&v.fromCache?d.reject(new B(D.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&v.fromCache&&h&&h.source==="server"?d.reject(new B(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),y=new Cd(wa(u.path),p,{includeMetadataChanges:!0,qa:!0});return Sd(o,y)})(await Bd(n),n.asyncQueue,e,t,r))),r.promise}function mT(n,e,t={}){const r=new zt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new Fd({next:v=>{p.Nu(),a.enqueueAndForget((()=>Pd(o,y))),v.fromCache&&h.source==="server"?d.reject(new B(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),y=new Cd(u,p,{includeMetadataChanges:!0,qa:!0});return Sd(o,y)})(await Bd(n),n.asyncQueue,e,t,r))),r.promise}function jd(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const il=new Map;const qd="firestore.googleapis.com",ol=!0;class al{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new B(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=qd,this.ssl=ol}else this.host=e.host,this.ssl=e.ssl??ol;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=md;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Gv)throw new B(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ky("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=jd(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new B(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new B(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new B(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new al({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new al(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Ey;switch(r.type){case"firstParty":return new Ay(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new B(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=il.get(t);r&&(L("ComponentProvider","Removing Datastore"),il.delete(t),r.terminate())})(this),Promise.resolve()}}function gT(n,e,t,r={}){n=Kt(n,zi);const s=mr(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(Vl(`https://${u}`),Dl("Firestore",!0)),o.host!==qd&&o.host!==u&&ur("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!On(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=et.MOCK_USER;else{d=Sp(r.mockUserToken,n._app?.options.projectId);const y=r.mockUserToken.sub||r.mockUserToken.user_id;if(!y)throw new B(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new et(y)}n._authCredentials=new Ty(new Sh(d,p))}}class Hi{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Hi(this.firestore,e,this._query)}}class Pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pe(this.firestore,e,this._key)}toJSON(){return{type:Pe._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(gs(t,Pe._jsonSchema))return new Pe(e,r||null,new z(me.fromString(t.referencePath)))}}Pe._jsonSchemaVersion="firestore/documentReference/1.0",Pe._jsonSchema={type:Se("string",Pe._jsonSchemaVersion),referencePath:Se("string")};class gn extends Hi{constructor(e,t,r){super(e,t,wa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new z(e))}withConverter(e){return new gn(this.firestore,e,this._path)}}function _T(n,e,...t){if(n=$e(n),Ph("collection","path",e),n instanceof zi){const r=me.fromString(e,...t);return Tu(r),new gn(n,null,r)}{if(!(n instanceof Pe||n instanceof gn))throw new B(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(me.fromString(e,...t));return Tu(r),new gn(n.firestore,null,r)}}function ti(n,e,...t){if(n=$e(n),arguments.length===1&&(e=ga.newId()),Ph("doc","path",e),n instanceof zi){const r=me.fromString(e,...t);return Eu(r),new Pe(n,null,new z(r))}{if(!(n instanceof Pe||n instanceof gn))throw new B(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(me.fromString(e,...t));return Eu(r),new Pe(n.firestore,n instanceof gn?n.converter:null,new z(r))}}const cl="AsyncQueue";class ul{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new vd(this,"async_queue_retry"),this._c=()=>{const r=So();r&&L(cl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=So();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=So();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new zt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!vr(e))throw e;L(cl,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Gt("INTERNAL UNHANDLED ERROR: ",ll(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=xa.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&W(47125,{Pc:ll(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ll(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Ts extends zi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ul,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ul(e),this._firestoreClient=void 0,await e}}}function yT(n,e){const t=typeof n=="object"?n:xl(),r=typeof n=="string"?n:fi,s=oa(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=bp("firestore");o&&gT(s,...o)}return s}function ja(n){if(n._terminated)throw new B(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||vT(n),n._firestoreClient}function vT(n){const e=n._freezeSettings(),t=(function(s,o,a,u){return new jy(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,jd(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new hT(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class vt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vt(Ye.fromBase64String(e))}catch(t){throw new B(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new vt(Ye.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:vt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(gs(e,vt._jsonSchema))return vt.fromBase64String(e.bytes)}}vt._jsonSchemaVersion="firestore/bytes/1.0",vt._jsonSchema={type:Se("string",vt._jsonSchemaVersion),bytes:Se("string")};class Wi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Qe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class qa{constructor(e){this._methodName=e}}class Mt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return te(this._lat,e._lat)||te(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Mt._jsonSchemaVersion}}static fromJSON(e){if(gs(e,Mt._jsonSchema))return new Mt(e.latitude,e.longitude)}}Mt._jsonSchemaVersion="firestore/geoPoint/1.0",Mt._jsonSchema={type:Se("string",Mt._jsonSchemaVersion),latitude:Se("number"),longitude:Se("number")};class xt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:xt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(gs(e,xt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new xt(e.vectorValues);throw new B(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}xt._jsonSchemaVersion="firestore/vectorValue/1.0",xt._jsonSchema={type:Se("string",xt._jsonSchemaVersion),vectorValues:Se("object")};const ET=/^__.*__$/;class TT{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new bn(e,this.data,this.fieldMask,t,this.fieldTransforms):new _s(e,this.data,t,this.fieldTransforms)}}class $d{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new bn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{Ac:n})}}class $a{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new $a({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return wi(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(zd(this.Ac)&&ET.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class IT{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ji(e)}Cc(e,t,r,s=!1){return new $a({Ac:e,methodName:t,Dc:r,path:Qe.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Hd(n){const e=n._freezeSettings(),t=ji(n._databaseId);return new IT(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wT(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);za("Data must be an object, but it was:",a,r);const u=Wd(r,a);let h,d;if(o.merge)h=new dt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const y of o.mergeFields){const v=ra(e,y,t);if(!a.contains(v))throw new B(D.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Kd(p,v)||p.push(v)}h=new dt(p),d=a.fieldTransforms.filter((y=>h.covers(y.field)))}else h=null,d=a.fieldTransforms;return new TT(new ct(u),h,d)}class Gi extends qa{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gi}}function AT(n,e,t,r){const s=n.Cc(1,e,t);za("Data must be an object, but it was:",s,r);const o=[],a=ct.empty();An(r,((h,d)=>{const p=Ha(e,h,t);d=$e(d);const y=s.yc(p);if(d instanceof Gi)o.push(p);else{const v=Ki(d,y);v!=null&&(o.push(p),a.set(p,v))}}));const u=new dt(o);return new $d(a,u,s.fieldTransforms)}function bT(n,e,t,r,s,o){const a=n.Cc(1,e,t),u=[ra(e,r,t)],h=[s];if(o.length%2!=0)throw new B(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)u.push(ra(e,o[v])),h.push(o[v+1]);const d=[],p=ct.empty();for(let v=u.length-1;v>=0;--v)if(!Kd(d,u[v])){const b=u[v];let P=h[v];P=$e(P);const k=a.yc(b);if(P instanceof Gi)d.push(b);else{const C=Ki(P,k);C!=null&&(d.push(b),p.set(b,C))}}const y=new dt(d);return new $d(p,y,a.fieldTransforms)}function Ki(n,e){if(Gd(n=$e(n)))return za("Unsupported field value:",e,n),Wd(n,e);if(n instanceof qa)return(function(r,s){if(!zd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=Ki(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=$e(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return hv(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=ge.fromDate(r);return{timestampValue:vi(s.serializer,o)}}if(r instanceof ge){const o=new ge(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:vi(s.serializer,o)}}if(r instanceof Mt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof vt)return{bytesValue:cd(s.serializer,r._byteString)};if(r instanceof Pe){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Sa(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof xt)return(function(a,u){return{mapValue:{fields:{[Lh]:{stringValue:Fh},[pi]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return Aa(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${_a(r)}`)})(n,e)}function Wd(n,e){const t={};return Vh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):An(n,((r,s)=>{const o=Ki(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function Gd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ge||n instanceof Mt||n instanceof vt||n instanceof Pe||n instanceof qa||n instanceof xt)}function za(n,e,t){if(!Gd(t)||!Ch(t)){const r=_a(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function ra(n,e,t){if((e=$e(e))instanceof Wi)return e._internalPath;if(typeof e=="string")return Ha(n,e);throw wi("Field path arguments must be of type string or ",n,!1,void 0,t)}const RT=new RegExp("[~\\*/\\[\\]]");function Ha(n,e,t){if(e.search(RT)>=0)throw wi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Wi(...e.split("."))._internalPath}catch{throw wi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function wi(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new B(D.INVALID_ARGUMENT,u+n+h)}function Kd(n,e){return n.some((t=>t.isEqual(e)))}class Qd{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ST(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Yd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ST extends Qd{data(){return super.data()}}function Yd(n,e){return typeof e=="string"?Ha(n,e):e instanceof Wi?e._internalPath:e._delegate._internalPath}function PT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new B(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class CT{convertValue(e,t="none"){switch(En(e)){case 0:return null;case 1:return e.booleanValue;case 2:return be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(vn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return An(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[pi].arrayValue?.values?.map((r=>be(r.doubleValue)));return new xt(t)}convertGeoPoint(e){return new Mt(be(e.latitude),be(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Oi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(is(e));default:return null}}convertTimestamp(e){const t=yn(e);return new ge(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=me.fromString(e);oe(pd(r),9688,{name:e});const s=new os(r.get(1),r.get(3)),o=new z(r.popFirst(5));return s.isEqual(t)||Gt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function kT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Hr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nn extends Qd{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ni(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Yd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new B(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Nn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Nn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Nn._jsonSchema={type:Se("string",Nn._jsonSchemaVersion),bundleSource:Se("string","DocumentSnapshot"),bundleName:Se("string"),bundle:Se("string")};class ni extends Nn{data(e={}){return super.data(e)}}class ar{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Hr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new ni(this._firestore,this._userDataWriter,r.key,r,new Hr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new ni(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Hr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new ni(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Hr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:VT(u.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new B(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ar._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ga.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function VT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:n})}}function DT(n){n=Kt(n,Pe);const e=Kt(n.firestore,Ts);return pT(ja(e),n._key).then((t=>MT(e,n,t)))}ar._jsonSchemaVersion="firestore/querySnapshot/1.0",ar._jsonSchema={type:Se("string",ar._jsonSchemaVersion),bundleSource:Se("string","QuerySnapshot"),bundleName:Se("string"),bundle:Se("string")};class Xd extends CT{constructor(e){super(),this.firestore=e}convertBytes(e){return new vt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}}function NT(n){n=Kt(n,Hi);const e=Kt(n.firestore,Ts),t=ja(e),r=new Xd(e);return PT(n._query),mT(t,n._query).then((s=>new ar(e,r,n,s)))}function Ai(n,e,t){n=Kt(n,Pe);const r=Kt(n.firestore,Ts),s=kT(n.converter,e,t);return Jd(r,[wT(Hd(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Nt.none())])}function OT(n,e,t,...r){n=Kt(n,Pe);const s=Kt(n.firestore,Ts),o=Hd(s);let a;return a=typeof(e=$e(e))=="string"||e instanceof Wi?bT(o,"updateDoc",n._key,e,t,r):AT(o,"updateDoc",n._key,e),Jd(s,[a.toMutation(n._key,Nt.exists(!0))])}function Jd(n,e){return(function(r,s){const o=new zt;return r.asyncQueue.enqueueAndForget((async()=>nT(await fT(r),s,o))),o.promise})(ja(n),e)}function MT(n,e,t){const r=t.docs.get(e._key),s=new Xd(n);return new Nn(n,s,e._key,r,new Hr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){_r=s})(gr),cr(new Mn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new Ts(new Iy(r.getProvider("auth-internal")),new by(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new B(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new os(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),pn(gu,_u,e),pn(gu,_u,"esm2020")})();const xT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},Zd=Ml(xT),Zr=yy(Zd),es=yT(Zd),Kn=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var LT=he('<div class="parent"><br/> <h1 class="title">Good Calendar</h1> <div style="margin-top: 2rem; position:relative"><div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem;"><input type="text" placeholder="Username or Email" class="login_input" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input" style="width: 200px;"/> <button class="login-show-password"> </button></div></div></div> <div style="position:relative"><div style="text-align:center"><button style="font-size:11pt;">Login</button> <button style="font-size:11pt;">Sign up</button></div> <div style="margin-top: 5px; text-align:center"><button style="font-size:11pt;">Forgot Password</button></div></div> <div class="login-hint"><!></div> <p style="text-align: center; max-width: 550px; color: var(--V-medium-text); font-size: 12pt">Track the quality of your days and nights using color-coded ratings and comments. Dedicated to my girlfriend and her chronic migranes.</p> <p style="text-align: center; max-width: 550px; color: var(--V-medium-text); font-size: 9pt">For demo, username and password: <span style="text-decoration:underline">goodcalendar</span></p> <span><a href="https://nicholashayek.com/" style="margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 576 512"><path fill="var(--V-medium-text)" d="M575.8 255.5c0 18-15 32.1-32 32.1l-32 0 .7 160.2c0 2.7-.2 5.4-.5 8.1l0 16.2c0 22.1-17.9 40-40 40l-16 0c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1L416 512l-24 0c-22.1 0-40-17.9-40-40l0-24 0-64c0-17.7-14.3-32-32-32l-64 0c-17.7 0-32 14.3-32 32l0 64 0 24c0 22.1-17.9 40-40 40l-24 0-31.9 0c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2l-16 0c-22.1 0-40-17.9-40-40l0-112c0-.9 0-1.9 .1-2.8l0-69.7-32 0c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"></path></svg></a> <button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></button></span></div>');function FT(n,e){Ri(e,!1),sp();let t=ie(""),r=ie(""),s=ie(""),o="",a=ie(!0),u=It(e,"darkMode",8,()=>{});async function h(){N(s,"");try{w(t).includes("@")?o=w(t):o=`${w(t)}@tracker.app`;const U=await n_(Zr,o,w(r))}catch(U){console.error(U),N(s,U.message)}}async function d(){N(s,"");try{w(t).includes("@")?o=w(t):o=`${w(t)}@tracker.app`;const U=await r_(Zr,o,w(r))}catch(U){console.error(U),N(s,U.message)}}async function p(){if(N(s,""),w(t).includes("@"))o=w(t);else{N(s,"You can only reset the password of an account which uses a valid email.");return}t_(Zr,o).then(()=>{N(s,"If this email is associated with an account, an email has been sent.")}).catch(U=>{N(s,U.message)})}function y(U){switch(!0){case U.startsWith("Firebase: Error (auth/invalid-credential)."):return"Incorrect password or the account doesn't exist.";case U.startsWith("Firebase: Missing password requirements:"):return"Your password must contain at least one uppercase character, lowercase character, and number. Minimum length is 6 characters.";case U.startsWith("Firebase: Error (auth/email-already-in-use)."):return"This account already exists.";case U.startsWith("Firebase: Error (auth/invalid-email)."):return"Your username cannot have any spaces. If using email, it must be valid.";case U.startsWith("Firebase: Error (auth/missing-password)."):return"Missing password";default:return U}}bi();var v=LT(),b=$(Q(v),4),P=Q(b),k=Q(P);tr(k);var C=$(k,2),F=Q(C);tr(F);var M=$(F,2),x=Q(M,!0);K(M),K(C),K(P),K(b);var G=$(b,2),q=Q(G),J=Q(q),I=$(J,2);K(q);var g=$(q,2),m=Q(g);K(g),K(G);var T=$(G,2),E=Q(T);{var A=U=>{var de=Co();je(ue=>qe(de,ue),[()=>(w(s),_e(()=>y(w(s))))]),se(U,de)};Te(E,U=>{w(s)&&U(A)})}K(T);var _=$(T,6),j=$(Q(_),2);K(_),K(v),je(()=>{vl(F,"type",w(a)?"password":"text"),qe(x,w(a)?"show":"hide")}),Dn(k,()=>w(t),U=>N(t,U)),Dn(F,()=>w(r),U=>N(r,U)),le("click",M,()=>N(a,!w(a))),le("click",J,d),le("click",I,h),le("click",m,p),le("click",j,function(...U){u()?.apply(this,U)}),se(n,v),Si()}var UT=he("<h3>Entry logged!</h3>"),BT=he('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),jT=he('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Come back tomorrow!</h4>',1),qT=he('<div class="overlay"><!> <button>Return</button></div>'),$T=he('<br/> <div class="parent"><h1 class="title svelte-kkv8mu"></h1> <h3 style="margin-top: 0; font-style: italic;"> </h3></div>',1),zT=he('<div class="parent"><h1 class="title svelte-kkv8mu"></h1> <h3 style="margin-top: 0; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..." style="margin-top:0"></textarea> <button> </button></div>'),HT=he('<!> <button class="floating-button" style="opacity: 0; left: 2%;"></button>',1);function WT(n,e){Ri(e,!1);let t=It(e,"user",8),r=It(e,"externalEntry",8,null),s=It(e,"onSaved",8,()=>{}),o=It(e,"invert",8),a=It(e,"selectedCalendar",8),u=new Date;const h=u.getFullYear(),d=u.getMonth(),p=u.getDate();function y(_){return _.toString().padStart(2,"0")}let v=t().uid;if(t().email){const _=t().email.split("@")[0];name=_.charAt(0).toUpperCase()+_.slice(1)}else name="Temp";`${h}${y(d+1)}${y(p)}`;let b=ie(5),P=ie(""),k=ie(!1),C=ie(""),F=ie(!1),M=ie(""),x=ie(""),G=ie(!1);function q(_){return o()&&(_=10-_),`hsl(${120*(_/10)}, 70%, var(--V-brightness))`}function J(){return w(b)/10}async function I(_){if(w(k)&&!w(G))return;N(F,!0);const j=ti(es,"users",v,a(),_.key);_.period==="day"?(await Ai(j,{valueDay:w(b),textDay:w(P),timestamp:Date.now()},{merge:!0}),_.filledNight&&N(x,"Come back tomorrow!")):(await Ai(j,{valueNight:w(b),textNight:w(P),timestamp:Date.now()},{merge:!0}),_.filledDay&&N(x,"Come back tomorrow!")),console.log("Logged "+_.key+" at "+_.period),s()()}function g(){N(F,!1)}Wr(()=>_t(r()),()=>{if(r()){let _=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&_?N(k,!0):!r().current&&!_?N(k,!0):r().current&&(N(k,!1),N(P,r().period==="day"?r().textDay:r().textNight),N(b,(r().period==="day"?r().valueDay:r().valueNight)||5))}}),Wr(()=>(_t(o()),w(b)),()=>{o()?N(C,w(b)<=0?"celebrate":""):N(C,w(b)>=10?"celebrate":"")}),Wr(()=>(_t(o()),w(b)),()=>{(o()||w(b))&&N(M,q(w(b)))}),yl(),bi();var m=HT(),T=Ut(m);{var E=_=>{var j=Hs(),U=Ut(j);{var de=ve=>{var ae=qT(),ze=Q(ae);{var fe=Ie=>{var He=UT();se(Ie,He)},Ce=Ie=>{var He=Hs(),it=Ut(He);{var ut=rt=>{var ft=BT();xc(2),se(rt,ft)},Xe=rt=>{var ft=jT();xc(2),se(rt,ft)};Te(it,rt=>{_t(r()),_e(()=>r().period==="night"&&!r().filledDay)?rt(ut):rt(Xe,!1)},!0)}se(Ie,He)};Te(ze,Ie=>{_t(r()),_e(()=>r().period==="day"&&!r().filledNight)?Ie(fe):Ie(Ce,!1)})}var ke=$(ze,2);ke.__click=g,K(ae),se(ve,ae)},ue=ve=>{var ae=Hs(),ze=Ut(ae);{var fe=ke=>{var Ie=$T(),He=$(Ut(Ie),2),it=Q(He);it.textContent=`Welcome ${name??""}!`;var ut=$(it,2),Xe=Q(ut,!0);K(ut),K(He),je(()=>qe(Xe,w(x)||"Viewing past entries")),se(ke,Ie)},Ce=ke=>{var Ie=zT(),He=Q(Ie);He.textContent=`Welcome ${name??""}!`;var it=$(He,2),ut=Q(it);K(it);var Xe=$(it,2);tr(Xe);var rt=$(Xe,2);tp(rt);var ft=$(rt,2);ft.__click=()=>I(r());var Et=Q(ft);K(ft),K(Ie),je((Je,pt)=>{qe(ut,`Rate your ${_t(r()),_e(()=>r().period==="day"?"day":"night")??""}`),Xe.disabled=w(k)&&!w(G),dp(Xe,1,up(w(C)),"svelte-kkv8mu"),nr(Xe,`--fill-percentage: ${Je??""}%; --slider-color: ${w(M)??""}; margin-bottom: 0`),ft.disabled=w(k)&&!w(G),qe(Et,`Save (${pt??""}/10)`)},[()=>_e(J),()=>(w(b),_e(()=>w(b).toFixed(1)))]),Dn(Xe,()=>w(b),Je=>N(b,Je)),Dn(rt,()=>w(P),Je=>N(P,Je)),se(ke,Ie)};Te(ze,ke=>{w(k)&&!w(G)?ke(fe):ke(Ce,!1)})}se(ve,ae)};Te(U,ve=>{w(F)?ve(de):ve(ue,!1)})}se(_,j)};Te(T,_=>{r()&&_(E)})}var A=$(T,2);A.__dblclick=()=>{console.log("Activated override!"),N(G,!w(G))},se(n,m),Si()}rp(["click","dblclick"]);const GT=n=>n;function hl(n,{delay:e=0,duration:t=400,easing:r=GT}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:o=>`opacity: ${o*s}`}}var KT=he('<div class="month-nav"><button class="nav-btn" aria-label="Previous month"></button> <p> </p> <button class="nav-btn" aria-label="Next month"></button></div>'),QT=he('<div class="day"><div class="day-number"> </div>  <div class="day-half top-half"></div>  <div class="day-half bottom-half"></div></div>'),YT=he("<!> <br/> <i> </i>",1),XT=he("<!> <br/> <i> </i>",1),JT=he('<div class="entry-info"><strong> </strong> <!></div>'),ZT=he('<!> <div class="calendar"></div> <!>',1);function eI(n,e){Ri(e,!1);let t=It(e,"user",8),r=It(e,"onSelectEntry",8,g=>{}),s=It(e,"reloadTrigger",8,0),o=It(e,"invert",8),a=It(e,"selectedCalendar",8),u=t().uid,h=ie([]),d=ie(null),p=ie(new Date),y=ie("");function v(g){return g==null?"var(--V-background-white)":`hsl(${120*(g/10)}, 70%, var(--V-brightness))`}function b(g){return g.toString().padStart(2,"0")}async function P(){console.log("Loaded calendar entries");const g=w(p).getFullYear(),m=w(p).getMonth(),E=new Date().getHours()<16?"day":"night",A=new Date,_=new Date(g,m+1,0).getDate();N(y,w(p).toLocaleString("default",{month:"long",year:"numeric"}));const j=_T(es,"users",u,a()),U=await NT(j),de={};U.forEach(ae=>{de[ae.id]=ae.data()});const ue=[],ve=g===A.getFullYear()&&m===A.getMonth()?A.getDate():_;for(let ae=1;ae<=ve;ae++){const ze=`${g}-${b(m+1)}-${b(ae)}`,fe=de[ze],Ce=g===A.getFullYear()&&m===A.getMonth()&&ae===A.getDate(),ke={key:ze,day:ae,filledDay:fe?.valueDay!=null,filledNight:fe?.valueNight!=null,valueDay:fe?.valueDay??null,valueNight:fe?.valueNight??null,textDay:fe?.textDay??null,textNight:fe?.textNight??null,current:Ce};Ce&&(w(d)?.period?ke.period=w(d).period:ke.period=E,k(ke)),ue.push(ke)}N(h,ue)}function k(g){N(d,g),r()(g),console.log("Selected "+w(d).key+" at "+w(d).period)}function C(){const g=new Date(w(p));g.setMonth(g.getMonth()-1),N(p,g),P(),N(d,null)}function F(){const g=new Date,m=new Date(w(p));m.setMonth(m.getMonth()+1),!(m.getFullYear()>g.getFullYear()||m.getFullYear()===g.getFullYear()&&m.getMonth()>g.getMonth())&&(N(p,m),P(),N(d,null))}ip(P),Wr(()=>_t(s()),()=>{s()&&P()}),Wr(()=>_t(a()),()=>{a()&&(P(),N(d,null))}),yl(),bi();var M=ZT(),x=Ut(M);{var G=g=>{var m=KT(),T=Q(m),E=$(T,2),A=Q(E,!0);K(E);var _=$(E,2);K(m),je(j=>{qe(A,w(y)),_.disabled=j},[()=>(w(p),_e(()=>w(p).getFullYear()===new Date().getFullYear()&&w(p).getMonth()===new Date().getMonth()))]),le("click",T,C),le("click",_,F),se(g,m)};Te(x,g=>{(w(d)||a())&&g(G)})}var q=$(x,2);Tl(q,5,()=>w(h),El,(g,m)=>{var T=QT(),E=Q(T),A=Q(E,!0);K(E);var _=$(E,2),j=$(_,2);K(T),je((U,de)=>{nr(T,(w(m),w(d),_e(()=>(w(m).current?"border: 1.5px solid var(--V-lighter-text);":"")+(w(d)!=null&&w(d).key===w(m).key&&w(d).period==="day"?"border-top: 2.5px solid #6BCBFF;":w(d)!=null&&w(d).key===w(m).key?"border-bottom: 2.5px solid #0077BA;":"")))),qe(A,(w(m),_e(()=>w(m).day))),nr(_,U),nr(j,de)},[()=>(w(m),_t(o()),_t(Kn),_e(()=>(w(m).valueDay!=null?!o()&&w(m).valueDay==10?`background: url('${Kn}'); background-size: cover;`:o()&&w(m).valueDay==0?`background: url('${Kn}'); background-size: cover;`:`background-color: ${v(w(m).valueDay!=null&&!o()?w(m).valueDay:w(m).valueDay!=null?10-w(m).valueDay:null)};`:"")+"transition: background-color .3s ease-in-out")),()=>(w(m),_t(o()),_t(Kn),_e(()=>(w(m).valueNight!=null?!o()&&w(m).valueNight==10?`background: url('${Kn}'); background-size: cover;`:o()&&w(m).valueNight==0?`background: url('${Kn}'); background-size: cover;`:`background-color: ${v(w(m).valueNight!=null&&!o()?w(m).valueNight:w(m).valueNight!=null?10-w(m).valueNight:null)};`:"")+"transition: background-color .3s ease-in-out"))]),le("click",_,()=>k({...w(m),period:"day"})),le("click",j,()=>k({...w(m),period:"night"})),se(g,T)}),K(q);var J=$(q,2);{var I=g=>{var m=JT(),T=Q(m),E=Q(T);K(T);var A=$(T,2);{var _=U=>{var de=YT(),ue=Ut(de);{var ve=fe=>{var Ce=Co();je(()=>qe(Ce,` ${w(d),_e(()=>w(d).valueDay)??""}/10`)),se(fe,Ce)};Te(ue,fe=>{w(d),_e(()=>w(d).filledDay)&&fe(ve)})}var ae=$(ue,4),ze=Q(ae,!0);K(ae),je(()=>qe(ze,(w(d),_e(()=>w(d).textDay||"No Entry")))),se(U,de)},j=U=>{var de=XT(),ue=Ut(de);{var ve=fe=>{var Ce=Co();je(()=>qe(Ce,` ${w(d),_e(()=>w(d).valueNight)??""}/10`)),se(fe,Ce)};Te(ue,fe=>{w(d),_e(()=>w(d).filledNight)&&fe(ve)})}var ae=$(ue,4),ze=Q(ae,!0);K(ae),je(()=>qe(ze,(w(d),_e(()=>w(d).textNight||"No Entry")))),se(U,de)};Te(A,U=>{w(d),_e(()=>w(d).period==="day")?U(_):U(j,!1)})}K(m),je(U=>qe(E,`${U??""} ${w(d),_e(()=>w(d).period==="day"?"Day":"Night")??""}`),[()=>(w(d),_e(()=>new Date(new Date(w(d).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),se(g,m)};Te(J,g=>{w(d),_e(()=>w(d)&&!(w(d).period==="day"&&!w(d).filledDay&&w(d).current||w(d).period==="night"&&!w(d).filledNight&&w(d).current))&&g(I)})}se(n,M),Si()}function tI(n){return n*n*n}function nI(n){const e=n-1;return e*e*e+1}var rI=he("<button> </button>"),sI=he('<div class="overlay"><h2 style="margin-bottom: .5rem;">Your Calendars</h2> <span></span><br/><br/> <span style="margin-bottom: .5rem; flex-wrap: wrap; gap:.5rem;display: flex;"><button>Rename</button> <button>Delete</button> <button>New</button></span> <button>Back</button></div>'),iI=he("<p> </p>"),oI=he('<div class="overlay"><input type="text" class="login_input"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),aI=he("<p> </p>"),cI=he('<div class="overlay"><h3 style="margin-bottom: 0;"> </h3> <p><i>This action cannot be undone.</i></p><br/><br/> <input type="password" class="login_input" placeholder="Re-enter Password"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),uI=he("<p> </p>"),lI=he('<div class="overlay"><input type="text" class="login_input" placeholder="New Calendar"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),hI=he('<div style="order: 1; flex-wrap: wrap; gap:.5rem;display: flex"><button style="padding: .4rem inherit; border: 2px dashed #339FFF;"><b> </b></button> <!> <!> <!> <!> <button>Invert</button></div>'),dI=he('<div class="overlay"><div style="width: 65%; text-align:left"><span>Click on the <b>top half</b> of the current date to log an entry for today. Click on the <b>bottom half</b> to log an entry for tonight. You can save a rating (0-10) and, optionally, some text. Entries may be edited only on the current date. <br/><br/>To manage your calendars, click on <b>Main</b> in the bottom-left corner. You may add, delete, rename, and toggle between calendars to your liking. To reverse the red-green color scheme, click <b>Invert.</b> Your preferences will be saved for the next time you login!</span></div> <br/><br/> <button>Return</button></div>'),fI=he(`<div style="display: flex;
  justify-content: space-between;
  gap: .5rem;
  flex-wrap: wrap;
  padding-left: 5%;
  padding-right: 5%;"><div style="order: 2; flex-wrap: wrap; gap:.5rem; display: flex;"><span><button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 352 512"><path fill="var(--V-medium-text)" d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></button> <button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 10px"><svg height="25px" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></button> <button style="background-color: rgb(0, 0, 0, 0); margin: 0; padding: 0px 8px"><svg height="25px" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path></svg></button></span></div> <!> <!></div>`),pI=he('<div style="flex-grow: 1;"><!> <!> <!></div>');function AI(n,e){Ri(e,!1);let t=ie(null),r=ie(null),s=ie(0),o=ie(null),a=ie(!1),u=ie(null),h=ie(null),d=ie(""),p=ie(""),y=ie(""),v=ie(""),b=ie(""),P=ie(!1),k=!1;o_(Zr,j=>{m(j),N(t,j)});async function C(){if(!w(t))return;N(o,!w(o));const j=ti(es,"users",w(t).uid);await Ai(j,{colorPreference:w(o),timestamp:Date.now()},{merge:!0}),console.log("Saved user profile invert="+w(o))}function F(){k=!k,k?(document.documentElement.style.setProperty("--V-background-white","var(--background-black)"),document.documentElement.style.setProperty("--V-background-off-white","var(--background-off-black)"),document.documentElement.style.setProperty("--V-medium-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-dark-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-ligher-text","var(--dark-text)"),document.documentElement.style.setProperty("--V-brightness","50%"),document.documentElement.style.setProperty("--V-brightness-factor","2.2"),document.documentElement.style.setProperty("--V-true-white","var(--true-black)")):(document.documentElement.style.setProperty("--V-background-white","var(--background-white)"),document.documentElement.style.setProperty("--V-background-off-white","var(--background-off-white)"),document.documentElement.style.setProperty("--V-medium-text","var(--medium-text)"),document.documentElement.style.setProperty("--V-dark-text","var(--dark-text)"),document.documentElement.style.setProperty("--V-ligher-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-brightness","var(--brightness)"),document.documentElement.style.setProperty("--V-brightness-factor","var(--brightness-factor)"),document.documentElement.style.setProperty("--V-true-white","var(--true-white)"))}function M(){w(p)===""?N(b,"New name cannot be empty!"):Object.values(w(u)).includes(w(p))?N(b,"New name cannot be a duplicate!"):(Ls(u,w(u)[w(h)]=w(p)),q(),N(p,""),N(b,""),N(y,""))}function x(){e_(w(t),Bn.credential(w(t).email,w(v))).then(()=>{Object.keys(w(u)).length===1?(N(b,"You cannot delete your last calendar!"),N(v,"")):(delete w(u)[w(h)],N(u,{...w(u)}),N(h,Object.keys(w(u)).sort()[0]),q(),N(v,""),N(b,""),N(y,""))}).catch(j=>{N(b,"Incorrect password!")})}function G(){if(w(d)==="")N(b,"New name cannot be empty!");else if(Object.values(w(u)).includes(w(d)))N(b,"New name cannot be a duplicate!");else{const j=Date.now().toString();Ls(u,w(u)[j]=w(d)),N(u,{...w(u)}),N(h,j),q(),N(b,""),N(d,""),N(y,"")}}async function q(){if(!w(t))return;const j=Date.now(),U=ti(es,"users",w(t).uid),de=w(t).email?w(t).email.replace("@tracker.app",""):"anonymous"+j.toString();U.calendars?await OT(U,{calendars:w(u),selectedCalendar:w(h),timestamp:j}):await Ai(U,{calendars:w(u),selectedCalendar:w(h),name:de,timestamp:j}),console.log("Saved calendars to database")}function J(){N(s,w(s)+1)}function I(){a_(Zr),N(t,null),N(r,null)}function g(j){N(r,j)}async function m(j){if(!j)return;const U=ti(es,"users",j.uid),de=await DT(U);if(de.exists()){const ue=de.data();if(ue.calendars)N(u,ue.calendars),N(h,ue.selectedCalendar),console.log("Loaded user calendars");else{N(u,{});const ve=Date.now().toString();Ls(u,w(u)[ve]="Main"),N(h,ve),await q(),console.log("Initialized user calendars")}ue.colorPreference?(N(o,ue.colorPreference),console.log("Loaded user invert="+w(o))):(N(o,!1),console.log("Initialized user invert="+w(o)))}else{N(o,!1),N(u,{});const ue=Date.now().toString();Ls(u,w(u)[ue]="Main"),N(h,ue),await q(),console.log("New user.")}}bi();var T=Hs(),E=Ut(T);{var A=j=>{FT(j,{darkMode:F})},_=j=>{var U=pI(),de=Q(U);WT(de,{get user(){return w(t)},get externalEntry(){return w(r)},onSaved:J,get invert(){return w(o)},get selectedCalendar(){return w(h)}});var ue=$(de,2);eI(ue,{get user(){return w(t)},onSelectEntry:g,get reloadTrigger(){return w(s)},get invert(){return w(o)},get selectedCalendar(){return w(h)}});var ve=$(ue,2);{var ae=ze=>{var fe=fI(),Ce=Q(fe),ke=Q(Ce),Ie=Q(ke),He=$(Ie,2),it=$(He,2);K(ke),K(Ce);var ut=$(Ce,2);{var Xe=Et=>{var Je=hI(),pt=Q(Je),Tr=Q(pt),Qi=Q(Tr,!0);K(Tr),K(pt);var $n=$(pt,2);{var Ir=we=>{var Fe=sI(),Ve=$(Q(Fe),2);Tl(Ve,5,()=>Object.keys(w(u)).sort(),El,(Ae,Ge)=>{var De=rI(),lt=Q(De,!0);K(De),je(()=>{nr(De,(w(h)===w(Ge)?"border: 2px dashed #339FFF;":"border: 2px dashed #ccc;")+"margin: .5rem; margin-bottom: 0; font-size: 1.1rem"),qe(lt,w(u)[w(Ge)])}),le("click",De,()=>{N(h,w(Ge)),q()}),se(Ae,De)}),K(Ve);var We=$(Ve,4),ot=Q(We),mt=$(ot,2),Tt=$(mt,2);K(We);var bt=$(We,2);K(Fe),le("click",ot,()=>{N(y,"rename")}),le("click",mt,()=>{N(y,"delete")}),le("click",Tt,()=>{N(y,"new")}),le("click",bt,()=>{N(P,!w(P))}),se(we,Fe)};Te($n,we=>{w(P)&&we(Ir)})}var wr=$($n,2);{var xe=we=>{var Fe=oI(),Ve=Q(Fe);tr(Ve);var We=$(Ve,3),ot=Q(We),mt=$(ot,2);K(We);var Tt=$(We,2);{var bt=Ae=>{var Ge=iI(),De=Q(Ge,!0);K(Ge),je(()=>qe(De,w(b))),se(Ae,Ge)};Te(Tt,Ae=>{w(b)!=""&&Ae(bt)})}K(Fe),je(()=>vl(Ve,"placeholder",`Renaming ${w(u)[w(h)]??""}`)),Dn(Ve,()=>w(p),Ae=>N(p,Ae)),le("click",ot,()=>{N(y,""),N(p,"")}),le("click",mt,M),se(we,Fe)};Te(wr,we=>{w(y)==="rename"&&we(xe)})}var Le=$(wr,2);{var zn=we=>{var Fe=cI(),Ve=Q(Fe),We=Q(Ve);K(Ve);var ot=$(Ve,6);tr(ot);var mt=$(ot,3),Tt=Q(mt),bt=$(Tt,2);K(mt);var Ae=$(mt,2);{var Ge=De=>{var lt=aI(),bs=Q(lt,!0);K(lt),je(()=>qe(bs,w(b))),se(De,lt)};Te(Ae,De=>{w(b)!=""&&De(Ge)})}K(Fe),je(()=>qe(We,`Delete ${w(u)[w(h)]??""}?`)),Dn(ot,()=>w(v),De=>N(v,De)),le("click",Tt,()=>{N(y,""),N(v,""),N(b,"")}),le("click",bt,x),se(we,Fe)};Te(Le,we=>{w(y)==="delete"&&we(zn)})}var Is=$(Le,2);{var ws=we=>{var Fe=lI(),Ve=Q(Fe);tr(Ve);var We=$(Ve,3),ot=Q(We),mt=$(ot,2);K(We);var Tt=$(We,2);{var bt=Ae=>{var Ge=uI(),De=Q(Ge,!0);K(Ge),je(()=>qe(De,w(b))),se(Ae,Ge)};Te(Tt,Ae=>{w(b)!=""&&Ae(bt)})}K(Fe),Dn(Ve,()=>w(d),Ae=>N(d,Ae)),le("click",ot,()=>{N(y,""),N(d,""),N(b,"")}),le("click",mt,G),se(we,Fe)};Te(Is,we=>{w(y)==="new"&&we(ws)})}var As=$(Is,2);K(Je),je(()=>{qe(Qi,w(u)[w(h)]),nr(As,`background-color: ${w(o)?"hsl(0, 70%, var(--V-brightness))":"hsl(120, 70%, var(--V-brightness))"}; color: #202020; transition: background-color .2s ease-in-out`)}),le("click",pt,()=>{N(P,!w(P))}),le("click",As,C),se(Et,Je)};Te(ut,Et=>{w(o)!=null&&Et(Xe)})}var rt=$(ut,2);{var ft=Et=>{var Je=dI(),pt=$(Q(Je),5);K(Je),le("click",pt,()=>{N(a,!w(a))}),se(Et,Je)};Te(rt,Et=>{w(a)&&Et(ft)})}K(fe),le("click",Ie,()=>{N(a,!w(a))}),le("click",He,F),le("click",it,I),se(ze,fe)};Te(ve,ze=>{w(r)&&ze(ae)})}K(U),Fc(1,U,()=>hl,()=>({delay:0,duration:400,easing:tI})),Fc(2,U,()=>hl,()=>({delay:0,duration:400,easing:nI})),se(j,U)};Te(E,j=>{!w(t)||!w(h)?j(A):j(_,!1)})}se(n,T),Si()}export{AI as component};
