import{f as Be,a as Ee,c as so,t as _c}from"../chunks/Dxr1Ij_4.js";import{i as Qs}from"../chunks/jxJGgJgQ.js";import{P as Fi,h as Xe,a4 as of,e as Yu,I as af,H as cf,t as k,U as uf,K as lf,M as hf,O as yc,Q as Ui,i as yr,aa as df,aF as ff,f as io,s as pf,c as Dn,aD as Xu,z as mf,aI as ge,af as Ec,ao as gf,r as Ju,p as _f,aM as yf,aN as Bi,d as Zu,aO as Ef,aP as vf,ab as Tf,aQ as If,aC as wf,aR as Af,Y as Rf,aS as Sf,aK as Pf,l as me,ag as bf,aT as Cf,A as Ys,G as re,E as he,F as le,C as Ke,D as Xs,W as K,aU as Er,aV as el,B as $t,v as Qe,aW as kf,ap as vc}from"../chunks/Bxsz-vti.js";import{s as Ye,e as Tt,d as Df}from"../chunks/BL4KWbMy.js";import{i as ht,p as zt}from"../chunks/BVnwWrB1.js";import{c as Vf,o as tl}from"../chunks/CrpsGFMf.js";import{r as oo,s as Nf}from"../chunks/BFr2TMnw.js";function Of(n,e){return e}function Mf(n,e,t){for(var r=n.items,s=[],o=e.length,a=0;a<o;a++)If(e[a].e,s,!0);var u=o>0&&s.length===0&&t!==null;if(u){var h=t.parentNode;wf(h),h.append(t),r.clear(),ut(n,e[0].prev,e[o-1].next)}Af(s,()=>{for(var d=0;d<o;d++){var p=e[d];u||(r.delete(p.k),ut(n,p.prev,p.next)),Zu(p.e,!u)}})}function Lf(n,e,t,r,s,o=null){var a=n,u={flags:e,items:new Map,first:null};{var h=n;a=Xe?Fi(of(h)):h.appendChild(Yu())}Xe&&af();var d=null,p=!1,v=new Map,I=uf(()=>{var C=t();return mf(C)?C:C==null?[]:Xu(C)}),R,V;function P(){xf(V,R,u,v,a,s,e,r,t),o!==null&&(R.length===0?d?Ju(d):d=io(()=>o(a)):d!==null&&_f(d,()=>{d=null}))}cf(()=>{V??=Rf,R=k(I);var C=R.length;if(p&&C===0)return;p=C===0;let x=!1;if(Xe){var F=lf(a)===hf;F!==(C===0)&&(a=yc(),Fi(a),Ui(!1),x=!0)}if(Xe){for(var M=null,q,H=0;H<C;H++){if(yr.nodeType===df&&yr.data===ff){a=yr,x=!0,Ui(!1);break}var Q=R[H],E=r(Q,H);q=ao(yr,u,M,null,Q,E,H,s,e,t),u.items.set(E,q),M=q}C>0&&Fi(yc())}if(Xe)C===0&&o&&(d=io(()=>o(a)));else if(pf()){var m=new Set,y=Dn;for(H=0;H<C;H+=1){Q=R[H],E=r(Q,H);var T=u.items.get(E)??v.get(E);T?nl(T,Q,H):(q=ao(null,u,null,null,Q,E,H,s,e,t,!0),v.set(E,q)),m.add(E)}for(const[g,w]of u.items)m.has(g)||y.skipped_effects.add(w.e);y.oncommit(P)}else P();x&&Ui(!0),k(I)}),Xe&&(a=yr)}function xf(n,e,t,r,s,o,a,u,h){var d=e.length,p=t.items,v=t.first,I=v,R,V=null,P=[],C=[],x,F,M,q;for(q=0;q<d;q+=1){if(x=e[q],F=u(x,q),M=p.get(F),M===void 0){var H=r.get(F);if(H!==void 0){r.delete(F),p.set(F,H);var Q=V?V.next:I;ut(t,V,H),ut(t,H,Q),ji(H,Q,s),V=H}else{var E=I?I.e.nodes_start:s;V=ao(E,t,V,V===null?t.first:V.next,x,F,q,o,a,h)}p.set(F,V),P=[],C=[],I=V.next;continue}if(nl(M,x,q),(M.e.f&Bi)!==0&&Ju(M.e),M!==I){if(R!==void 0&&R.has(M)){if(P.length<C.length){var m=C[0],y;V=m.prev;var T=P[0],g=P[P.length-1];for(y=0;y<P.length;y+=1)ji(P[y],m,s);for(y=0;y<C.length;y+=1)R.delete(C[y]);ut(t,T.prev,g.next),ut(t,V,T),ut(t,g,m),I=m,V=g,q-=1,P=[],C=[]}else R.delete(M),ji(M,I,s),ut(t,M.prev,M.next),ut(t,M,V===null?t.first:V.next),ut(t,V,M),V=M;continue}for(P=[],C=[];I!==null&&I.k!==F;)(I.e.f&Bi)===0&&(R??=new Set).add(I),C.push(I),I=I.next;if(I===null)continue;M=I}P.push(M),V=M,I=M.next}if(I!==null||R!==void 0){for(var w=R===void 0?[]:Xu(R);I!==null;)(I.e.f&Bi)===0&&w.push(I),I=I.next;var _=w.length;if(_>0){var ae=d===0?s:null;Mf(t,w,ae)}}n.first=t.first&&t.first.e,n.last=V&&V.e;for(var Te of r.values())Zu(Te.e);r.clear()}function nl(n,e,t,r){gf(n.v,e),n.i=t}function ao(n,e,t,r,s,o,a,u,h,d,p){var v=(h&Ef)!==0,I=(h&vf)===0,R=v?I?ge(s,!1,!1):Ec(s):s,V=(h&yf)===0?a:Ec(a),P={i:V,v:R,k:o,a:null,e:null,prev:t,next:r};try{if(n===null){var C=document.createDocumentFragment();C.append(n=Yu())}return P.e=io(()=>u(n,R,V,d),Xe),P.e.prev=t&&t.e,P.e.next=r&&r.e,t===null?p||(e.first=P):(t.next=P,t.e.next=P.e),r!==null&&(r.prev=P,r.e.prev=P.e),P}finally{}}function ji(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==r;){var a=Tf(o);s.before(o),o=a}}function ut(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function rl(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=rl(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Ff(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=rl(n))&&(r&&(r+=" "),r+=e);return r}function Uf(n){return typeof n=="object"?Ff(n):n??""}function Bf(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Tc(n,e=!1){var t=e?" !important;":";",r="";for(var s in n){var o=n[s];o!=null&&o!==""&&(r+=" "+s+": "+o+t)}return r}function qi(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function jf(n,e){if(e){var t="",r,s;if(Array.isArray(e)?(r=e[0],s=e[1]):r=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,u=!1,h=[];r&&h.push(...Object.keys(r).map(qi)),s&&h.push(...Object.keys(s).map(qi));var d=0,p=-1;const P=n.length;for(var v=0;v<P;v++){var I=n[v];if(u?I==="/"&&n[v-1]==="*"&&(u=!1):o?o===I&&(o=!1):I==="/"&&n[v+1]==="*"?u=!0:I==='"'||I==="'"?o=I:I==="("?a++:I===")"&&a--,!u&&o===!1&&a===0){if(I===":"&&p===-1)p=v;else if(I===";"||v===P-1){if(p!==-1){var R=qi(n.substring(d,p).trim());if(!h.includes(R)){I!==";"&&v++;var V=n.substring(d,v).trim();t+=" "+V+";"}}d=v+1,p=-1}}}}return r&&(t+=Tc(r)),s&&(t+=Tc(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function qf(n,e,t,r,s,o){var a=n.__className;if(Xe||a!==t||a===void 0){var u=Bf(t,r);(!Xe||u!==n.getAttribute("class"))&&(u==null?n.removeAttribute("class"):n.className=u),n.__className=t}return o}function $i(n,e={},t,r){for(var s in t){var o=t[s];e[s]!==o&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,o,r))}}function Wt(n,e,t,r){var s=n.__style;if(Xe||s!==e){var o=jf(e,r);(!Xe||o!==n.getAttribute("style"))&&(o==null?n.removeAttribute("style"):n.style.cssText=o),n.__style=e}else r&&(Array.isArray(r)?($i(n,t?.[0],r[0]),$i(n,t?.[1],r[1],"important")):$i(n,t,r));return r}function Ps(n,e,t=e){var r=new WeakSet;Sf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=zi(n)?Hi(o):o,t(o),Dn!==null&&r.add(Dn),await Pf(),o!==(o=e())){var a=n.selectionStart,u=n.selectionEnd,h=n.value.length;if(n.value=o??"",u!==null){var d=n.value.length;a===u&&u===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(u,d))}}}),(Xe&&n.defaultValue!==n.value||me(e)==null&&n.value)&&(t(zi(n)?Hi(n.value):n.value),Dn!==null&&r.add(Dn)),bf(()=>{var s=e();if(n===document.activeElement){var o=Cf??Dn;if(r.has(o))return}zi(n)&&s===Hi(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function zi(n){var e=n.type;return e==="number"||e==="range"}function Hi(n){return n===""?null:+n}const $f=()=>{};var Ic={};const sl=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},zf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},il={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,v=(o&3)<<4|u>>4;let I=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(I=64)),r.push(t[p],t[v],t[I],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(sl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):zf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const v=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||v==null)throw new Hf;const I=o<<2|u>>4;if(r.push(I),d!==64){const R=u<<4&240|d>>2;if(r.push(R),v!==64){const V=d<<6&192|v;r.push(V)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Hf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Wf=function(n){const e=sl(n);return il.encodeByteArray(e,!0)},bs=function(n){return Wf(n).replace(/\./g,"")},ol=function(n){try{return il.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Gf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Kf=()=>Gf().__FIREBASE_DEFAULTS__,Qf=()=>{if(typeof process>"u"||typeof Ic>"u")return;const n=Ic.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Yf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ol(n[1]);return e&&JSON.parse(e)},Js=()=>{try{return $f()||Kf()||Qf()||Yf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},al=n=>Js()?.emulatorHosts?.[n],Xf=n=>{const e=al(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},cl=()=>Js()?.config,ul=n=>Js()?.[`_${n}`];class Jf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Qn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ll(n){return(await fetch(n,{credentials:"include"})).ok}function Zf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[bs(JSON.stringify(t)),bs(JSON.stringify(a)),""].join(".")}const Sr={};function ep(){const n={prod:[],emulator:[]};for(const e of Object.keys(Sr))Sr[e]?n.emulator.push(e):n.prod.push(e);return n}function tp(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let wc=!1;function hl(n,e){if(typeof window>"u"||typeof document>"u"||!Qn(window.location.host)||Sr[n]===e||Sr[n]||wc)return;Sr[n]=e;function t(I){return`__firebase__banner__${I}`}const r="__firebase__banner",o=ep().prod.length>0;function a(){const I=document.getElementById(r);I&&I.remove()}function u(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function h(I,R){I.setAttribute("width","24"),I.setAttribute("id",R),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function d(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{wc=!0,a()},I}function p(I,R){I.setAttribute("id",R),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function v(){const I=tp(r),R=t("text"),V=document.getElementById(R)||document.createElement("span"),P=t("learnmore"),C=document.getElementById(P)||document.createElement("a"),x=t("preprendIcon"),F=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const M=I.element;u(M),p(C,P);const q=d();h(F,x),M.append(F,V,C,q),document.body.appendChild(M)}o?(V.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,V.innerText="Preview backend running in this workspace."),V.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function Le(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function np(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Le())}function rp(){const n=Js()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function sp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ip(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function op(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ap(){const n=Le();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function cp(){return!rp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function up(){try{return typeof indexedDB=="object"}catch{return!1}}function lp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const hp="FirebaseError";class Dt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=hp,Object.setPrototypeOf(this,Dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jr.prototype.create)}}class jr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?dp(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Dt(s,u,r)}}function dp(n,e){return n.replace(fp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const fp=/\{\$([^}]+)}/g;function pp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function gn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Ac(o)&&Ac(a)){if(!gn(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Ac(n){return n!==null&&typeof n=="object"}function qr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function vr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Tr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function mp(n,e){const t=new gp(n,e);return t.subscribe.bind(t)}class gp{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");_p(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Wi),s.error===void 0&&(s.error=Wi),s.complete===void 0&&(s.complete=Wi);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function _p(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Wi(){}function ze(n){return n&&n._delegate?n._delegate:n}class _n{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const fn="[DEFAULT]";class yp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Jf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(vp(e))try{this.getOrInitializeService({instanceIdentifier:fn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=fn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=fn){return this.instances.has(e)}getOptions(e=fn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ep(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=fn){return this.component?this.component.multipleInstances?e:fn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ep(n){return n===fn?void 0:n}function vp(n){return n.instantiationMode==="EAGER"}class Tp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new yp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Y;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Y||(Y={}));const Ip={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},wp=Y.INFO,Ap={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},Rp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Ap[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Mo{constructor(e){this.name=e,this._logLevel=wp,this._logHandler=Rp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ip[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const Sp=(n,e)=>e.some(t=>n instanceof t);let Rc,Sc;function Pp(){return Rc||(Rc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bp(){return Sc||(Sc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const dl=new WeakMap,co=new WeakMap,fl=new WeakMap,Gi=new WeakMap,Lo=new WeakMap;function Cp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Gt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&dl.set(t,n)}).catch(()=>{}),Lo.set(e,n),e}function kp(n){if(co.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});co.set(n,e)}let uo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return co.get(n);if(e==="objectStoreNames")return n.objectStoreNames||fl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Gt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Dp(n){uo=n(uo)}function Vp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ki(this),e,...t);return fl.set(r,e.sort?e.sort():[e]),Gt(r)}:bp().includes(n)?function(...e){return n.apply(Ki(this),e),Gt(dl.get(this))}:function(...e){return Gt(n.apply(Ki(this),e))}}function Np(n){return typeof n=="function"?Vp(n):(n instanceof IDBTransaction&&kp(n),Sp(n,Pp())?new Proxy(n,uo):n)}function Gt(n){if(n instanceof IDBRequest)return Cp(n);if(Gi.has(n))return Gi.get(n);const e=Np(n);return e!==n&&(Gi.set(n,e),Lo.set(e,n)),e}const Ki=n=>Lo.get(n);function Op(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=Gt(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Gt(a.result),h.oldVersion,h.newVersion,Gt(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const Mp=["get","getKey","getAll","getAllKeys","count"],Lp=["put","add","delete","clear"],Qi=new Map;function Pc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Qi.get(e))return Qi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Lp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Mp.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),s&&h.done]))[0]};return Qi.set(e,o),o}Dp(n=>({...n,get:(e,t,r)=>Pc(e,t)||n.get(e,t,r),has:(e,t)=>!!Pc(e,t)||n.has(e,t)}));class xp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Fp(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Fp(n){return n.getComponent()?.type==="VERSION"}const lo="@firebase/app",bc="0.14.5";const Pt=new Mo("@firebase/app"),Up="@firebase/app-compat",Bp="@firebase/analytics-compat",jp="@firebase/analytics",qp="@firebase/app-check-compat",$p="@firebase/app-check",zp="@firebase/auth",Hp="@firebase/auth-compat",Wp="@firebase/database",Gp="@firebase/data-connect",Kp="@firebase/database-compat",Qp="@firebase/functions",Yp="@firebase/functions-compat",Xp="@firebase/installations",Jp="@firebase/installations-compat",Zp="@firebase/messaging",em="@firebase/messaging-compat",tm="@firebase/performance",nm="@firebase/performance-compat",rm="@firebase/remote-config",sm="@firebase/remote-config-compat",im="@firebase/storage",om="@firebase/storage-compat",am="@firebase/firestore",cm="@firebase/ai",um="@firebase/firestore-compat",lm="firebase",hm="12.5.0";const ho="[DEFAULT]",dm={[lo]:"fire-core",[Up]:"fire-core-compat",[jp]:"fire-analytics",[Bp]:"fire-analytics-compat",[$p]:"fire-app-check",[qp]:"fire-app-check-compat",[zp]:"fire-auth",[Hp]:"fire-auth-compat",[Wp]:"fire-rtdb",[Gp]:"fire-data-connect",[Kp]:"fire-rtdb-compat",[Qp]:"fire-fn",[Yp]:"fire-fn-compat",[Xp]:"fire-iid",[Jp]:"fire-iid-compat",[Zp]:"fire-fcm",[em]:"fire-fcm-compat",[tm]:"fire-perf",[nm]:"fire-perf-compat",[rm]:"fire-rc",[sm]:"fire-rc-compat",[im]:"fire-gcs",[om]:"fire-gcs-compat",[am]:"fire-fst",[um]:"fire-fst-compat",[cm]:"fire-vertex","fire-js":"fire-js",[lm]:"fire-js-all"};const Cs=new Map,fm=new Map,fo=new Map;function Cc(n,e){try{n.container.addComponent(e)}catch(t){Pt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function qn(n){const e=n.name;if(fo.has(e))return Pt.debug(`There were multiple attempts to register component ${e}.`),!1;fo.set(e,n);for(const t of Cs.values())Cc(t,n);for(const t of fm.values())Cc(t,n);return!0}function xo(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Je(n){return n==null?!1:n.settings!==void 0}const pm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Kt=new jr("app","Firebase",pm);class mm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _n("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Kt.create("app-deleted",{appName:this._name})}}const Yn=hm;function pl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:ho,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Kt.create("bad-app-name",{appName:String(s)});if(t||(t=cl()),!t)throw Kt.create("no-options");const o=Cs.get(s);if(o){if(gn(t,o.options)&&gn(r,o.config))return o;throw Kt.create("duplicate-app",{appName:s})}const a=new Tp(s);for(const h of fo.values())a.addComponent(h);const u=new mm(t,r,a);return Cs.set(s,u),u}function ml(n=ho){const e=Cs.get(n);if(!e&&n===ho&&cl())return pl();if(!e)throw Kt.create("no-app",{appName:n});return e}function Qt(n,e,t){let r=dm[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Pt.warn(a.join(" "));return}qn(new _n(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const gm="firebase-heartbeat-database",_m=1,Vr="firebase-heartbeat-store";let Yi=null;function gl(){return Yi||(Yi=Op(gm,_m,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Vr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Kt.create("idb-open",{originalErrorMessage:n.message})})),Yi}async function ym(n){try{const t=(await gl()).transaction(Vr),r=await t.objectStore(Vr).get(_l(n));return await t.done,r}catch(e){if(e instanceof Dt)Pt.warn(e.message);else{const t=Kt.create("idb-get",{originalErrorMessage:e?.message});Pt.warn(t.message)}}}async function kc(n,e){try{const r=(await gl()).transaction(Vr,"readwrite");await r.objectStore(Vr).put(e,_l(n)),await r.done}catch(t){if(t instanceof Dt)Pt.warn(t.message);else{const r=Kt.create("idb-set",{originalErrorMessage:t?.message});Pt.warn(r.message)}}}function _l(n){return`${n.name}!${n.options.appId}`}const Em=1024,vm=30;class Tm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new wm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Dc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>vm){const s=Am(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Pt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Dc(),{heartbeatsToSend:t,unsentEntries:r}=Im(this._heartbeatsCache.heartbeats),s=bs(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Pt.warn(e),""}}}function Dc(){return new Date().toISOString().substring(0,10)}function Im(n,e=Em){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Vc(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Vc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class wm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return up()?lp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await ym(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return kc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return kc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Vc(n){return bs(JSON.stringify({version:2,heartbeats:n})).length}function Am(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Rm(n){qn(new _n("platform-logger",e=>new xp(e),"PRIVATE")),qn(new _n("heartbeat",e=>new Tm(e),"PRIVATE")),Qt(lo,bc,n),Qt(lo,bc,"esm2020"),Qt("fire-js","")}Rm("");var Sm="firebase",Pm="12.5.0";Qt(Sm,Pm,"app");function yl(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const bm=yl,El=new jr("auth","Firebase",yl());const ks=new Mo("@firebase/auth");function Cm(n,...e){ks.logLevel<=Y.WARN&&ks.warn(`Auth (${Yn}): ${n}`,...e)}function _s(n,...e){ks.logLevel<=Y.ERROR&&ks.error(`Auth (${Yn}): ${n}`,...e)}function it(n,...e){throw Fo(n,...e)}function dt(n,...e){return Fo(n,...e)}function vl(n,e,t){const r={...bm(),[e]:t};return new jr("auth","Firebase",r).create(e,{appName:n.name})}function At(n){return vl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fo(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return El.create(n,...e)}function B(n,e,...t){if(!n)throw Fo(e,...t)}function It(n){const e="INTERNAL ASSERTION FAILED: "+n;throw _s(e),new Error(e)}function bt(n,e){n||It(e)}function po(){return typeof self<"u"&&self.location?.href||""}function km(){return Nc()==="http:"||Nc()==="https:"}function Nc(){return typeof self<"u"&&self.location?.protocol||null}function Dm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(km()||ip()||"connection"in navigator)?navigator.onLine:!0}function Vm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class $r{constructor(e,t){this.shortDelay=e,this.longDelay=t,bt(t>e,"Short delay should be less than long delay!"),this.isMobile=np()||op()}get(){return Dm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Uo(n,e){bt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Tl{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;It("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;It("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;It("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Nm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Om=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Mm=new $r(3e4,6e4);function sn(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function on(n,e,t,r,s={}){return Il(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const u=qr({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return sp()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Qn(n.emulatorConfig.host)&&(d.credentials="include"),Tl.fetch()(await wl(n,n.config.apiHost,t,u),d)})}async function Il(n,e,t){n._canInitEmulator=!1;const r={...Nm,...e};try{const s=new xm(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw hs(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw hs(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw hs(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw hs(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw vl(n,p,d);it(n,p)}}catch(s){if(s instanceof Dt)throw s;it(n,"network-request-failed",{message:String(s)})}}async function zr(n,e,t,r,s={}){const o=await on(n,e,t,r,s);return"mfaPendingCredential"in o&&it(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function wl(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?Uo(n.config,s):`${n.config.apiScheme}://${s}`;return Om.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function Lm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class xm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(dt(this.auth,"network-request-failed")),Mm.get())})}}function hs(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=dt(n,e,r);return s.customData._tokenResponse=t,s}function Oc(n){return n!==void 0&&n.enterprise!==void 0}class Fm{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Lm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Um(n,e){return on(n,"GET","/v2/recaptchaConfig",sn(n,e))}async function Bm(n,e){return on(n,"POST","/v1/accounts:delete",e)}async function Ds(n,e){return on(n,"POST","/v1/accounts:lookup",e)}function Pr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jm(n,e=!1){const t=ze(n),r=await t.getIdToken(e),s=Bo(r);B(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:Pr(Xi(s.auth_time)),issuedAtTime:Pr(Xi(s.iat)),expirationTime:Pr(Xi(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Xi(n){return Number(n)*1e3}function Bo(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return _s("JWT malformed, contained fewer than 3 sections"),null;try{const s=ol(t);return s?JSON.parse(s):(_s("Failed to decode base64 JWT payload"),null)}catch(s){return _s("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Mc(n){const e=Bo(n);return B(e,"internal-error"),B(typeof e.exp<"u","internal-error"),B(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Nr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Dt&&qm(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function qm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class $m{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class mo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Pr(this.lastLoginAt),this.creationTime=Pr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Vs(n){const e=n.auth,t=await n.getIdToken(),r=await Nr(n,Ds(e,{idToken:t}));B(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Al(s.providerUserInfo):[],a=Hm(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=u?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new mo(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function zm(n){const e=ze(n);await Vs(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Hm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Al(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Wm(n,e){const t=await Il(n,{},async()=>{const r=qr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await wl(n,s,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return n.emulatorConfig&&Qn(n.emulatorConfig.host)&&(h.credentials="include"),Tl.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Gm(n,e){return on(n,"POST","/v2/accounts:revokeToken",sn(n,e))}class xn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){B(e.idToken,"internal-error"),B(typeof e.idToken<"u","internal-error"),B(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){B(e.length!==0,"internal-error");const t=Mc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(B(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await Wm(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new xn;return r&&(B(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(B(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(B(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xn,this.toJSON())}_performRefresh(){return It("not implemented")}}function Ft(n,e){B(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class rt{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new $m(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new mo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Nr(this,this.stsTokenManager.getToken(this.auth,e));return B(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return jm(this,e)}reload(){return zm(this)}_assign(e){this!==e&&(B(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new rt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){B(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Vs(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Je(this.auth.app))return Promise.reject(At(this.auth));const e=await this.getIdToken();return await Nr(this,Bm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:v,emailVerified:I,isAnonymous:R,providerData:V,stsTokenManager:P}=t;B(v&&P,e,"internal-error");const C=xn.fromJSON(this.name,P);B(typeof v=="string",e,"internal-error"),Ft(r,e.name),Ft(s,e.name),B(typeof I=="boolean",e,"internal-error"),B(typeof R=="boolean",e,"internal-error"),Ft(o,e.name),Ft(a,e.name),Ft(u,e.name),Ft(h,e.name),Ft(d,e.name),Ft(p,e.name);const x=new rt({uid:v,auth:e,email:s,emailVerified:I,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:C,createdAt:d,lastLoginAt:p});return V&&Array.isArray(V)&&(x.providerData=V.map(F=>({...F}))),h&&(x._redirectEventId=h),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new xn;s.updateFromServerResponse(t);const o=new rt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Vs(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];B(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Al(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,u=new xn;u.updateFromIdToken(r);const h=new rt({uid:s.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new mo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Lc=new Map;function wt(n){bt(n instanceof Function,"Expected a class definition");let e=Lc.get(n);return e?(bt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Lc.set(n,e),e)}class Rl{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Rl.type="NONE";const xc=Rl;function ys(n,e,t){return`firebase:${n}:${e}:${t}`}class Fn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=ys(this.userKey,s.apiKey,o),this.fullPersistenceKey=ys("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Ds(this.auth,{idToken:e}).catch(()=>{});return t?rt._fromGetAccountInfoResponse(this.auth,t,e):null}return rt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Fn(wt(xc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||wt(xc);const a=ys(r,e.config.apiKey,e.name);let u=null;for(const d of t)try{const p=await d._get(a);if(p){let v;if(typeof p=="string"){const I=await Ds(e,{idToken:p}).catch(()=>{});if(!I)break;v=await rt._fromGetAccountInfoResponse(e,I,p)}else v=rt._fromJSON(e,p);d!==o&&(u=v),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Fn(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new Fn(o,e,r))}}function Fc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Cl(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Sl(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Dl(e))return"Blackberry";if(Vl(e))return"Webos";if(Pl(e))return"Safari";if((e.includes("chrome/")||bl(e))&&!e.includes("edge/"))return"Chrome";if(kl(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Sl(n=Le()){return/firefox\//i.test(n)}function Pl(n=Le()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bl(n=Le()){return/crios\//i.test(n)}function Cl(n=Le()){return/iemobile/i.test(n)}function kl(n=Le()){return/android/i.test(n)}function Dl(n=Le()){return/blackberry/i.test(n)}function Vl(n=Le()){return/webos/i.test(n)}function jo(n=Le()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Km(n=Le()){return jo(n)&&!!window.navigator?.standalone}function Qm(){return ap()&&document.documentMode===10}function Nl(n=Le()){return jo(n)||kl(n)||Vl(n)||Dl(n)||/windows phone/i.test(n)||Cl(n)}function Ol(n,e=[]){let t;switch(n){case"Browser":t=Fc(Le());break;case"Worker":t=`${Fc(Le())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Yn}/${r}`}class Ym{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,u)=>{try{const h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Xm(n,e={}){return on(n,"GET","/v2/passwordPolicy",sn(n,e))}const Jm=6;class Zm{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Jm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class eg{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Uc(this),this.idTokenSubscription=new Uc(this),this.beforeStateQueue=new Ym(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=El,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=wt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Fn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Ds(this,{idToken:e}),r=await rt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Je(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return B(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Vs(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Vm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Je(this.app))return Promise.reject(At(this));const t=e?ze(e):null;return t&&B(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&B(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Je(this.app)?Promise.reject(At(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Je(this.app)?Promise.reject(At(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Xm(this),t=new Zm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new jr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Gm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&wt(e)||this._popupRedirectResolver;B(t,this,"argument-error"),this.redirectPersistenceManager=await Fn.create(this,[wt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(B(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return B(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ol(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Je(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Cm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function wn(n){return ze(n)}class Uc{constructor(e){this.auth=e,this.observer=null,this.addObserver=mp(t=>this.observer=t)}get next(){return B(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Zs={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tg(n){Zs=n}function Ml(n){return Zs.loadJS(n)}function ng(){return Zs.recaptchaEnterpriseScript}function rg(){return Zs.gapiScript}function sg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ig{constructor(){this.enterprise=new og}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class og{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const ag="recaptcha-enterprise",Ll="NO_RECAPTCHA";class cg{constructor(e){this.type=ag,this.auth=wn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,u)=>{Um(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const d=new Fm(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{u(h)})})}function s(o,a,u){const h=window.grecaptcha;Oc(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(Ll)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ig().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(u=>{if(!t&&Oc(window.grecaptcha))s(u,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=ng();h.length!==0&&(h+=u),Ml(h).then(()=>{s(u,o,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})}}async function Bc(n,e,t,r=!1,s=!1){const o=new cg(n);let a;if(s)a=Ll;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function go(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Bc(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Bc(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}function ug(n,e){const t=xo(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(gn(o,e??{}))return s;it(s,"already-initialized")}return t.initialize({options:e})}function lg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(wt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function hg(n,e,t){const r=wn(n);B(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=xl(e),{host:a,port:u}=dg(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){B(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),B(gn(d,r.config.emulator)&&gn(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Qn(a)?(ll(`${o}//${a}${h}`),hl("Auth",!0)):fg()}function xl(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function dg(n){const e=xl(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:jc(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:jc(a)}}}function jc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function fg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class qo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return It("not implemented")}_getIdTokenResponse(e){return It("not implemented")}_linkToIdToken(e,t){return It("not implemented")}_getReauthenticationResolver(e){return It("not implemented")}}async function pg(n,e){return on(n,"POST","/v1/accounts:signUp",e)}async function mg(n,e){return zr(n,"POST","/v1/accounts:signInWithPassword",sn(n,e))}async function gg(n,e){return zr(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))}async function _g(n,e){return zr(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))}class Or extends qo{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Or(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Or(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return go(e,t,"signInWithPassword",mg);case"emailLink":return gg(e,{email:this._email,oobCode:this._password});default:it(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return go(e,r,"signUpPassword",pg);case"emailLink":return _g(e,{idToken:t,email:this._email,oobCode:this._password});default:it(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Un(n,e){return zr(n,"POST","/v1/accounts:signInWithIdp",sn(n,e))}const yg="http://localhost";class yn extends qo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):it("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new yn(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Un(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Un(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Un(e,t)}buildRequest(){const e={requestUri:yg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=qr(t)}return e}}function Eg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function vg(n){const e=vr(Tr(n)).link,t=e?vr(Tr(e)).deep_link_id:null,r=vr(Tr(n)).deep_link_id;return(r?vr(Tr(r)).link:null)||r||t||e||n}class $o{constructor(e){const t=vr(Tr(e)),r=t.apiKey??null,s=t.oobCode??null,o=Eg(t.mode??null);B(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=vg(e);try{return new $o(t)}catch{return null}}}class Xn{constructor(){this.providerId=Xn.PROVIDER_ID}static credential(e,t){return Or._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=$o.parseLink(t);return B(r,"argument-error"),Or._fromEmailAndCode(e,r.code,r.tenantId)}}Xn.PROVIDER_ID="password";Xn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Fl{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Hr extends Fl{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ut extends Hr{constructor(){super("facebook.com")}static credential(e){return yn._fromParams({providerId:Ut.PROVIDER_ID,signInMethod:Ut.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ut.credentialFromTaggedObject(e)}static credentialFromError(e){return Ut.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ut.credential(e.oauthAccessToken)}catch{return null}}}Ut.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ut.PROVIDER_ID="facebook.com";class Bt extends Hr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yn._fromParams({providerId:Bt.PROVIDER_ID,signInMethod:Bt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bt.credentialFromTaggedObject(e)}static credentialFromError(e){return Bt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Bt.credential(t,r)}catch{return null}}}Bt.GOOGLE_SIGN_IN_METHOD="google.com";Bt.PROVIDER_ID="google.com";class jt extends Hr{constructor(){super("github.com")}static credential(e){return yn._fromParams({providerId:jt.PROVIDER_ID,signInMethod:jt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jt.credentialFromTaggedObject(e)}static credentialFromError(e){return jt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jt.credential(e.oauthAccessToken)}catch{return null}}}jt.GITHUB_SIGN_IN_METHOD="github.com";jt.PROVIDER_ID="github.com";class qt extends Hr{constructor(){super("twitter.com")}static credential(e,t){return yn._fromParams({providerId:qt.PROVIDER_ID,signInMethod:qt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return qt.credentialFromTaggedObject(e)}static credentialFromError(e){return qt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return qt.credential(t,r)}catch{return null}}}qt.TWITTER_SIGN_IN_METHOD="twitter.com";qt.PROVIDER_ID="twitter.com";async function Tg(n,e){return zr(n,"POST","/v1/accounts:signUp",sn(n,e))}class En{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await rt._fromIdTokenResponse(e,r,s),a=qc(r);return new En({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=qc(r);return new En({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function qc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Ns extends Dt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Ns.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Ns(e,t,r,s)}}function Ul(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Ns._fromErrorAndOperation(n,o,e,r):o})}async function Ig(n,e,t=!1){const r=await Nr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return En._forOperation(n,"link",r)}async function wg(n,e,t=!1){const{auth:r}=n;if(Je(r.app))return Promise.reject(At(r));const s="reauthenticate";try{const o=await Nr(n,Ul(r,s,e,n),t);B(o.idToken,r,"internal-error");const a=Bo(o.idToken);B(a,r,"internal-error");const{sub:u}=a;return B(n.uid===u,r,"user-mismatch"),En._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&it(r,"user-mismatch"),o}}async function Bl(n,e,t=!1){if(Je(n.app))return Promise.reject(At(n));const r="signIn",s=await Ul(n,r,e),o=await En._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}async function Ag(n,e){return Bl(wn(n),e)}async function jl(n){const e=wn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Rg(n,e,t){if(Je(n.app))return Promise.reject(At(n));const r=wn(n),a=await go(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Tg).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&jl(n),h}),u=await En._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function Sg(n,e,t){return Je(n.app)?Promise.reject(At(n)):Ag(ze(n),Xn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jl(n),r})}function Pg(n,e,t,r){return ze(n).onIdTokenChanged(e,t,r)}function bg(n,e,t){return ze(n).beforeAuthStateChanged(e,t)}function Cg(n,e,t,r){return ze(n).onAuthStateChanged(e,t,r)}function kg(n){return ze(n).signOut()}const Os="__sak";class ql{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Os,"1"),this.storage.removeItem(Os),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Dg=1e3,Vg=10;class $l extends ql{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Nl(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,u,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);Qm()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Vg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Dg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}$l.type="LOCAL";const Ng=$l;class zl extends ql{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}zl.type="SESSION";const Hl=zl;function Og(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ei{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ei(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const u=Array.from(a).map(async d=>d(t.origin,o)),h=await Og(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ei.receivers=[];function zo(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Mg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{const d=zo("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(v){const I=v;if(I.data.eventId===d)switch(I.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(I.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function ft(){return window}function Lg(n){ft().location.href=n}function Wl(){return typeof ft().WorkerGlobalScope<"u"&&typeof ft().importScripts=="function"}async function xg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Fg(){return navigator?.serviceWorker?.controller||null}function Ug(){return Wl()?self:null}const Gl="firebaseLocalStorageDb",Bg=1,Ms="firebaseLocalStorage",Kl="fbase_key";class Wr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ti(n,e){return n.transaction([Ms],e?"readwrite":"readonly").objectStore(Ms)}function jg(){const n=indexedDB.deleteDatabase(Gl);return new Wr(n).toPromise()}function _o(){const n=indexedDB.open(Gl,Bg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ms,{keyPath:Kl})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ms)?e(r):(r.close(),await jg(),e(await _o()))})})}async function $c(n,e,t){const r=ti(n,!0).put({[Kl]:e,value:t});return new Wr(r).toPromise()}async function qg(n,e){const t=ti(n,!1).get(e),r=await new Wr(t).toPromise();return r===void 0?null:r.value}function zc(n,e){const t=ti(n,!0).delete(e);return new Wr(t).toPromise()}const $g=800,zg=3;class Ql{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _o(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>zg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Wl()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ei._getInstance(Ug()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await xg(),!this.activeServiceWorker)return;this.sender=new Mg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Fg()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _o();return await $c(e,Os,"1"),await zc(e,Os),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>$c(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>qg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>zc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=ti(s,!1).getAll();return new Wr(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),$g)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ql.type="LOCAL";const Hg=Ql;new $r(3e4,6e4);function Wg(n,e){return e?wt(e):(B(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Ho extends qo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Un(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Un(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Un(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Gg(n){return Bl(n.auth,new Ho(n),n.bypassAuthState)}function Kg(n){const{auth:e,user:t}=n;return B(t,e,"internal-error"),wg(t,new Ho(n),n.bypassAuthState)}async function Qg(n){const{auth:e,user:t}=n;return B(t,e,"internal-error"),Ig(t,new Ho(n),n.bypassAuthState)}class Yl{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Gg;case"linkViaPopup":case"linkViaRedirect":return Qg;case"reauthViaPopup":case"reauthViaRedirect":return Kg;default:it(this.auth,"internal-error")}}resolve(e){bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){bt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yg=new $r(2e3,1e4);class Ln extends Yl{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,Ln.currentPopupAction&&Ln.currentPopupAction.cancel(),Ln.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return B(e,this.auth,"internal-error"),e}async onExecution(){bt(this.filter.length===1,"Popup operations only handle one event");const e=zo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(dt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(dt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ln.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Yg.get())};e()}}Ln.currentPopupAction=null;const Xg="pendingRedirect",Es=new Map;class Jg extends Yl{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Es.get(this.auth._key());if(!e){try{const r=await Zg(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Es.set(this.auth._key(),e)}return this.bypassAuthState||Es.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Zg(n,e){const t=n_(e),r=t_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function e_(n,e){Es.set(n._key(),e)}function t_(n){return wt(n._redirectPersistence)}function n_(n){return ys(Xg,n.config.apiKey,n.name)}async function r_(n,e,t=!1){if(Je(n.app))return Promise.reject(At(n));const r=wn(n),s=Wg(r,e),a=await new Jg(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const s_=600*1e3;class i_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!o_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Xl(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(dt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=s_&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hc(e))}saveEventToCache(e){this.cachedEventUids.add(Hc(e)),this.lastProcessedEventTime=Date.now()}}function Hc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Xl({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function o_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Xl(n);default:return!1}}async function a_(n,e={}){return on(n,"GET","/v1/projects",e)}const c_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,u_=/^https?/;async function l_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await a_(n);for(const t of e)try{if(h_(t))return}catch{}it(n,"unauthorized-domain")}function h_(n){const e=po(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!u_.test(t))return!1;if(c_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const d_=new $r(3e4,6e4);function Wc(){const n=ft().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function f_(n){return new Promise((e,t)=>{function r(){Wc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Wc(),t(dt(n,"network-request-failed"))},timeout:d_.get()})}if(ft().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ft().gapi?.load)r();else{const s=sg("iframefcb");return ft()[s]=()=>{gapi.load?r():t(dt(n,"network-request-failed"))},Ml(`${rg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw vs=null,e})}let vs=null;function p_(n){return vs=vs||f_(n),vs}const m_=new $r(5e3,15e3),g_="__/auth/iframe",__="emulator/auth/iframe",y_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},E_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function v_(n){const e=n.config;B(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Uo(e,__):`https://${n.config.authDomain}/${g_}`,r={apiKey:e.apiKey,appName:n.name,v:Yn},s=E_.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${qr(r).slice(1)}`}async function T_(n){const e=await p_(n),t=ft().gapi;return B(t,n,"internal-error"),e.open({where:document.body,url:v_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:y_,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=dt(n,"network-request-failed"),u=ft().setTimeout(()=>{o(a)},m_.get());function h(){ft().clearTimeout(u),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const I_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},w_=500,A_=600,R_="_blank",S_="http://localhost";class Gc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function P_(n,e,t,r=w_,s=A_){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...I_,width:r.toString(),height:s.toString(),top:o,left:a},d=Le().toLowerCase();t&&(u=bl(d)?R_:t),Sl(d)&&(e=e||S_,h.scrollbars="yes");const p=Object.entries(h).reduce((I,[R,V])=>`${I}${R}=${V},`,"");if(Km(d)&&u!=="_self")return b_(e||"",u),new Gc(null);const v=window.open(e||"",u,p);B(v,n,"popup-blocked");try{v.focus()}catch{}return new Gc(v)}function b_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const C_="__/auth/handler",k_="emulator/auth/handler",D_=encodeURIComponent("fac");async function Kc(n,e,t,r,s,o){B(n.config.authDomain,n,"auth-domain-config-required"),B(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Yn,eventId:s};if(e instanceof Fl){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",pp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,v]of Object.entries({}))a[p]=v}if(e instanceof Hr){const p=e.getScopes().filter(v=>v!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const u=a;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await n._getAppCheckToken(),d=h?`#${D_}=${encodeURIComponent(h)}`:"";return`${V_(n)}?${qr(u).slice(1)}${d}`}function V_({config:n}){return n.emulator?Uo(n,k_):`https://${n.authDomain}/${C_}`}const Ji="webStorageSupport";class N_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Hl,this._completeRedirectFn=r_,this._overrideRedirectResult=e_}async _openPopup(e,t,r,s){bt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Kc(e,t,r,po(),s);return P_(e,o,zo())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await Kc(e,t,r,po(),s);return Lg(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(bt(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await T_(e),r=new i_(e);return t.register("authEvent",s=>(B(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ji,{type:Ji},s=>{const o=s?.[0]?.[Ji];o!==void 0&&t(!!o),it(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=l_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Nl()||Pl()||jo()}}const O_=N_;var Qc="@firebase/auth",Yc="1.11.1";class M_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){B(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function L_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function x_(n){qn(new _n("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;B(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ol(n)},d=new eg(r,s,o,h);return lg(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),qn(new _n("auth-internal",e=>{const t=wn(e.getProvider("auth").getImmediate());return(r=>new M_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Qt(Qc,Yc,L_(n)),Qt(Qc,Yc,"esm2020")}const F_=300,U_=ul("authIdTokenMaxAge")||F_;let Xc=null;const B_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>U_)return;const s=t?.token;Xc!==s&&(Xc=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function j_(n=ml()){const e=xo(n,"auth");if(e.isInitialized())return e.getImmediate();const t=ug(n,{popupRedirectResolver:O_,persistence:[Hg,Ng,Hl]}),r=ul("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=B_(o.toString());bg(t,a,()=>a(t.currentUser)),Pg(t,u=>a(u))}}const s=al("auth");return s&&hg(t,`http://${s}`),t}function q_(){return document.getElementsByTagName("head")?.[0]??document}tg({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=dt("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",q_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});x_("Browser");var Jc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Yt,Jl;(function(){var n;function e(E,m){function y(){}y.prototype=m.prototype,E.F=m.prototype,E.prototype=new y,E.prototype.constructor=E,E.D=function(T,g,w){for(var _=Array(arguments.length-2),ae=2;ae<arguments.length;ae++)_[ae-2]=arguments[ae];return m.prototype[g].apply(T,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,m,y){y||(y=0);const T=Array(16);if(typeof m=="string")for(var g=0;g<16;++g)T[g]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(g=0;g<16;++g)T[g]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=E.g[0],y=E.g[1],g=E.g[2];let w=E.g[3],_;_=m+(w^y&(g^w))+T[0]+3614090360&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+T[1]+3905402710&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+T[2]+606105819&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+T[3]+3250441966&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(w^y&(g^w))+T[4]+4118548399&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+T[5]+1200080426&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+T[6]+2821735955&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+T[7]+4249261313&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(w^y&(g^w))+T[8]+1770035416&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+T[9]+2336552879&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+T[10]+4294925233&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+T[11]+2304563134&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(w^y&(g^w))+T[12]+1804603682&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+T[13]+4254626195&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+T[14]+2792965006&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+T[15]+1236535329&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(g^w&(y^g))+T[1]+4129170786&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+T[6]+3225465664&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+T[11]+643717713&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+T[0]+3921069994&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(g^w&(y^g))+T[5]+3593408605&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+T[10]+38016083&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+T[15]+3634488961&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+T[4]+3889429448&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(g^w&(y^g))+T[9]+568446438&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+T[14]+3275163606&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+T[3]+4107603335&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+T[8]+1163531501&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(g^w&(y^g))+T[13]+2850285829&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+T[2]+4243563512&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+T[7]+1735328473&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+T[12]+2368359562&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(y^g^w)+T[5]+4294588738&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+T[8]+2272392833&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+T[11]+1839030562&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+T[14]+4259657740&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(y^g^w)+T[1]+2763975236&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+T[4]+1272893353&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+T[7]+4139469664&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+T[10]+3200236656&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(y^g^w)+T[13]+681279174&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+T[0]+3936430074&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+T[3]+3572445317&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+T[6]+76029189&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(y^g^w)+T[9]+3654602809&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+T[12]+3873151461&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+T[15]+530742520&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+T[2]+3299628645&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(g^(y|~w))+T[0]+4096336452&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+T[7]+1126891415&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+T[14]+2878612391&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+T[5]+4237533241&4294967295,y=g+(_<<21&4294967295|_>>>11),_=m+(g^(y|~w))+T[12]+1700485571&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+T[3]+2399980690&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+T[10]+4293915773&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+T[1]+2240044497&4294967295,y=g+(_<<21&4294967295|_>>>11),_=m+(g^(y|~w))+T[8]+1873313359&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+T[15]+4264355552&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+T[6]+2734768916&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+T[13]+1309151649&4294967295,y=g+(_<<21&4294967295|_>>>11),_=m+(g^(y|~w))+T[4]+4149444226&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+T[11]+3174756917&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+T[2]+718787259&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(g+(_<<21&4294967295|_>>>11))&4294967295,E.g[2]=E.g[2]+g&4294967295,E.g[3]=E.g[3]+w&4294967295}r.prototype.v=function(E,m){m===void 0&&(m=E.length);const y=m-this.blockSize,T=this.C;let g=this.h,w=0;for(;w<m;){if(g==0)for(;w<=y;)s(this,E,w),w+=this.blockSize;if(typeof E=="string"){for(;w<m;)if(T[g++]=E.charCodeAt(w++),g==this.blockSize){s(this,T),g=0;break}}else for(;w<m;)if(T[g++]=E[w++],g==this.blockSize){s(this,T),g=0;break}}this.h=g,this.o+=m},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;m=this.o*8;for(var y=E.length-8;y<E.length;++y)E[y]=m&255,m/=256;for(this.v(E),E=Array(16),m=0,y=0;y<4;++y)for(let T=0;T<32;T+=8)E[m++]=this.g[y]>>>T&255;return E};function o(E,m){var y=u;return Object.prototype.hasOwnProperty.call(y,E)?y[E]:y[E]=m(E)}function a(E,m){this.h=m;const y=[];let T=!0;for(let g=E.length-1;g>=0;g--){const w=E[g]|0;T&&w==m||(y[g]=w,T=!1)}this.g=y}var u={};function h(E){return-128<=E&&E<128?o(E,function(m){return new a([m|0],m<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return v;if(E<0)return C(d(-E));const m=[];let y=1;for(let T=0;E>=y;T++)m[T]=E/y|0,y*=4294967296;return new a(m,0)}function p(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return C(p(E.substring(1),m));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(m,8));let T=v;for(let w=0;w<E.length;w+=8){var g=Math.min(8,E.length-w);const _=parseInt(E.substring(w,w+g),m);g<8?(g=d(Math.pow(m,g)),T=T.j(g).add(d(_))):(T=T.j(y),T=T.add(d(_)))}return T}var v=h(0),I=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(P(this))return-C(this).m();let E=0,m=1;for(let y=0;y<this.g.length;y++){const T=this.i(y);E+=(T>=0?T:4294967296+T)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(V(this))return"0";if(P(this))return"-"+C(this).toString(E);const m=d(Math.pow(E,6));var y=this;let T="";for(;;){const g=q(y,m).g;y=x(y,g.j(m));let w=((y.g.length>0?y.g[0]:y.h)>>>0).toString(E);if(y=g,V(y))return w+T;for(;w.length<6;)w="0"+w;T=w+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function V(E){if(E.h!=0)return!1;for(let m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function P(E){return E.h==-1}n.l=function(E){return E=x(this,E),P(E)?-1:V(E)?0:1};function C(E){const m=E.g.length,y=[];for(let T=0;T<m;T++)y[T]=~E.g[T];return new a(y,~E.h).add(I)}n.abs=function(){return P(this)?C(this):this},n.add=function(E){const m=Math.max(this.g.length,E.g.length),y=[];let T=0;for(let g=0;g<=m;g++){let w=T+(this.i(g)&65535)+(E.i(g)&65535),_=(w>>>16)+(this.i(g)>>>16)+(E.i(g)>>>16);T=_>>>16,w&=65535,_&=65535,y[g]=_<<16|w}return new a(y,y[y.length-1]&-2147483648?-1:0)};function x(E,m){return E.add(C(m))}n.j=function(E){if(V(this)||V(E))return v;if(P(this))return P(E)?C(this).j(C(E)):C(C(this).j(E));if(P(E))return C(this.j(C(E)));if(this.l(R)<0&&E.l(R)<0)return d(this.m()*E.m());const m=this.g.length+E.g.length,y=[];for(var T=0;T<2*m;T++)y[T]=0;for(T=0;T<this.g.length;T++)for(let g=0;g<E.g.length;g++){const w=this.i(T)>>>16,_=this.i(T)&65535,ae=E.i(g)>>>16,Te=E.i(g)&65535;y[2*T+2*g]+=_*Te,F(y,2*T+2*g),y[2*T+2*g+1]+=w*Te,F(y,2*T+2*g+1),y[2*T+2*g+1]+=_*ae,F(y,2*T+2*g+1),y[2*T+2*g+2]+=w*ae,F(y,2*T+2*g+2)}for(E=0;E<m;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=m;E<2*m;E++)y[E]=0;return new a(y,0)};function F(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function M(E,m){this.g=E,this.h=m}function q(E,m){if(V(m))throw Error("division by zero");if(V(E))return new M(v,v);if(P(E))return m=q(C(E),m),new M(C(m.g),C(m.h));if(P(m))return m=q(E,C(m)),new M(C(m.g),m.h);if(E.g.length>30){if(P(E)||P(m))throw Error("slowDivide_ only works with positive integers.");for(var y=I,T=m;T.l(E)<=0;)y=H(y),T=H(T);var g=Q(y,1),w=Q(T,1);for(T=Q(T,2),y=Q(y,2);!V(T);){var _=w.add(T);_.l(E)<=0&&(g=g.add(y),w=_),T=Q(T,1),y=Q(y,1)}return m=x(E,g.j(m)),new M(g,m)}for(g=v;E.l(m)>=0;){for(y=Math.max(1,Math.floor(E.m()/m.m())),T=Math.ceil(Math.log(y)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),w=d(y),_=w.j(m);P(_)||_.l(E)>0;)y-=T,w=d(y),_=w.j(m);V(w)&&(w=I),g=g.add(w),E=x(E,_)}return new M(g,E)}n.B=function(E){return q(this,E).h},n.and=function(E){const m=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<m;T++)y[T]=this.i(T)&E.i(T);return new a(y,this.h&E.h)},n.or=function(E){const m=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<m;T++)y[T]=this.i(T)|E.i(T);return new a(y,this.h|E.h)},n.xor=function(E){const m=Math.max(this.g.length,E.g.length),y=[];for(let T=0;T<m;T++)y[T]=this.i(T)^E.i(T);return new a(y,this.h^E.h)};function H(E){const m=E.g.length+1,y=[];for(let T=0;T<m;T++)y[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(y,E.h)}function Q(E,m){const y=m>>5;m%=32;const T=E.g.length-y,g=[];for(let w=0;w<T;w++)g[w]=m>0?E.i(w+y)>>>m|E.i(w+y+1)<<32-m:E.i(w+y);return new a(g,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Jl=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Yt=a}).apply(typeof Jc<"u"?Jc:typeof self<"u"?self:typeof window<"u"?window:{});var ds=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Zl,Ir,eh,Ts,yo,th,nh,rh;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof ds=="object"&&ds];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var A=i[f];if(!(A in l))break e;l=l[A]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&e(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function p(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function v(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,A,S){for(var N=Array(arguments.length-2),G=2;G<arguments.length;G++)N[G-2]=arguments[G];return c.prototype[A].apply(f,N)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function R(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function V(i,c){for(let f=1;f<arguments.length;f++){const A=arguments[f];var l=typeof A;if(l=l!="object"?l:A?Array.isArray(A)?"array":l:"null",l=="array"||l=="object"&&typeof A.length=="number"){l=i.length||0;const S=A.length||0;i.length=l+S;for(let N=0;N<S;N++)i[l+N]=A[N]}else i.push(A)}}class P{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function C(i){a.setTimeout(()=>{throw i},0)}function x(){var i=E;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class F{constructor(){this.h=this.g=null}add(c,l){const f=M.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var M=new P(()=>new q,i=>i.reset());class q{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let H,Q=!1,E=new F,m=()=>{const i=Promise.resolve(void 0);H=()=>{i.then(y)}};function y(){for(var i;i=x();){try{i.h.call(i.g)}catch(l){C(l)}var c=M;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}Q=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function g(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}g.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function _(i){return/^[\s\xa0]*$/.test(i)}function ae(i,c){g.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}v(ae,g),ae.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&ae.Z.h.call(this)},ae.prototype.h=function(){ae.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Te="closure_listenable_"+(Math.random()*1e6|0),tt=0;function W(i,c,l,f,A){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=A,this.key=++tt,this.da=this.fa=!1}function ee(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function ce(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function Ge(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function Ie(i){const c={};for(const l in i)c[l]=i[l];return c}const xe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(i,c){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)i[l]=f[l];for(let S=0;S<xe.length;S++)l=xe[S],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function fe(i){this.src=i,this.g={},this.h=0}fe.prototype.add=function(i,c,l,f,A){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const N=ot(i,c,f,A);return N>-1?(c=i[N],l||(c.fa=!1)):(c=new W(c,this.src,S,!!f,A),c.fa=l,i.push(c)),c};function He(i,c){const l=c.type;if(l in i.g){var f=i.g[l],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=A>=0)&&Array.prototype.splice.call(f,A,1),S&&(ee(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function ot(i,c,l,f){for(let A=0;A<i.length;++A){const S=i[A];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return A}return-1}var je="closure_lm_"+(Math.random()*1e6|0),qe={};function nt(i,c,l,f,A){if(Array.isArray(c)){for(let S=0;S<c.length;S++)nt(i,c[S],l,f,A);return null}return l=Ia(l),i&&i[Te]?i.J(c,l,u(f)?!!f.capture:!1,A):_i(i,c,l,!1,f,A)}function _i(i,c,l,f,A,S){if(!c)throw Error("Invalid event type");const N=u(A)?!!A.capture:!!A;let G=Ei(i);if(G||(i[je]=G=new fe(i)),l=G.add(c,l,f,N,S),l.proxy)return l;if(f=an(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)w||(A=N),A===void 0&&(A=!1),i.addEventListener(c.toString(),f,A);else if(i.attachEvent)i.attachEvent(Ta(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function an(){function i(l){return c.call(i.src,i.listener,l)}const c=Vd;return i}function Jr(i,c,l,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Jr(i,c[S],l,f,A);else f=u(f)?!!f.capture:!!f,l=Ia(l),i&&i[Te]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],l=ot(c,l,f,A),l>-1&&(ee(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Ei(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ot(c,l,f,A)),(l=i>-1?c[i]:null)&&yi(l))}function yi(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[Te])He(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(Ta(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=Ei(c))?(He(l,i),l.h==0&&(l.src=null,c[je]=null)):ee(i)}}}function Ta(i){return i in qe?qe[i]:qe[i]="on"+i}function Vd(i,c){if(i.da)i=!0;else{c=new ae(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&yi(i),i=l.call(f,c)}return i}function Ei(i){return i=i[je],i instanceof fe?i:null}var vi="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ia(i){return typeof i=="function"?i:(i[vi]||(i[vi]=function(c){return i.handleEvent(c)}),i[vi])}function Ve(){T.call(this),this.i=new fe(this),this.M=this,this.G=null}v(Ve,T),Ve.prototype[Te]=!0,Ve.prototype.removeEventListener=function(i,c,l,f){Jr(this,i,c,l,f)};function Fe(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new g(c,i);else if(c instanceof g)c.target=c.target||i;else{var A=c;c=new g(f,i),ue(c,A)}A=!0;let S,N;if(l)for(N=l.length-1;N>=0;N--)S=c.g=l[N],A=Zr(S,f,!0,c)&&A;if(S=c.g=i,A=Zr(S,f,!0,c)&&A,A=Zr(S,f,!1,c)&&A,l)for(N=0;N<l.length;N++)S=c.g=l[N],A=Zr(S,f,!1,c)&&A}Ve.prototype.N=function(){if(Ve.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)ee(l[f]);delete i.g[c],i.h--}}this.G=null},Ve.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},Ve.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function Zr(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let S=0;S<c.length;++S){const N=c[S];if(N&&!N.da&&N.capture==l){const G=N.listener,we=N.ha||N.src;N.fa&&He(i.i,N),A=G.call(we,f)!==!1&&A}}return A&&!f.defaultPrevented}function Nd(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function wa(i){i.g=Nd(()=>{i.g=null,i.i&&(i.i=!1,wa(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Od extends T{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:wa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nr(i){T.call(this),this.h=i,this.g={}}v(nr,T);var Aa=[];function Ra(i){ce(i.g,function(c,l){this.g.hasOwnProperty(l)&&yi(c)},i),i.g={}}nr.prototype.N=function(){nr.Z.N.call(this),Ra(this)},nr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ti=a.JSON.stringify,Md=a.JSON.parse,Ld=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Sa(){}function Pa(){}var rr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ii(){g.call(this,"d")}v(Ii,g);function wi(){g.call(this,"c")}v(wi,g);var cn={},ba=null;function es(){return ba=ba||new Ve}cn.Ia="serverreachability";function Ca(i){g.call(this,cn.Ia,i)}v(Ca,g);function sr(i){const c=es();Fe(c,new Ca(c))}cn.STAT_EVENT="statevent";function ka(i,c){g.call(this,cn.STAT_EVENT,i),this.stat=c}v(ka,g);function Ue(i){const c=es();Fe(c,new ka(c,i))}cn.Ja="timingevent";function Da(i,c){g.call(this,cn.Ja,i),this.size=c}v(Da,g);function ir(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function or(){this.g=!0}or.prototype.ua=function(){this.g=!1};function xd(i,c,l,f,A,S){i.info(function(){if(i.g)if(S){var N="",G=S.split("&");for(let ne=0;ne<G.length;ne++){var we=G[ne].split("=");if(we.length>1){const Pe=we[0];we=we[1];const ct=Pe.split("_");N=ct.length>=2&&ct[1]=="type"?N+(Pe+"="+we+"&"):N+(Pe+"=redacted&")}}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+l+`
`+N})}function Fd(i,c,l,f,A,S,N){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+l+`
`+S+" "+N})}function bn(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Bd(i,l)+(f?" "+f:"")})}function Ud(i,c){i.info(function(){return"TIMEOUT: "+c})}or.prototype.info=function(){};function Bd(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var l=S[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var A=f[0];if(A!="noop"&&A!="stop"&&A!="close")for(let N=1;N<f.length;N++)f[N]=""}}}}return Ti(S)}catch{return c}}var ts={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Va={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Na;function Ai(){}v(Ai,Sa),Ai.prototype.g=function(){return new XMLHttpRequest},Na=new Ai;function ar(i){return encodeURIComponent(String(i))}function jd(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Vt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new nr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Oa}function Oa(){this.i=null,this.g="",this.h=!1}var Ma={},Ri={};function Si(i,c,l){i.M=1,i.A=rs(at(c)),i.u=l,i.R=!0,La(i,null)}function La(i,c){i.F=Date.now(),ns(i),i.B=at(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),Qa(l.i,"t",f),i.C=0,l=i.j.L,i.h=new Oa,i.g=fc(i.j,l?c:null,!i.u),i.P>0&&(i.O=new Od(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var A="readystatechange";Array.isArray(A)||(A&&(Aa[0]=A.toString()),A=Aa);for(let S=0;S<A.length;S++){const N=nt(l,A[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=i.J?Ie(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),sr(),xd(i.i,i.v,i.B,i.l,i.S,i.u)}Vt.prototype.ba=function(i){i=i.target;const c=this.O;c&&Mt(i)==3?c.j():this.Y(i)},Vt.prototype.Y=function(i){try{if(i==this.g)e:{const G=Mt(this.g),we=this.g.ya(),ne=this.g.ca();if(!(G<3)&&(G!=3||this.g&&(this.h.h||this.g.la()||nc(this.g)))){this.K||G!=4||we==7||(we==8||ne<=0?sr(3):sr(2)),Pi(this);var c=this.g.ca();this.X=c;var l=qd(this);if(this.o=c==200,Fd(this.i,this.v,this.B,this.l,this.S,G,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,A=this.g;if((f=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var S=f;break t}}S=null}if(i=S)bn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,bi(this,i);else{this.o=!1,this.m=3,Ue(12),un(this),cr(this);break e}}if(this.R){i=!0;let Pe;for(;!this.K&&this.C<l.length;)if(Pe=$d(this,l),Pe==Ri){G==4&&(this.m=4,Ue(14),i=!1),bn(this.i,this.l,null,"[Incomplete Response]");break}else if(Pe==Ma){this.m=4,Ue(15),bn(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else bn(this.i,this.l,Pe,null),bi(this,Pe);if(xa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),G!=4||l.length!=0||this.h.h||(this.m=1,Ue(16),i=!1),this.o=this.o&&i,!i)bn(this.i,this.l,l,"[Invalid Chunked Response]"),un(this),cr(this);else if(l.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),Li(N),N.P=!0,Ue(11))}}else bn(this.i,this.l,l,null),bi(this,l);G==4&&un(this),this.o&&!this.K&&(G==4?uc(this.j,this):(this.o=!1,ns(this)))}else rf(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,Ue(12)):(this.m=0,Ue(13)),un(this),cr(this)}}}catch{}finally{}};function qd(i){if(!xa(i))return i.g.la();const c=nc(i.g);if(c==="")return"";let l="";const f=c.length,A=Mt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return un(i),cr(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,l+=i.h.i.decode(c[S],{stream:!(A&&S==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function xa(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function $d(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?Ri:(l=Number(c.substring(l,f)),isNaN(l)?Ma:(f+=1,f+l>c.length?Ri:(c=c.slice(f,f+l),i.C=f+l,c)))}Vt.prototype.cancel=function(){this.K=!0,un(this)};function ns(i){i.T=Date.now()+i.H,Fa(i,i.H)}function Fa(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=ir(d(i.aa,i),c)}function Pi(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Vt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Ud(this.i,this.B),this.M!=2&&(sr(),Ue(17)),un(this),this.m=2,cr(this)):Fa(this,this.T-i)};function cr(i){i.j.I==0||i.K||uc(i.j,i)}function un(i){Pi(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Ra(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function bi(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||Ci(l.h,i))){if(!i.L&&Ci(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)cs(l),os(l);else break e;Mi(l),Ue(18)}}else l.xa=A[1],0<l.xa-l.K&&A[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=ir(d(l.Va,l),6e3));ja(l.h)<=1&&l.ta&&(l.ta=void 0)}else hn(l,11)}else if((i.L||l.g==i)&&cs(l),!_(c))for(A=l.Ba.g.parse(c),c=0;c<A.length;c++){let ne=A[c];const Pe=ne[0];if(!(Pe<=l.K))if(l.K=Pe,ne=ne[1],l.I==2)if(ne[0]=="c"){l.M=ne[1],l.ba=ne[2];const ct=ne[3];ct!=null&&(l.ka=ct,l.j.info("VER="+l.ka));const dn=ne[4];dn!=null&&(l.za=dn,l.j.info("SVER="+l.za));const Lt=ne[5];Lt!=null&&typeof Lt=="number"&&Lt>0&&(f=1.5*Lt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const xt=i.g;if(xt){const ls=xt.g?xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ls){var S=f.h;S.g||ls.indexOf("spdy")==-1&&ls.indexOf("quic")==-1&&ls.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(ki(S,S.h),S.h=null))}if(f.G){const xi=xt.g?xt.g.getResponseHeader("X-HTTP-Session-Id"):null;xi&&(f.wa=xi,se(f.J,f.G,xi))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var N=i;if(f.na=dc(f,f.L?f.ba:null,f.W),N.L){qa(f.h,N);var G=N,we=f.O;we&&(G.H=we),G.D&&(Pi(G),ns(G)),f.g=N}else ac(f);l.i.length>0&&as(l)}else ne[0]!="stop"&&ne[0]!="close"||hn(l,7);else l.I==3&&(ne[0]=="stop"||ne[0]=="close"?ne[0]=="stop"?hn(l,7):Oi(l):ne[0]!="noop"&&l.l&&l.l.qa(ne),l.A=0)}}sr(4)}catch{}}var zd=class{constructor(i,c){this.g=i,this.map=c}};function Ua(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ba(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function ja(i){return i.h?1:i.g?i.g.size:0}function Ci(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function ki(i,c){i.g?i.g.add(c):i.h=c}function qa(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Ua.prototype.cancel=function(){if(this.i=$a(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function $a(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return R(i.i)}var za=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Hd(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let A,S=null;f>=0?(A=i[l].substring(0,f),S=i[l].substring(f+1)):A=i[l],c(A,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Nt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Nt?(this.l=i.l,ur(this,i.j),this.o=i.o,this.g=i.g,lr(this,i.u),this.h=i.h,Di(this,Ya(i.i)),this.m=i.m):i&&(c=String(i).match(za))?(this.l=!1,ur(this,c[1]||"",!0),this.o=hr(c[2]||""),this.g=hr(c[3]||"",!0),lr(this,c[4]),this.h=hr(c[5]||"",!0),Di(this,c[6]||"",!0),this.m=hr(c[7]||"")):(this.l=!1,this.i=new fr(null,this.l))}Nt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(dr(c,Ha,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(dr(c,Ha,!0),"@"),i.push(ar(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(dr(l,l.charAt(0)=="/"?Kd:Gd,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",dr(l,Yd)),i.join("")},Nt.prototype.resolve=function(i){const c=at(this);let l=!!i.j;l?ur(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)lr(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var A=c.h.lastIndexOf("/");A!=-1&&(f=c.h.slice(0,A+1)+f)}if(A=f,A==".."||A==".")f="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){f=A.lastIndexOf("/",0)==0,A=A.split("/");const S=[];for(let N=0;N<A.length;){const G=A[N++];G=="."?f&&N==A.length&&S.push(""):G==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&N==A.length&&S.push("")):(S.push(G),f=!0)}f=S.join("/")}else f=A}return l?c.h=f:l=i.i.toString()!=="",l?Di(c,Ya(i.i)):l=!!i.m,l&&(c.m=i.m),c};function at(i){return new Nt(i)}function ur(i,c,l){i.j=l?hr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function lr(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Di(i,c,l){c instanceof fr?(i.i=c,Xd(i.i,i.l)):(l||(c=dr(c,Qd)),i.i=new fr(c,i.l))}function se(i,c,l){i.i.set(c,l)}function rs(i){return se(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function hr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function dr(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,Wd),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Wd(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Ha=/[#\/\?@]/g,Gd=/[#\?:]/g,Kd=/[#\?]/g,Qd=/[#\?@]/g,Yd=/#/g;function fr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function ln(i){i.g||(i.g=new Map,i.h=0,i.i&&Hd(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=fr.prototype,n.add=function(i,c){ln(this),this.i=null,i=Cn(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function Wa(i,c){ln(i),c=Cn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Ga(i,c){return ln(i),c=Cn(i,c),i.g.has(c)}n.forEach=function(i,c){ln(this),this.g.forEach(function(l,f){l.forEach(function(A){i.call(c,A,f,this)},this)},this)};function Ka(i,c){ln(i);let l=[];if(typeof c=="string")Ga(i,c)&&(l=l.concat(i.g.get(Cn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return ln(this),this.i=null,i=Cn(this,i),Ga(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Ka(this,i),i.length>0?String(i[0]):c):c};function Qa(i,c,l){Wa(i,c),l.length>0&&(i.i=null,i.g.set(Cn(i,c),R(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const A=ar(l);l=Ka(this,l);for(let S=0;S<l.length;S++){let N=A;l[S]!==""&&(N+="="+ar(l[S])),i.push(N)}}return this.i=i.join("&")};function Ya(i){const c=new fr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Cn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function Xd(i,c){c&&!i.j&&(ln(i),i.i=null,i.g.forEach(function(l,f){const A=f.toLowerCase();f!=A&&(Wa(this,f),Qa(this,A,l))},i)),i.j=c}function Jd(i,c){const l=new or;if(a.Image){const f=new Image;f.onload=p(Ot,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(Ot,l,"TestLoadImage: error",!1,c,f),f.onabort=p(Ot,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(Ot,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function Zd(i,c){const l=new or,f=new AbortController,A=setTimeout(()=>{f.abort(),Ot(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?Ot(l,"TestPingServer: ok",!0,c):Ot(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),Ot(l,"TestPingServer: error",!1,c)})}function Ot(i,c,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function ef(){this.g=new Ld}function Vi(i){this.i=i.Sb||null,this.h=i.ab||!1}v(Vi,Sa),Vi.prototype.g=function(){return new ss(this.i,this.h)};function ss(i,c){Ve.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(ss,Ve),n=ss.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,mr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,pr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,mr(this)),this.g&&(this.readyState=3,mr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Xa(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Xa(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?pr(this):mr(this),this.readyState==3&&Xa(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,pr(this))},n.Na=function(i){this.g&&(this.response=i,pr(this))},n.ga=function(){this.g&&pr(this)};function pr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,mr(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function mr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(ss.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Ja(i){let c="";return ce(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function Ni(i,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=Ja(l),typeof i=="string"?l!=null&&ar(l):se(i,c,l))}function pe(i){Ve.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(pe,Ve);var tf=/^https?$/i,nf=["POST","PUT"];n=pe.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Na.g(),this.g.onreadystatechange=I(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){Za(this,S);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(nf,c,void 0)>=0)||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,N]of l)this.g.setRequestHeader(S,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){Za(this,S)}};function Za(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,ec(i),is(i)}function ec(i){i.A||(i.A=!0,Fe(i,"complete"),Fe(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Fe(this,"complete"),Fe(this,"abort"),is(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),is(this,!0)),pe.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?tc(this):this.Xa())},n.Xa=function(){tc(this)};function tc(i){if(i.h&&typeof o<"u"){if(i.v&&Mt(i)==4)setTimeout(i.Ca.bind(i),0);else if(Fe(i,"readystatechange"),Mt(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let N=String(i.D).match(za)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),f=!tf.test(N?N.toLowerCase():"")}l=f}if(l)Fe(i,"complete"),Fe(i,"success");else{i.o=6;try{var A=Mt(i)>2?i.g.statusText:""}catch{A=""}i.l=A+" ["+i.ca()+"]",ec(i)}}finally{is(i)}}}}function is(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||Fe(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Mt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Mt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Md(c)}};function nc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function rf(i){const c={};i=(i.g&&Mt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(_(i[f]))continue;var l=jd(i[f]);const A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const S=c[A]||[];c[A]=S,S.push(l)}Ge(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function gr(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function rc(i){this.za=0,this.i=[],this.j=new or,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=gr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=gr("baseRetryDelayMs",5e3,i),this.Za=gr("retryDelaySeedMs",1e4,i),this.Ta=gr("forwardChannelMaxRetries",2,i),this.va=gr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Ua(i&&i.concurrentRequestLimit),this.Ba=new ef,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=rc.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){Ue(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=dc(this,null,this.W),as(this)};function Oi(i){if(sc(i),i.I==3){var c=i.V++,l=at(i.J);if(se(l,"SID",i.M),se(l,"RID",c),se(l,"TYPE","terminate"),_r(i,l),c=new Vt(i,i.j,c),c.M=2,c.A=rs(at(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=fc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),ns(c)}hc(i)}function os(i){i.g&&(Li(i),i.g.cancel(),i.g=null)}function sc(i){os(i),i.v&&(a.clearTimeout(i.v),i.v=null),cs(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function as(i){if(!Ba(i.h)&&!i.m){i.m=!0;var c=i.Ea;H||m(),Q||(H(),Q=!0),E.add(c,i),i.D=0}}function sf(i,c){return ja(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=ir(d(i.Ea,i,c),lc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const A=new Vt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=Ie(S),ue(S,this.U)):S=this.U),this.u!==null||this.R||(A.J=S,S=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=oc(this,A,c),l=at(this.J),se(l,"RID",i),se(l,"CVER",22),this.G&&se(l,"X-HTTP-Session-Id",this.G),_r(this,l),S&&(this.R?c="headers="+ar(Ja(S))+"&"+c:this.u&&Ni(l,this.u,S)),ki(this.h,A),this.Ra&&se(l,"TYPE","init"),this.S?(se(l,"$req",c),se(l,"SID","null"),A.U=!0,Si(A,l,null)):Si(A,l,c),this.I=2}}else this.I==3&&(i?ic(this,i):this.i.length==0||Ba(this.h)||ic(this))};function ic(i,c){var l;c?l=c.l:l=i.V++;const f=at(i.J);se(f,"SID",i.M),se(f,"RID",l),se(f,"AID",i.K),_r(i,f),i.u&&i.o&&Ni(f,i.u,i.o),l=new Vt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=oc(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),ki(i.h,l),Si(l,f,c)}function _r(i,c){i.H&&ce(i.H,function(l,f){se(c,f,l)}),i.l&&ce({},function(l,f){se(c,f,l)})}function oc(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var A=i.i;let G=-1;for(;;){const we=["count="+l];G==-1?l>0?(G=A[0].g,we.push("ofs="+G)):G=0:we.push("ofs="+G);let ne=!0;for(let Pe=0;Pe<l;Pe++){var S=A[Pe].g;const ct=A[Pe].map;if(S-=G,S<0)G=Math.max(0,A[Pe].g-100),ne=!1;else try{S="req"+S+"_"||"";try{var N=ct instanceof Map?ct:Object.entries(ct);for(const[dn,Lt]of N){let xt=Lt;u(Lt)&&(xt=Ti(Lt)),we.push(S+dn+"="+encodeURIComponent(xt))}}catch(dn){throw we.push(S+"type="+encodeURIComponent("_badmap")),dn}}catch{f&&f(ct)}}if(ne){N=we.join("&");break e}}N=void 0}return i=i.i.splice(0,l),c.G=i,N}function ac(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;H||m(),Q||(H(),Q=!0),E.add(c,i),i.A=0}}function Mi(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=ir(d(i.Da,i),lc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,cc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=ir(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ue(10),os(this),cc(this))};function Li(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function cc(i){i.g=new Vt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=at(i.na);se(c,"RID","rpc"),se(c,"SID",i.M),se(c,"AID",i.K),se(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&se(c,"TO",i.ia),se(c,"TYPE","xmlhttp"),_r(i,c),i.u&&i.o&&Ni(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=rs(at(c)),l.u=null,l.R=!0,La(l,i)}n.Va=function(){this.C!=null&&(this.C=null,os(this),Mi(this),Ue(19))};function cs(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function uc(i,c){var l=null;if(i.g==c){cs(i),Li(i),i.g=null;var f=2}else if(Ci(i.h,c))l=c.G,qa(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var A=i.D;f=es(),Fe(f,new Da(f,l)),as(i)}else ac(i);else if(A=c.m,A==3||A==0&&c.X>0||!(f==1&&sf(i,c)||f==2&&Mi(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),A){case 1:hn(i,5);break;case 4:hn(i,10);break;case 3:hn(i,6);break;default:hn(i,2)}}}function lc(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function hn(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const A=!f;f=new Nt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ur(f,"https"),rs(f),A?Jd(f.toString(),l):Zd(f.toString(),l)}else Ue(2);i.I=0,i.l&&i.l.pa(c),hc(i),sc(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Ue(2)):(this.j.info("Failed to ping google.com"),Ue(1))};function hc(i){if(i.I=0,i.ja=[],i.l){const c=$a(i.h);(c.length!=0||i.i.length!=0)&&(V(i.ja,c),V(i.ja,i.i),i.h.i.length=0,R(i.i),i.i.length=0),i.l.oa()}}function dc(i,c,l){var f=l instanceof Nt?at(l):new Nt(l);if(f.g!="")c&&(f.g=c+"."+f.g),lr(f,f.u);else{var A=a.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const S=new Nt(null);f&&ur(S,f),c&&(S.g=c),A&&lr(S,A),l&&(S.h=l),f=S}return l=i.G,c=i.wa,l&&c&&se(f,l,c),se(f,"VER",i.ka),_r(i,f),f}function fc(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new pe(new Vi({ab:l})):new pe(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function pc(){}n=pc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function us(){}us.prototype.g=function(i,c){return new We(i,c)};function We(i,c){Ve.call(this),this.g=new rc(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!_(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new kn(this)}v(We,Ve),We.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},We.prototype.close=function(){Oi(this.g)},We.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=Ti(i),i=l);c.i.push(new zd(c.Ya++,i)),c.I==3&&as(c)},We.prototype.N=function(){this.g.l=null,delete this.j,Oi(this.g),delete this.g,We.Z.N.call(this)};function mc(i){Ii.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const l in c){i=l;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}v(mc,Ii);function gc(){wi.call(this),this.status=1}v(gc,wi);function kn(i){this.g=i}v(kn,pc),kn.prototype.ra=function(){Fe(this.g,"a")},kn.prototype.qa=function(i){Fe(this.g,new mc(i))},kn.prototype.pa=function(i){Fe(this.g,new gc)},kn.prototype.oa=function(){Fe(this.g,"b")},us.prototype.createWebChannel=us.prototype.g,We.prototype.send=We.prototype.o,We.prototype.open=We.prototype.m,We.prototype.close=We.prototype.close,rh=function(){return new us},nh=function(){return es()},th=cn,yo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ts.NO_ERROR=0,ts.TIMEOUT=8,ts.HTTP_ERROR=6,Ts=ts,Va.COMPLETE="complete",eh=Va,Pa.EventType=rr,rr.OPEN="a",rr.CLOSE="b",rr.ERROR="c",rr.MESSAGE="d",Ve.prototype.listen=Ve.prototype.J,Ir=Pa,pe.prototype.listenOnce=pe.prototype.K,pe.prototype.getLastError=pe.prototype.Ha,pe.prototype.getLastErrorCode=pe.prototype.ya,pe.prototype.getStatus=pe.prototype.ca,pe.prototype.getResponseJson=pe.prototype.La,pe.prototype.getResponseText=pe.prototype.la,pe.prototype.send=pe.prototype.ea,pe.prototype.setWithCredentials=pe.prototype.Fa,Zl=pe}).apply(typeof ds<"u"?ds:typeof self<"u"?self:typeof window<"u"?window:{});const Zc="@firebase/firestore",eu="4.9.2";class Oe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Oe.UNAUTHENTICATED=new Oe(null),Oe.GOOGLE_CREDENTIALS=new Oe("google-credentials-uid"),Oe.FIRST_PARTY=new Oe("first-party-uid"),Oe.MOCK_USER=new Oe("mock-user");let Jn="12.3.0";const vn=new Mo("@firebase/firestore");function Vn(){return vn.logLevel}function O(n,...e){if(vn.logLevel<=Y.DEBUG){const t=e.map(Wo);vn.debug(`Firestore (${Jn}): ${n}`,...t)}}function Ct(n,...e){if(vn.logLevel<=Y.ERROR){const t=e.map(Wo);vn.error(`Firestore (${Jn}): ${n}`,...t)}}function $n(n,...e){if(vn.logLevel<=Y.WARN){const t=e.map(Wo);vn.warn(`Firestore (${Jn}): ${n}`,...t)}}function Wo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function j(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,sh(n,r,t)}function sh(n,e,t){let r=`FIRESTORE (${Jn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ct(r),new Error(r)}function te(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||sh(e,s,r)}function z(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends Dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Rt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ih{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Oe.UNAUTHENTICATED)))}shutdown(){}}class z_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class H_{constructor(e){this.t=e,this.currentUser=Oe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){te(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new Rt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Rt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Rt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string",31837,{l:r}),new ih(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string",2055,{h:e}),new Oe(e)}}class W_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Oe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class G_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new W_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Oe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class tu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Je(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){te(this.o===void 0,3512);const r=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new tu(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(te(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new tu(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Q_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Go{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Q_(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function X(n,e){return n<e?-1:n>e?1:0}function Eo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Zi(s)===Zi(o)?X(s,o):Zi(s)?1:-1}return X(n.length,e.length)}const Y_=55296,X_=57343;function Zi(n){const e=n.charCodeAt(0);return e>=Y_&&e<=X_}function zn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const nu="__name__";class lt{constructor(e,t,r){t===void 0?t=0:t>e.length&&j(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&j(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return lt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof lt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=lt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return X(e.length,t.length)}static compareSegments(e,t){const r=lt.isNumericId(e),s=lt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?lt.extractNumericId(e).compare(lt.extractNumericId(t)):Eo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Yt.fromString(e.substring(4,e.length-2))}}class ie extends lt{construct(e,t,r){return new ie(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new L(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new ie(t)}static emptyPath(){return new ie([])}}const J_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ke extends lt{construct(e,t,r){return new ke(e,t,r)}static isValidIdentifier(e){return J_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ke.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===nu}static keyField(){return new ke([nu])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new L(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new L(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new L(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new L(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ke(t)}static emptyPath(){return new ke([])}}class U{constructor(e){this.path=e}static fromPath(e){return new U(ie.fromString(e))}static fromName(e){return new U(ie.fromString(e).popFirst(5))}static empty(){return new U(ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ie.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new U(new ie(e.slice()))}}function oh(n,e,t){if(!t)throw new L(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Z_(n,e,t,r){if(e===!0&&r===!0)throw new L(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ru(n){if(!U.isDocumentKey(n))throw new L(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function su(n){if(U.isDocumentKey(n))throw new L(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ah(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ko(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":j(12329,{type:typeof n})}function Tn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ko(n);throw new L(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ve(n,e){const t={typeString:n};return e&&(t.value=e),t}function Gr(n,e){if(!ah(n))throw new L(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new L(D.INVALID_ARGUMENT,t);return!0}const iu=-62135596800,ou=1e6;class oe{static now(){return oe.fromMillis(Date.now())}static fromDate(e){return oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ou);return new oe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<iu)throw new L(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ou}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:oe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Gr(e,oe._jsonSchema))return new oe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-iu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}oe._jsonSchemaVersion="firestore/timestamp/1.0",oe._jsonSchema={type:ve("string",oe._jsonSchemaVersion),seconds:ve("number"),nanoseconds:ve("number")};class ${static fromTimestamp(e){return new $(e)}static min(){return new $(new oe(0,0))}static max(){return new $(new oe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Mr=-1;function ey(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$.fromTimestamp(r===1e9?new oe(t+1,0):new oe(t,r));return new Jt(s,U.empty(),e)}function ty(n){return new Jt(n.readTime,n.key,Mr)}class Jt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Jt($.min(),U.empty(),Mr)}static max(){return new Jt($.max(),U.empty(),Mr)}}function ny(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=U.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}const ry="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Zn(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==ry)throw n;O("LocalStore","Unexpectedly lost primary lease")}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):b.reject(t)}static resolve(e){return new b(((t,r)=>{t(e)}))}static reject(e){return new b(((t,r)=>{r(e)}))}static waitFor(e){return new b(((t,r)=>{let s=0,o=0,a=!1;e.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=b.resolve(!1);for(const r of e)t=t.next((s=>s?b.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new b(((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++u,u===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new b(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function iy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function er(n){return n.name==="IndexedDbTransactionError"}class ni{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ni.ce=-1;const Qo=-1;function ri(n){return n==null}function Ls(n){return n===0&&1/n==-1/0}function oy(n){return typeof n=="number"&&Number.isInteger(n)&&!Ls(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const ch="";function ay(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=au(e)),e=cy(n.get(t),e);return au(e)}function cy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case ch:t+="";break;default:t+=o}}return t}function au(n){return n+ch+""}function cu(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function An(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function uh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class de{constructor(e,t){this.comparator=e,this.root=t||Ce.EMPTY}insert(e,t){return new de(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ce.BLACK,null,null))}remove(e){return new de(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ce.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fs(this.root,e,this.comparator,!1)}getReverseIterator(){return new fs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fs(this.root,e,this.comparator,!0)}}class fs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ce{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Ce.RED,this.left=s??Ce.EMPTY,this.right=o??Ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Ce(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ce.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ce.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw j(43730,{key:this.key,value:this.value});if(this.right.isRed())throw j(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw j(27949);return e+(this.isRed()?0:1)}}Ce.EMPTY=null,Ce.RED=!0,Ce.BLACK=!1;Ce.EMPTY=new class{constructor(){this.size=0}get key(){throw j(57766)}get value(){throw j(16141)}get color(){throw j(16727)}get left(){throw j(29726)}get right(){throw j(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Ce(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Se{constructor(e){this.comparator=e,this.data=new de(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uu(this.data.getIterator())}getIteratorFrom(e){return new uu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Se)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Se(this.comparator);return t.data=e,t}}class uu{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class st{constructor(e){this.fields=e,e.sort(ke.comparator)}static empty(){return new st([])}unionWith(e){let t=new Se(ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new st(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class lh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class De{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new lh("Invalid base64 string: "+o):o}})(e);return new De(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new De(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}De.EMPTY_BYTE_STRING=new De("");const uy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zt(n){if(te(!!n,39018),typeof n=="string"){let e=0;const t=uy.exec(n);if(te(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_e(n.seconds),nanos:_e(n.nanos)}}function _e(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function en(n){return typeof n=="string"?De.fromBase64String(n):De.fromUint8Array(n)}const hh="server_timestamp",dh="__type__",fh="__previous_value__",ph="__local_write_time__";function Yo(n){return(n?.mapValue?.fields||{})[dh]?.stringValue===hh}function si(n){const e=n.mapValue.fields[fh];return Yo(e)?si(e):e}function Lr(n){const e=Zt(n.mapValue.fields[ph].timestampValue);return new oe(e.seconds,e.nanos)}class ly{constructor(e,t,r,s,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const xs="(default)";class xr{constructor(e,t){this.projectId=e,this.database=t||xs}static empty(){return new xr("","")}get isDefaultDatabase(){return this.database===xs}isEqual(e){return e instanceof xr&&e.projectId===this.projectId&&e.database===this.database}}const mh="__type__",hy="__max__",ps={mapValue:{}},gh="__vector__",Fs="value";function tn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yo(n)?4:fy(n)?9007199254740991:dy(n)?10:11:j(28295,{value:n})}function yt(n,e){if(n===e)return!0;const t=tn(n);if(t!==tn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lr(n).isEqual(Lr(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=Zt(s.timestampValue),u=Zt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return en(s.bytesValue).isEqual(en(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return _e(s.geoPointValue.latitude)===_e(o.geoPointValue.latitude)&&_e(s.geoPointValue.longitude)===_e(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return _e(s.integerValue)===_e(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=_e(s.doubleValue),u=_e(o.doubleValue);return a===u?Ls(a)===Ls(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return zn(n.arrayValue.values||[],e.arrayValue.values||[],yt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(cu(a)!==cu(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!yt(a[h],u[h])))return!1;return!0})(n,e);default:return j(52216,{left:n})}}function Fr(n,e){return(n.values||[]).find((t=>yt(t,e)))!==void 0}function Hn(n,e){if(n===e)return 0;const t=tn(n),r=tn(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=_e(o.integerValue||o.doubleValue),h=_e(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return lu(n.timestampValue,e.timestampValue);case 4:return lu(Lr(n),Lr(e));case 5:return Eo(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=en(o),h=en(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const p=X(u[d],h[d]);if(p!==0)return p}return X(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=X(_e(o.latitude),_e(a.latitude));return u!==0?u:X(_e(o.longitude),_e(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return hu(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[Fs]?.arrayValue,p=h[Fs]?.arrayValue,v=X(d?.values?.length||0,p?.values?.length||0);return v!==0?v:hu(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ps.mapValue&&a===ps.mapValue)return 0;if(o===ps.mapValue)return 1;if(a===ps.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){const I=Eo(h[v],p[v]);if(I!==0)return I;const R=Hn(u[h[v]],d[p[v]]);if(R!==0)return R}return X(h.length,p.length)})(n.mapValue,e.mapValue);default:throw j(23264,{he:t})}}function lu(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=Zt(n),r=Zt(e),s=X(t.seconds,r.seconds);return s!==0?s:X(t.nanos,r.nanos)}function hu(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=Hn(t[s],r[s]);if(o)return o}return X(t.length,r.length)}function Wn(n){return vo(n)}function vo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Zt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return en(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return U.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=vo(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${vo(t.fields[a])}`;return s+"}"})(n.mapValue):j(61005,{value:n})}function Is(n){switch(tn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=si(n);return e?16+Is(e):16;case 5:return 2*n.stringValue.length;case 6:return en(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Is(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return An(r.fields,((o,a)=>{s+=o.length+Is(a)})),s})(n.mapValue);default:throw j(13486,{value:n})}}function To(n){return!!n&&"integerValue"in n}function Xo(n){return!!n&&"arrayValue"in n}function du(n){return!!n&&"nullValue"in n}function fu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ws(n){return!!n&&"mapValue"in n}function dy(n){return(n?.mapValue?.fields||{})[mh]?.stringValue===gh}function br(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return An(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=br(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=br(n.arrayValue.values[t]);return e}return{...n}}function fy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===hy}class Ze{constructor(e){this.value=e}static empty(){return new Ze({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=br(t)}setAll(e){let t=ke.emptyPath(),r={},s=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=br(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return yt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ws(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){An(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new Ze(br(this.value))}}function _h(n){const e=[];return An(n.fields,((t,r)=>{const s=new ke([t]);if(ws(r)){const o=_h(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new st(e)}class Me{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new Me(e,0,$.min(),$.min(),$.min(),Ze.empty(),0)}static newFoundDocument(e,t,r,s){return new Me(e,1,t,$.min(),r,s,0)}static newNoDocument(e,t){return new Me(e,2,t,$.min(),$.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new Me(e,3,t,$.min(),$.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Me&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Me(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Us{constructor(e,t){this.position=e,this.inclusive=t}}function pu(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=U.comparator(U.fromName(a.referenceValue),t.key):r=Hn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function mu(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!yt(n.position[t],e.position[t]))return!1;return!0}class Bs{constructor(e,t="asc"){this.field=e,this.dir=t}}function py(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class yh{}class Ae extends yh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new gy(e,t,r):t==="array-contains"?new Ey(e,r):t==="in"?new vy(e,r):t==="not-in"?new Ty(e,r):t==="array-contains-any"?new Iy(e,r):new Ae(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new _y(e,r):new yy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Hn(t,this.value)):t!==null&&tn(this.value)===tn(t)&&this.matchesComparison(Hn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Et extends yh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Et(e,t)}matches(e){return Eh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Eh(n){return n.op==="and"}function vh(n){return my(n)&&Eh(n)}function my(n){for(const e of n.filters)if(e instanceof Et)return!1;return!0}function Io(n){if(n instanceof Ae)return n.field.canonicalString()+n.op.toString()+Wn(n.value);if(vh(n))return n.filters.map((e=>Io(e))).join(",");{const e=n.filters.map((t=>Io(t))).join(",");return`${n.op}(${e})`}}function Th(n,e){return n instanceof Ae?(function(r,s){return s instanceof Ae&&r.op===s.op&&r.field.isEqual(s.field)&&yt(r.value,s.value)})(n,e):n instanceof Et?(function(r,s){return s instanceof Et&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&Th(a,s.filters[u])),!0):!1})(n,e):void j(19439)}function Ih(n){return n instanceof Ae?(function(t){return`${t.field.canonicalString()} ${t.op} ${Wn(t.value)}`})(n):n instanceof Et?(function(t){return t.op.toString()+" {"+t.getFilters().map(Ih).join(" ,")+"}"})(n):"Filter"}class gy extends Ae{constructor(e,t,r){super(e,t,r),this.key=U.fromName(r.referenceValue)}matches(e){const t=U.comparator(e.key,this.key);return this.matchesComparison(t)}}class _y extends Ae{constructor(e,t){super(e,"in",t),this.keys=wh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class yy extends Ae{constructor(e,t){super(e,"not-in",t),this.keys=wh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function wh(n,e){return(e.arrayValue?.values||[]).map((t=>U.fromName(t.referenceValue)))}class Ey extends Ae{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Xo(t)&&Fr(t.arrayValue,this.value)}}class vy extends Ae{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fr(this.value.arrayValue,t)}}class Ty extends Ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Fr(this.value.arrayValue,t)}}class Iy extends Ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Xo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Fr(this.value.arrayValue,r)))}}class wy{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function gu(n,e=null,t=[],r=[],s=null,o=null,a=null){return new wy(n,e,t,r,s,o,a)}function Jo(n){const e=z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Io(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),ri(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Wn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Wn(r))).join(",")),e.Te=t}return e.Te}function Zo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!py(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Th(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!mu(n.startAt,e.startAt)&&mu(n.endAt,e.endAt)}function wo(n){return U.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ii{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ay(n,e,t,r,s,o,a,u){return new ii(n,e,t,r,s,o,a,u)}function ea(n){return new ii(n)}function _u(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ry(n){return n.collectionGroup!==null}function Cr(n){const e=z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Se(ke.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Bs(o,r))})),t.has(ke.keyField().canonicalString())||e.Ie.push(new Bs(ke.keyField(),r))}return e.Ie}function pt(n){const e=z(n);return e.Ee||(e.Ee=Sy(e,Cr(n))),e.Ee}function Sy(n,e){if(n.limitType==="F")return gu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Bs(s.field,o)}));const t=n.endAt?new Us(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Us(n.startAt.position,n.startAt.inclusive):null;return gu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ao(n,e,t){return new ii(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function oi(n,e){return Zo(pt(n),pt(e))&&n.limitType===e.limitType}function Ah(n){return`${Jo(pt(n))}|lt:${n.limitType}`}function Nn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Ih(s))).join(", ")}]`),ri(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Wn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Wn(s))).join(",")),`Target(${r})`})(pt(n))}; limitType=${n.limitType})`}function ai(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):U.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Cr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=pu(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Cr(r),s)||r.endAt&&!(function(a,u,h){const d=pu(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Cr(r),s))})(n,e)}function Py(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Rh(n){return(e,t)=>{let r=!1;for(const s of Cr(n)){const o=by(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function by(n,e,t){const r=n.field.isKeyField()?U.comparator(e.key,t.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Hn(h,d):j(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return j(19790,{direction:n.dir})}}class Rn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){An(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return uh(this.inner)}size(){return this.innerSize}}const Cy=new de(U.comparator);function kt(){return Cy}const Sh=new de(U.comparator);function wr(...n){let e=Sh;for(const t of n)e=e.insert(t.key,t);return e}function Ph(n){let e=Sh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function pn(){return kr()}function bh(){return kr()}function kr(){return new Rn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const ky=new de(U.comparator),Dy=new Se(U.comparator);function J(...n){let e=Dy;for(const t of n)e=e.add(t);return e}const Vy=new Se(X);function Ny(){return Vy}function ta(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ls(e)?"-0":e}}function Ch(n){return{integerValue:""+n}}function Oy(n,e){return oy(e)?Ch(e):ta(n,e)}class ci{constructor(){this._=void 0}}function My(n,e,t){return n instanceof js?(function(s,o){const a={fields:{[dh]:{stringValue:hh},[ph]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Yo(o)&&(o=si(o)),o&&(a.fields[fh]=o),{mapValue:a}})(t,e):n instanceof Ur?Dh(n,e):n instanceof Br?Vh(n,e):(function(s,o){const a=kh(s,o),u=yu(a)+yu(s.Ae);return To(a)&&To(s.Ae)?Ch(u):ta(s.serializer,u)})(n,e)}function Ly(n,e,t){return n instanceof Ur?Dh(n,e):n instanceof Br?Vh(n,e):t}function kh(n,e){return n instanceof qs?(function(r){return To(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class js extends ci{}class Ur extends ci{constructor(e){super(),this.elements=e}}function Dh(n,e){const t=Nh(e);for(const r of n.elements)t.some((s=>yt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Br extends ci{constructor(e){super(),this.elements=e}}function Vh(n,e){let t=Nh(e);for(const r of n.elements)t=t.filter((s=>!yt(s,r)));return{arrayValue:{values:t}}}class qs extends ci{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function yu(n){return _e(n.integerValue||n.doubleValue)}function Nh(n){return Xo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function xy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Ur&&s instanceof Ur||r instanceof Br&&s instanceof Br?zn(r.elements,s.elements,yt):r instanceof qs&&s instanceof qs?yt(r.Ae,s.Ae):r instanceof js&&s instanceof js})(n.transform,e.transform)}class Fy{constructor(e,t){this.version=e,this.transformResults=t}}class St{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new St}static exists(e){return new St(void 0,e)}static updateTime(e){return new St(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function As(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ui{}function Oh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Lh(n.key,St.none()):new Kr(n.key,n.data,St.none());{const t=n.data,r=Ze.empty();let s=new Se(ke.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Sn(n.key,r,new st(s.toArray()),St.none())}}function Uy(n,e,t){n instanceof Kr?(function(s,o,a){const u=s.value.clone(),h=vu(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Sn?(function(s,o,a){if(!As(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=vu(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Mh(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Dr(n,e,t,r){return n instanceof Kr?(function(o,a,u,h){if(!As(o.precondition,a))return u;const d=o.value.clone(),p=Tu(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Sn?(function(o,a,u,h){if(!As(o.precondition,a))return u;const d=Tu(o.fieldTransforms,h,a),p=a.data;return p.setAll(Mh(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(n,e,t,r):(function(o,a,u){return As(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function By(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=kh(r.transform,s||null);o!=null&&(t===null&&(t=Ze.empty()),t.set(r.field,o))}return t||null}function Eu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&zn(r,s,((o,a)=>xy(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Kr extends ui{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Sn extends ui{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Mh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function vu(n,e,t){const r=new Map;te(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,Ly(a,u,t[s]))}return r}function Tu(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,My(o,a,e))}return r}class Lh extends ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jy extends ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class qy{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&Uy(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=bh();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=Oh(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument($.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),J())}isEqual(e){return this.batchId===e.batchId&&zn(this.mutations,e.mutations,((t,r)=>Eu(t,r)))&&zn(this.baseMutations,e.baseMutations,((t,r)=>Eu(t,r)))}}class na{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){te(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return ky})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new na(e,t,r,s)}}class $y{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class zy{constructor(e,t){this.count=e,this.unchangedNames=t}}var ye,Z;function Hy(n){switch(n){case D.OK:return j(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return j(15467,{code:n})}}function xh(n){if(n===void 0)return Ct("GRPC error has no .code"),D.UNKNOWN;switch(n){case ye.OK:return D.OK;case ye.CANCELLED:return D.CANCELLED;case ye.UNKNOWN:return D.UNKNOWN;case ye.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case ye.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case ye.INTERNAL:return D.INTERNAL;case ye.UNAVAILABLE:return D.UNAVAILABLE;case ye.UNAUTHENTICATED:return D.UNAUTHENTICATED;case ye.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case ye.NOT_FOUND:return D.NOT_FOUND;case ye.ALREADY_EXISTS:return D.ALREADY_EXISTS;case ye.PERMISSION_DENIED:return D.PERMISSION_DENIED;case ye.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case ye.ABORTED:return D.ABORTED;case ye.OUT_OF_RANGE:return D.OUT_OF_RANGE;case ye.UNIMPLEMENTED:return D.UNIMPLEMENTED;case ye.DATA_LOSS:return D.DATA_LOSS;default:return j(39323,{code:n})}}(Z=ye||(ye={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";function Wy(){return new TextEncoder}const Gy=new Yt([4294967295,4294967295],0);function Iu(n){const e=Wy().encode(n),t=new Jl;return t.update(e),new Uint8Array(t.digest())}function wu(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Yt([t,r],0),new Yt([s,o],0)]}class ra{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ar(`Invalid padding: ${t}`);if(r<0)throw new Ar(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ar(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ar(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Yt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Yt.fromNumber(r)));return s.compare(Gy)===1&&(s=new Yt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Iu(e),[r,s]=wu(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new ra(o,s,t);return r.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=Iu(e),[r,s]=wu(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ar extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class li{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Qr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new li($.min(),s,new de(X),kt(),J())}}class Qr{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Qr(r,t,J(),J(),J())}}class Rs{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Fh{constructor(e,t){this.targetId=e,this.Ce=t}}class Uh{constructor(e,t,r=De.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Au{constructor(){this.ve=0,this.Fe=Ru(),this.Me=De.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=J(),t=J(),r=J();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:j(38017,{changeType:o})}})),new Qr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Ru()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,te(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Ky{constructor(e){this.Ge=e,this.ze=new Map,this.je=kt(),this.Je=ms(),this.He=ms(),this.Ye=new de(X)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:j(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(wo(o))if(r===0){const a=new U(o.path);this.et(t,a,Me.newNoDocument(a,$.min()))}else te(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=en(r).toUint8Array()}catch(h){if(h instanceof lh)return $n("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new ra(a,s,o)}catch(h){return $n(h instanceof Ar?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&wo(u.target)){const h=new U(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Me.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=J();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new li(e,t,this.Ye,this.je,r);return this.je=kt(),this.Je=ms(),this.He=ms(),this.Ye=new de(X),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Au,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Se(X),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Se(X),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Au),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ms(){return new de(U.comparator)}function Ru(){return new de(U.comparator)}const Qy={asc:"ASCENDING",desc:"DESCENDING"},Yy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xy={and:"AND",or:"OR"};class Jy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ro(n,e){return n.useProto3Json||ri(e)?e:{value:e}}function $s(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Zy(n,e){return $s(n,e.toTimestamp())}function mt(n){return te(!!n,49232),$.fromTimestamp((function(t){const r=Zt(t);return new oe(r.seconds,r.nanos)})(n))}function sa(n,e){return So(n,e).canonicalString()}function So(n,e){const t=(function(s){return new ie(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function jh(n){const e=ie.fromString(n);return te(Wh(e),10190,{key:e.toString()}),e}function Po(n,e){return sa(n.databaseId,e.path)}function eo(n,e){const t=jh(e);if(t.get(1)!==n.databaseId.projectId)throw new L(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new U($h(t))}function qh(n,e){return sa(n.databaseId,e)}function eE(n){const e=jh(n);return e.length===4?ie.emptyPath():$h(e)}function bo(n){return new ie(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $h(n){return te(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Su(n,e,t){return{name:Po(n,e),fields:t.value.mapValue.fields}}function tE(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:j(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(te(p===void 0||typeof p=="string",58123),De.fromBase64String(p||"")):(te(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),De.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){const p=d.code===void 0?D.UNKNOWN:xh(d.code);return new L(p,d.message||"")})(a);t=new Uh(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=eo(n,r.document.name),o=mt(r.document.updateTime),a=r.document.createTime?mt(r.document.createTime):$.min(),u=new Ze({mapValue:{fields:r.document.fields}}),h=Me.newFoundDocument(s,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Rs(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=eo(n,r.document),o=r.readTime?mt(r.readTime):$.min(),a=Me.newNoDocument(s,o),u=r.removedTargetIds||[];t=new Rs([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=eo(n,r.document),o=r.removedTargetIds||[];t=new Rs([],o,s,null)}else{if(!("filter"in e))return j(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new zy(s,o),u=r.targetId;t=new Fh(u,a)}}return t}function nE(n,e){let t;if(e instanceof Kr)t={update:Su(n,e.key,e.value)};else if(e instanceof Lh)t={delete:Po(n,e.key)};else if(e instanceof Sn)t={update:Su(n,e.key,e.data),updateMask:hE(e.fieldMask)};else{if(!(e instanceof jy))return j(16599,{Vt:e.type});t={verify:Po(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof js)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ur)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Br)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof qs)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw j(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:Zy(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:j(27497)})(n,e.precondition)),t}function rE(n,e){return n&&n.length>0?(te(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?mt(s.updateTime):mt(o);return a.isEqual($.min())&&(a=mt(o)),new Fy(a,s.transformResults||[])})(t,e)))):[]}function sE(n,e){return{documents:[qh(n,e.path)]}}function iE(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=qh(n,s);const o=(function(d){if(d.length!==0)return Hh(Et.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(I){return{field:On(I.field),direction:cE(I.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Ro(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function oE(n){let e=eE(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){te(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(v){const I=zh(v);return I instanceof Et&&vh(I)?I.getFilters():[I]})(t.where));let a=[];t.orderBy&&(a=(function(v){return v.map((I=>(function(V){return new Bs(Mn(V.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(V.direction))})(I)))})(t.orderBy));let u=null;t.limit&&(u=(function(v){let I;return I=typeof v=="object"?v.value:v,ri(I)?null:I})(t.limit));let h=null;t.startAt&&(h=(function(v){const I=!!v.before,R=v.values||[];return new Us(R,I)})(t.startAt));let d=null;return t.endAt&&(d=(function(v){const I=!v.before,R=v.values||[];return new Us(R,I)})(t.endAt)),Ay(e,s,a,o,u,"F",h,d)}function aE(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Mn(t.unaryFilter.field);return Ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Mn(t.unaryFilter.field);return Ae.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Mn(t.unaryFilter.field);return Ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Mn(t.unaryFilter.field);return Ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return j(61313);default:return j(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Ae.create(Mn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return j(58110);default:return j(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Et.create(t.compositeFilter.filters.map((r=>zh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return j(1026)}})(t.compositeFilter.op))})(n):j(30097,{filter:n})}function cE(n){return Qy[n]}function uE(n){return Yy[n]}function lE(n){return Xy[n]}function On(n){return{fieldPath:n.canonicalString()}}function Mn(n){return ke.fromServerFormat(n.fieldPath)}function Hh(n){return n instanceof Ae?(function(t){if(t.op==="=="){if(fu(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NAN"}};if(du(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(fu(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NOT_NAN"}};if(du(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:On(t.field),op:uE(t.op),value:t.value}}})(n):n instanceof Et?(function(t){const r=t.getFilters().map((s=>Hh(s)));return r.length===1?r[0]:{compositeFilter:{op:lE(t.op),filters:r}}})(n):j(54877,{filter:n})}function hE(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Wh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Ht{constructor(e,t,r,s,o=$.min(),a=$.min(),u=De.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new Ht(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ht(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dE{constructor(e){this.yt=e}}function fE(n){const e=oE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ao(e,e.limit,"L"):e}class pE{constructor(){this.Cn=new mE}addToCollectionParentIndex(e,t){return this.Cn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(Jt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(Jt.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class mE{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Se(ie.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Se(ie.comparator)).toArray()}}const Pu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gh=41943040;class $e{static withCacheSize(e){return new $e(e,$e.DEFAULT_COLLECTION_PERCENTILE,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}$e.DEFAULT_COLLECTION_PERCENTILE=10,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$e.DEFAULT=new $e(Gh,$e.DEFAULT_COLLECTION_PERCENTILE,$e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$e.DISABLED=new $e(-1,0,0);class Gn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Gn(0)}static cr(){return new Gn(-1)}}const bu="LruGarbageCollector",gE=1048576;function Cu([n,e],[t,r]){const s=X(n,t);return s===0?X(e,r):s}class _E{constructor(e){this.Ir=e,this.buffer=new Se(Cu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Cu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class yE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){O(bu,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){er(t)?O(bu,"Ignoring IndexedDB error during garbage collection: ",t):await Zn(t)}await this.Vr(3e5)}))}}class EE{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(ni.ce);const r=new _E(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Pu)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Pu):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,u,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,a=Date.now(),this.nthSequenceNumber(e,s)))).next((v=>(r=v,u=Date.now(),this.removeTargets(e,r,t)))).next((v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((v=>(d=Date.now(),Vn()<=Y.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function vE(n,e){return new EE(n,e)}class TE{constructor(){this.changes=new Rn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class IE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class wE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Dr(r.mutation,s,st.empty(),oe.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,J()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=J()){const s=pn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=wr();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=pn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,J())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,r,s){let o=kt();const a=kr(),u=(function(){return kr()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof Sn)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Dr(p.mutation,d,p.mutation.getFieldMask(),oe.now())):a.set(d.key,st.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>u.set(d,new IE(p,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=kr();let s=new de(((a,u)=>a-u)),o=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||st.empty();p=u.applyToLocalView(d,p),r.set(h,p);const v=(s.get(u.batchId)||J()).add(h);s=s.insert(u.batchId,v)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,p=h.value,v=bh();p.forEach((I=>{if(!o.has(I)){const R=Oh(t.get(I),r.get(I));R!==null&&v.set(I,R),o=o.add(I)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return b.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return U.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ry(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):b.resolve(pn());let u=Mr,h=o;return a.next((d=>b.forEach(d,((p,v)=>(u<v.largestBatchId&&(u=v.largestBatchId),o.get(p)?b.resolve():this.remoteDocumentCache.getEntry(e,p).next((I=>{h=h.insert(p,I)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,J()))).next((p=>({batchId:u,changes:Ph(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new U(t)).next((r=>{let s=wr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=wr();return this.indexManager.getCollectionParents(e,o).next((u=>b.forEach(u,(h=>{const d=(function(v,I){return new ii(I,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((v,I)=>{a=a.insert(v,I)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,Me.newInvalidDocument(p)))}));let u=wr();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Dr(p.mutation,d,st.empty(),oe.now()),ai(t,d)&&(u=u.insert(h,d))})),u}))}}class AE{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return b.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:mt(s.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:fE(s.bundledQuery),readTime:mt(s.readTime)}})(t)),b.resolve()}}class RE{constructor(){this.overlays=new de(U.comparator),this.qr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const r=pn();return b.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),b.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){const s=pn(),o=t.length+1,a=new U(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return b.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new de(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=pn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const u=pn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>u.set(d,p))),!(u.size()>=s)););return b.resolve(u)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new $y(t,r));let o=this.qr.get(t);o===void 0&&(o=J(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class SE{constructor(){this.sessionToken=De.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}}class ia{constructor(){this.Qr=new Se(be.$r),this.Ur=new Se(be.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new be(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new be(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new U(new ie([])),r=new be(t,e),s=new be(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new U(new ie([])),r=new be(t,e),s=new be(t,e+1);let o=J();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new be(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class be{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return U.comparator(e.key,t.key)||X(e.Yr,t.Yr)}static Kr(e,t){return X(e.Yr,t.Yr)||U.comparator(e.key,t.key)}}class PE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Se(be.$r)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new qy(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new be(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(e,t){return b.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return b.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?Qo:this.tr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new be(t,0),s=new be(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),b.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Se(X);return t.forEach((s=>{const o=new be(s,0),a=new be(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),b.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;U.isDocumentKey(o)||(o=o.child(""));const a=new be(new U(o),0);let u=new Se(X);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),b.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){te(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return b.forEach(t.mutations,(s=>{const o=new be(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new be(t,0),s=this.Zr.firstAfterOrEqual(r);return b.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class bE{constructor(e){this.ri=e,this.docs=(function(){return new de(U.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=kt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Me.newInvalidDocument(s))})),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=kt();const a=t.path,u=new U(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ny(ty(p),r)<=0||(s.has(p.key)||ai(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return b.resolve(o)}getAllFromCollectionGroup(e,t,r,s){j(9500)}ii(e,t){return b.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new CE(this)}getSize(e){return b.resolve(this.size)}}class CE extends TE{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),b.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class kE{constructor(e){this.persistence=e,this.si=new Rn((t=>Jo(t)),Zo),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.oi=0,this._i=new ia,this.targetCount=0,this.ai=Gn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),b.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Gn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Pr(t),b.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)})),b.waitFor(o).next((()=>s))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),b.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),b.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this._i.containsKey(t))}}class Kh{constructor(e,t){this.ui={},this.overlays={},this.ci=new ni(0),this.li=!1,this.li=!0,this.hi=new SE,this.referenceDelegate=e(this),this.Pi=new kE(this),this.indexManager=new pE,this.remoteDocumentCache=(function(s){return new bE(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new dE(t),this.Ii=new AE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new RE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new PE(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);const s=new DE(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return b.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class DE extends sy{constructor(e){super(),this.currentSequenceNumber=e}}class oa{constructor(e){this.persistence=e,this.Ri=new ia,this.Vi=null}static mi(e){return new oa(e)}get fi(){if(this.Vi)return this.Vi;throw j(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,(r=>{const s=U.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,$.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class zs{constructor(e,t){this.persistence=e,this.pi=new Rn((r=>ay(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=vE(this,t)}static mi(e,t){return new zs(e,t)}Ei(){}di(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return b.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?b.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((u=>{u||(r++,o.removeEntry(a,$.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),b.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Is(e.data.value)),t}br(e,t,r){return b.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return b.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class aa{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=J(),s=J();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new aa(e,t.fromCache,r,s)}}class VE{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class NE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return cp()?8:iy(Le())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new VE;return this.Ss(e,t,a).next((u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Vn()<=Y.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(Vn()<=Y.DEBUG&&O("QueryEngine","Query:",Nn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Vn()<=Y.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,pt(t))):b.resolve())}ys(e,t){if(_u(t))return b.resolve(null);let r=pt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=Ao(t,null,"F"),r=pt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=J(...o);return this.ps.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,Ao(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ws(e,t,r,s){return _u(t)||s.isEqual($.min())?b.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?b.resolve(null):(Vn()<=Y.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Nn(t)),this.vs(e,a,t,ey(s,Mr)).next((u=>u)))}))}Ds(e,t){let r=new Se(Rh(e));return t.forEach(((s,o)=>{ai(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Vn()<=Y.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Nn(t)),this.ps.getDocumentsMatchingQuery(e,t,Jt.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const ca="LocalStore",OE=3e8;class ME{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new de(X),this.xs=new Rn((o=>Jo(o)),Zo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function LE(n,e,t,r){return new ME(n,e,t,r)}async function Qh(n,e){const t=z(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=J();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){u.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function xE(n,e){const t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){const v=d.batch,I=v.keys();let R=b.resolve();return I.forEach((V=>{R=R.next((()=>p.getEntry(h,V))).next((P=>{const C=d.docVersions.get(V);te(C!==null,48541),P.version.compareTo(C)<0&&(v.applyToRemoteDocument(P,d),P.isValidDocument()&&(P.setReadTime(d.commitVersion),p.addEntry(P)))}))})),R.next((()=>u.mutationQueue.removeMutationBatch(h,v)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=J();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Yh(n){const e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function FE(n,e){const t=z(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const u=[];e.targetChanges.forEach(((p,v)=>{const I=s.get(v);if(!I)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,v).next((()=>t.Pi.addMatchingKeys(o,p.addedDocuments,v))));let R=I.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?R=R.withResumeToken(De.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),s=s.insert(v,R),(function(P,C,x){return P.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=OE?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0})(I,R,p)&&u.push(t.Pi.updateTargetData(o,R))}));let h=kt(),d=J();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(UE(o,a,e.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual($.min())){const p=t.Pi.getLastRemoteSnapshotVersion(o).next((v=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return b.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function UE(n,e,t){let r=J(),s=J();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=kt();return t.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual($.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):O(ca,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function BE(n,e){const t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Qo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function jE(n,e){const t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,b.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new Ht(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Co(n,e,t){const r=z(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!er(a))throw a;O(ca,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function ku(n,e,t){const r=z(n);let s=$.min(),o=J();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const v=z(h),I=v.xs.get(p);return I!==void 0?b.resolve(v.Ms.get(I)):v.Pi.getTargetData(d,p)})(r,a,pt(e)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:$.min(),t?o:J()))).next((u=>(qE(r,Py(e),u),{documents:u,Qs:o})))))}function qE(n,e,t){let r=n.Os.get(e)||$.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class Du{constructor(){this.activeTargetIds=Ny()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $E{constructor(){this.Mo=new Du,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Du,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class zE{Oo(e){}shutdown(){}}const Vu="ConnectivityMonitor";class Nu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){O(Vu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){O(Vu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let gs=null;function ko(){return gs===null?gs=(function(){return 268435456+Math.round(2147483648*Math.random())})():gs++,"0x"+gs.toString(16)}const to="RestConnection",HE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class WE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===xs?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=ko(),u=this.zo(e,t.toUriEncodedString());O(to,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),p=Qn(d);return this.Jo(e,u,h,r,p).then((v=>(O(to,`Received RPC '${e}' ${a}: `,v),v)),(v=>{throw $n(to,`RPC '${e}' ${a} failed with error: `,v,"url: ",u,"request:",r),v}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Jn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=HE[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class GE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ne="WebChannelConnection";class KE extends WE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=ko();return new Promise(((u,h)=>{const d=new Zl;d.setWithCredentials(!0),d.listenOnce(eh.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Ts.NO_ERROR:const v=d.getResponseJson();O(Ne,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),u(v);break;case Ts.TIMEOUT:O(Ne,`RPC '${e}' ${a} timed out`),h(new L(D.DEADLINE_EXCEEDED,"Request time out"));break;case Ts.HTTP_ERROR:const I=d.getStatus();if(O(Ne,`RPC '${e}' ${a} failed with status:`,I,"response text:",d.getResponseText()),I>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const V=R?.error;if(V&&V.status&&V.message){const P=(function(x){const F=x.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(F)>=0?F:D.UNKNOWN})(V.status);h(new L(P,V.message))}else h(new L(D.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new L(D.UNAVAILABLE,"Connection failed."));break;default:j(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{O(Ne,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);O(Ne,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=ko(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=rh(),u=nh(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=o.join("");O(Ne,`Creating RPC '${e}' stream ${s}: ${p}`,h);const v=a.createWebChannel(p,h);this.I_(v);let I=!1,R=!1;const V=new GE({Yo:C=>{R?O(Ne,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(I||(O(Ne,`Opening RPC '${e}' stream ${s} transport.`),v.open(),I=!0),O(Ne,`RPC '${e}' stream ${s} sending:`,C),v.send(C))},Zo:()=>v.close()}),P=(C,x,F)=>{C.listen(x,(M=>{try{F(M)}catch(q){setTimeout((()=>{throw q}),0)}}))};return P(v,Ir.EventType.OPEN,(()=>{R||(O(Ne,`RPC '${e}' stream ${s} transport opened.`),V.o_())})),P(v,Ir.EventType.CLOSE,(()=>{R||(R=!0,O(Ne,`RPC '${e}' stream ${s} transport closed`),V.a_(),this.E_(v))})),P(v,Ir.EventType.ERROR,(C=>{R||(R=!0,$n(Ne,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),V.a_(new L(D.UNAVAILABLE,"The operation could not be completed")))})),P(v,Ir.EventType.MESSAGE,(C=>{if(!R){const x=C.data[0];te(!!x,16349);const F=x,M=F?.error||F[0]?.error;if(M){O(Ne,`RPC '${e}' stream ${s} received error:`,M);const q=M.status;let H=(function(m){const y=ye[m];if(y!==void 0)return xh(y)})(q),Q=M.message;H===void 0&&(H=D.INTERNAL,Q="Unknown error status: "+q+" with message "+M.message),R=!0,V.a_(new L(H,Q)),v.close()}else O(Ne,`RPC '${e}' stream ${s} received:`,x),V.u_(x)}})),P(u,th.STAT_EVENT,(C=>{C.stat===yo.PROXY?O(Ne,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===yo.NOPROXY&&O(Ne,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{V.__()}),0),V}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function no(){return typeof document<"u"?document:null}function hi(n){return new Jy(n,!0)}class Xh{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ou="PersistentStream";class Jh{constructor(e,t,r,s,o,a,u,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Xh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Ct(t.toString()),Ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new L(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return O(Ou,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(O(Ou,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class QE extends Jh{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=tE(this.serializer,e),r=(function(o){if(!("targetChange"in o))return $.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?mt(a.readTime):$.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=bo(this.serializer),t.addTarget=(function(o,a){let u;const h=a.target;if(u=wo(h)?{documents:sE(o,h)}:{query:iE(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Bh(o,a.resumeToken);const d=Ro(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo($.min())>0){u.readTime=$s(o,a.snapshotVersion.toTimestamp());const d=Ro(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);const r=aE(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=bo(this.serializer),t.removeTarget=e,this.q_(t)}}class YE extends Jh{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return te(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,te(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){te(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=rE(e.writeResults,e.commitTime),r=mt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=bo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>nE(this.serializer,r)))};this.q_(t)}}class XE{}class JE extends XE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new L(D.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,So(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new L(D.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(e,So(t,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new L(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class ZE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ct(t),this.aa=!1):O("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const In="RemoteStore";class ev{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{Pn(this)&&(O(In,"Restarting streams for network reachability change."),await(async function(h){const d=z(h);d.Ea.add(4),await Yr(d),d.Ra.set("Unknown"),d.Ea.delete(4),await di(d)})(this))}))})),this.Ra=new ZE(r,s)}}async function di(n){if(Pn(n))for(const e of n.da)await e(!0)}async function Yr(n){for(const e of n.da)await e(!1)}function Zh(n,e){const t=z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),da(t)?ha(t):tr(t).O_()&&la(t,e))}function ua(n,e){const t=z(n),r=tr(t);t.Ia.delete(e),r.O_()&&ed(t,e),t.Ia.size===0&&(r.O_()?r.L_():Pn(t)&&t.Ra.set("Unknown"))}function la(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}tr(n).Y_(e)}function ed(n,e){n.Va.Ue(e),tr(n).Z_(e)}function ha(n){n.Va=new Ky({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),tr(n).start(),n.Ra.ua()}function da(n){return Pn(n)&&!tr(n).x_()&&n.Ia.size>0}function Pn(n){return z(n).Ea.size===0}function td(n){n.Va=void 0}async function tv(n){n.Ra.set("Online")}async function nv(n){n.Ia.forEach(((e,t)=>{la(n,e)}))}async function rv(n,e){td(n),da(n)?(n.Ra.ha(e),ha(n)):n.Ra.set("Unknown")}async function sv(n,e,t){if(n.Ra.set("Online"),e instanceof Uh&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,e)}catch(r){O(In,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Hs(n,r)}else if(e instanceof Rs?n.Va.Ze(e):e instanceof Fh?n.Va.st(e):n.Va.tt(e),!t.isEqual($.min()))try{const r=await Yh(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(De.EMPTY_BYTE_STRING,p.snapshotVersion)),ed(o,h);const v=new Ht(p.target,h,d,p.sequenceNumber);la(o,v)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){O(In,"Failed to raise snapshot:",r),await Hs(n,r)}}async function Hs(n,e,t){if(!er(e))throw e;n.Ea.add(1),await Yr(n),n.Ra.set("Offline"),t||(t=()=>Yh(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{O(In,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await di(n)}))}function nd(n,e){return e().catch((t=>Hs(n,t,e)))}async function fi(n){const e=z(n),t=nn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Qo;for(;iv(e);)try{const s=await BE(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,ov(e,s)}catch(s){await Hs(e,s)}rd(e)&&sd(e)}function iv(n){return Pn(n)&&n.Ta.length<10}function ov(n,e){n.Ta.push(e);const t=nn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function rd(n){return Pn(n)&&!nn(n).x_()&&n.Ta.length>0}function sd(n){nn(n).start()}async function av(n){nn(n).ra()}async function cv(n){const e=nn(n);for(const t of n.Ta)e.ea(t.mutations)}async function uv(n,e,t){const r=n.Ta.shift(),s=na.from(r,e,t);await nd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await fi(n)}async function lv(n,e){e&&nn(n).X_&&await(async function(r,s){if((function(a){return Hy(a)&&a!==D.ABORTED})(s.code)){const o=r.Ta.shift();nn(r).B_(),await nd(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await fi(r)}})(n,e),rd(n)&&sd(n)}async function Mu(n,e){const t=z(n);t.asyncQueue.verifyOperationInProgress(),O(In,"RemoteStore received new credentials");const r=Pn(t);t.Ea.add(3),await Yr(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await di(t)}async function hv(n,e){const t=z(n);e?(t.Ea.delete(2),await di(t)):e||(t.Ea.add(2),await Yr(t),t.Ra.set("Unknown"))}function tr(n){return n.ma||(n.ma=(function(t,r,s){const o=z(t);return o.sa(),new QE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:tv.bind(null,n),t_:nv.bind(null,n),r_:rv.bind(null,n),H_:sv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),da(n)?ha(n):n.Ra.set("Unknown")):(await n.ma.stop(),td(n))}))),n.ma}function nn(n){return n.fa||(n.fa=(function(t,r,s){const o=z(t);return o.sa(),new YE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:av.bind(null,n),r_:lv.bind(null,n),ta:cv.bind(null,n),na:uv.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await fi(n)):(await n.fa.stop(),n.Ta.length>0&&(O(In,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class fa{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new fa(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pa(n,e){if(Ct("AsyncQueue",`${e}: ${n}`),er(n))return new L(D.UNAVAILABLE,`${e}: ${n}`);throw n}class Bn{static emptySet(e){return new Bn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||U.comparator(t.key,r.key):(t,r)=>U.comparator(t.key,r.key),this.keyedMap=wr(),this.sortedSet=new de(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Bn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Bn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Lu{constructor(){this.ga=new de(U.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):j(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Kn{constructor(e,t,r,s,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new Kn(e,t,Bn.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class dv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class fv{constructor(){this.queries=xu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=z(t),o=s.queries;s.queries=xu(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new L(D.ABORTED,"Firestore shutting down"))}}function xu(){return new Rn((n=>Ah(n)),oi)}async function id(n,e){const t=z(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new dv,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=pa(a,`Initialization of query '${Nn(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&ma(t)}async function od(n,e){const t=z(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function pv(n,e){const t=z(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&ma(t)}function mv(n,e,t){const r=z(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function ma(n){n.Ca.forEach((e=>{e.next()}))}var Do,Fu;(Fu=Do||(Do={})).Ma="default",Fu.Cache="cache";class ad{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Kn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Kn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Do.Cache}}class cd{constructor(e){this.key=e}}class ud{constructor(e){this.key=e}}class gv{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=Rh(e),this.tu=new Bn(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Lu,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,v)=>{const I=s.get(p),R=ai(this.query,v)?v:null,V=!!I&&this.mutatedKeys.has(I.key),P=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let C=!1;I&&R?I.data.isEqual(R.data)?V!==P&&(r.track({type:3,doc:R}),C=!0):this.su(I,R)||(r.track({type:2,doc:R}),C=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!I&&R?(r.track({type:0,doc:R}),C=!0):I&&!R&&(r.track({type:1,doc:I}),C=!0,(h||d)&&(u=!0)),C&&(R?(a=a.add(R),o=P?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,v)=>(function(R,V){const P=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j(20277,{Rt:C})}};return P(R)-P(V)})(p.type,v.type)||this.eu(p.doc,v.doc))),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new Kn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Lu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=J(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new ud(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new cd(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=J();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Kn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ga="SyncEngine";class _v{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class yv{constructor(e){this.key=e,this.hu=!1}}class Ev{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Rn((u=>Ah(u)),oi),this.Iu=new Map,this.Eu=new Set,this.du=new de(U.comparator),this.Au=new Map,this.Ru=new ia,this.Vu={},this.mu=new Map,this.fu=Gn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function vv(n,e,t=!0){const r=md(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await ld(r,e,t,!0),s}async function Tv(n,e){const t=md(n);await ld(t,e,!0,!1)}async function ld(n,e,t,r){const s=await jE(n.localStore,pt(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await Iv(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Zh(n.remoteStore,s),u}async function Iv(n,e,t,r,s){n.pu=(v,I,R)=>(async function(P,C,x,F){let M=C.view.ru(x);M.Cs&&(M=await ku(P.localStore,C.query,!1).then((({documents:E})=>C.view.ru(E,M))));const q=F&&F.targetChanges.get(C.targetId),H=F&&F.targetMismatches.get(C.targetId)!=null,Q=C.view.applyChanges(M,P.isPrimaryClient,q,H);return Bu(P,C.targetId,Q.au),Q.snapshot})(n,v,I,R);const o=await ku(n.localStore,e,!0),a=new gv(e,o.Qs),u=a.ru(o.documents),h=Qr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);Bu(n,t,d.au);const p=new _v(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function wv(n,e,t){const r=z(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!oi(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Co(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&ua(r.remoteStore,s.targetId),Vo(r,s.targetId)})).catch(Zn)):(Vo(r,s.targetId),await Co(r.localStore,s.targetId,!0))}async function Av(n,e){const t=z(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ua(t.remoteStore,r.targetId))}async function Rv(n,e,t){const r=Vv(n);try{const s=await(function(a,u){const h=z(a),d=oe.now(),p=u.reduce(((R,V)=>R.add(V.key)),J());let v,I;return h.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let V=kt(),P=J();return h.Ns.getEntries(R,p).next((C=>{V=C,V.forEach(((x,F)=>{F.isValidDocument()||(P=P.add(x))}))})).next((()=>h.localDocuments.getOverlayedDocuments(R,V))).next((C=>{v=C;const x=[];for(const F of u){const M=By(F,v.get(F.key).overlayedDocument);M!=null&&x.push(new Sn(F.key,M,_h(M.value.mapValue),St.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,x,u)})).next((C=>{I=C;const x=C.applyToLocalDocumentSet(v,P);return h.documentOverlayCache.saveOverlays(R,C.batchId,x)}))})).then((()=>({batchId:I.batchId,changes:Ph(v)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new de(X)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await Xr(r,s.changes),await fi(r.remoteStore)}catch(s){const o=pa(s,"Failed to persist write");t.reject(o)}}async function hd(n,e){const t=z(n);try{const r=await FE(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(te(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?te(a.hu,14607):s.removedDocuments.size>0&&(te(a.hu,42227),a.hu=!1))})),await Xr(t,r,e)}catch(r){await Zn(r)}}function Uu(n,e,t){const r=z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=z(a);h.onlineState=u;let d=!1;h.queries.forEach(((p,v)=>{for(const I of v.Sa)I.va(u)&&(d=!0)})),d&&ma(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Sv(n,e,t){const r=z(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new de(U.comparator);a=a.insert(o,Me.newNoDocument(o,$.min()));const u=J().add(o),h=new li($.min(),new Map,new de(X),a,u);await hd(r,h),r.du=r.du.remove(o),r.Au.delete(e),_a(r)}else await Co(r.localStore,e,!1).then((()=>Vo(r,e,t))).catch(Zn)}async function Pv(n,e){const t=z(n),r=e.batch.batchId;try{const s=await xE(t.localStore,e);fd(t,r,null),dd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Xr(t,s)}catch(s){await Zn(s)}}async function bv(n,e,t){const r=z(n);try{const s=await(function(a,u){const h=z(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next((v=>(te(v!==null,37113),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);fd(r,e,t),dd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Xr(r,s)}catch(s){await Zn(s)}}function dd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function fd(n,e,t){const r=z(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Vo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||pd(n,r)}))}function pd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(ua(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),_a(n))}function Bu(n,e,t){for(const r of t)r instanceof cd?(n.Ru.addReference(r.key,e),Cv(n,r)):r instanceof ud?(O(ga,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||pd(n,r.key)):j(19791,{wu:r})}function Cv(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(O(ga,"New document in limbo: "+t),n.Eu.add(r),_a(n))}function _a(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new U(ie.fromString(e)),r=n.fu.next();n.Au.set(r,new yv(t)),n.du=n.du.insert(t,r),Zh(n.remoteStore,new Ht(pt(ea(t.path)),r,"TargetPurposeLimboResolution",ni.ce))}}async function Xr(n,e,t){const r=z(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=aa.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=z(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>b.forEach(d,(I=>b.forEach(I.Es,(R=>p.persistence.referenceDelegate.addReference(v,I.targetId,R))).next((()=>b.forEach(I.ds,(R=>p.persistence.referenceDelegate.removeReference(v,I.targetId,R)))))))))}catch(v){if(!er(v))throw v;O(ca,"Failed to update sequence numbers: "+v)}for(const v of d){const I=v.targetId;if(!v.fromCache){const R=p.Ms.get(I),V=R.snapshotVersion,P=R.withLastLimboFreeSnapshotVersion(V);p.Ms=p.Ms.insert(I,P)}}})(r.localStore,o))}async function kv(n,e){const t=z(n);if(!t.currentUser.isEqual(e)){O(ga,"User change. New user:",e.toKey());const r=await Qh(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new L(D.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Xr(t,r.Ls)}}function Dv(n,e){const t=z(n),r=t.Au.get(e);if(r&&r.hu)return J().add(r.key);{let s=J();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function md(n){const e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=hd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Dv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Sv.bind(null,e),e.Pu.H_=pv.bind(null,e.eventManager),e.Pu.yu=mv.bind(null,e.eventManager),e}function Vv(n){const e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Pv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bv.bind(null,e),e}class Ws{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=hi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return LE(this.persistence,new NE,e.initialUser,this.serializer)}Cu(e){return new Kh(oa.mi,this.serializer)}Du(e){return new $E}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ws.provider={build:()=>new Ws};class Nv extends Ws{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){te(this.persistence.referenceDelegate instanceof zs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new yE(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?$e.withCacheSize(this.cacheSizeBytes):$e.DEFAULT;return new Kh((r=>zs.mi(r,t)),this.serializer)}}class No{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Uu(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=kv.bind(null,this.syncEngine),await hv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new fv})()}createDatastore(e){const t=hi(e.databaseInfo.databaseId),r=(function(o){return new KE(o)})(e.databaseInfo);return(function(o,a,u,h){return new JE(o,a,u,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,u){return new ev(r,s,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>Uu(this.syncEngine,t,0)),(function(){return Nu.v()?new Nu:new zE})())}createSyncEngine(e,t){return(function(s,o,a,u,h,d,p){const v=new Ev(s,o,a,u,h,d);return p&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=z(t);O(In,"RemoteStore shutting down."),r.Ea.add(5),await Yr(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}No.provider={build:()=>new No};class gd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ct("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const rn="FirestoreClient";class Ov{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Oe.UNAUTHENTICATED,this.clientId=Go.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{O(rn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(O(rn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=pa(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function ro(n,e){n.asyncQueue.verifyOperationInProgress(),O(rn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Qh(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function ju(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Mv(n);O(rn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Mu(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Mu(e.remoteStore,s))),n._onlineComponents=e}async function Mv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(rn,"Using user provided OfflineComponentProvider");try{await ro(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;$n("Error using user provided cache. Falling back to memory cache: "+t),await ro(n,new Ws)}}else O(rn,"Using default OfflineComponentProvider"),await ro(n,new Nv(void 0));return n._offlineComponents}async function _d(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(rn,"Using user provided OnlineComponentProvider"),await ju(n,n._uninitializedComponentsProvider._online)):(O(rn,"Using default OnlineComponentProvider"),await ju(n,new No))),n._onlineComponents}function Lv(n){return _d(n).then((e=>e.syncEngine))}async function yd(n){const e=await _d(n),t=e.eventManager;return t.onListen=vv.bind(null,e.syncEngine),t.onUnlisten=wv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Tv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Av.bind(null,e.syncEngine),t}function xv(n,e,t={}){const r=new Rt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new gd({next:I=>{p.Nu(),a.enqueueAndForget((()=>od(o,v)));const R=I.docs.has(u);!R&&I.fromCache?d.reject(new L(D.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&I.fromCache&&h&&h.source==="server"?d.reject(new L(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(I)},error:I=>d.reject(I)}),v=new ad(ea(u.path),p,{includeMetadataChanges:!0,qa:!0});return id(o,v)})(await yd(n),n.asyncQueue,e,t,r))),r.promise}function Fv(n,e,t={}){const r=new Rt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new gd({next:I=>{p.Nu(),a.enqueueAndForget((()=>od(o,v))),I.fromCache&&h.source==="server"?d.reject(new L(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(I)},error:I=>d.reject(I)}),v=new ad(u,p,{includeMetadataChanges:!0,qa:!0});return id(o,v)})(await yd(n),n.asyncQueue,e,t,r))),r.promise}function Ed(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const qu=new Map;const vd="firestore.googleapis.com",$u=!0;class zu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vd,this.ssl=$u}else this.host=e.host,this.ssl=e.ssl??$u;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Gh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<gE)throw new L(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Z_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ed(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new L(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new L(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new L(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new $_;switch(r.type){case"firstParty":return new G_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new L(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=qu.get(t);r&&(O("ComponentProvider","Removing Datastore"),qu.delete(t),r.terminate())})(this),Promise.resolve()}}function Uv(n,e,t,r={}){n=Tn(n,pi);const s=Qn(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(ll(`https://${u}`),hl("Firestore",!0)),o.host!==vd&&o.host!==u&&$n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!gn(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=Oe.MOCK_USER;else{d=Zf(r.mockUserToken,n._app?.options.projectId);const v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new L(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Oe(v)}n._authCredentials=new z_(new ih(d,p))}}class mi{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new mi(this.firestore,e,this._query)}}class Re{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Re(this.firestore,e,this._key)}toJSON(){return{type:Re._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Gr(t,Re._jsonSchema))return new Re(e,r||null,new U(ie.fromString(t.referencePath)))}}Re._jsonSchemaVersion="firestore/documentReference/1.0",Re._jsonSchema={type:ve("string",Re._jsonSchemaVersion),referencePath:ve("string")};class Xt extends mi{constructor(e,t,r){super(e,t,ea(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Re(this.firestore,null,new U(e))}withConverter(e){return new Xt(this.firestore,e,this._path)}}function Bv(n,e,...t){if(n=ze(n),oh("collection","path",e),n instanceof pi){const r=ie.fromString(e,...t);return su(r),new Xt(n,null,r)}{if(!(n instanceof Re||n instanceof Xt))throw new L(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ie.fromString(e,...t));return su(r),new Xt(n.firestore,null,r)}}function Hu(n,e,...t){if(n=ze(n),arguments.length===1&&(e=Go.newId()),oh("doc","path",e),n instanceof pi){const r=ie.fromString(e,...t);return ru(r),new Re(n,null,new U(r))}{if(!(n instanceof Re||n instanceof Xt))throw new L(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ie.fromString(e,...t));return ru(r),new Re(n.firestore,n instanceof Xt?n.converter:null,new U(r))}}const Wu="AsyncQueue";class Gu{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xh(this,"async_queue_retry"),this._c=()=>{const r=no();r&&O(Wu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=no();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=no();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Rt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!er(e))throw e;O(Wu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ct("INTERNAL UNHANDLED ERROR: ",Ku(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=fa.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&j(47125,{Pc:Ku(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ku(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class gi extends pi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Gu,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Gu(e),this._firestoreClient=void 0,await e}}}function jv(n,e){const t=typeof n=="object"?n:ml(),r=typeof n=="string"?n:xs,s=xo(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Xf("firestore");o&&Uv(s,...o)}return s}function ya(n){if(n._terminated)throw new L(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||qv(n),n._firestoreClient}function qv(n){const e=n._freezeSettings(),t=(function(s,o,a,u){return new ly(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Ed(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Ov(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class et{constructor(e){this._byteString=e}static fromBase64String(e){try{return new et(De.fromBase64String(e))}catch(t){throw new L(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new et(De.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:et._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Gr(e,et._jsonSchema))return et.fromBase64String(e.bytes)}}et._jsonSchemaVersion="firestore/bytes/1.0",et._jsonSchema={type:ve("string",et._jsonSchemaVersion),bytes:ve("string")};class Ea{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Td{constructor(e){this._methodName=e}}class gt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:gt._jsonSchemaVersion}}static fromJSON(e){if(Gr(e,gt._jsonSchema))return new gt(e.latitude,e.longitude)}}gt._jsonSchemaVersion="firestore/geoPoint/1.0",gt._jsonSchema={type:ve("string",gt._jsonSchemaVersion),latitude:ve("number"),longitude:ve("number")};class _t{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:_t._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Gr(e,_t._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new _t(e.vectorValues);throw new L(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}_t._jsonSchemaVersion="firestore/vectorValue/1.0",_t._jsonSchema={type:ve("string",_t._jsonSchemaVersion),vectorValues:ve("object")};const $v=/^__.*__$/;class zv{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Sn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Kr(e,this.data,t,this.fieldTransforms)}}function Id(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j(40011,{Ac:n})}}class va{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new va({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Gs(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Id(this.Ac)&&$v.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Hv{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||hi(e)}Cc(e,t,r,s=!1){return new va({Ac:e,methodName:t,Dc:r,path:ke.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wv(n){const e=n._freezeSettings(),t=hi(n._databaseId);return new Hv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Gv(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);Sd("Data must be an object, but it was:",a,r);const u=Ad(r,a);let h,d;if(o.merge)h=new st(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const v of o.mergeFields){const I=Kv(e,v,t);if(!a.contains(I))throw new L(D.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);Yv(p,I)||p.push(I)}h=new st(p),d=a.fieldTransforms.filter((v=>h.covers(v.field)))}else h=null,d=a.fieldTransforms;return new zv(new Ze(u),h,d)}function wd(n,e){if(Rd(n=ze(n)))return Sd("Unsupported field value:",e,n),Ad(n,e);if(n instanceof Td)return(function(r,s){if(!Id(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=wd(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=ze(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Oy(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=oe.fromDate(r);return{timestampValue:$s(s.serializer,o)}}if(r instanceof oe){const o=new oe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$s(s.serializer,o)}}if(r instanceof gt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof et)return{bytesValue:Bh(s.serializer,r._byteString)};if(r instanceof Re){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:sa(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof _t)return(function(a,u){return{mapValue:{fields:{[mh]:{stringValue:gh},[Fs]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return ta(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Ko(r)}`)})(n,e)}function Ad(n,e){const t={};return uh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):An(n,((r,s)=>{const o=wd(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function Rd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof oe||n instanceof gt||n instanceof et||n instanceof Re||n instanceof Td||n instanceof _t)}function Sd(n,e,t){if(!Rd(t)||!ah(t)){const r=Ko(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Kv(n,e,t){if((e=ze(e))instanceof Ea)return e._internalPath;if(typeof e=="string")return Pd(n,e);throw Gs("Field path arguments must be of type string or ",n,!1,void 0,t)}const Qv=new RegExp("[~\\*/\\[\\]]");function Pd(n,e,t){if(e.search(Qv)>=0)throw Gs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ea(...e.split("."))._internalPath}catch{throw Gs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Gs(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new L(D.INVALID_ARGUMENT,u+n+h)}function Yv(n,e){return n.some((t=>t.isEqual(e)))}class bd{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Re(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Xv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Cd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Xv extends bd{data(){return super.data()}}function Cd(n,e){return typeof e=="string"?Pd(n,e):e instanceof Ea?e._internalPath:e._delegate._internalPath}function Jv(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zv{convertValue(e,t="none"){switch(tn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return _e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(en(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return An(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[Fs].arrayValue?.values?.map((r=>_e(r.doubleValue)));return new _t(t)}convertGeoPoint(e){return new gt(_e(e.latitude),_e(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=si(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Lr(e));default:return null}}convertTimestamp(e){const t=Zt(e);return new oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ie.fromString(e);te(Wh(r),9688,{name:e});const s=new xr(r.get(1),r.get(3)),o=new U(r.popFirst(5));return s.isEqual(t)||Ct(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function eT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Rr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mn extends bd{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ss(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Cd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=mn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}mn._jsonSchemaVersion="firestore/documentSnapshot/1.0",mn._jsonSchema={type:ve("string",mn._jsonSchemaVersion),bundleSource:ve("string","DocumentSnapshot"),bundleName:ve("string"),bundle:ve("string")};class Ss extends mn{data(e={}){return super.data(e)}}class jn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Rr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Ss(this._firestore,this._userDataWriter,r.key,r,new Rr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new Ss(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Rr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new Ss(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Rr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:tT(u.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=jn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Go.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function tT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j(61501,{type:n})}}function nT(n){n=Tn(n,Re);const e=Tn(n.firestore,gi);return xv(ya(e),n._key).then((t=>iT(e,n,t)))}jn._jsonSchemaVersion="firestore/querySnapshot/1.0",jn._jsonSchema={type:ve("string",jn._jsonSchemaVersion),bundleSource:ve("string","QuerySnapshot"),bundleName:ve("string"),bundle:ve("string")};class kd extends Zv{constructor(e){super(),this.firestore=e}convertBytes(e){return new et(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Re(this.firestore,null,t)}}function rT(n){n=Tn(n,mi);const e=Tn(n.firestore,gi),t=ya(e),r=new kd(e);return Jv(n._query),Fv(t,n._query).then((s=>new jn(e,r,n,s)))}function Qu(n,e,t){n=Tn(n,Re);const r=Tn(n.firestore,gi),s=eT(n.converter,e,t);return sT(r,[Gv(Wv(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,St.none())])}function sT(n,e){return(function(r,s){const o=new Rt;return r.asyncQueue.enqueueAndForget((async()=>Rv(await Lv(r),s,o))),o.promise})(ya(n),e)}function iT(n,e,t){const r=t.docs.get(e._key),s=new kd(n);return new mn(n,s,e._key,r,new Rr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){Jn=s})(Yn),qn(new _n("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new gi(new H_(r.getProvider("auth-internal")),new K_(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new L(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xr(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Qt(Zc,eu,e),Qt(Zc,eu,"esm2020")})();const oT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},Dd=pl(oT),Ks=j_(Dd),Oo=jv(Dd),vt=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var aT=Be("<p> </p>"),cT=Be(`<div class="login svelte-2v2n6f"><br/> <h2>The Good Calendar</h2> <p>Here, you can log the quality of your days and nights for posterity. Dedicated to my girlfriend and her chronic migranes.</p> <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem; "><input type="text" placeholder="Username" class="login_input svelte-2v2n6f" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input svelte-2v2n6f" style="width: 200px;"/> <button style="
          position: absolute;
          right: -45px;
          top: 50%;
          transform: translateY(-50%);
          border-radius: 10%;
          font-size: 0.75rem;
          padding: 0.1rem 0.25rem;
          white-space: nowrap;
        "> </button></div></div> <!> <div style="align-items: center"><button>Login</button> <button>Sign up</button></div></div>`);function uT(n,e){Ys(e,!1);const t=Vf();let r=ge(""),s=ge(""),o=ge(""),a=ge(!0);async function u(){K(o,"");try{const E=`${k(r)}@tracker.app`,m=await Rg(Ks,E,k(s));t("loggedin",{uid:m.user.uid})}catch(E){console.error(E),K(o,E.message)}}async function h(){K(o,"");try{const E=`${k(r)}@tracker.app`,m=await Sg(Ks,E,k(s));t("loggedin",{uid:m.user.uid})}catch(E){console.error(E),K(o,E.message)}}function d(E){switch(E){case"Firebase: Error (auth/invalid-credential).":return"Incorrect password or the account doesn't exist";case"Firebase: Missing password requirements: [Password must contain at least 6 characters] (auth/password-does-not-meet-requirements).":return"Password must contain at least 6 characters";case"Firebase: Error (auth/email-already-in-use).":return"This account already exists.";case"Firebase: Error (auth/invalid-email).":return"Your username cannot have any spaces";case"Firebase: Error (auth/missing-password).":return"Missing password";default:return E}}Qs();var p=cT(),v=re(he(p),2),I=re(v,4),R=he(I);oo(R);var V=re(R,2),P=he(V);oo(P);var C=re(P,2),x=he(C,!0);le(C),le(V),le(I);var F=re(I,2);{var M=E=>{var m=aT(),y=he(m,!0);le(m),Ke(T=>Ye(y,T),[()=>d(k(o))]),Ee(E,m)};ht(F,E=>{k(o)&&E(M)})}var q=re(F,2),H=he(q),Q=re(H,2);le(q),le(p),Ke(()=>{Wt(v,`background: url(${vt}); no-repeat; background-size: cover; 
  -webkit-background-clip: text; -webkit-text-fill-color: transparent`),Nf(P,"type",k(a)?"password":"text"),Ye(x,k(a)?"show":"hide")}),Ps(R,()=>k(r),E=>K(r,E)),Ps(P,()=>k(s),E=>K(s,E)),Tt("click",C,()=>K(a,!k(a))),Tt("click",H,h),Tt("click",Q,u),Ee(n,p),Xs()}var lT=Be("<h3>Entry logged!</h3>"),hT=Be('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),dT=Be('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Check again tomorrow.</h4>',1),fT=Be('<div class="overlay svelte-kkv8mu"><!> <button>Return</button></div>'),pT=Be('<br/> <div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3></div>',1),mT=Be('<div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..."></textarea><br/> <button> </button></div>'),gT=Be('<!> <button class="hiddencheck svelte-kkv8mu"></button>',1);function _T(n,e){Ys(e,!1);let t=zt(e,"user",8),r=zt(e,"externalEntry",12,null),s=zt(e,"onSaved",8,()=>{}),o=zt(e,"invert",8),a=new Date;const u=a.getFullYear(),h=a.getMonth(),d=a.getDate();function p(W){return W.toString().padStart(2,"0")}let v=t().uid;t().email?name=t().email.replace("@tracker.app","").charAt(0).toUpperCase()+t().email.replace("@tracker.app","").slice(1):name="Temp";let I=`${u}-${p(h+1)}-${p(d)}`,R=ge(5),V=ge(""),P=ge(!1),C=ge(""),x=ge(!1),F=ge(""),M=ge(""),q=ge(!1),Q=new Date().getHours()<16?"day":"night";function E(W){return o()&&(W=10-W),`hsl(${120*(W/10)}, 70%, 65%)`}function m(){return k(R)/10}async function y(){const W=Hu(Oo,"users",v,"entries",I),ee=await nT(W);console.log(ee.data()),ee.exists()&&ee.data().valueDay&&ee.data().valueNight&&(K(P,!0),K(M,"Check again tomorrow"))}async function T(W){if(k(P)&&!k(q))return;K(x,!0),K(P,!0);const ee=Hu(Oo,"users",v,"entries",W.key);W.period==="day"?(await Qu(ee,{valueDay:k(R),textDay:k(V),timestamp:Date.now()},{merge:!0}),W.filledNight&&K(M,"Check again tomorrow")):(await Qu(ee,{valueNight:k(R),textNight:k(V),timestamp:Date.now()},{merge:!0}),W.filledDay&&K(M,"Check again tomorrow")),console.log("Logged "+W.key+" at "+W.period),K(R,5),K(V,""),s()()}function g(){K(x,!1)}tl(y),Er(()=>Qe(r()),()=>{r()||(console.log("Selection reset to today (at "+Q+")"),r({key:I,period:Q,current:!0,filledDay:!1,filledNight:!1}))}),Er(()=>Qe(r()),()=>{if(r()){let W=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&W?K(P,!0):!r().current&&!W?K(P,!0):r().current&&W?K(P,!0):r().current&&!W&&K(P,!1)}}),Er(()=>(Qe(o()),k(R)),()=>{o()?K(C,k(R)<=0?"celebrate":""):K(C,k(R)>=10?"celebrate":"")}),Er(()=>(Qe(o()),k(R)),()=>{(o()||k(R))&&K(F,E(k(R)))}),el(),Qs();var w=gT(),_=$t(w);{var ae=W=>{var ee=fT(),ce=he(ee);{var Ge=ue=>{var fe=lT();Ee(ue,fe)},Ie=ue=>{var fe=so(),He=$t(fe);{var ot=qe=>{var nt=hT();vc(2),Ee(qe,nt)},je=qe=>{var nt=dT();vc(2),Ee(qe,nt)};ht(He,qe=>{Qe(r()),me(()=>r().period==="night"&&!r().filledDay)?qe(ot):qe(je,!1)},!0)}Ee(ue,fe)};ht(ce,ue=>{Qe(r()),me(()=>r().period==="day"&&!r().filledNight)?ue(Ge):ue(Ie,!1)})}var xe=re(ce,2);xe.__click=g,le(ee),Ee(W,ee)},Te=W=>{var ee=so(),ce=$t(ee);{var Ge=xe=>{var ue=pT(),fe=re($t(ue),2),He=he(fe);He.textContent=`Welcome ${name??""}!`;var ot=re(He,2),je=he(ot,!0);le(ot),le(fe),Ke(()=>{Wt(He,`background: url(${vt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),Ye(je,k(M)||"Viewing past entries")}),Ee(xe,ue)},Ie=xe=>{var ue=mT(),fe=he(ue);fe.textContent=`Welcome ${name??""}!`;var He=re(fe,2),ot=he(He);le(He);var je=re(He,2);oo(je);var qe=re(je,2);kf(qe);var nt=re(qe,3);nt.__click=()=>T(r());var _i=he(nt);le(nt),le(ue),Ke((an,Jr)=>{Wt(fe,`background: url(${vt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),Ye(ot,`Rate your ${Qe(r()),me(()=>r().period==="day"?"day":"night")??""}`),je.disabled=k(P)&&!k(q),qf(je,1,Uf(k(C)),"svelte-kkv8mu"),Wt(je,`--fill-percentage: ${an??""}%; --slider-color: ${k(F)??""}`),nt.disabled=k(P)&&!k(q),Ye(_i,`Save (${Jr??""}/10)`)},[()=>me(m),()=>(k(R),me(()=>k(R).toFixed(1)))]),Ps(je,()=>k(R),an=>K(R,an)),Ps(qe,()=>k(V),an=>K(V,an)),Ee(xe,ue)};ht(ce,xe=>{k(P)&&!k(q)?xe(Ge):xe(Ie,!1)})}Ee(W,ee)};ht(_,W=>{k(x)?W(ae):W(Te,!1)})}var tt=re(_,2);tt.__dblclick=()=>{console.log("Activated override!"),K(q,!k(q))},Ee(n,w),Xs()}Df(["click","dblclick"]);var yT=Be('<div class="day svelte-dw9jm0"><div class="day-number svelte-dw9jm0"> </div> <div class="day-half top-half svelte-dw9jm0"></div> <div class="day-half bottom-half svelte-dw9jm0"></div></div>'),ET=Be("<!> <br/> <i> </i>",1),vT=Be("<!> <br/> <i> </i>",1),TT=Be('<div class="entry-info svelte-dw9jm0"><strong> </strong> <!></div>'),IT=Be('<div class="month-nav svelte-dw9jm0"><button class="nav-btn svelte-dw9jm0" aria-label="Previous month"></button> <p> </p> <button class="nav-btn svelte-dw9jm0" aria-label="Next month"></button></div> <div class="calendar svelte-dw9jm0"></div> <!>',1);function wT(n,e){Ys(e,!1);let t=zt(e,"user",8),r=zt(e,"onSelectEntry",8,T=>{}),s=zt(e,"reloadTrigger",8,0),o=zt(e,"invert",8),a=t().uid,u=ge([]),h=ge(null),d=ge(new Date),p=ge("");function v(T){return T==null?"#fff":`hsl(${120*(T/10)}, 70%, 65%)`}function I(T){return T.toString().padStart(2,"0")}async function R(){console.log("Loaded calendar entries");const T=k(d).getFullYear(),g=k(d).getMonth(),w=new Date,_=new Date(T,g+1,0).getDate();K(p,k(d).toLocaleString("default",{month:"long",year:"numeric"}));const ae=Bv(Oo,"users",a,"entries"),Te=await rT(ae),tt={};Te.forEach(ce=>{tt[ce.id]=ce.data()});const W=[],ee=T===w.getFullYear()&&g===w.getMonth()?w.getDate():_;for(let ce=1;ce<=ee;ce++){const Ge=`${T}-${I(g+1)}-${I(ce)}`,Ie=tt[Ge];W.push({key:Ge,day:ce,filledDay:Ie?.valueDay!=null,filledNight:Ie?.valueNight!=null,valueDay:Ie?.valueDay??null,valueNight:Ie?.valueNight??null,textDay:Ie?.textDay??null,textNight:Ie?.textNight??null,current:T===w.getFullYear()&&g===w.getMonth()&&ce===w.getDate()})}K(u,W)}function V(T){K(h,T),r()(T),console.log("Selected "+T.key)}function P(){const T=new Date(k(d));T.setMonth(T.getMonth()-1),K(d,T),R(),K(h,null)}function C(){const T=new Date,g=new Date(k(d));g.setMonth(g.getMonth()+1),!(g.getFullYear()>T.getFullYear()||g.getFullYear()===T.getFullYear()&&g.getMonth()>T.getMonth())&&(K(d,g),R(),K(h,null))}tl(R),Er(()=>Qe(s()),()=>{s()&&R()}),el(),Qs();var x=IT(),F=$t(x),M=he(F),q=re(M,2),H=he(q,!0);le(q);var Q=re(q,2);le(F);var E=re(F,2);Lf(E,5,()=>k(u),Of,(T,g)=>{var w=yT(),_=he(w),ae=he(_,!0);le(_);var Te=re(_,2),tt=re(Te,2);le(w),Ke((W,ee)=>{Wt(w,(k(g),me(()=>k(g).current?"border: 1.5px solid #333;":""))),Ye(ae,(k(g),me(()=>k(g).day))),Wt(Te,W),Wt(tt,ee)},[()=>(Qe(o()),k(g),Qe(vt),me(()=>!o()&&k(g).valueDay==10?`background: url('${vt}'); background-size: cover;`:o()&&k(g).valueDay==0?`background: url('${vt}'); background-size: cover;`:`background-color: ${v(k(g).valueDay!=null&&!o()?k(g).valueDay:k(g).valueDay!=null?10-k(g).valueDay:null)};`)),()=>(Qe(o()),k(g),Qe(vt),me(()=>!o()&&k(g).valueNight==10?`background: url('${vt}'); background-size: cover;`:o()&&k(g).valueNight==0?`background: url('${vt}'); background-size: cover;`:`background-color: ${v(k(g).valueNight!=null&&!o()?k(g).valueNight:k(g).valueNight!=null?10-k(g).valueNight:null)};`))]),Tt("click",Te,()=>V({...k(g),period:"day"})),Tt("click",tt,()=>V({...k(g),period:"night"})),Ee(T,w)}),le(E);var m=re(E,2);{var y=T=>{var g=TT(),w=he(g),_=he(w);le(w);var ae=re(w,2);{var Te=W=>{var ee=ET(),ce=$t(ee);{var Ge=ue=>{var fe=_c();Ke(()=>Ye(fe,` ${k(h),me(()=>k(h).valueDay)??""}/10`)),Ee(ue,fe)};ht(ce,ue=>{k(h),me(()=>k(h).filledDay)&&ue(Ge)})}var Ie=re(ce,4),xe=he(Ie,!0);le(Ie),Ke(()=>Ye(xe,(k(h),me(()=>k(h).textDay||"No Entry")))),Ee(W,ee)},tt=W=>{var ee=vT(),ce=$t(ee);{var Ge=ue=>{var fe=_c();Ke(()=>Ye(fe,` ${k(h),me(()=>k(h).valueNight)??""}/10`)),Ee(ue,fe)};ht(ce,ue=>{k(h),me(()=>k(h).filledNight)&&ue(Ge)})}var Ie=re(ce,4),xe=he(Ie,!0);le(Ie),Ke(()=>Ye(xe,(k(h),me(()=>k(h).textNight||"No Entry")))),Ee(W,ee)};ht(ae,W=>{k(h),me(()=>k(h).period==="day")?W(Te):W(tt,!1)})}le(g),Ke(W=>Ye(_,`${W??""} ${k(h),me(()=>k(h).period==="day"?"Day":"Night")??""}`),[()=>(k(h),me(()=>new Date(new Date(k(h).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),Ee(T,g)};ht(m,T=>{k(h),me(()=>k(h)&&!(k(h).period==="day"&&!k(h).filledDay&&k(h).current||k(h).period==="night"&&!k(h).filledNight&&k(h).current))&&T(y)})}Ke(T=>{Ye(H,k(p)),Q.disabled=T},[()=>(k(d),me(()=>k(d).getFullYear()===new Date().getFullYear()&&k(d).getMonth()===new Date().getMonth()))]),Tt("click",M,P),Tt("click",Q,C),Ee(n,x),Xs()}var AT=Be(`<div style="display: flex;
  flex-direction: column;
  min-height: 100vh;"><div style="flex-grow: 1;"><!> <!></div> <div style="display: flex;
    justify-content: space-between;
    padding-left: 5%;
    padding-right: 5%;
    margin-bottom: 5%;"><button>Log Out</button> <button>Invert Colors</button></div></div>`);function NT(n,e){Ys(e,!1);let t=ge(null),r=ge(null),s=ge(0),o=ge(!1);Cg(Ks,P=>{K(t,P)});function a(P){K(t,{uid:P.detail.uid})}async function u(){k(t)&&K(o,!k(o))}function h(){K(s,k(s)+1)}function d(){kg(Ks),K(t,null),K(r,null)}function p(P){K(r,P)}Qs();var v=so(),I=$t(v);{var R=P=>{uT(P,{$$events:{loggedin:a}})},V=P=>{var C=AT(),x=he(C),F=he(x);_T(F,{get user(){return k(t)},get externalEntry(){return k(r)},onSaved:h,get invert(){return k(o)}});var M=re(F,2);wT(M,{get user(){return k(t)},onSelectEntry:p,get reloadTrigger(){return k(s)},get invert(){return k(o)}}),le(x);var q=re(x,2),H=he(q),Q=re(H,2);let E;le(q),le(C),Ke(()=>E=Wt(Q,"",E,{"background-color":k(o)?"hsl(0, 70%, 65%)":"hsl(120, 70%, 65%)"})),Tt("click",H,d),Tt("click",Q,u),Ee(P,C)};ht(I,P=>{k(t)?P(V,!1):P(R)})}Ee(n,v),Xs()}export{NT as component};
