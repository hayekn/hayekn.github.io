import{f as Ve,a as ge,c as oo,t as vc}from"../chunks/Dxr1Ij_4.js";import{i as Xs}from"../chunks/jxJGgJgQ.js";import{c as cf,o as xo}from"../chunks/CrpsGFMf.js";import{P as Bi,h as Je,a4 as uf,e as Xu,I as lf,H as hf,t as P,U as df,K as ff,M as pf,O as Tc,Q as ji,i as yr,aa as mf,aF as gf,f as ao,s as _f,c as Dn,aD as Ju,z as yf,aI as _e,af as Ic,ao as Ef,r as Zu,p as vf,aM as Tf,aN as qi,d as el,aO as If,aP as wf,ab as Af,aQ as Rf,aC as Sf,aR as bf,Y as Pf,aS as Cf,aK as kf,l as ye,ag as Df,aT as Vf,A as Js,G as ne,E as ae,F as oe,C as Ke,D as Zs,W,aU as Er,aV as tl,B as $t,v as Ye,aW as Nf,ap as wc}from"../chunks/Bxsz-vti.js";import{s as Xe,e as st,d as Of}from"../chunks/BL4KWbMy.js";import{i as nt,p as zt}from"../chunks/BVnwWrB1.js";import{r as co,s as nl}from"../chunks/BFr2TMnw.js";function Mf(n,e){return e}function Lf(n,e,t){for(var r=n.items,s=[],o=e.length,a=0;a<o;a++)Rf(e[a].e,s,!0);var u=o>0&&s.length===0&&t!==null;if(u){var h=t.parentNode;Sf(h),h.append(t),r.clear(),ht(n,e[0].prev,e[o-1].next)}bf(s,()=>{for(var d=0;d<o;d++){var p=e[d];u||(r.delete(p.k),ht(n,p.prev,p.next)),el(p.e,!u)}})}function xf(n,e,t,r,s,o=null){var a=n,u={flags:e,items:new Map,first:null};{var h=n;a=Je?Bi(uf(h)):h.appendChild(Xu())}Je&&lf();var d=null,p=!1,E=new Map,I=df(()=>{var b=t();return yf(b)?b:b==null?[]:Ju(b)}),R,D;function V(){Ff(D,R,u,E,a,s,e,r,t),o!==null&&(R.length===0?d?Zu(d):d=ao(()=>o(a)):d!==null&&vf(d,()=>{d=null}))}hf(()=>{D??=Pf,R=P(I);var b=R.length;if(p&&b===0)return;p=b===0;let x=!1;if(Je){var F=ff(a)===pf;F!==(b===0)&&(a=Tc(),Bi(a),ji(!1),x=!0)}if(Je){for(var M=null,$,G=0;G<b;G++){if(yr.nodeType===mf&&yr.data===gf){a=yr,x=!0,ji(!1);break}var U=R[G],T=r(U,G);$=uo(yr,u,M,null,U,T,G,s,e,t),u.items.set(T,$),M=$}b>0&&Bi(Tc())}if(Je)b===0&&o&&(d=ao(()=>o(a)));else if(_f()){var m=new Set,y=Dn;for(G=0;G<b;G+=1){U=R[G],T=r(U,G);var v=u.items.get(T)??E.get(T);v?rl(v,U,G):($=uo(null,u,null,null,U,T,G,s,e,t,!0),E.set(T,$)),m.add(T)}for(const[g,w]of u.items)m.has(g)||y.skipped_effects.add(w.e);y.oncommit(V)}else V();x&&ji(!0),P(I)}),Je&&(a=yr)}function Ff(n,e,t,r,s,o,a,u,h){var d=e.length,p=t.items,E=t.first,I=E,R,D=null,V=[],b=[],x,F,M,$;for($=0;$<d;$+=1){if(x=e[$],F=u(x,$),M=p.get(F),M===void 0){var G=r.get(F);if(G!==void 0){r.delete(F),p.set(F,G);var U=D?D.next:I;ht(t,D,G),ht(t,G,U),$i(G,U,s),D=G}else{var T=I?I.e.nodes_start:s;D=uo(T,t,D,D===null?t.first:D.next,x,F,$,o,a,h)}p.set(F,D),V=[],b=[],I=D.next;continue}if(rl(M,x,$),(M.e.f&qi)!==0&&Zu(M.e),M!==I){if(R!==void 0&&R.has(M)){if(V.length<b.length){var m=b[0],y;D=m.prev;var v=V[0],g=V[V.length-1];for(y=0;y<V.length;y+=1)$i(V[y],m,s);for(y=0;y<b.length;y+=1)R.delete(b[y]);ht(t,v.prev,g.next),ht(t,D,v),ht(t,g,m),I=m,D=g,$-=1,V=[],b=[]}else R.delete(M),$i(M,I,s),ht(t,M.prev,M.next),ht(t,M,D===null?t.first:D.next),ht(t,D,M),D=M;continue}for(V=[],b=[];I!==null&&I.k!==F;)(I.e.f&qi)===0&&(R??=new Set).add(I),b.push(I),I=I.next;if(I===null)continue;M=I}V.push(M),D=M,I=M.next}if(I!==null||R!==void 0){for(var w=R===void 0?[]:Ju(R);I!==null;)(I.e.f&qi)===0&&w.push(I),I=I.next;var _=w.length;if(_>0){var ee=d===0?s:null;Lf(t,w,ee)}}n.first=t.first&&t.first.e,n.last=D&&D.e;for(var se of r.values())el(se.e);r.clear()}function rl(n,e,t,r){Ef(n.v,e),n.i=t}function uo(n,e,t,r,s,o,a,u,h,d,p){var E=(h&If)!==0,I=(h&wf)===0,R=E?I?_e(s,!1,!1):Ic(s):s,D=(h&Tf)===0?a:Ic(a),V={i:D,v:R,k:o,a:null,e:null,prev:t,next:r};try{if(n===null){var b=document.createDocumentFragment();b.append(n=Xu())}return V.e=ao(()=>u(n,R,D,d),Je),V.e.prev=t&&t.e,V.e.next=r&&r.e,t===null?p||(e.first=V):(t.next=V,t.e.next=V.e),r!==null&&(r.prev=V,r.e.prev=V.e),V}finally{}}function $i(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==r;){var a=Af(o);s.before(o),o=a}}function ht(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function sl(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=sl(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Uf(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=sl(n))&&(r&&(r+=" "),r+=e);return r}function Bf(n){return typeof n=="object"?Uf(n):n??""}function jf(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Ac(n,e=!1){var t=e?" !important;":";",r="";for(var s in n){var o=n[s];o!=null&&o!==""&&(r+=" "+s+": "+o+t)}return r}function zi(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function qf(n,e){if(e){var t="",r,s;if(Array.isArray(e)?(r=e[0],s=e[1]):r=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,u=!1,h=[];r&&h.push(...Object.keys(r).map(zi)),s&&h.push(...Object.keys(s).map(zi));var d=0,p=-1;const V=n.length;for(var E=0;E<V;E++){var I=n[E];if(u?I==="/"&&n[E-1]==="*"&&(u=!1):o?o===I&&(o=!1):I==="/"&&n[E+1]==="*"?u=!0:I==='"'||I==="'"?o=I:I==="("?a++:I===")"&&a--,!u&&o===!1&&a===0){if(I===":"&&p===-1)p=E;else if(I===";"||E===V-1){if(p!==-1){var R=zi(n.substring(d,p).trim());if(!h.includes(R)){I!==";"&&E++;var D=n.substring(d,E).trim();t+=" "+D+";"}}d=E+1,p=-1}}}}return r&&(t+=Ac(r)),s&&(t+=Ac(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function $f(n,e,t,r,s,o){var a=n.__className;if(Je||a!==t||a===void 0){var u=jf(t,r);(!Je||u!==n.getAttribute("class"))&&(u==null?n.removeAttribute("class"):n.className=u),n.__className=t}return o}function Hi(n,e={},t,r){for(var s in t){var o=t[s];e[s]!==o&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,o,r))}}function Wt(n,e,t,r){var s=n.__style;if(Je||s!==e){var o=qf(e,r);(!Je||o!==n.getAttribute("style"))&&(o==null?n.removeAttribute("style"):n.style.cssText=o),n.__style=e}else r&&(Array.isArray(r)?(Hi(n,t?.[0],r[0]),Hi(n,t?.[1],r[1],"important")):Hi(n,t,r));return r}function Ps(n,e,t=e){var r=new WeakSet;Cf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=Wi(n)?Gi(o):o,t(o),Dn!==null&&r.add(Dn),await kf(),o!==(o=e())){var a=n.selectionStart,u=n.selectionEnd,h=n.value.length;if(n.value=o??"",u!==null){var d=n.value.length;a===u&&u===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(u,d))}}}),(Je&&n.defaultValue!==n.value||ye(e)==null&&n.value)&&(t(Wi(n)?Gi(n.value):n.value),Dn!==null&&r.add(Dn)),Df(()=>{var s=e();if(n===document.activeElement){var o=Vf??Dn;if(r.has(o))return}Wi(n)&&s===Gi(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function Wi(n){var e=n.type;return e==="number"||e==="range"}function Gi(n){return n===""?null:+n}const zf=()=>{};var Rc={};const il=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Hf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},ol={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,E=(o&3)<<4|u>>4;let I=(u&15)<<2|d>>6,R=d&63;h||(R=64,a||(I=64)),r.push(t[p],t[E],t[I],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(il(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Hf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const E=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||E==null)throw new Wf;const I=o<<2|u>>4;if(r.push(I),d!==64){const R=u<<4&240|d>>2;if(r.push(R),E!==64){const D=d<<6&192|E;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Wf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Gf=function(n){const e=il(n);return ol.encodeByteArray(e,!0)},Cs=function(n){return Gf(n).replace(/\./g,"")},al=function(n){try{return ol.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Kf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Qf=()=>Kf().__FIREBASE_DEFAULTS__,Yf=()=>{if(typeof process>"u"||typeof Rc>"u")return;const n=Rc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Xf=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&al(n[1]);return e&&JSON.parse(e)},ei=()=>{try{return zf()||Qf()||Yf()||Xf()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},cl=n=>ei()?.emulatorHosts?.[n],Jf=n=>{const e=cl(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ul=()=>ei()?.config,ll=n=>ei()?.[`_${n}`];class Zf{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Qn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hl(n){return(await fetch(n,{credentials:"include"})).ok}function ep(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Cs(JSON.stringify(t)),Cs(JSON.stringify(a)),""].join(".")}const Sr={};function tp(){const n={prod:[],emulator:[]};for(const e of Object.keys(Sr))Sr[e]?n.emulator.push(e):n.prod.push(e);return n}function np(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Sc=!1;function dl(n,e){if(typeof window>"u"||typeof document>"u"||!Qn(window.location.host)||Sr[n]===e||Sr[n]||Sc)return;Sr[n]=e;function t(I){return`__firebase__banner__${I}`}const r="__firebase__banner",o=tp().prod.length>0;function a(){const I=document.getElementById(r);I&&I.remove()}function u(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function h(I,R){I.setAttribute("width","24"),I.setAttribute("id",R),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function d(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{Sc=!0,a()},I}function p(I,R){I.setAttribute("id",R),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function E(){const I=np(r),R=t("text"),D=document.getElementById(R)||document.createElement("span"),V=t("learnmore"),b=document.getElementById(V)||document.createElement("a"),x=t("preprendIcon"),F=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const M=I.element;u(M),p(b,V);const $=d();h(F,x),M.append(F,D,b,$),document.body.appendChild(M)}o?(D.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function Fe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fe())}function sp(){const n=ei()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ip(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function op(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ap(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cp(){const n=Fe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function up(){return!sp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lp(){try{return typeof indexedDB=="object"}catch{return!1}}function hp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const dp="FirebaseError";class Dt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=dp,Object.setPrototypeOf(this,Dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qr.prototype.create)}}class qr{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?fp(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new Dt(s,u,r)}}function fp(n,e){return n.replace(pp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const pp=/\{\$([^}]+)}/g;function mp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function gn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(bc(o)&&bc(a)){if(!gn(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function bc(n){return n!==null&&typeof n=="object"}function $r(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function vr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Tr(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function gp(n,e){const t=new _p(n,e);return t.subscribe.bind(t)}class _p{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");yp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Ki),s.error===void 0&&(s.error=Ki),s.complete===void 0&&(s.complete=Ki);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ki(){}function He(n){return n&&n._delegate?n._delegate:n}class _n{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const fn="[DEFAULT]";class Ep{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Zf;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Tp(e))try{this.getOrInitializeService({instanceIdentifier:fn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=fn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=fn){return this.instances.has(e)}getOptions(e=fn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:vp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=fn){return this.component?this.component.multipleInstances?e:fn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function vp(n){return n===fn?void 0:n}function Tp(n){return n.instantiationMode==="EAGER"}class Ip{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ep(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Y;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Y||(Y={}));const wp={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},Ap=Y.INFO,Rp={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},Sp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Rp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Fo{constructor(e){this.name=e,this._logLevel=Ap,this._logHandler=Sp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const bp=(n,e)=>e.some(t=>n instanceof t);let Pc,Cc;function Pp(){return Pc||(Pc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Cp(){return Cc||(Cc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fl=new WeakMap,lo=new WeakMap,pl=new WeakMap,Qi=new WeakMap,Uo=new WeakMap;function kp(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Gt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&fl.set(t,n)}).catch(()=>{}),Uo.set(e,n),e}function Dp(n){if(lo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});lo.set(n,e)}let ho={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return lo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||pl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Gt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Vp(n){ho=n(ho)}function Np(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Yi(this),e,...t);return pl.set(r,e.sort?e.sort():[e]),Gt(r)}:Cp().includes(n)?function(...e){return n.apply(Yi(this),e),Gt(fl.get(this))}:function(...e){return Gt(n.apply(Yi(this),e))}}function Op(n){return typeof n=="function"?Np(n):(n instanceof IDBTransaction&&Dp(n),bp(n,Pp())?new Proxy(n,ho):n)}function Gt(n){if(n instanceof IDBRequest)return kp(n);if(Qi.has(n))return Qi.get(n);const e=Op(n);return e!==n&&(Qi.set(n,e),Uo.set(e,n)),e}const Yi=n=>Uo.get(n);function Mp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=Gt(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Gt(a.result),h.oldVersion,h.newVersion,Gt(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const Lp=["get","getKey","getAll","getAllKeys","count"],xp=["put","add","delete","clear"],Xi=new Map;function kc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Xi.get(e))return Xi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=xp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Lp.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[t](...u),s&&h.done]))[0]};return Xi.set(e,o),o}Vp(n=>({...n,get:(e,t,r)=>kc(e,t)||n.get(e,t,r),has:(e,t)=>!!kc(e,t)||n.has(e,t)}));class Fp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Up(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Up(n){return n.getComponent()?.type==="VERSION"}const fo="@firebase/app",Dc="0.14.5";const bt=new Fo("@firebase/app"),Bp="@firebase/app-compat",jp="@firebase/analytics-compat",qp="@firebase/analytics",$p="@firebase/app-check-compat",zp="@firebase/app-check",Hp="@firebase/auth",Wp="@firebase/auth-compat",Gp="@firebase/database",Kp="@firebase/data-connect",Qp="@firebase/database-compat",Yp="@firebase/functions",Xp="@firebase/functions-compat",Jp="@firebase/installations",Zp="@firebase/installations-compat",em="@firebase/messaging",tm="@firebase/messaging-compat",nm="@firebase/performance",rm="@firebase/performance-compat",sm="@firebase/remote-config",im="@firebase/remote-config-compat",om="@firebase/storage",am="@firebase/storage-compat",cm="@firebase/firestore",um="@firebase/ai",lm="@firebase/firestore-compat",hm="firebase",dm="12.5.0";const po="[DEFAULT]",fm={[fo]:"fire-core",[Bp]:"fire-core-compat",[qp]:"fire-analytics",[jp]:"fire-analytics-compat",[zp]:"fire-app-check",[$p]:"fire-app-check-compat",[Hp]:"fire-auth",[Wp]:"fire-auth-compat",[Gp]:"fire-rtdb",[Kp]:"fire-data-connect",[Qp]:"fire-rtdb-compat",[Yp]:"fire-fn",[Xp]:"fire-fn-compat",[Jp]:"fire-iid",[Zp]:"fire-iid-compat",[em]:"fire-fcm",[tm]:"fire-fcm-compat",[nm]:"fire-perf",[rm]:"fire-perf-compat",[sm]:"fire-rc",[im]:"fire-rc-compat",[om]:"fire-gcs",[am]:"fire-gcs-compat",[cm]:"fire-fst",[lm]:"fire-fst-compat",[um]:"fire-vertex","fire-js":"fire-js",[hm]:"fire-js-all"};const ks=new Map,pm=new Map,mo=new Map;function Vc(n,e){try{n.container.addComponent(e)}catch(t){bt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function qn(n){const e=n.name;if(mo.has(e))return bt.debug(`There were multiple attempts to register component ${e}.`),!1;mo.set(e,n);for(const t of ks.values())Vc(t,n);for(const t of pm.values())Vc(t,n);return!0}function Bo(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ze(n){return n==null?!1:n.settings!==void 0}const mm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Kt=new qr("app","Firebase",mm);class gm{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _n("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Kt.create("app-deleted",{appName:this._name})}}const Yn=dm;function ml(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:po,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Kt.create("bad-app-name",{appName:String(s)});if(t||(t=ul()),!t)throw Kt.create("no-options");const o=ks.get(s);if(o){if(gn(t,o.options)&&gn(r,o.config))return o;throw Kt.create("duplicate-app",{appName:s})}const a=new Ip(s);for(const h of mo.values())a.addComponent(h);const u=new gm(t,r,a);return ks.set(s,u),u}function gl(n=po){const e=ks.get(n);if(!e&&n===po&&ul())return ml();if(!e)throw Kt.create("no-app",{appName:n});return e}function Qt(n,e,t){let r=fm[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bt.warn(a.join(" "));return}qn(new _n(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const _m="firebase-heartbeat-database",ym=1,Vr="firebase-heartbeat-store";let Ji=null;function _l(){return Ji||(Ji=Mp(_m,ym,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Vr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Kt.create("idb-open",{originalErrorMessage:n.message})})),Ji}async function Em(n){try{const t=(await _l()).transaction(Vr),r=await t.objectStore(Vr).get(yl(n));return await t.done,r}catch(e){if(e instanceof Dt)bt.warn(e.message);else{const t=Kt.create("idb-get",{originalErrorMessage:e?.message});bt.warn(t.message)}}}async function Nc(n,e){try{const r=(await _l()).transaction(Vr,"readwrite");await r.objectStore(Vr).put(e,yl(n)),await r.done}catch(t){if(t instanceof Dt)bt.warn(t.message);else{const r=Kt.create("idb-set",{originalErrorMessage:t?.message});bt.warn(r.message)}}}function yl(n){return`${n.name}!${n.options.appId}`}const vm=1024,Tm=30;class Im{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Am(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Oc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Tm){const s=Rm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){bt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Oc(),{heartbeatsToSend:t,unsentEntries:r}=wm(this._heartbeatsCache.heartbeats),s=Cs(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return bt.warn(e),""}}}function Oc(){return new Date().toISOString().substring(0,10)}function wm(n,e=vm){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Mc(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Mc(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Am{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lp()?hp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Em(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Nc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Mc(n){return Cs(JSON.stringify({version:2,heartbeats:n})).length}function Rm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Sm(n){qn(new _n("platform-logger",e=>new Fp(e),"PRIVATE")),qn(new _n("heartbeat",e=>new Im(e),"PRIVATE")),Qt(fo,Dc,n),Qt(fo,Dc,"esm2020"),Qt("fire-js","")}Sm("");var bm="firebase",Pm="12.5.0";Qt(bm,Pm,"app");function El(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Cm=El,vl=new qr("auth","Firebase",El());const Ds=new Fo("@firebase/auth");function km(n,...e){Ds.logLevel<=Y.WARN&&Ds.warn(`Auth (${Yn}): ${n}`,...e)}function ys(n,...e){Ds.logLevel<=Y.ERROR&&Ds.error(`Auth (${Yn}): ${n}`,...e)}function at(n,...e){throw jo(n,...e)}function ft(n,...e){return jo(n,...e)}function Tl(n,e,t){const r={...Cm(),[e]:t};return new qr("auth","Firebase",r).create(e,{appName:n.name})}function At(n){return Tl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function jo(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return vl.create(n,...e)}function j(n,e,...t){if(!n)throw jo(e,...t)}function It(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ys(e),new Error(e)}function Pt(n,e){n||It(e)}function go(){return typeof self<"u"&&self.location?.href||""}function Dm(){return Lc()==="http:"||Lc()==="https:"}function Lc(){return typeof self<"u"&&self.location?.protocol||null}function Vm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Dm()||op()||"connection"in navigator)?navigator.onLine:!0}function Nm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class zr{constructor(e,t){this.shortDelay=e,this.longDelay=t,Pt(t>e,"Short delay should be less than long delay!"),this.isMobile=rp()||ap()}get(){return Vm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function qo(n,e){Pt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Il{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;It("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;It("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;It("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Om={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Mm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Lm=new zr(3e4,6e4);function sn(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function on(n,e,t,r,s={}){return wl(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const u=$r({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return ip()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&Qn(n.emulatorConfig.host)&&(d.credentials="include"),Il.fetch()(await Al(n,n.config.apiHost,t,u),d)})}async function wl(n,e,t){n._canInitEmulator=!1;const r={...Om,...e};try{const s=new Fm(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw ds(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const u=o.ok?a.errorMessage:a.error.message,[h,d]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw ds(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw ds(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw ds(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Tl(n,p,d);at(n,p)}}catch(s){if(s instanceof Dt)throw s;at(n,"network-request-failed",{message:String(s)})}}async function Hr(n,e,t,r,s={}){const o=await on(n,e,t,r,s);return"mfaPendingCredential"in o&&at(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function Al(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?qo(n.config,s):`${n.config.apiScheme}://${s}`;return Mm.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function xm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Fm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ft(this.auth,"network-request-failed")),Lm.get())})}}function ds(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ft(n,e,r);return s.customData._tokenResponse=t,s}function xc(n){return n!==void 0&&n.enterprise!==void 0}class Um{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Bm(n,e){return on(n,"GET","/v2/recaptchaConfig",sn(n,e))}async function jm(n,e){return on(n,"POST","/v1/accounts:delete",e)}async function Vs(n,e){return on(n,"POST","/v1/accounts:lookup",e)}function br(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function qm(n,e=!1){const t=He(n),r=await t.getIdToken(e),s=$o(r);j(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:br(Zi(s.auth_time)),issuedAtTime:br(Zi(s.iat)),expirationTime:br(Zi(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Zi(n){return Number(n)*1e3}function $o(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ys("JWT malformed, contained fewer than 3 sections"),null;try{const s=al(t);return s?JSON.parse(s):(ys("Failed to decode base64 JWT payload"),null)}catch(s){return ys("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Fc(n){const e=$o(n);return j(e,"internal-error"),j(typeof e.exp<"u","internal-error"),j(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Nr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Dt&&$m(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function $m({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class zm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class _o{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=br(this.lastLoginAt),this.creationTime=br(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Ns(n){const e=n.auth,t=await n.getIdToken(),r=await Nr(n,Vs(e,{idToken:t}));j(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Rl(s.providerUserInfo):[],a=Wm(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=u?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new _o(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function Hm(n){const e=He(n);await Ns(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Wm(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Rl(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Gm(n,e){const t=await wl(n,{},async()=>{const r=$r({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await Al(n,s,"/v1/token",`key=${o}`),u=await n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:u,body:r};return n.emulatorConfig&&Qn(n.emulatorConfig.host)&&(h.credentials="include"),Il.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Km(n,e){return on(n,"POST","/v2/accounts:revokeToken",sn(n,e))}class xn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){j(e.idToken,"internal-error"),j(typeof e.idToken<"u","internal-error"),j(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Fc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){j(e.length!==0,"internal-error");const t=Fc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await Gm(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new xn;return r&&(j(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(j(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(j(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xn,this.toJSON())}_performRefresh(){return It("not implemented")}}function Ft(n,e){j(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class it{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new zm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new _o(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Nr(this,this.stsTokenManager.getToken(this.auth,e));return j(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qm(this,e)}reload(){return Hm(this)}_assign(e){this!==e&&(j(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new it({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ns(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ze(this.auth.app))return Promise.reject(At(this.auth));const e=await this.getIdToken();return await Nr(this,jm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,u=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:E,emailVerified:I,isAnonymous:R,providerData:D,stsTokenManager:V}=t;j(E&&V,e,"internal-error");const b=xn.fromJSON(this.name,V);j(typeof E=="string",e,"internal-error"),Ft(r,e.name),Ft(s,e.name),j(typeof I=="boolean",e,"internal-error"),j(typeof R=="boolean",e,"internal-error"),Ft(o,e.name),Ft(a,e.name),Ft(u,e.name),Ft(h,e.name),Ft(d,e.name),Ft(p,e.name);const x=new it({uid:E,auth:e,email:s,emailVerified:I,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:u,stsTokenManager:b,createdAt:d,lastLoginAt:p});return D&&Array.isArray(D)&&(x.providerData=D.map(F=>({...F}))),h&&(x._redirectEventId=h),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new xn;s.updateFromServerResponse(t);const o=new it({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ns(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];j(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Rl(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,u=new xn;u.updateFromIdToken(r);const h=new it({uid:s.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new _o(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Uc=new Map;function wt(n){Pt(n instanceof Function,"Expected a class definition");let e=Uc.get(n);return e?(Pt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Uc.set(n,e),e)}class Sl{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Sl.type="NONE";const Bc=Sl;function Es(n,e,t){return`firebase:${n}:${e}:${t}`}class Fn{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=Es(this.userKey,s.apiKey,o),this.fullPersistenceKey=Es("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Vs(this.auth,{idToken:e}).catch(()=>{});return t?it._fromGetAccountInfoResponse(this.auth,t,e):null}return it._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Fn(wt(Bc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||wt(Bc);const a=Es(r,e.config.apiKey,e.name);let u=null;for(const d of t)try{const p=await d._get(a);if(p){let E;if(typeof p=="string"){const I=await Vs(e,{idToken:p}).catch(()=>{});if(!I)break;E=await it._fromGetAccountInfoResponse(e,I,p)}else E=it._fromJSON(e,p);d!==o&&(u=E),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new Fn(o,e,r):(o=h[0],u&&await o._set(a,u.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new Fn(o,e,r))}}function jc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kl(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(bl(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Vl(e))return"Blackberry";if(Nl(e))return"Webos";if(Pl(e))return"Safari";if((e.includes("chrome/")||Cl(e))&&!e.includes("edge/"))return"Chrome";if(Dl(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function bl(n=Fe()){return/firefox\//i.test(n)}function Pl(n=Fe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Cl(n=Fe()){return/crios\//i.test(n)}function kl(n=Fe()){return/iemobile/i.test(n)}function Dl(n=Fe()){return/android/i.test(n)}function Vl(n=Fe()){return/blackberry/i.test(n)}function Nl(n=Fe()){return/webos/i.test(n)}function zo(n=Fe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Qm(n=Fe()){return zo(n)&&!!window.navigator?.standalone}function Ym(){return cp()&&document.documentMode===10}function Ol(n=Fe()){return zo(n)||Dl(n)||Nl(n)||Vl(n)||/windows phone/i.test(n)||kl(n)}function Ml(n,e=[]){let t;switch(n){case"Browser":t=jc(Fe());break;case"Worker":t=`${jc(Fe())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Yn}/${r}`}class Xm{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,u)=>{try{const h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Jm(n,e={}){return on(n,"GET","/v2/passwordPolicy",sn(n,e))}const Zm=6;class eg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Zm,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class tg{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new qc(this),this.idTokenSubscription=new qc(this),this.beforeStateQueue=new Xm(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vl,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=wt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Fn.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Vs(this,{idToken:e}),r=await it._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ze(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===a)&&u?.user&&(r=u.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ns(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Nm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ze(this.app))return Promise.reject(At(this));const t=e?He(e):null;return t&&j(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&j(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ze(this.app)?Promise.reject(At(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ze(this.app)?Promise.reject(At(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Jm(this),t=new eg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new qr("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Km(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&wt(e)||this._popupRedirectResolver;j(t,this,"argument-error"),this.redirectPersistenceManager=await Fn.create(this,[wt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const u=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ml(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Ze(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&km(`Error while retrieving App Check token: ${e.error}`),e?.token}}function wn(n){return He(n)}class qc{constructor(e){this.auth=e,this.observer=null,this.addObserver=gp(t=>this.observer=t)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ti={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ng(n){ti=n}function Ll(n){return ti.loadJS(n)}function rg(){return ti.recaptchaEnterpriseScript}function sg(){return ti.gapiScript}function ig(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class og{constructor(){this.enterprise=new ag}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ag{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const cg="recaptcha-enterprise",xl="NO_RECAPTCHA";class ug{constructor(e){this.type=cg,this.auth=wn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,u)=>{Bm(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{const d=new Um(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{u(h)})})}function s(o,a,u){const h=window.grecaptcha;xc(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(xl)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new og().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(u=>{if(!t&&xc(window.grecaptcha))s(u,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=rg();h.length!==0&&(h+=u),Ll(h).then(()=>{s(u,o,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})}}async function $c(n,e,t,r=!1,s=!1){const o=new ug(n);let a;if(s)a=xl;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const u={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in u){const h=u.phoneEnrollmentInfo.phoneNumber,d=u.phoneEnrollmentInfo.recaptchaToken;Object.assign(u,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in u){const h=u.phoneSignInInfo.recaptchaToken;Object.assign(u,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return u}return r?Object.assign(u,{captchaResp:a}):Object.assign(u,{captchaResponse:a}),Object.assign(u,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(u,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),u}async function yo(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await $c(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await $c(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}function lg(n,e){const t=Bo(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(gn(o,e??{}))return s;at(s,"already-initialized")}return t.initialize({options:e})}function hg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(wt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function dg(n,e,t){const r=wn(n);j(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=Fl(e),{host:a,port:u}=fg(e),h=u===null?"":`:${u}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){j(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),j(gn(d,r.config.emulator)&&gn(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Qn(a)?(hl(`${o}//${a}${h}`),dl("Auth",!0)):pg()}function Fl(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function fg(n){const e=Fl(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:zc(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:zc(a)}}}function zc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function pg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Ho{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return It("not implemented")}_getIdTokenResponse(e){return It("not implemented")}_linkToIdToken(e,t){return It("not implemented")}_getReauthenticationResolver(e){return It("not implemented")}}async function mg(n,e){return on(n,"POST","/v1/accounts:signUp",e)}async function gg(n,e){return Hr(n,"POST","/v1/accounts:signInWithPassword",sn(n,e))}async function _g(n,e){return Hr(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))}async function yg(n,e){return Hr(n,"POST","/v1/accounts:signInWithEmailLink",sn(n,e))}class Or extends Ho{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Or(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Or(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yo(e,t,"signInWithPassword",gg);case"emailLink":return _g(e,{email:this._email,oobCode:this._password});default:at(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yo(e,r,"signUpPassword",mg);case"emailLink":return yg(e,{idToken:t,email:this._email,oobCode:this._password});default:at(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Un(n,e){return Hr(n,"POST","/v1/accounts:signInWithIdp",sn(n,e))}const Eg="http://localhost";class yn extends Ho{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new yn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):at("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new yn(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Un(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Un(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Un(e,t)}buildRequest(){const e={requestUri:Eg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=$r(t)}return e}}function vg(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Tg(n){const e=vr(Tr(n)).link,t=e?vr(Tr(e)).deep_link_id:null,r=vr(Tr(n)).deep_link_id;return(r?vr(Tr(r)).link:null)||r||t||e||n}class Wo{constructor(e){const t=vr(Tr(e)),r=t.apiKey??null,s=t.oobCode??null,o=vg(t.mode??null);j(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Tg(e);try{return new Wo(t)}catch{return null}}}class Xn{constructor(){this.providerId=Xn.PROVIDER_ID}static credential(e,t){return Or._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Wo.parseLink(t);return j(r,"argument-error"),Or._fromEmailAndCode(e,r.code,r.tenantId)}}Xn.PROVIDER_ID="password";Xn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ul{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Wr extends Ul{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ut extends Wr{constructor(){super("facebook.com")}static credential(e){return yn._fromParams({providerId:Ut.PROVIDER_ID,signInMethod:Ut.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ut.credentialFromTaggedObject(e)}static credentialFromError(e){return Ut.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ut.credential(e.oauthAccessToken)}catch{return null}}}Ut.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ut.PROVIDER_ID="facebook.com";class Bt extends Wr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return yn._fromParams({providerId:Bt.PROVIDER_ID,signInMethod:Bt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bt.credentialFromTaggedObject(e)}static credentialFromError(e){return Bt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Bt.credential(t,r)}catch{return null}}}Bt.GOOGLE_SIGN_IN_METHOD="google.com";Bt.PROVIDER_ID="google.com";class jt extends Wr{constructor(){super("github.com")}static credential(e){return yn._fromParams({providerId:jt.PROVIDER_ID,signInMethod:jt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jt.credentialFromTaggedObject(e)}static credentialFromError(e){return jt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jt.credential(e.oauthAccessToken)}catch{return null}}}jt.GITHUB_SIGN_IN_METHOD="github.com";jt.PROVIDER_ID="github.com";class qt extends Wr{constructor(){super("twitter.com")}static credential(e,t){return yn._fromParams({providerId:qt.PROVIDER_ID,signInMethod:qt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return qt.credentialFromTaggedObject(e)}static credentialFromError(e){return qt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return qt.credential(t,r)}catch{return null}}}qt.TWITTER_SIGN_IN_METHOD="twitter.com";qt.PROVIDER_ID="twitter.com";async function Ig(n,e){return Hr(n,"POST","/v1/accounts:signUp",sn(n,e))}class En{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await it._fromIdTokenResponse(e,r,s),a=Hc(r);return new En({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Hc(r);return new En({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Hc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Os extends Dt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Os.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Os(e,t,r,s)}}function Bl(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Os._fromErrorAndOperation(n,o,e,r):o})}async function wg(n,e,t=!1){const r=await Nr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return En._forOperation(n,"link",r)}async function Ag(n,e,t=!1){const{auth:r}=n;if(Ze(r.app))return Promise.reject(At(r));const s="reauthenticate";try{const o=await Nr(n,Bl(r,s,e,n),t);j(o.idToken,r,"internal-error");const a=$o(o.idToken);j(a,r,"internal-error");const{sub:u}=a;return j(n.uid===u,r,"user-mismatch"),En._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&at(r,"user-mismatch"),o}}async function jl(n,e,t=!1){if(Ze(n.app))return Promise.reject(At(n));const r="signIn",s=await Bl(n,r,e),o=await En._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}async function Rg(n,e){return jl(wn(n),e)}async function ql(n){const e=wn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Sg(n,e,t){if(Ze(n.app))return Promise.reject(At(n));const r=wn(n),a=await yo(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ig).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&ql(n),h}),u=await En._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(u.user),u}function bg(n,e,t){return Ze(n.app)?Promise.reject(At(n)):Rg(He(n),Xn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&ql(n),r})}function Pg(n,e,t,r){return He(n).onIdTokenChanged(e,t,r)}function Cg(n,e,t){return He(n).beforeAuthStateChanged(e,t)}function kg(n,e,t,r){return He(n).onAuthStateChanged(e,t,r)}function Dg(n){return He(n).signOut()}const Ms="__sak";class $l{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ms,"1"),this.storage.removeItem(Ms),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const Vg=1e3,Ng=10;class zl extends $l{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ol(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,u,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);Ym()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Ng):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Vg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zl.type="LOCAL";const Og=zl;class Hl extends $l{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Hl.type="SESSION";const Wl=Hl;function Mg(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ni{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ni(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const u=Array.from(a).map(async d=>d(t.origin,o)),h=await Mg(u);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ni.receivers=[];function Go(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Lg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((u,h)=>{const d=Go("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(E){const I=E;if(I.data.eventId===d)switch(I.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(I.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function pt(){return window}function xg(n){pt().location.href=n}function Gl(){return typeof pt().WorkerGlobalScope<"u"&&typeof pt().importScripts=="function"}async function Fg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ug(){return navigator?.serviceWorker?.controller||null}function Bg(){return Gl()?self:null}const Kl="firebaseLocalStorageDb",jg=1,Ls="firebaseLocalStorage",Ql="fbase_key";class Gr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ri(n,e){return n.transaction([Ls],e?"readwrite":"readonly").objectStore(Ls)}function qg(){const n=indexedDB.deleteDatabase(Kl);return new Gr(n).toPromise()}function Eo(){const n=indexedDB.open(Kl,jg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Ls,{keyPath:Ql})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Ls)?e(r):(r.close(),await qg(),e(await Eo()))})})}async function Wc(n,e,t){const r=ri(n,!0).put({[Ql]:e,value:t});return new Gr(r).toPromise()}async function $g(n,e){const t=ri(n,!1).get(e),r=await new Gr(t).toPromise();return r===void 0?null:r.value}function Gc(n,e){const t=ri(n,!0).delete(e);return new Gr(t).toPromise()}const zg=800,Hg=3;class Yl{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Eo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Hg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gl()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ni._getInstance(Bg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Fg(),!this.activeServiceWorker)return;this.sender=new Lg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ug()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Eo();return await Wc(e,Ms,"1"),await Gc(e,Ms),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Wc(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>$g(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Gc(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=ri(s,!1).getAll();return new Gr(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),zg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Yl.type="LOCAL";const Wg=Yl;new zr(3e4,6e4);function Gg(n,e){return e?wt(e):(j(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Ko extends Ho{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Un(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Un(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Un(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Kg(n){return jl(n.auth,new Ko(n),n.bypassAuthState)}function Qg(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),Ag(t,new Ko(n),n.bypassAuthState)}async function Yg(n){const{auth:e,user:t}=n;return j(t,e,"internal-error"),wg(t,new Ko(n),n.bypassAuthState)}class Xl{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(u)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Kg;case"linkViaPopup":case"linkViaRedirect":return Yg;case"reauthViaPopup":case"reauthViaRedirect":return Qg;default:at(this.auth,"internal-error")}}resolve(e){Pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Pt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Xg=new zr(2e3,1e4);class Ln extends Xl{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,Ln.currentPopupAction&&Ln.currentPopupAction.cancel(),Ln.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return j(e,this.auth,"internal-error"),e}async onExecution(){Pt(this.filter.length===1,"Popup operations only handle one event");const e=Go();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ft(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ft(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ln.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ft(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xg.get())};e()}}Ln.currentPopupAction=null;const Jg="pendingRedirect",vs=new Map;class Zg extends Xl{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=vs.get(this.auth._key());if(!e){try{const r=await e_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}vs.set(this.auth._key(),e)}return this.bypassAuthState||vs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function e_(n,e){const t=r_(e),r=n_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function t_(n,e){vs.set(n._key(),e)}function n_(n){return wt(n._redirectPersistence)}function r_(n){return Es(Jg,n.config.apiKey,n.name)}async function s_(n,e,t=!1){if(Ze(n.app))return Promise.reject(At(n));const r=wn(n),s=Gg(r,e),a=await new Zg(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const i_=600*1e3;class o_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!a_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Jl(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ft(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=i_&&this.cachedEventUids.clear(),this.cachedEventUids.has(Kc(e))}saveEventToCache(e){this.cachedEventUids.add(Kc(e)),this.lastProcessedEventTime=Date.now()}}function Kc(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Jl({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function a_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Jl(n);default:return!1}}async function c_(n,e={}){return on(n,"GET","/v1/projects",e)}const u_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,l_=/^https?/;async function h_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await c_(n);for(const t of e)try{if(d_(t))return}catch{}at(n,"unauthorized-domain")}function d_(n){const e=go(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!l_.test(t))return!1;if(u_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const f_=new zr(3e4,6e4);function Qc(){const n=pt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function p_(n){return new Promise((e,t)=>{function r(){Qc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Qc(),t(ft(n,"network-request-failed"))},timeout:f_.get()})}if(pt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(pt().gapi?.load)r();else{const s=ig("iframefcb");return pt()[s]=()=>{gapi.load?r():t(ft(n,"network-request-failed"))},Ll(`${sg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw Ts=null,e})}let Ts=null;function m_(n){return Ts=Ts||p_(n),Ts}const g_=new zr(5e3,15e3),__="__/auth/iframe",y_="emulator/auth/iframe",E_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},v_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function T_(n){const e=n.config;j(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?qo(e,y_):`https://${n.config.authDomain}/${__}`,r={apiKey:e.apiKey,appName:n.name,v:Yn},s=v_.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${$r(r).slice(1)}`}async function I_(n){const e=await m_(n),t=pt().gapi;return j(t,n,"internal-error"),e.open({where:document.body,url:T_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:E_,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=ft(n,"network-request-failed"),u=pt().setTimeout(()=>{o(a)},g_.get());function h(){pt().clearTimeout(u),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const w_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},A_=500,R_=600,S_="_blank",b_="http://localhost";class Yc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function P_(n,e,t,r=A_,s=R_){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let u="";const h={...w_,width:r.toString(),height:s.toString(),top:o,left:a},d=Fe().toLowerCase();t&&(u=Cl(d)?S_:t),bl(d)&&(e=e||b_,h.scrollbars="yes");const p=Object.entries(h).reduce((I,[R,D])=>`${I}${R}=${D},`,"");if(Qm(d)&&u!=="_self")return C_(e||"",u),new Yc(null);const E=window.open(e||"",u,p);j(E,n,"popup-blocked");try{E.focus()}catch{}return new Yc(E)}function C_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const k_="__/auth/handler",D_="emulator/auth/handler",V_=encodeURIComponent("fac");async function Xc(n,e,t,r,s,o){j(n.config.authDomain,n,"auth-domain-config-required"),j(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Yn,eventId:s};if(e instanceof Ul){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",mp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,E]of Object.entries({}))a[p]=E}if(e instanceof Wr){const p=e.getScopes().filter(E=>E!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const u=a;for(const p of Object.keys(u))u[p]===void 0&&delete u[p];const h=await n._getAppCheckToken(),d=h?`#${V_}=${encodeURIComponent(h)}`:"";return`${N_(n)}?${$r(u).slice(1)}${d}`}function N_({config:n}){return n.emulator?qo(n,D_):`https://${n.authDomain}/${k_}`}const eo="webStorageSupport";class O_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wl,this._completeRedirectFn=s_,this._overrideRedirectResult=t_}async _openPopup(e,t,r,s){Pt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await Xc(e,t,r,go(),s);return P_(e,o,Go())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await Xc(e,t,r,go(),s);return xg(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(Pt(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await I_(e),r=new o_(e);return t.register("authEvent",s=>(j(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(eo,{type:eo},s=>{const o=s?.[0]?.[eo];o!==void 0&&t(!!o),at(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=h_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ol()||Pl()||zo()}}const M_=O_;var Jc="@firebase/auth",Zc="1.11.1";class L_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function x_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function F_(n){qn(new _n("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;j(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ml(n)},d=new tg(r,s,o,h);return hg(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),qn(new _n("auth-internal",e=>{const t=wn(e.getProvider("auth").getImmediate());return(r=>new L_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Qt(Jc,Zc,x_(n)),Qt(Jc,Zc,"esm2020")}const U_=300,B_=ll("authIdTokenMaxAge")||U_;let eu=null;const j_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>B_)return;const s=t?.token;eu!==s&&(eu=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function q_(n=gl()){const e=Bo(n,"auth");if(e.isInitialized())return e.getImmediate();const t=lg(n,{popupRedirectResolver:M_,persistence:[Wg,Og,Wl]}),r=ll("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=j_(o.toString());Cg(t,a,()=>a(t.currentUser)),Pg(t,u=>a(u))}}const s=cl("auth");return s&&dg(t,`http://${s}`),t}function $_(){return document.getElementsByTagName("head")?.[0]??document}ng({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=ft("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",$_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});F_("Browser");var tu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Yt,Zl;(function(){var n;function e(T,m){function y(){}y.prototype=m.prototype,T.F=m.prototype,T.prototype=new y,T.prototype.constructor=T,T.D=function(v,g,w){for(var _=Array(arguments.length-2),ee=2;ee<arguments.length;ee++)_[ee-2]=arguments[ee];return m.prototype[g].apply(v,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,m,y){y||(y=0);const v=Array(16);if(typeof m=="string")for(var g=0;g<16;++g)v[g]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(g=0;g<16;++g)v[g]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=T.g[0],y=T.g[1],g=T.g[2];let w=T.g[3],_;_=m+(w^y&(g^w))+v[0]+3614090360&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+v[1]+3905402710&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+v[2]+606105819&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+v[3]+3250441966&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(w^y&(g^w))+v[4]+4118548399&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+v[5]+1200080426&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+v[6]+2821735955&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+v[7]+4249261313&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(w^y&(g^w))+v[8]+1770035416&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+v[9]+2336552879&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+v[10]+4294925233&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+v[11]+2304563134&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(w^y&(g^w))+v[12]+1804603682&4294967295,m=y+(_<<7&4294967295|_>>>25),_=w+(g^m&(y^g))+v[13]+4254626195&4294967295,w=m+(_<<12&4294967295|_>>>20),_=g+(y^w&(m^y))+v[14]+2792965006&4294967295,g=w+(_<<17&4294967295|_>>>15),_=y+(m^g&(w^m))+v[15]+1236535329&4294967295,y=g+(_<<22&4294967295|_>>>10),_=m+(g^w&(y^g))+v[1]+4129170786&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+v[6]+3225465664&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+v[11]+643717713&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+v[0]+3921069994&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(g^w&(y^g))+v[5]+3593408605&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+v[10]+38016083&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+v[15]+3634488961&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+v[4]+3889429448&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(g^w&(y^g))+v[9]+568446438&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+v[14]+3275163606&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+v[3]+4107603335&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+v[8]+1163531501&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(g^w&(y^g))+v[13]+2850285829&4294967295,m=y+(_<<5&4294967295|_>>>27),_=w+(y^g&(m^y))+v[2]+4243563512&4294967295,w=m+(_<<9&4294967295|_>>>23),_=g+(m^y&(w^m))+v[7]+1735328473&4294967295,g=w+(_<<14&4294967295|_>>>18),_=y+(w^m&(g^w))+v[12]+2368359562&4294967295,y=g+(_<<20&4294967295|_>>>12),_=m+(y^g^w)+v[5]+4294588738&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+v[8]+2272392833&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+v[11]+1839030562&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+v[14]+4259657740&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(y^g^w)+v[1]+2763975236&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+v[4]+1272893353&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+v[7]+4139469664&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+v[10]+3200236656&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(y^g^w)+v[13]+681279174&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+v[0]+3936430074&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+v[3]+3572445317&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+v[6]+76029189&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(y^g^w)+v[9]+3654602809&4294967295,m=y+(_<<4&4294967295|_>>>28),_=w+(m^y^g)+v[12]+3873151461&4294967295,w=m+(_<<11&4294967295|_>>>21),_=g+(w^m^y)+v[15]+530742520&4294967295,g=w+(_<<16&4294967295|_>>>16),_=y+(g^w^m)+v[2]+3299628645&4294967295,y=g+(_<<23&4294967295|_>>>9),_=m+(g^(y|~w))+v[0]+4096336452&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+v[7]+1126891415&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+v[14]+2878612391&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+v[5]+4237533241&4294967295,y=g+(_<<21&4294967295|_>>>11),_=m+(g^(y|~w))+v[12]+1700485571&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+v[3]+2399980690&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+v[10]+4293915773&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+v[1]+2240044497&4294967295,y=g+(_<<21&4294967295|_>>>11),_=m+(g^(y|~w))+v[8]+1873313359&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+v[15]+4264355552&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+v[6]+2734768916&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+v[13]+1309151649&4294967295,y=g+(_<<21&4294967295|_>>>11),_=m+(g^(y|~w))+v[4]+4149444226&4294967295,m=y+(_<<6&4294967295|_>>>26),_=w+(y^(m|~g))+v[11]+3174756917&4294967295,w=m+(_<<10&4294967295|_>>>22),_=g+(m^(w|~y))+v[2]+718787259&4294967295,g=w+(_<<15&4294967295|_>>>17),_=y+(w^(g|~m))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+m&4294967295,T.g[1]=T.g[1]+(g+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+g&4294967295,T.g[3]=T.g[3]+w&4294967295}r.prototype.v=function(T,m){m===void 0&&(m=T.length);const y=m-this.blockSize,v=this.C;let g=this.h,w=0;for(;w<m;){if(g==0)for(;w<=y;)s(this,T,w),w+=this.blockSize;if(typeof T=="string"){for(;w<m;)if(v[g++]=T.charCodeAt(w++),g==this.blockSize){s(this,v),g=0;break}}else for(;w<m;)if(v[g++]=T[w++],g==this.blockSize){s(this,v),g=0;break}}this.h=g,this.o+=m},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var m=1;m<T.length-8;++m)T[m]=0;m=this.o*8;for(var y=T.length-8;y<T.length;++y)T[y]=m&255,m/=256;for(this.v(T),T=Array(16),m=0,y=0;y<4;++y)for(let v=0;v<32;v+=8)T[m++]=this.g[y]>>>v&255;return T};function o(T,m){var y=u;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=m(T)}function a(T,m){this.h=m;const y=[];let v=!0;for(let g=T.length-1;g>=0;g--){const w=T[g]|0;v&&w==m||(y[g]=w,v=!1)}this.g=y}var u={};function h(T){return-128<=T&&T<128?o(T,function(m){return new a([m|0],m<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return E;if(T<0)return b(d(-T));const m=[];let y=1;for(let v=0;T>=y;v++)m[v]=T/y|0,y*=4294967296;return new a(m,0)}function p(T,m){if(T.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(T.charAt(0)=="-")return b(p(T.substring(1),m));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(m,8));let v=E;for(let w=0;w<T.length;w+=8){var g=Math.min(8,T.length-w);const _=parseInt(T.substring(w,w+g),m);g<8?(g=d(Math.pow(m,g)),v=v.j(g).add(d(_))):(v=v.j(y),v=v.add(d(_)))}return v}var E=h(0),I=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(V(this))return-b(this).m();let T=0,m=1;for(let y=0;y<this.g.length;y++){const v=this.i(y);T+=(v>=0?v:4294967296+v)*m,m*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(D(this))return"0";if(V(this))return"-"+b(this).toString(T);const m=d(Math.pow(T,6));var y=this;let v="";for(;;){const g=$(y,m).g;y=x(y,g.j(m));let w=((y.g.length>0?y.g[0]:y.h)>>>0).toString(T);if(y=g,D(y))return w+v;for(;w.length<6;)w="0"+w;v=w+v}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function D(T){if(T.h!=0)return!1;for(let m=0;m<T.g.length;m++)if(T.g[m]!=0)return!1;return!0}function V(T){return T.h==-1}n.l=function(T){return T=x(this,T),V(T)?-1:D(T)?0:1};function b(T){const m=T.g.length,y=[];for(let v=0;v<m;v++)y[v]=~T.g[v];return new a(y,~T.h).add(I)}n.abs=function(){return V(this)?b(this):this},n.add=function(T){const m=Math.max(this.g.length,T.g.length),y=[];let v=0;for(let g=0;g<=m;g++){let w=v+(this.i(g)&65535)+(T.i(g)&65535),_=(w>>>16)+(this.i(g)>>>16)+(T.i(g)>>>16);v=_>>>16,w&=65535,_&=65535,y[g]=_<<16|w}return new a(y,y[y.length-1]&-2147483648?-1:0)};function x(T,m){return T.add(b(m))}n.j=function(T){if(D(this)||D(T))return E;if(V(this))return V(T)?b(this).j(b(T)):b(b(this).j(T));if(V(T))return b(this.j(b(T)));if(this.l(R)<0&&T.l(R)<0)return d(this.m()*T.m());const m=this.g.length+T.g.length,y=[];for(var v=0;v<2*m;v++)y[v]=0;for(v=0;v<this.g.length;v++)for(let g=0;g<T.g.length;g++){const w=this.i(v)>>>16,_=this.i(v)&65535,ee=T.i(g)>>>16,se=T.i(g)&65535;y[2*v+2*g]+=_*se,F(y,2*v+2*g),y[2*v+2*g+1]+=w*se,F(y,2*v+2*g+1),y[2*v+2*g+1]+=_*ee,F(y,2*v+2*g+1),y[2*v+2*g+2]+=w*ee,F(y,2*v+2*g+2)}for(T=0;T<m;T++)y[T]=y[2*T+1]<<16|y[2*T];for(T=m;T<2*m;T++)y[T]=0;return new a(y,0)};function F(T,m){for(;(T[m]&65535)!=T[m];)T[m+1]+=T[m]>>>16,T[m]&=65535,m++}function M(T,m){this.g=T,this.h=m}function $(T,m){if(D(m))throw Error("division by zero");if(D(T))return new M(E,E);if(V(T))return m=$(b(T),m),new M(b(m.g),b(m.h));if(V(m))return m=$(T,b(m)),new M(b(m.g),m.h);if(T.g.length>30){if(V(T)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var y=I,v=m;v.l(T)<=0;)y=G(y),v=G(v);var g=U(y,1),w=U(v,1);for(v=U(v,2),y=U(y,2);!D(v);){var _=w.add(v);_.l(T)<=0&&(g=g.add(y),w=_),v=U(v,1),y=U(y,1)}return m=x(T,g.j(m)),new M(g,m)}for(g=E;T.l(m)>=0;){for(y=Math.max(1,Math.floor(T.m()/m.m())),v=Math.ceil(Math.log(y)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),w=d(y),_=w.j(m);V(_)||_.l(T)>0;)y-=v,w=d(y),_=w.j(m);D(w)&&(w=I),g=g.add(w),T=x(T,_)}return new M(g,T)}n.B=function(T){return $(this,T).h},n.and=function(T){const m=Math.max(this.g.length,T.g.length),y=[];for(let v=0;v<m;v++)y[v]=this.i(v)&T.i(v);return new a(y,this.h&T.h)},n.or=function(T){const m=Math.max(this.g.length,T.g.length),y=[];for(let v=0;v<m;v++)y[v]=this.i(v)|T.i(v);return new a(y,this.h|T.h)},n.xor=function(T){const m=Math.max(this.g.length,T.g.length),y=[];for(let v=0;v<m;v++)y[v]=this.i(v)^T.i(v);return new a(y,this.h^T.h)};function G(T){const m=T.g.length+1,y=[];for(let v=0;v<m;v++)y[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(y,T.h)}function U(T,m){const y=m>>5;m%=32;const v=T.g.length-y,g=[];for(let w=0;w<v;w++)g[w]=m>0?T.i(w+y)>>>m|T.i(w+y+1)<<32-m:T.i(w+y);return new a(g,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Zl=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Yt=a}).apply(typeof tu<"u"?tu:typeof self<"u"?self:typeof window<"u"?window:{});var fs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var eh,Ir,th,Is,vo,nh,rh,sh;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof fs=="object"&&fs];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var A=i[f];if(!(A in l))break e;l=l[A]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&e(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function p(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function E(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,A,S){for(var N=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)N[Q-2]=arguments[Q];return c.prototype[A].apply(f,N)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function R(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function D(i,c){for(let f=1;f<arguments.length;f++){const A=arguments[f];var l=typeof A;if(l=l!="object"?l:A?Array.isArray(A)?"array":l:"null",l=="array"||l=="object"&&typeof A.length=="number"){l=i.length||0;const S=A.length||0;i.length=l+S;for(let N=0;N<S;N++)i[l+N]=A[N]}else i.push(A)}}class V{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function b(i){a.setTimeout(()=>{throw i},0)}function x(){var i=T;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class F{constructor(){this.h=this.g=null}add(c,l){const f=M.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var M=new V(()=>new $,i=>i.reset());class ${constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let G,U=!1,T=new F,m=()=>{const i=Promise.resolve(void 0);G=()=>{i.then(y)}};function y(){for(var i;i=x();){try{i.h.call(i.g)}catch(l){b(l)}var c=M;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}U=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function g(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}g.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function _(i){return/^[\s\xa0]*$/.test(i)}function ee(i,c){g.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(ee,g),ee.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&ee.Z.h.call(this)},ee.prototype.h=function(){ee.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var se="closure_listenable_"+(Math.random()*1e6|0),Ne=0;function K(i,c,l,f,A){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=A,this.key=++Ne,this.da=this.fa=!1}function te(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function he(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function Qe(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function Ie(i){const c={};for(const l in i)c[l]=i[l];return c}const Ue="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function de(i,c){let l,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(l in f)i[l]=f[l];for(let S=0;S<Ue.length;S++)l=Ue[S],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function pe(i){this.src=i,this.g={},this.h=0}pe.prototype.add=function(i,c,l,f,A){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const N=ct(i,c,f,A);return N>-1?(c=i[N],l||(c.fa=!1)):(c=new K(c,this.src,S,!!f,A),c.fa=l,i.push(c)),c};function We(i,c){const l=c.type;if(l in i.g){var f=i.g[l],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=A>=0)&&Array.prototype.splice.call(f,A,1),S&&(te(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function ct(i,c,l,f){for(let A=0;A<i.length;++A){const S=i[A];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return A}return-1}var qe="closure_lm_"+(Math.random()*1e6|0),$e={};function rt(i,c,l,f,A){if(Array.isArray(c)){for(let S=0;S<c.length;S++)rt(i,c[S],l,f,A);return null}return l=Ra(l),i&&i[se]?i.J(c,l,u(f)?!!f.capture:!1,A):Ei(i,c,l,!1,f,A)}function Ei(i,c,l,f,A,S){if(!c)throw Error("Invalid event type");const N=u(A)?!!A.capture:!!A;let Q=Ti(i);if(Q||(i[qe]=Q=new pe(i)),l=Q.add(c,l,f,N,S),l.proxy)return l;if(f=an(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)w||(A=N),A===void 0&&(A=!1),i.addEventListener(c.toString(),f,A);else if(i.attachEvent)i.attachEvent(Aa(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function an(){function i(l){return c.call(i.src,i.listener,l)}const c=Od;return i}function Zr(i,c,l,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Zr(i,c[S],l,f,A);else f=u(f)?!!f.capture:!!f,l=Ra(l),i&&i[se]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],l=ct(c,l,f,A),l>-1&&(te(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Ti(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ct(c,l,f,A)),(l=i>-1?c[i]:null)&&vi(l))}function vi(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[se])We(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(Aa(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=Ti(c))?(We(l,i),l.h==0&&(l.src=null,c[qe]=null)):te(i)}}}function Aa(i){return i in $e?$e[i]:$e[i]="on"+i}function Od(i,c){if(i.da)i=!0;else{c=new ee(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&vi(i),i=l.call(f,c)}return i}function Ti(i){return i=i[qe],i instanceof pe?i:null}var Ii="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ra(i){return typeof i=="function"?i:(i[Ii]||(i[Ii]=function(c){return i.handleEvent(c)}),i[Ii])}function Oe(){v.call(this),this.i=new pe(this),this.M=this,this.G=null}E(Oe,v),Oe.prototype[se]=!0,Oe.prototype.removeEventListener=function(i,c,l,f){Zr(this,i,c,l,f)};function Be(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new g(c,i);else if(c instanceof g)c.target=c.target||i;else{var A=c;c=new g(f,i),de(c,A)}A=!0;let S,N;if(l)for(N=l.length-1;N>=0;N--)S=c.g=l[N],A=es(S,f,!0,c)&&A;if(S=c.g=i,A=es(S,f,!0,c)&&A,A=es(S,f,!1,c)&&A,l)for(N=0;N<l.length;N++)S=c.g=l[N],A=es(S,f,!1,c)&&A}Oe.prototype.N=function(){if(Oe.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)te(l[f]);delete i.g[c],i.h--}}this.G=null},Oe.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},Oe.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function es(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let S=0;S<c.length;++S){const N=c[S];if(N&&!N.da&&N.capture==l){const Q=N.listener,we=N.ha||N.src;N.fa&&We(i.i,N),A=Q.call(we,f)!==!1&&A}}return A&&!f.defaultPrevented}function Md(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Sa(i){i.g=Md(()=>{i.g=null,i.i&&(i.i=!1,Sa(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Ld extends v{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Sa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function nr(i){v.call(this),this.h=i,this.g={}}E(nr,v);var ba=[];function Pa(i){he(i.g,function(c,l){this.g.hasOwnProperty(l)&&vi(c)},i),i.g={}}nr.prototype.N=function(){nr.Z.N.call(this),Pa(this)},nr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wi=a.JSON.stringify,xd=a.JSON.parse,Fd=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Ca(){}function ka(){}var rr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ai(){g.call(this,"d")}E(Ai,g);function Ri(){g.call(this,"c")}E(Ri,g);var cn={},Da=null;function ts(){return Da=Da||new Oe}cn.Ia="serverreachability";function Va(i){g.call(this,cn.Ia,i)}E(Va,g);function sr(i){const c=ts();Be(c,new Va(c))}cn.STAT_EVENT="statevent";function Na(i,c){g.call(this,cn.STAT_EVENT,i),this.stat=c}E(Na,g);function je(i){const c=ts();Be(c,new Na(c,i))}cn.Ja="timingevent";function Oa(i,c){g.call(this,cn.Ja,i),this.size=c}E(Oa,g);function ir(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function or(){this.g=!0}or.prototype.ua=function(){this.g=!1};function Ud(i,c,l,f,A,S){i.info(function(){if(i.g)if(S){var N="",Q=S.split("&");for(let ie=0;ie<Q.length;ie++){var we=Q[ie].split("=");if(we.length>1){const be=we[0];we=we[1];const lt=be.split("_");N=lt.length>=2&&lt[1]=="type"?N+(be+"="+we+"&"):N+(be+"=redacted&")}}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+l+`
`+N})}function Bd(i,c,l,f,A,S,N){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+l+`
`+S+" "+N})}function Pn(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+qd(i,l)+(f?" "+f:"")})}function jd(i,c){i.info(function(){return"TIMEOUT: "+c})}or.prototype.info=function(){};function qd(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var l=S[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var A=f[0];if(A!="noop"&&A!="stop"&&A!="close")for(let N=1;N<f.length;N++)f[N]=""}}}}return wi(S)}catch{return c}}var ns={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ma={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},La;function Si(){}E(Si,Ca),Si.prototype.g=function(){return new XMLHttpRequest},La=new Si;function ar(i){return encodeURIComponent(String(i))}function $d(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Vt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new nr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new xa}function xa(){this.i=null,this.g="",this.h=!1}var Fa={},bi={};function Pi(i,c,l){i.M=1,i.A=ss(ut(c)),i.u=l,i.R=!0,Ua(i,null)}function Ua(i,c){i.F=Date.now(),rs(i),i.B=ut(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),Ja(l.i,"t",f),i.C=0,l=i.j.L,i.h=new xa,i.g=gc(i.j,l?c:null,!i.u),i.P>0&&(i.O=new Ld(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var A="readystatechange";Array.isArray(A)||(A&&(ba[0]=A.toString()),A=ba);for(let S=0;S<A.length;S++){const N=rt(l,A[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=i.J?Ie(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),sr(),Ud(i.i,i.v,i.B,i.l,i.S,i.u)}Vt.prototype.ba=function(i){i=i.target;const c=this.O;c&&Mt(i)==3?c.j():this.Y(i)},Vt.prototype.Y=function(i){try{if(i==this.g)e:{const Q=Mt(this.g),we=this.g.ya(),ie=this.g.ca();if(!(Q<3)&&(Q!=3||this.g&&(this.h.h||this.g.la()||ic(this.g)))){this.K||Q!=4||we==7||(we==8||ie<=0?sr(3):sr(2)),Ci(this);var c=this.g.ca();this.X=c;var l=zd(this);if(this.o=c==200,Bd(this.i,this.v,this.B,this.l,this.S,Q,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,A=this.g;if((f=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(f)){var S=f;break t}}S=null}if(i=S)Pn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ki(this,i);else{this.o=!1,this.m=3,je(12),un(this),cr(this);break e}}if(this.R){i=!0;let be;for(;!this.K&&this.C<l.length;)if(be=Hd(this,l),be==bi){Q==4&&(this.m=4,je(14),i=!1),Pn(this.i,this.l,null,"[Incomplete Response]");break}else if(be==Fa){this.m=4,je(15),Pn(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Pn(this.i,this.l,be,null),ki(this,be);if(Ba(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Q!=4||l.length!=0||this.h.h||(this.m=1,je(16),i=!1),this.o=this.o&&i,!i)Pn(this.i,this.l,l,"[Invalid Chunked Response]"),un(this),cr(this);else if(l.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),Fi(N),N.P=!0,je(11))}}else Pn(this.i,this.l,l,null),ki(this,l);Q==4&&un(this),this.o&&!this.K&&(Q==4?dc(this.j,this):(this.o=!1,rs(this)))}else of(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,je(12)):(this.m=0,je(13)),un(this),cr(this)}}}catch{}finally{}};function zd(i){if(!Ba(i))return i.g.la();const c=ic(i.g);if(c==="")return"";let l="";const f=c.length,A=Mt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return un(i),cr(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,l+=i.h.i.decode(c[S],{stream:!(A&&S==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function Ba(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Hd(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?bi:(l=Number(c.substring(l,f)),isNaN(l)?Fa:(f+=1,f+l>c.length?bi:(c=c.slice(f,f+l),i.C=f+l,c)))}Vt.prototype.cancel=function(){this.K=!0,un(this)};function rs(i){i.T=Date.now()+i.H,ja(i,i.H)}function ja(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=ir(d(i.aa,i),c)}function Ci(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Vt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(jd(this.i,this.B),this.M!=2&&(sr(),je(17)),un(this),this.m=2,cr(this)):ja(this,this.T-i)};function cr(i){i.j.I==0||i.K||dc(i.j,i)}function un(i){Ci(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Pa(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function ki(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||Di(l.h,i))){if(!i.L&&Di(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)us(l),as(l);else break e;xi(l),je(18)}}else l.xa=A[1],0<l.xa-l.K&&A[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=ir(d(l.Va,l),6e3));za(l.h)<=1&&l.ta&&(l.ta=void 0)}else hn(l,11)}else if((i.L||l.g==i)&&us(l),!_(c))for(A=l.Ba.g.parse(c),c=0;c<A.length;c++){let ie=A[c];const be=ie[0];if(!(be<=l.K))if(l.K=be,ie=ie[1],l.I==2)if(ie[0]=="c"){l.M=ie[1],l.ba=ie[2];const lt=ie[3];lt!=null&&(l.ka=lt,l.j.info("VER="+l.ka));const dn=ie[4];dn!=null&&(l.za=dn,l.j.info("SVER="+l.za));const Lt=ie[5];Lt!=null&&typeof Lt=="number"&&Lt>0&&(f=1.5*Lt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const xt=i.g;if(xt){const hs=xt.g?xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hs){var S=f.h;S.g||hs.indexOf("spdy")==-1&&hs.indexOf("quic")==-1&&hs.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Vi(S,S.h),S.h=null))}if(f.G){const Ui=xt.g?xt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ui&&(f.wa=Ui,ce(f.J,f.G,Ui))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var N=i;if(f.na=mc(f,f.L?f.ba:null,f.W),N.L){Ha(f.h,N);var Q=N,we=f.O;we&&(Q.H=we),Q.D&&(Ci(Q),rs(Q)),f.g=N}else lc(f);l.i.length>0&&cs(l)}else ie[0]!="stop"&&ie[0]!="close"||hn(l,7);else l.I==3&&(ie[0]=="stop"||ie[0]=="close"?ie[0]=="stop"?hn(l,7):Li(l):ie[0]!="noop"&&l.l&&l.l.qa(ie),l.A=0)}}sr(4)}catch{}}var Wd=class{constructor(i,c){this.g=i,this.map=c}};function qa(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $a(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function za(i){return i.h?1:i.g?i.g.size:0}function Di(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Vi(i,c){i.g?i.g.add(c):i.h=c}function Ha(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}qa.prototype.cancel=function(){if(this.i=Wa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Wa(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return R(i.i)}var Ga=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gd(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let A,S=null;f>=0?(A=i[l].substring(0,f),S=i[l].substring(f+1)):A=i[l],c(A,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Nt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Nt?(this.l=i.l,ur(this,i.j),this.o=i.o,this.g=i.g,lr(this,i.u),this.h=i.h,Ni(this,Za(i.i)),this.m=i.m):i&&(c=String(i).match(Ga))?(this.l=!1,ur(this,c[1]||"",!0),this.o=hr(c[2]||""),this.g=hr(c[3]||"",!0),lr(this,c[4]),this.h=hr(c[5]||"",!0),Ni(this,c[6]||"",!0),this.m=hr(c[7]||"")):(this.l=!1,this.i=new fr(null,this.l))}Nt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(dr(c,Ka,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(dr(c,Ka,!0),"@"),i.push(ar(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(dr(l,l.charAt(0)=="/"?Yd:Qd,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",dr(l,Jd)),i.join("")},Nt.prototype.resolve=function(i){const c=ut(this);let l=!!i.j;l?ur(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)lr(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var A=c.h.lastIndexOf("/");A!=-1&&(f=c.h.slice(0,A+1)+f)}if(A=f,A==".."||A==".")f="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){f=A.lastIndexOf("/",0)==0,A=A.split("/");const S=[];for(let N=0;N<A.length;){const Q=A[N++];Q=="."?f&&N==A.length&&S.push(""):Q==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&N==A.length&&S.push("")):(S.push(Q),f=!0)}f=S.join("/")}else f=A}return l?c.h=f:l=i.i.toString()!=="",l?Ni(c,Za(i.i)):l=!!i.m,l&&(c.m=i.m),c};function ut(i){return new Nt(i)}function ur(i,c,l){i.j=l?hr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function lr(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Ni(i,c,l){c instanceof fr?(i.i=c,Zd(i.i,i.l)):(l||(c=dr(c,Xd)),i.i=new fr(c,i.l))}function ce(i,c,l){i.i.set(c,l)}function ss(i){return ce(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function hr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function dr(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,Kd),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Kd(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Ka=/[#\/\?@]/g,Qd=/[#\?:]/g,Yd=/[#\?]/g,Xd=/[#\?@]/g,Jd=/#/g;function fr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function ln(i){i.g||(i.g=new Map,i.h=0,i.i&&Gd(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=fr.prototype,n.add=function(i,c){ln(this),this.i=null,i=Cn(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function Qa(i,c){ln(i),c=Cn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Ya(i,c){return ln(i),c=Cn(i,c),i.g.has(c)}n.forEach=function(i,c){ln(this),this.g.forEach(function(l,f){l.forEach(function(A){i.call(c,A,f,this)},this)},this)};function Xa(i,c){ln(i);let l=[];if(typeof c=="string")Ya(i,c)&&(l=l.concat(i.g.get(Cn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return ln(this),this.i=null,i=Cn(this,i),Ya(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Xa(this,i),i.length>0?String(i[0]):c):c};function Ja(i,c,l){Qa(i,c),l.length>0&&(i.i=null,i.g.set(Cn(i,c),R(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const A=ar(l);l=Xa(this,l);for(let S=0;S<l.length;S++){let N=A;l[S]!==""&&(N+="="+ar(l[S])),i.push(N)}}return this.i=i.join("&")};function Za(i){const c=new fr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Cn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function Zd(i,c){c&&!i.j&&(ln(i),i.i=null,i.g.forEach(function(l,f){const A=f.toLowerCase();f!=A&&(Qa(this,f),Ja(this,A,l))},i)),i.j=c}function ef(i,c){const l=new or;if(a.Image){const f=new Image;f.onload=p(Ot,l,"TestLoadImage: loaded",!0,c,f),f.onerror=p(Ot,l,"TestLoadImage: error",!1,c,f),f.onabort=p(Ot,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(Ot,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function tf(i,c){const l=new or,f=new AbortController,A=setTimeout(()=>{f.abort(),Ot(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?Ot(l,"TestPingServer: ok",!0,c):Ot(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),Ot(l,"TestPingServer: error",!1,c)})}function Ot(i,c,l,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(l)}catch{}}function nf(){this.g=new Fd}function Oi(i){this.i=i.Sb||null,this.h=i.ab||!1}E(Oi,Ca),Oi.prototype.g=function(){return new is(this.i,this.h)};function is(i,c){Oe.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(is,Oe),n=is.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,mr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,pr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,mr(this)),this.g&&(this.readyState=3,mr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ec(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function ec(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?pr(this):mr(this),this.readyState==3&&ec(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,pr(this))},n.Na=function(i){this.g&&(this.response=i,pr(this))},n.ga=function(){this.g&&pr(this)};function pr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,mr(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function mr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(is.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function tc(i){let c="";return he(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function Mi(i,c,l){e:{for(f in l){var f=!1;break e}f=!0}f||(l=tc(l),typeof i=="string"?l!=null&&ar(l):ce(i,c,l))}function me(i){Oe.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(me,Oe);var rf=/^https?$/i,sf=["POST","PUT"];n=me.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():La.g(),this.g.onreadystatechange=I(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){nc(this,S);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)l.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),A=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(sf,c,void 0)>=0)||f||A||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,N]of l)this.g.setRequestHeader(S,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){nc(this,S)}};function nc(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,rc(i),os(i)}function rc(i){i.A||(i.A=!0,Be(i,"complete"),Be(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Be(this,"complete"),Be(this,"abort"),os(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),os(this,!0)),me.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?sc(this):this.Xa())},n.Xa=function(){sc(this)};function sc(i){if(i.h&&typeof o<"u"){if(i.v&&Mt(i)==4)setTimeout(i.Ca.bind(i),0);else if(Be(i,"readystatechange"),Mt(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let N=String(i.D).match(Ga)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),f=!rf.test(N?N.toLowerCase():"")}l=f}if(l)Be(i,"complete"),Be(i,"success");else{i.o=6;try{var A=Mt(i)>2?i.g.statusText:""}catch{A=""}i.l=A+" ["+i.ca()+"]",rc(i)}}finally{os(i)}}}}function os(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||Be(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Mt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Mt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),xd(c)}};function ic(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function of(i){const c={};i=(i.g&&Mt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(_(i[f]))continue;var l=$d(i[f]);const A=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const S=c[A]||[];c[A]=S,S.push(l)}Qe(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function gr(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function oc(i){this.za=0,this.i=[],this.j=new or,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=gr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=gr("baseRetryDelayMs",5e3,i),this.Za=gr("retryDelaySeedMs",1e4,i),this.Ta=gr("forwardChannelMaxRetries",2,i),this.va=gr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new qa(i&&i.concurrentRequestLimit),this.Ba=new nf,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=oc.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){je(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=mc(this,null,this.W),cs(this)};function Li(i){if(ac(i),i.I==3){var c=i.V++,l=ut(i.J);if(ce(l,"SID",i.M),ce(l,"RID",c),ce(l,"TYPE","terminate"),_r(i,l),c=new Vt(i,i.j,c),c.M=2,c.A=ss(ut(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=gc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),rs(c)}pc(i)}function as(i){i.g&&(Fi(i),i.g.cancel(),i.g=null)}function ac(i){as(i),i.v&&(a.clearTimeout(i.v),i.v=null),us(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function cs(i){if(!$a(i.h)&&!i.m){i.m=!0;var c=i.Ea;G||m(),U||(G(),U=!0),T.add(c,i),i.D=0}}function af(i,c){return za(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=ir(d(i.Ea,i,c),fc(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const A=new Vt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=Ie(S),de(S,this.U)):S=this.U),this.u!==null||this.R||(A.J=S,S=null),this.S)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=uc(this,A,c),l=ut(this.J),ce(l,"RID",i),ce(l,"CVER",22),this.G&&ce(l,"X-HTTP-Session-Id",this.G),_r(this,l),S&&(this.R?c="headers="+ar(tc(S))+"&"+c:this.u&&Mi(l,this.u,S)),Vi(this.h,A),this.Ra&&ce(l,"TYPE","init"),this.S?(ce(l,"$req",c),ce(l,"SID","null"),A.U=!0,Pi(A,l,null)):Pi(A,l,c),this.I=2}}else this.I==3&&(i?cc(this,i):this.i.length==0||$a(this.h)||cc(this))};function cc(i,c){var l;c?l=c.l:l=i.V++;const f=ut(i.J);ce(f,"SID",i.M),ce(f,"RID",l),ce(f,"AID",i.K),_r(i,f),i.u&&i.o&&Mi(f,i.u,i.o),l=new Vt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=uc(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Vi(i.h,l),Pi(l,f,c)}function _r(i,c){i.H&&he(i.H,function(l,f){ce(c,f,l)}),i.l&&he({},function(l,f){ce(c,f,l)})}function uc(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var A=i.i;let Q=-1;for(;;){const we=["count="+l];Q==-1?l>0?(Q=A[0].g,we.push("ofs="+Q)):Q=0:we.push("ofs="+Q);let ie=!0;for(let be=0;be<l;be++){var S=A[be].g;const lt=A[be].map;if(S-=Q,S<0)Q=Math.max(0,A[be].g-100),ie=!1;else try{S="req"+S+"_"||"";try{var N=lt instanceof Map?lt:Object.entries(lt);for(const[dn,Lt]of N){let xt=Lt;u(Lt)&&(xt=wi(Lt)),we.push(S+dn+"="+encodeURIComponent(xt))}}catch(dn){throw we.push(S+"type="+encodeURIComponent("_badmap")),dn}}catch{f&&f(lt)}}if(ie){N=we.join("&");break e}}N=void 0}return i=i.i.splice(0,l),c.G=i,N}function lc(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;G||m(),U||(G(),U=!0),T.add(c,i),i.A=0}}function xi(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=ir(d(i.Da,i),fc(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,hc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=ir(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,je(10),as(this),hc(this))};function Fi(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function hc(i){i.g=new Vt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=ut(i.na);ce(c,"RID","rpc"),ce(c,"SID",i.M),ce(c,"AID",i.K),ce(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&ce(c,"TO",i.ia),ce(c,"TYPE","xmlhttp"),_r(i,c),i.u&&i.o&&Mi(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=ss(ut(c)),l.u=null,l.R=!0,Ua(l,i)}n.Va=function(){this.C!=null&&(this.C=null,as(this),xi(this),je(19))};function us(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function dc(i,c){var l=null;if(i.g==c){us(i),Fi(i),i.g=null;var f=2}else if(Di(i.h,c))l=c.G,Ha(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var A=i.D;f=ts(),Be(f,new Oa(f,l)),cs(i)}else lc(i);else if(A=c.m,A==3||A==0&&c.X>0||!(f==1&&af(i,c)||f==2&&xi(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),A){case 1:hn(i,5);break;case 4:hn(i,10);break;case 3:hn(i,6);break;default:hn(i,2)}}}function fc(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function hn(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const A=!f;f=new Nt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ur(f,"https"),ss(f),A?ef(f.toString(),l):tf(f.toString(),l)}else je(2);i.I=0,i.l&&i.l.pa(c),pc(i),ac(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),je(2)):(this.j.info("Failed to ping google.com"),je(1))};function pc(i){if(i.I=0,i.ja=[],i.l){const c=Wa(i.h);(c.length!=0||i.i.length!=0)&&(D(i.ja,c),D(i.ja,i.i),i.h.i.length=0,R(i.i),i.i.length=0),i.l.oa()}}function mc(i,c,l){var f=l instanceof Nt?ut(l):new Nt(l);if(f.g!="")c&&(f.g=c+"."+f.g),lr(f,f.u);else{var A=a.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const S=new Nt(null);f&&ur(S,f),c&&(S.g=c),A&&lr(S,A),l&&(S.h=l),f=S}return l=i.G,c=i.wa,l&&c&&ce(f,l,c),ce(f,"VER",i.ka),_r(i,f),f}function gc(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new me(new Oi({ab:l})):new me(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _c(){}n=_c.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ls(){}ls.prototype.g=function(i,c){return new Ge(i,c)};function Ge(i,c){Oe.call(this),this.g=new oc(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!_(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new kn(this)}E(Ge,Oe),Ge.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ge.prototype.close=function(){Li(this.g)},Ge.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=wi(i),i=l);c.i.push(new Wd(c.Ya++,i)),c.I==3&&cs(c)},Ge.prototype.N=function(){this.g.l=null,delete this.j,Li(this.g),delete this.g,Ge.Z.N.call(this)};function yc(i){Ai.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const l in c){i=l;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E(yc,Ai);function Ec(){Ri.call(this),this.status=1}E(Ec,Ri);function kn(i){this.g=i}E(kn,_c),kn.prototype.ra=function(){Be(this.g,"a")},kn.prototype.qa=function(i){Be(this.g,new yc(i))},kn.prototype.pa=function(i){Be(this.g,new Ec)},kn.prototype.oa=function(){Be(this.g,"b")},ls.prototype.createWebChannel=ls.prototype.g,Ge.prototype.send=Ge.prototype.o,Ge.prototype.open=Ge.prototype.m,Ge.prototype.close=Ge.prototype.close,sh=function(){return new ls},rh=function(){return ts()},nh=cn,vo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ns.NO_ERROR=0,ns.TIMEOUT=8,ns.HTTP_ERROR=6,Is=ns,Ma.COMPLETE="complete",th=Ma,ka.EventType=rr,rr.OPEN="a",rr.CLOSE="b",rr.ERROR="c",rr.MESSAGE="d",Oe.prototype.listen=Oe.prototype.J,Ir=ka,me.prototype.listenOnce=me.prototype.K,me.prototype.getLastError=me.prototype.Ha,me.prototype.getLastErrorCode=me.prototype.ya,me.prototype.getStatus=me.prototype.ca,me.prototype.getResponseJson=me.prototype.La,me.prototype.getResponseText=me.prototype.la,me.prototype.send=me.prototype.ea,me.prototype.setWithCredentials=me.prototype.Fa,eh=me}).apply(typeof fs<"u"?fs:typeof self<"u"?self:typeof window<"u"?window:{});const nu="@firebase/firestore",ru="4.9.2";class Le{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Le.UNAUTHENTICATED=new Le(null),Le.GOOGLE_CREDENTIALS=new Le("google-credentials-uid"),Le.FIRST_PARTY=new Le("first-party-uid"),Le.MOCK_USER=new Le("mock-user");let Jn="12.3.0";const vn=new Fo("@firebase/firestore");function Vn(){return vn.logLevel}function O(n,...e){if(vn.logLevel<=Y.DEBUG){const t=e.map(Qo);vn.debug(`Firestore (${Jn}): ${n}`,...t)}}function Ct(n,...e){if(vn.logLevel<=Y.ERROR){const t=e.map(Qo);vn.error(`Firestore (${Jn}): ${n}`,...t)}}function $n(n,...e){if(vn.logLevel<=Y.WARN){const t=e.map(Qo);vn.warn(`Firestore (${Jn}): ${n}`,...t)}}function Qo(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function q(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,ih(n,r,t)}function ih(n,e,t){let r=`FIRESTORE (${Jn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Ct(r),new Error(r)}function re(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||ih(e,s,r)}function H(n,e){return n}const k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends Dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Rt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class oh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class z_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Le.UNAUTHENTICATED)))}shutdown(){}}class H_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class W_{constructor(e){this.t=e,this.currentUser=Le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){re(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new Rt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Rt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Rt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(re(typeof r.accessToken=="string",31837,{l:r}),new oh(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return re(e===null||typeof e=="string",2055,{h:e}),new Le(e)}}class G_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Le.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class K_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new G_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Le.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class su{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Q_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ze(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){re(this.o===void 0,3512);const r=o=>{o.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,O("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new su(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(re(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new su(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Y_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Yo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Y_(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function X(n,e){return n<e?-1:n>e?1:0}function To(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return to(s)===to(o)?X(s,o):to(s)?1:-1}return X(n.length,e.length)}const X_=55296,J_=57343;function to(n){const e=n.charCodeAt(0);return e>=X_&&e<=J_}function zn(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const iu="__name__";class dt{constructor(e,t,r){t===void 0?t=0:t>e.length&&q(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&q(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return dt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof dt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=dt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return X(e.length,t.length)}static compareSegments(e,t){const r=dt.isNumericId(e),s=dt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?dt.extractNumericId(e).compare(dt.extractNumericId(t)):To(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Yt.fromString(e.substring(4,e.length-2))}}class ue extends dt{construct(e,t,r){return new ue(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new L(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new ue(t)}static emptyPath(){return new ue([])}}const Z_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ke extends dt{construct(e,t,r){return new ke(e,t,r)}static isValidIdentifier(e){return Z_.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ke.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===iu}static keyField(){return new ke([iu])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new L(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new L(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new L(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new L(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ke(t)}static emptyPath(){return new ke([])}}class B{constructor(e){this.path=e}static fromPath(e){return new B(ue.fromString(e))}static fromName(e){return new B(ue.fromString(e).popFirst(5))}static empty(){return new B(ue.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ue.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ue.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new B(new ue(e.slice()))}}function ah(n,e,t){if(!t)throw new L(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ey(n,e,t,r){if(e===!0&&r===!0)throw new L(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ou(n){if(!B.isDocumentKey(n))throw new L(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function au(n){if(B.isDocumentKey(n))throw new L(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ch(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Xo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":q(12329,{type:typeof n})}function Tn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new L(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xo(n);throw new L(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Te(n,e){const t={typeString:n};return e&&(t.value=e),t}function Kr(n,e){if(!ch(n))throw new L(k.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new L(k.INVALID_ARGUMENT,t);return!0}const cu=-62135596800,uu=1e6;class le{static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*uu);return new le(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<cu)throw new L(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/uu}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:le._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Kr(e,le._jsonSchema))return new le(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-cu;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}le._jsonSchemaVersion="firestore/timestamp/1.0",le._jsonSchema={type:Te("string",le._jsonSchemaVersion),seconds:Te("number"),nanoseconds:Te("number")};class z{static fromTimestamp(e){return new z(e)}static min(){return new z(new le(0,0))}static max(){return new z(new le(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Mr=-1;function ty(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=z.fromTimestamp(r===1e9?new le(t+1,0):new le(t,r));return new Jt(s,B.empty(),e)}function ny(n){return new Jt(n.readTime,n.key,Mr)}class Jt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Jt(z.min(),B.empty(),Mr)}static max(){return new Jt(z.max(),B.empty(),Mr)}}function ry(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=B.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}const sy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Zn(n){if(n.code!==k.FAILED_PRECONDITION||n.message!==sy)throw n;O("LocalStore","Unexpectedly lost primary lease")}class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new C(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof C?t:C.resolve(t)}catch(t){return C.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):C.reject(t)}static resolve(e){return new C(((t,r)=>{t(e)}))}static reject(e){return new C(((t,r)=>{r(e)}))}static waitFor(e){return new C(((t,r)=>{let s=0,o=0,a=!1;e.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=C.resolve(!1);for(const r of e)t=t.next((s=>s?C.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new C(((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++u,u===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new C(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function oy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function er(n){return n.name==="IndexedDbTransactionError"}class si{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}si.ce=-1;const Jo=-1;function ii(n){return n==null}function xs(n){return n===0&&1/n==-1/0}function ay(n){return typeof n=="number"&&Number.isInteger(n)&&!xs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const uh="";function cy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=lu(e)),e=uy(n.get(t),e);return lu(e)}function uy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case uh:t+="";break;default:t+=o}}return t}function lu(n){return n+uh+""}function hu(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function An(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function lh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class fe{constructor(e,t){this.comparator=e,this.root=t||Ce.EMPTY}insert(e,t){return new fe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ce.BLACK,null,null))}remove(e){return new fe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ce.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ps(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ps(this.root,e,this.comparator,!1)}getReverseIterator(){return new ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ps(this.root,e,this.comparator,!0)}}class ps{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ce{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Ce.RED,this.left=s??Ce.EMPTY,this.right=o??Ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Ce(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ce.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ce.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw q(27949);return e+(this.isRed()?0:1)}}Ce.EMPTY=null,Ce.RED=!0,Ce.BLACK=!1;Ce.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Ce(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Se{constructor(e){this.comparator=e,this.data=new fe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new du(this.data.getIterator())}getIteratorFrom(e){return new du(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Se)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Se(this.comparator);return t.data=e,t}}class du{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ot{constructor(e){this.fields=e,e.sort(ke.comparator)}static empty(){return new ot([])}unionWith(e){let t=new Se(ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ot(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zn(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class hh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class De{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new hh("Invalid base64 string: "+o):o}})(e);return new De(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new De(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}De.EMPTY_BYTE_STRING=new De("");const ly=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zt(n){if(re(!!n,39018),typeof n=="string"){let e=0;const t=ly.exec(n);if(re(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ee(n.seconds),nanos:Ee(n.nanos)}}function Ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function en(n){return typeof n=="string"?De.fromBase64String(n):De.fromUint8Array(n)}const dh="server_timestamp",fh="__type__",ph="__previous_value__",mh="__local_write_time__";function Zo(n){return(n?.mapValue?.fields||{})[fh]?.stringValue===dh}function oi(n){const e=n.mapValue.fields[ph];return Zo(e)?oi(e):e}function Lr(n){const e=Zt(n.mapValue.fields[mh].timestampValue);return new le(e.seconds,e.nanos)}class hy{constructor(e,t,r,s,o,a,u,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const Fs="(default)";class xr{constructor(e,t){this.projectId=e,this.database=t||Fs}static empty(){return new xr("","")}get isDefaultDatabase(){return this.database===Fs}isEqual(e){return e instanceof xr&&e.projectId===this.projectId&&e.database===this.database}}const gh="__type__",dy="__max__",ms={mapValue:{}},_h="__vector__",Us="value";function tn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Zo(n)?4:py(n)?9007199254740991:fy(n)?10:11:q(28295,{value:n})}function Et(n,e){if(n===e)return!0;const t=tn(n);if(t!==tn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lr(n).isEqual(Lr(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=Zt(s.timestampValue),u=Zt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return en(s.bytesValue).isEqual(en(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return Ee(s.geoPointValue.latitude)===Ee(o.geoPointValue.latitude)&&Ee(s.geoPointValue.longitude)===Ee(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return Ee(s.integerValue)===Ee(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=Ee(s.doubleValue),u=Ee(o.doubleValue);return a===u?xs(a)===xs(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return zn(n.arrayValue.values||[],e.arrayValue.values||[],Et);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(hu(a)!==hu(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Et(a[h],u[h])))return!1;return!0})(n,e);default:return q(52216,{left:n})}}function Fr(n,e){return(n.values||[]).find((t=>Et(t,e)))!==void 0}function Hn(n,e){if(n===e)return 0;const t=tn(n),r=tn(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=Ee(o.integerValue||o.doubleValue),h=Ee(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,e);case 3:return fu(n.timestampValue,e.timestampValue);case 4:return fu(Lr(n),Lr(e));case 5:return To(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=en(o),h=en(a);return u.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const p=X(u[d],h[d]);if(p!==0)return p}return X(u.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=X(Ee(o.latitude),Ee(a.latitude));return u!==0?u:X(Ee(o.longitude),Ee(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return pu(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[Us]?.arrayValue,p=h[Us]?.arrayValue,E=X(d?.values?.length||0,p?.values?.length||0);return E!==0?E:pu(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ms.mapValue&&a===ms.mapValue)return 0;if(o===ms.mapValue)return 1;if(a===ms.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let E=0;E<h.length&&E<p.length;++E){const I=To(h[E],p[E]);if(I!==0)return I;const R=Hn(u[h[E]],d[p[E]]);if(R!==0)return R}return X(h.length,p.length)})(n.mapValue,e.mapValue);default:throw q(23264,{he:t})}}function fu(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=Zt(n),r=Zt(e),s=X(t.seconds,r.seconds);return s!==0?s:X(t.nanos,r.nanos)}function pu(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=Hn(t[s],r[s]);if(o)return o}return X(t.length,r.length)}function Wn(n){return Io(n)}function Io(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=Zt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return en(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return B.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=Io(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Io(t.fields[a])}`;return s+"}"})(n.mapValue):q(61005,{value:n})}function ws(n){switch(tn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=oi(n);return e?16+ws(e):16;case 5:return 2*n.stringValue.length;case 6:return en(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+ws(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return An(r.fields,((o,a)=>{s+=o.length+ws(a)})),s})(n.mapValue);default:throw q(13486,{value:n})}}function wo(n){return!!n&&"integerValue"in n}function ea(n){return!!n&&"arrayValue"in n}function mu(n){return!!n&&"nullValue"in n}function gu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function As(n){return!!n&&"mapValue"in n}function fy(n){return(n?.mapValue?.fields||{})[gh]?.stringValue===_h}function Pr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return An(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Pr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Pr(n.arrayValue.values[t]);return e}return{...n}}function py(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===dy}class et{constructor(e){this.value=e}static empty(){return new et({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!As(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pr(t)}setAll(e){let t=ke.emptyPath(),r={},s=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=Pr(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());As(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];As(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){An(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new et(Pr(this.value))}}function yh(n){const e=[];return An(n.fields,((t,r)=>{const s=new ke([t]);if(As(r)){const o=yh(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new ot(e)}class xe{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new xe(e,0,z.min(),z.min(),z.min(),et.empty(),0)}static newFoundDocument(e,t,r,s){return new xe(e,1,t,z.min(),r,s,0)}static newNoDocument(e,t){return new xe(e,2,t,z.min(),z.min(),et.empty(),0)}static newUnknownDocument(e,t){return new xe(e,3,t,z.min(),z.min(),et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof xe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xe(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bs{constructor(e,t){this.position=e,this.inclusive=t}}function _u(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=B.comparator(B.fromName(a.referenceValue),t.key):r=Hn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function yu(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Et(n.position[t],e.position[t]))return!1;return!0}class js{constructor(e,t="asc"){this.field=e,this.dir=t}}function my(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Eh{}class Ae extends Eh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new _y(e,t,r):t==="array-contains"?new vy(e,r):t==="in"?new Ty(e,r):t==="not-in"?new Iy(e,r):t==="array-contains-any"?new wy(e,r):new Ae(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new yy(e,r):new Ey(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Hn(t,this.value)):t!==null&&tn(this.value)===tn(t)&&this.matchesComparison(Hn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class vt extends Eh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new vt(e,t)}matches(e){return vh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function vh(n){return n.op==="and"}function Th(n){return gy(n)&&vh(n)}function gy(n){for(const e of n.filters)if(e instanceof vt)return!1;return!0}function Ao(n){if(n instanceof Ae)return n.field.canonicalString()+n.op.toString()+Wn(n.value);if(Th(n))return n.filters.map((e=>Ao(e))).join(",");{const e=n.filters.map((t=>Ao(t))).join(",");return`${n.op}(${e})`}}function Ih(n,e){return n instanceof Ae?(function(r,s){return s instanceof Ae&&r.op===s.op&&r.field.isEqual(s.field)&&Et(r.value,s.value)})(n,e):n instanceof vt?(function(r,s){return s instanceof vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&Ih(a,s.filters[u])),!0):!1})(n,e):void q(19439)}function wh(n){return n instanceof Ae?(function(t){return`${t.field.canonicalString()} ${t.op} ${Wn(t.value)}`})(n):n instanceof vt?(function(t){return t.op.toString()+" {"+t.getFilters().map(wh).join(" ,")+"}"})(n):"Filter"}class _y extends Ae{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){const t=B.comparator(e.key,this.key);return this.matchesComparison(t)}}class yy extends Ae{constructor(e,t){super(e,"in",t),this.keys=Ah("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ey extends Ae{constructor(e,t){super(e,"not-in",t),this.keys=Ah("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ah(n,e){return(e.arrayValue?.values||[]).map((t=>B.fromName(t.referenceValue)))}class vy extends Ae{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ea(t)&&Fr(t.arrayValue,this.value)}}class Ty extends Ae{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fr(this.value.arrayValue,t)}}class Iy extends Ae{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Fr(this.value.arrayValue,t)}}class wy extends Ae{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ea(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>Fr(this.value.arrayValue,r)))}}class Ay{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Eu(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Ay(n,e,t,r,s,o,a)}function ta(n){const e=H(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>Ao(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),ii(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Wn(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Wn(r))).join(",")),e.Te=t}return e.Te}function na(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!my(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ih(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!yu(n.startAt,e.startAt)&&yu(n.endAt,e.endAt)}function Ro(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ai{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ry(n,e,t,r,s,o,a,u){return new ai(n,e,t,r,s,o,a,u)}function ra(n){return new ai(n)}function vu(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sy(n){return n.collectionGroup!==null}function Cr(n){const e=H(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Se(ke.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new js(o,r))})),t.has(ke.keyField().canonicalString())||e.Ie.push(new js(ke.keyField(),r))}return e.Ie}function mt(n){const e=H(n);return e.Ee||(e.Ee=by(e,Cr(n))),e.Ee}function by(n,e){if(n.limitType==="F")return Eu(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new js(s.field,o)}));const t=n.endAt?new Bs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Bs(n.startAt.position,n.startAt.inclusive):null;return Eu(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function So(n,e,t){return new ai(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ci(n,e){return na(mt(n),mt(e))&&n.limitType===e.limitType}function Rh(n){return`${ta(mt(n))}|lt:${n.limitType}`}function Nn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>wh(s))).join(", ")}]`),ii(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>Wn(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>Wn(s))).join(",")),`Target(${r})`})(mt(n))}; limitType=${n.limitType})`}function ui(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):B.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Cr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=_u(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Cr(r),s)||r.endAt&&!(function(a,u,h){const d=_u(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Cr(r),s))})(n,e)}function Py(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Sh(n){return(e,t)=>{let r=!1;for(const s of Cr(n)){const o=Cy(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Cy(n,e,t){const r=n.field.isKeyField()?B.comparator(e.key,t.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Hn(h,d):q(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return q(19790,{direction:n.dir})}}class Rn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){An(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return lh(this.inner)}size(){return this.innerSize}}const ky=new fe(B.comparator);function kt(){return ky}const bh=new fe(B.comparator);function wr(...n){let e=bh;for(const t of n)e=e.insert(t.key,t);return e}function Ph(n){let e=bh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function pn(){return kr()}function Ch(){return kr()}function kr(){return new Rn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Dy=new fe(B.comparator),Vy=new Se(B.comparator);function J(...n){let e=Vy;for(const t of n)e=e.add(t);return e}const Ny=new Se(X);function Oy(){return Ny}function sa(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xs(e)?"-0":e}}function kh(n){return{integerValue:""+n}}function My(n,e){return ay(e)?kh(e):sa(n,e)}class li{constructor(){this._=void 0}}function Ly(n,e,t){return n instanceof qs?(function(s,o){const a={fields:{[fh]:{stringValue:dh},[mh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Zo(o)&&(o=oi(o)),o&&(a.fields[ph]=o),{mapValue:a}})(t,e):n instanceof Ur?Vh(n,e):n instanceof Br?Nh(n,e):(function(s,o){const a=Dh(s,o),u=Tu(a)+Tu(s.Ae);return wo(a)&&wo(s.Ae)?kh(u):sa(s.serializer,u)})(n,e)}function xy(n,e,t){return n instanceof Ur?Vh(n,e):n instanceof Br?Nh(n,e):t}function Dh(n,e){return n instanceof $s?(function(r){return wo(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class qs extends li{}class Ur extends li{constructor(e){super(),this.elements=e}}function Vh(n,e){const t=Oh(e);for(const r of n.elements)t.some((s=>Et(s,r)))||t.push(r);return{arrayValue:{values:t}}}class Br extends li{constructor(e){super(),this.elements=e}}function Nh(n,e){let t=Oh(e);for(const r of n.elements)t=t.filter((s=>!Et(s,r)));return{arrayValue:{values:t}}}class $s extends li{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Tu(n){return Ee(n.integerValue||n.doubleValue)}function Oh(n){return ea(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Fy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Ur&&s instanceof Ur||r instanceof Br&&s instanceof Br?zn(r.elements,s.elements,Et):r instanceof $s&&s instanceof $s?Et(r.Ae,s.Ae):r instanceof qs&&s instanceof qs})(n.transform,e.transform)}class Uy{constructor(e,t){this.version=e,this.transformResults=t}}class St{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new St}static exists(e){return new St(void 0,e)}static updateTime(e){return new St(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Rs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class hi{}function Mh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new xh(n.key,St.none()):new Qr(n.key,n.data,St.none());{const t=n.data,r=et.empty();let s=new Se(ke.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Sn(n.key,r,new ot(s.toArray()),St.none())}}function By(n,e,t){n instanceof Qr?(function(s,o,a){const u=s.value.clone(),h=wu(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Sn?(function(s,o,a){if(!Rs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=wu(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Lh(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Dr(n,e,t,r){return n instanceof Qr?(function(o,a,u,h){if(!Rs(o.precondition,a))return u;const d=o.value.clone(),p=Au(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Sn?(function(o,a,u,h){if(!Rs(o.precondition,a))return u;const d=Au(o.fieldTransforms,h,a),p=a.data;return p.setAll(Lh(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((E=>E.field)))})(n,e,t,r):(function(o,a,u){return Rs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function jy(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=Dh(r.transform,s||null);o!=null&&(t===null&&(t=et.empty()),t.set(r.field,o))}return t||null}function Iu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&zn(r,s,((o,a)=>Fy(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Qr extends hi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Sn extends hi{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Lh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function wu(n,e,t){const r=new Map;re(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,xy(a,u,t[s]))}return r}function Au(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,Ly(o,a,e))}return r}class xh extends hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qy extends hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $y{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&By(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Dr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ch();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=Mh(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(z.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),J())}isEqual(e){return this.batchId===e.batchId&&zn(this.mutations,e.mutations,((t,r)=>Iu(t,r)))&&zn(this.baseMutations,e.baseMutations,((t,r)=>Iu(t,r)))}}class ia{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){re(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Dy})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new ia(e,t,r,s)}}class zy{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Hy{constructor(e,t){this.count=e,this.unchangedNames=t}}var ve,Z;function Wy(n){switch(n){case k.OK:return q(64938);case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0;default:return q(15467,{code:n})}}function Fh(n){if(n===void 0)return Ct("GRPC error has no .code"),k.UNKNOWN;switch(n){case ve.OK:return k.OK;case ve.CANCELLED:return k.CANCELLED;case ve.UNKNOWN:return k.UNKNOWN;case ve.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case ve.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case ve.INTERNAL:return k.INTERNAL;case ve.UNAVAILABLE:return k.UNAVAILABLE;case ve.UNAUTHENTICATED:return k.UNAUTHENTICATED;case ve.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case ve.NOT_FOUND:return k.NOT_FOUND;case ve.ALREADY_EXISTS:return k.ALREADY_EXISTS;case ve.PERMISSION_DENIED:return k.PERMISSION_DENIED;case ve.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case ve.ABORTED:return k.ABORTED;case ve.OUT_OF_RANGE:return k.OUT_OF_RANGE;case ve.UNIMPLEMENTED:return k.UNIMPLEMENTED;case ve.DATA_LOSS:return k.DATA_LOSS;default:return q(39323,{code:n})}}(Z=ve||(ve={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";function Gy(){return new TextEncoder}const Ky=new Yt([4294967295,4294967295],0);function Ru(n){const e=Gy().encode(n),t=new Zl;return t.update(e),new Uint8Array(t.digest())}function Su(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Yt([t,r],0),new Yt([s,o],0)]}class oa{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ar(`Invalid padding: ${t}`);if(r<0)throw new Ar(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ar(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ar(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Yt.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(Yt.fromNumber(r)));return s.compare(Ky)===1&&(s=new Yt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Ru(e),[r,s]=Su(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new oa(o,s,t);return r.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=Ru(e),[r,s]=Su(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ar extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class di{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Yr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new di(z.min(),s,new fe(X),kt(),J())}}class Yr{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Yr(r,t,J(),J(),J())}}class Ss{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Uh{constructor(e,t){this.targetId=e,this.Ce=t}}class Bh{constructor(e,t,r=De.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class bu{constructor(){this.ve=0,this.Fe=Pu(),this.Me=De.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=J(),t=J(),r=J();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:q(38017,{changeType:o})}})),new Yr(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Pu()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,re(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Qy{constructor(e){this.Ge=e,this.ze=new Map,this.je=kt(),this.Je=gs(),this.He=gs(),this.Ye=new fe(X)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:q(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(Ro(o))if(r===0){const a=new B(o.path);this.et(t,a,xe.newNoDocument(a,z.min()))}else re(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=en(r).toUint8Array()}catch(h){if(h instanceof hh)return $n("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new oa(a,s,o)}catch(h){return $n(h instanceof Ar?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&Ro(u.target)){const h=new B(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,xe.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=J();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new di(e,t,this.Ye,this.je,r);return this.je=kt(),this.Je=gs(),this.He=gs(),this.Ye=new fe(X),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new bu,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Se(X),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Se(X),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new bu),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function gs(){return new fe(B.comparator)}function Pu(){return new fe(B.comparator)}const Yy={asc:"ASCENDING",desc:"DESCENDING"},Xy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Jy={and:"AND",or:"OR"};class Zy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function bo(n,e){return n.useProto3Json||ii(e)?e:{value:e}}function zs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function eE(n,e){return zs(n,e.toTimestamp())}function gt(n){return re(!!n,49232),z.fromTimestamp((function(t){const r=Zt(t);return new le(r.seconds,r.nanos)})(n))}function aa(n,e){return Po(n,e).canonicalString()}function Po(n,e){const t=(function(s){return new ue(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function qh(n){const e=ue.fromString(n);return re(Gh(e),10190,{key:e.toString()}),e}function Co(n,e){return aa(n.databaseId,e.path)}function no(n,e){const t=qh(e);if(t.get(1)!==n.databaseId.projectId)throw new L(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new L(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(zh(t))}function $h(n,e){return aa(n.databaseId,e)}function tE(n){const e=qh(n);return e.length===4?ue.emptyPath():zh(e)}function ko(n){return new ue(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function zh(n){return re(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Cu(n,e,t){return{name:Co(n,e),fields:t.value.mapValue.fields}}function nE(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:q(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(re(p===void 0||typeof p=="string",58123),De.fromBase64String(p||"")):(re(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),De.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){const p=d.code===void 0?k.UNKNOWN:Fh(d.code);return new L(p,d.message||"")})(a);t=new Bh(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=no(n,r.document.name),o=gt(r.document.updateTime),a=r.document.createTime?gt(r.document.createTime):z.min(),u=new et({mapValue:{fields:r.document.fields}}),h=xe.newFoundDocument(s,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Ss(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=no(n,r.document),o=r.readTime?gt(r.readTime):z.min(),a=xe.newNoDocument(s,o),u=r.removedTargetIds||[];t=new Ss([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=no(n,r.document),o=r.removedTargetIds||[];t=new Ss([],o,s,null)}else{if(!("filter"in e))return q(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new Hy(s,o),u=r.targetId;t=new Uh(u,a)}}return t}function rE(n,e){let t;if(e instanceof Qr)t={update:Cu(n,e.key,e.value)};else if(e instanceof xh)t={delete:Co(n,e.key)};else if(e instanceof Sn)t={update:Cu(n,e.key,e.data),updateMask:dE(e.fieldMask)};else{if(!(e instanceof qy))return q(16599,{Vt:e.type});t={verify:Co(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof qs)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Ur)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Br)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof $s)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw q(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:eE(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:q(27497)})(n,e.precondition)),t}function sE(n,e){return n&&n.length>0?(re(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?gt(s.updateTime):gt(o);return a.isEqual(z.min())&&(a=gt(o)),new Uy(a,s.transformResults||[])})(t,e)))):[]}function iE(n,e){return{documents:[$h(n,e.path)]}}function oE(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=$h(n,s);const o=(function(d){if(d.length!==0)return Wh(vt.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(I){return{field:On(I.field),direction:uE(I.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=bo(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function aE(n){let e=tE(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){re(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(E){const I=Hh(E);return I instanceof vt&&Th(I)?I.getFilters():[I]})(t.where));let a=[];t.orderBy&&(a=(function(E){return E.map((I=>(function(D){return new js(Mn(D.field),(function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(I)))})(t.orderBy));let u=null;t.limit&&(u=(function(E){let I;return I=typeof E=="object"?E.value:E,ii(I)?null:I})(t.limit));let h=null;t.startAt&&(h=(function(E){const I=!!E.before,R=E.values||[];return new Bs(R,I)})(t.startAt));let d=null;return t.endAt&&(d=(function(E){const I=!E.before,R=E.values||[];return new Bs(R,I)})(t.endAt)),Ry(e,s,a,o,u,"F",h,d)}function cE(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Hh(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Mn(t.unaryFilter.field);return Ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Mn(t.unaryFilter.field);return Ae.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Mn(t.unaryFilter.field);return Ae.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Mn(t.unaryFilter.field);return Ae.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Ae.create(Mn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return vt.create(t.compositeFilter.filters.map((r=>Hh(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return q(1026)}})(t.compositeFilter.op))})(n):q(30097,{filter:n})}function uE(n){return Yy[n]}function lE(n){return Xy[n]}function hE(n){return Jy[n]}function On(n){return{fieldPath:n.canonicalString()}}function Mn(n){return ke.fromServerFormat(n.fieldPath)}function Wh(n){return n instanceof Ae?(function(t){if(t.op==="=="){if(gu(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NAN"}};if(mu(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(gu(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NOT_NAN"}};if(mu(t.value))return{unaryFilter:{field:On(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:On(t.field),op:lE(t.op),value:t.value}}})(n):n instanceof vt?(function(t){const r=t.getFilters().map((s=>Wh(s)));return r.length===1?r[0]:{compositeFilter:{op:hE(t.op),filters:r}}})(n):q(54877,{filter:n})}function dE(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Gh(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Ht{constructor(e,t,r,s,o=z.min(),a=z.min(),u=De.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new Ht(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ht(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ht(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fE{constructor(e){this.yt=e}}function pE(n){const e=aE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?So(e,e.limit,"L"):e}class mE{constructor(){this.Cn=new gE}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(Jt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(Jt.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class gE{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Se(ue.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Se(ue.comparator)).toArray()}}const ku={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kh=41943040;class ze{static withCacheSize(e){return new ze(e,ze.DEFAULT_COLLECTION_PERCENTILE,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ze.DEFAULT_COLLECTION_PERCENTILE=10,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ze.DEFAULT=new ze(Kh,ze.DEFAULT_COLLECTION_PERCENTILE,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ze.DISABLED=new ze(-1,0,0);class Gn{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Gn(0)}static cr(){return new Gn(-1)}}const Du="LruGarbageCollector",_E=1048576;function Vu([n,e],[t,r]){const s=X(n,t);return s===0?X(e,r):s}class yE{constructor(e){this.Ir=e,this.buffer=new Se(Vu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Vu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class EE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){O(Du,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){er(t)?O(Du,"Ignoring IndexedDB error during garbage collection: ",t):await Zn(t)}await this.Vr(3e5)}))}}class vE{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return C.resolve(si.ce);const r=new yE(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(ku)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ku):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,u,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,a=Date.now(),this.nthSequenceNumber(e,s)))).next((E=>(r=E,u=Date.now(),this.removeTargets(e,r,t)))).next((E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((E=>(d=Date.now(),Vn()<=Y.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${E} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E}))))}}function TE(n,e){return new vE(n,e)}class IE{constructor(){this.changes=new Rn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class wE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class AE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Dr(r.mutation,s,ot.empty(),le.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,J()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=J()){const s=pn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=wr();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=pn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,J())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,r,s){let o=kt();const a=kr(),u=(function(){return kr()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof Sn)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Dr(p.mutation,d,p.mutation.getFieldMask(),le.now())):a.set(d.key,ot.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>u.set(d,new wE(p,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(e,t){const r=kr();let s=new fe(((a,u)=>a-u)),o=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||ot.empty();p=u.applyToLocalView(d,p),r.set(h,p);const E=(s.get(u.batchId)||J()).add(h);s=s.insert(u.batchId,E)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,p=h.value,E=Ch();p.forEach((I=>{if(!o.has(I)){const R=Mh(t.get(I),r.get(I));R!==null&&E.set(I,R),o=o.add(I)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,E))}return C.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return B.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):C.resolve(pn());let u=Mr,h=o;return a.next((d=>C.forEach(d,((p,E)=>(u<E.largestBatchId&&(u=E.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next((I=>{h=h.insert(p,I)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,J()))).next((p=>({batchId:u,changes:Ph(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next((r=>{let s=wr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=wr();return this.indexManager.getCollectionParents(e,o).next((u=>C.forEach(u,(h=>{const d=(function(E,I){return new ai(I,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((E,I)=>{a=a.insert(E,I)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,xe.newInvalidDocument(p)))}));let u=wr();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Dr(p.mutation,d,ot.empty(),le.now()),ui(t,d)&&(u=u.insert(h,d))})),u}))}}class RE{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:gt(s.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:pE(s.bundledQuery),readTime:gt(s.readTime)}})(t)),C.resolve()}}class SE{constructor(){this.overlays=new fe(B.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){const r=pn();return C.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),C.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){const s=pn(),o=t.length+1,a=new B(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return C.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new fe(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=pn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const u=pn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>u.set(d,p))),!(u.size()>=s)););return C.resolve(u)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new zy(t,r));let o=this.qr.get(t);o===void 0&&(o=J(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class bE{constructor(){this.sessionToken=De.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}class ca{constructor(){this.Qr=new Se(Pe.$r),this.Ur=new Se(Pe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Pe(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new Pe(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new B(new ue([])),r=new Pe(t,e),s=new Pe(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new B(new ue([])),r=new Pe(t,e),s=new Pe(t,e+1);let o=J();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new Pe(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Pe{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return B.comparator(e.key,t.key)||X(e.Yr,t.Yr)}static Kr(e,t){return X(e.Yr,t.Yr)||B.comparator(e.key,t.key)}}class PE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Se(Pe.$r)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new $y(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new Pe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Jo:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Pe(t,0),s=new Pe(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Se(X);return t.forEach((s=>{const o=new Pe(s,0),a=new Pe(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;B.isDocumentKey(o)||(o=o.child(""));const a=new Pe(new B(o),0);let u=new Se(X);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),C.resolve(this.ti(u))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){re(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(t.mutations,(s=>{const o=new Pe(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new Pe(t,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class CE{constructor(e){this.ri=e,this.docs=(function(){return new fe(B.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let r=kt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():xe.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=kt();const a=t.path,u=new B(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ry(ny(p),r)<=0||(s.has(p.key)||ui(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,s){q(9500)}ii(e,t){return C.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new kE(this)}getSize(e){return C.resolve(this.size)}}class kE extends IE{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),C.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class DE{constructor(e){this.persistence=e,this.si=new Rn((t=>ta(t)),na),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.oi=0,this._i=new ca,this.targetCount=0,this.ai=Gn.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Gn(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)})),C.waitFor(o).next((()=>s))}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}}class Qh{constructor(e,t){this.ui={},this.overlays={},this.ci=new si(0),this.li=!1,this.li=!0,this.hi=new bE,this.referenceDelegate=e(this),this.Pi=new DE(this),this.indexManager=new mE,this.remoteDocumentCache=(function(s){return new CE(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new fE(t),this.Ii=new RE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new SE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new PE(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){O("MemoryPersistence","Starting transaction:",e);const s=new VE(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class VE extends iy{constructor(e){super(),this.currentSequenceNumber=e}}class ua{constructor(e){this.persistence=e,this.Ri=new ca,this.Vi=null}static mi(e){return new ua(e)}get fi(){if(this.Vi)return this.Vi;throw q(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=B.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,z.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Hs{constructor(e,t){this.persistence=e,this.pi=new Rn((r=>cy(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=TE(this,t)}static mi(e,t){return new Hs(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return C.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?C.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((u=>{u||(r++,o.removeEntry(a,z.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ws(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class la{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=J(),s=J();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new la(e,t.fromCache,r,s)}}class NE{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class OE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return up()?8:oy(Fe())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new NE;return this.Ss(e,t,a).next((u=>{if(o.result=u,this.Vs)return this.bs(e,t,a,u.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Vn()<=Y.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(Vn()<=Y.DEBUG&&O("QueryEngine","Query:",Nn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Vn()<=Y.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mt(t))):C.resolve())}ys(e,t){if(vu(t))return C.resolve(null);let r=mt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=So(t,null,"F"),r=mt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=J(...o);return this.ps.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.Ds(t,u);return this.Cs(t,d,a,h.readTime)?this.ys(e,So(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ws(e,t,r,s){return vu(t)||s.isEqual(z.min())?C.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?C.resolve(null):(Vn()<=Y.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Nn(t)),this.vs(e,a,t,ty(s,Mr)).next((u=>u)))}))}Ds(e,t){let r=new Se(Sh(e));return t.forEach(((s,o)=>{ui(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Vn()<=Y.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Nn(t)),this.ps.getDocumentsMatchingQuery(e,t,Jt.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const ha="LocalStore",ME=3e8;class LE{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new fe(X),this.xs=new Rn((o=>ta(o)),na),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new AE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function xE(n,e,t,r){return new LE(n,e,t,r)}async function Yh(n,e){const t=H(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=J();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){u.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function FE(n,e){const t=H(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,p){const E=d.batch,I=E.keys();let R=C.resolve();return I.forEach((D=>{R=R.next((()=>p.getEntry(h,D))).next((V=>{const b=d.docVersions.get(D);re(b!==null,48541),V.version.compareTo(b)<0&&(E.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),p.addEntry(V)))}))})),R.next((()=>u.mutationQueue.removeMutationBatch(h,E)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=J();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Xh(n){const e=H(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function UE(n,e){const t=H(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const u=[];e.targetChanges.forEach(((p,E)=>{const I=s.get(E);if(!I)return;u.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,E).next((()=>t.Pi.addMatchingKeys(o,p.addedDocuments,E))));let R=I.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(E)!==null?R=R.withResumeToken(De.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),s=s.insert(E,R),(function(V,b,x){return V.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=ME?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0})(I,R,p)&&u.push(t.Pi.updateTargetData(o,R))}));let h=kt(),d=J();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(BE(o,a,e.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(z.min())){const p=t.Pi.getLastRemoteSnapshotVersion(o).next((E=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(p)}return C.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function BE(n,e,t){let r=J(),s=J();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=kt();return t.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(z.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):O(ha,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function jE(n,e){const t=H(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Jo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function qE(n,e){const t=H(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,C.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new Ht(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Do(n,e,t){const r=H(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!er(a))throw a;O(ha,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Nu(n,e,t){const r=H(n);let s=z.min(),o=J();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const E=H(h),I=E.xs.get(p);return I!==void 0?C.resolve(E.Ms.get(I)):E.Pi.getTargetData(d,p)})(r,a,mt(e)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:z.min(),t?o:J()))).next((u=>($E(r,Py(e),u),{documents:u,Qs:o})))))}function $E(n,e,t){let r=n.Os.get(e)||z.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class Ou{constructor(){this.activeTargetIds=Oy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zE{constructor(){this.Mo=new Ou,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ou,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class HE{Oo(e){}shutdown(){}}const Mu="ConnectivityMonitor";class Lu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){O(Mu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){O(Mu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let _s=null;function Vo(){return _s===null?_s=(function(){return 268435456+Math.round(2147483648*Math.random())})():_s++,"0x"+_s.toString(16)}const ro="RestConnection",WE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class GE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Fs?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=Vo(),u=this.zo(e,t.toUriEncodedString());O(ro,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),p=Qn(d);return this.Jo(e,u,h,r,p).then((E=>(O(ro,`Received RPC '${e}' ${a}: `,E),E)),(E=>{throw $n(ro,`RPC '${e}' ${a} failed with error: `,E,"url: ",u,"request:",r),E}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Jn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=WE[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class KE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Me="WebChannelConnection";class QE extends GE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=Vo();return new Promise(((u,h)=>{const d=new eh;d.setWithCredentials(!0),d.listenOnce(th.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Is.NO_ERROR:const E=d.getResponseJson();O(Me,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(E)),u(E);break;case Is.TIMEOUT:O(Me,`RPC '${e}' ${a} timed out`),h(new L(k.DEADLINE_EXCEEDED,"Request time out"));break;case Is.HTTP_ERROR:const I=d.getStatus();if(O(Me,`RPC '${e}' ${a} failed with status:`,I,"response text:",d.getResponseText()),I>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const D=R?.error;if(D&&D.status&&D.message){const V=(function(x){const F=x.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(F)>=0?F:k.UNKNOWN})(D.status);h(new L(V,D.message))}else h(new L(k.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new L(k.UNAVAILABLE,"Connection failed."));break;default:q(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{O(Me,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);O(Me,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=Vo(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=sh(),u=rh(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=o.join("");O(Me,`Creating RPC '${e}' stream ${s}: ${p}`,h);const E=a.createWebChannel(p,h);this.I_(E);let I=!1,R=!1;const D=new KE({Yo:b=>{R?O(Me,`Not sending because RPC '${e}' stream ${s} is closed:`,b):(I||(O(Me,`Opening RPC '${e}' stream ${s} transport.`),E.open(),I=!0),O(Me,`RPC '${e}' stream ${s} sending:`,b),E.send(b))},Zo:()=>E.close()}),V=(b,x,F)=>{b.listen(x,(M=>{try{F(M)}catch($){setTimeout((()=>{throw $}),0)}}))};return V(E,Ir.EventType.OPEN,(()=>{R||(O(Me,`RPC '${e}' stream ${s} transport opened.`),D.o_())})),V(E,Ir.EventType.CLOSE,(()=>{R||(R=!0,O(Me,`RPC '${e}' stream ${s} transport closed`),D.a_(),this.E_(E))})),V(E,Ir.EventType.ERROR,(b=>{R||(R=!0,$n(Me,`RPC '${e}' stream ${s} transport errored. Name:`,b.name,"Message:",b.message),D.a_(new L(k.UNAVAILABLE,"The operation could not be completed")))})),V(E,Ir.EventType.MESSAGE,(b=>{if(!R){const x=b.data[0];re(!!x,16349);const F=x,M=F?.error||F[0]?.error;if(M){O(Me,`RPC '${e}' stream ${s} received error:`,M);const $=M.status;let G=(function(m){const y=ve[m];if(y!==void 0)return Fh(y)})($),U=M.message;G===void 0&&(G=k.INTERNAL,U="Unknown error status: "+$+" with message "+M.message),R=!0,D.a_(new L(G,U)),E.close()}else O(Me,`RPC '${e}' stream ${s} received:`,x),D.u_(x)}})),V(u,nh.STAT_EVENT,(b=>{b.stat===vo.PROXY?O(Me,`RPC '${e}' stream ${s} detected buffering proxy`):b.stat===vo.NOPROXY&&O(Me,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{D.__()}),0),D}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function so(){return typeof document<"u"?document:null}function fi(n){return new Zy(n,!0)}class Jh{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const xu="PersistentStream";class Zh{constructor(e,t,r,s,o,a,u,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Jh(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(Ct(t.toString()),Ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new L(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return O(xu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(O(xu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class YE extends Zh{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=nE(this.serializer,e),r=(function(o){if(!("targetChange"in o))return z.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?z.min():a.readTime?gt(a.readTime):z.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=ko(this.serializer),t.addTarget=(function(o,a){let u;const h=a.target;if(u=Ro(h)?{documents:iE(o,h)}:{query:oE(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=jh(o,a.resumeToken);const d=bo(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(z.min())>0){u.readTime=zs(o,a.snapshotVersion.toTimestamp());const d=bo(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);const r=cE(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=ko(this.serializer),t.removeTarget=e,this.q_(t)}}class XE extends Zh{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return re(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,re(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){re(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=sE(e.writeResults,e.commitTime),r=gt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=ko(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>rE(this.serializer,r)))};this.q_(t)}}class JE{}class ZE extends JE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new L(k.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,Po(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new L(k.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(e,Po(t,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new L(k.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class ev{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ct(t),this.aa=!1):O("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const In="RemoteStore";class tv{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{bn(this)&&(O(In,"Restarting streams for network reachability change."),await(async function(h){const d=H(h);d.Ea.add(4),await Xr(d),d.Ra.set("Unknown"),d.Ea.delete(4),await pi(d)})(this))}))})),this.Ra=new ev(r,s)}}async function pi(n){if(bn(n))for(const e of n.da)await e(!0)}async function Xr(n){for(const e of n.da)await e(!1)}function ed(n,e){const t=H(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ma(t)?pa(t):tr(t).O_()&&fa(t,e))}function da(n,e){const t=H(n),r=tr(t);t.Ia.delete(e),r.O_()&&td(t,e),t.Ia.size===0&&(r.O_()?r.L_():bn(t)&&t.Ra.set("Unknown"))}function fa(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}tr(n).Y_(e)}function td(n,e){n.Va.Ue(e),tr(n).Z_(e)}function pa(n){n.Va=new Qy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),tr(n).start(),n.Ra.ua()}function ma(n){return bn(n)&&!tr(n).x_()&&n.Ia.size>0}function bn(n){return H(n).Ea.size===0}function nd(n){n.Va=void 0}async function nv(n){n.Ra.set("Online")}async function rv(n){n.Ia.forEach(((e,t)=>{fa(n,e)}))}async function sv(n,e){nd(n),ma(n)?(n.Ra.ha(e),pa(n)):n.Ra.set("Unknown")}async function iv(n,e,t){if(n.Ra.set("Online"),e instanceof Bh&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,e)}catch(r){O(In,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ws(n,r)}else if(e instanceof Ss?n.Va.Ze(e):e instanceof Uh?n.Va.st(e):n.Va.tt(e),!t.isEqual(z.min()))try{const r=await Xh(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(De.EMPTY_BYTE_STRING,p.snapshotVersion)),td(o,h);const E=new Ht(p.target,h,d,p.sequenceNumber);fa(o,E)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(r){O(In,"Failed to raise snapshot:",r),await Ws(n,r)}}async function Ws(n,e,t){if(!er(e))throw e;n.Ea.add(1),await Xr(n),n.Ra.set("Offline"),t||(t=()=>Xh(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{O(In,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await pi(n)}))}function rd(n,e){return e().catch((t=>Ws(n,t,e)))}async function mi(n){const e=H(n),t=nn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Jo;for(;ov(e);)try{const s=await jE(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,av(e,s)}catch(s){await Ws(e,s)}sd(e)&&id(e)}function ov(n){return bn(n)&&n.Ta.length<10}function av(n,e){n.Ta.push(e);const t=nn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function sd(n){return bn(n)&&!nn(n).x_()&&n.Ta.length>0}function id(n){nn(n).start()}async function cv(n){nn(n).ra()}async function uv(n){const e=nn(n);for(const t of n.Ta)e.ea(t.mutations)}async function lv(n,e,t){const r=n.Ta.shift(),s=ia.from(r,e,t);await rd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await mi(n)}async function hv(n,e){e&&nn(n).X_&&await(async function(r,s){if((function(a){return Wy(a)&&a!==k.ABORTED})(s.code)){const o=r.Ta.shift();nn(r).B_(),await rd(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await mi(r)}})(n,e),sd(n)&&id(n)}async function Fu(n,e){const t=H(n);t.asyncQueue.verifyOperationInProgress(),O(In,"RemoteStore received new credentials");const r=bn(t);t.Ea.add(3),await Xr(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await pi(t)}async function dv(n,e){const t=H(n);e?(t.Ea.delete(2),await pi(t)):e||(t.Ea.add(2),await Xr(t),t.Ra.set("Unknown"))}function tr(n){return n.ma||(n.ma=(function(t,r,s){const o=H(t);return o.sa(),new YE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:nv.bind(null,n),t_:rv.bind(null,n),r_:sv.bind(null,n),H_:iv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),ma(n)?pa(n):n.Ra.set("Unknown")):(await n.ma.stop(),nd(n))}))),n.ma}function nn(n){return n.fa||(n.fa=(function(t,r,s){const o=H(t);return o.sa(),new XE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:cv.bind(null,n),r_:hv.bind(null,n),ta:uv.bind(null,n),na:lv.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await mi(n)):(await n.fa.stop(),n.Ta.length>0&&(O(In,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class ga{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new ga(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new L(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _a(n,e){if(Ct("AsyncQueue",`${e}: ${n}`),er(n))return new L(k.UNAVAILABLE,`${e}: ${n}`);throw n}class Bn{static emptySet(e){return new Bn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||B.comparator(t.key,r.key):(t,r)=>B.comparator(t.key,r.key),this.keyedMap=wr(),this.sortedSet=new fe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Bn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Bn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Uu{constructor(){this.ga=new fe(B.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):q(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class Kn{constructor(e,t,r,s,o,a,u,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new Kn(e,t,Bn.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ci(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class fv{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class pv{constructor(){this.queries=Bu(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=H(t),o=s.queries;s.queries=Bu(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new L(k.ABORTED,"Firestore shutting down"))}}function Bu(){return new Rn((n=>Rh(n)),ci)}async function od(n,e){const t=H(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new fv,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=_a(a,`Initialization of query '${Nn(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&ya(t)}async function ad(n,e){const t=H(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function mv(n,e){const t=H(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&ya(t)}function gv(n,e,t){const r=H(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function ya(n){n.Ca.forEach((e=>{e.next()}))}var No,ju;(ju=No||(No={})).Ma="default",ju.Cache="cache";class cd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Kn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Kn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==No.Cache}}class ud{constructor(e){this.key=e}}class ld{constructor(e){this.key=e}}class _v{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=Sh(e),this.tu=new Bn(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Uu,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,E)=>{const I=s.get(p),R=ui(this.query,E)?E:null,D=!!I&&this.mutatedKeys.has(I.key),V=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let b=!1;I&&R?I.data.isEqual(R.data)?D!==V&&(r.track({type:3,doc:R}),b=!0):this.su(I,R)||(r.track({type:2,doc:R}),b=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(u=!0)):!I&&R?(r.track({type:0,doc:R}),b=!0):I&&!R&&(r.track({type:1,doc:I}),b=!0,(h||d)&&(u=!0)),b&&(R?(a=a.add(R),o=V?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,E)=>(function(R,D){const V=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q(20277,{Rt:b})}};return V(R)-V(D)})(p.type,E.type)||this.eu(p.doc,E.doc))),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new Kn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Uu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=J(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new ld(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new ud(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=J();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Kn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ea="SyncEngine";class yv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Ev{constructor(e){this.key=e,this.hu=!1}}class vv{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Rn((u=>Rh(u)),ci),this.Iu=new Map,this.Eu=new Set,this.du=new fe(B.comparator),this.Au=new Map,this.Ru=new ca,this.Vu={},this.mu=new Map,this.fu=Gn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Tv(n,e,t=!0){const r=gd(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await hd(r,e,t,!0),s}async function Iv(n,e){const t=gd(n);await hd(t,e,!0,!1)}async function hd(n,e,t,r){const s=await qE(n.localStore,mt(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await wv(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&ed(n.remoteStore,s),u}async function wv(n,e,t,r,s){n.pu=(E,I,R)=>(async function(V,b,x,F){let M=b.view.ru(x);M.Cs&&(M=await Nu(V.localStore,b.query,!1).then((({documents:T})=>b.view.ru(T,M))));const $=F&&F.targetChanges.get(b.targetId),G=F&&F.targetMismatches.get(b.targetId)!=null,U=b.view.applyChanges(M,V.isPrimaryClient,$,G);return $u(V,b.targetId,U.au),U.snapshot})(n,E,I,R);const o=await Nu(n.localStore,e,!0),a=new _v(e,o.Qs),u=a.ru(o.documents),h=Yr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);$u(n,t,d.au);const p=new yv(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function Av(n,e,t){const r=H(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!ci(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Do(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&da(r.remoteStore,s.targetId),Oo(r,s.targetId)})).catch(Zn)):(Oo(r,s.targetId),await Do(r.localStore,s.targetId,!0))}async function Rv(n,e){const t=H(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),da(t.remoteStore,r.targetId))}async function Sv(n,e,t){const r=Nv(n);try{const s=await(function(a,u){const h=H(a),d=le.now(),p=u.reduce(((R,D)=>R.add(D.key)),J());let E,I;return h.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let D=kt(),V=J();return h.Ns.getEntries(R,p).next((b=>{D=b,D.forEach(((x,F)=>{F.isValidDocument()||(V=V.add(x))}))})).next((()=>h.localDocuments.getOverlayedDocuments(R,D))).next((b=>{E=b;const x=[];for(const F of u){const M=jy(F,E.get(F.key).overlayedDocument);M!=null&&x.push(new Sn(F.key,M,yh(M.value.mapValue),St.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,x,u)})).next((b=>{I=b;const x=b.applyToLocalDocumentSet(E,V);return h.documentOverlayCache.saveOverlays(R,b.batchId,x)}))})).then((()=>({batchId:I.batchId,changes:Ph(E)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new fe(X)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await Jr(r,s.changes),await mi(r.remoteStore)}catch(s){const o=_a(s,"Failed to persist write");t.reject(o)}}async function dd(n,e){const t=H(n);try{const r=await UE(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(re(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?re(a.hu,14607):s.removedDocuments.size>0&&(re(a.hu,42227),a.hu=!1))})),await Jr(t,r,e)}catch(r){await Zn(r)}}function qu(n,e,t){const r=H(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=H(a);h.onlineState=u;let d=!1;h.queries.forEach(((p,E)=>{for(const I of E.Sa)I.va(u)&&(d=!0)})),d&&ya(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function bv(n,e,t){const r=H(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new fe(B.comparator);a=a.insert(o,xe.newNoDocument(o,z.min()));const u=J().add(o),h=new di(z.min(),new Map,new fe(X),a,u);await dd(r,h),r.du=r.du.remove(o),r.Au.delete(e),va(r)}else await Do(r.localStore,e,!1).then((()=>Oo(r,e,t))).catch(Zn)}async function Pv(n,e){const t=H(n),r=e.batch.batchId;try{const s=await FE(t.localStore,e);pd(t,r,null),fd(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Jr(t,s)}catch(s){await Zn(s)}}async function Cv(n,e,t){const r=H(n);try{const s=await(function(a,u){const h=H(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,u).next((E=>(re(E!==null,37113),p=E.keys(),h.mutationQueue.removeMutationBatch(d,E)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);pd(r,e,t),fd(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Jr(r,s)}catch(s){await Zn(s)}}function fd(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function pd(n,e,t){const r=H(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Oo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||md(n,r)}))}function md(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(da(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),va(n))}function $u(n,e,t){for(const r of t)r instanceof ud?(n.Ru.addReference(r.key,e),kv(n,r)):r instanceof ld?(O(Ea,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||md(n,r.key)):q(19791,{wu:r})}function kv(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(O(Ea,"New document in limbo: "+t),n.Eu.add(r),va(n))}function va(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new B(ue.fromString(e)),r=n.fu.next();n.Au.set(r,new Ev(t)),n.du=n.du.insert(t,r),ed(n.remoteStore,new Ht(mt(ra(t.path)),r,"TargetPurposeLimboResolution",si.ce))}}async function Jr(n,e,t){const r=H(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=la.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=H(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>C.forEach(d,(I=>C.forEach(I.Es,(R=>p.persistence.referenceDelegate.addReference(E,I.targetId,R))).next((()=>C.forEach(I.ds,(R=>p.persistence.referenceDelegate.removeReference(E,I.targetId,R)))))))))}catch(E){if(!er(E))throw E;O(ha,"Failed to update sequence numbers: "+E)}for(const E of d){const I=E.targetId;if(!E.fromCache){const R=p.Ms.get(I),D=R.snapshotVersion,V=R.withLastLimboFreeSnapshotVersion(D);p.Ms=p.Ms.insert(I,V)}}})(r.localStore,o))}async function Dv(n,e){const t=H(n);if(!t.currentUser.isEqual(e)){O(Ea,"User change. New user:",e.toKey());const r=await Yh(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new L(k.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Jr(t,r.Ls)}}function Vv(n,e){const t=H(n),r=t.Au.get(e);if(r&&r.hu)return J().add(r.key);{let s=J();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function gd(n){const e=H(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=dd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Vv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bv.bind(null,e),e.Pu.H_=mv.bind(null,e.eventManager),e.Pu.yu=gv.bind(null,e.eventManager),e}function Nv(n){const e=H(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Pv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Cv.bind(null,e),e}class Gs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return xE(this.persistence,new OE,e.initialUser,this.serializer)}Cu(e){return new Qh(ua.mi,this.serializer)}Du(e){return new zE}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gs.provider={build:()=>new Gs};class Ov extends Gs{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){re(this.persistence.referenceDelegate instanceof Hs,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new EE(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ze.withCacheSize(this.cacheSizeBytes):ze.DEFAULT;return new Qh((r=>Hs.mi(r,t)),this.serializer)}}class Mo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>qu(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Dv.bind(null,this.syncEngine),await dv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new pv})()}createDatastore(e){const t=fi(e.databaseInfo.databaseId),r=(function(o){return new QE(o)})(e.databaseInfo);return(function(o,a,u,h){return new ZE(o,a,u,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,u){return new tv(r,s,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>qu(this.syncEngine,t,0)),(function(){return Lu.v()?new Lu:new HE})())}createSyncEngine(e,t){return(function(s,o,a,u,h,d,p){const E=new vv(s,o,a,u,h,d);return p&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=H(t);O(In,"RemoteStore shutting down."),r.Ea.add(5),await Xr(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Mo.provider={build:()=>new Mo};class _d{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ct("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const rn="FirestoreClient";class Mv{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Le.UNAUTHENTICATED,this.clientId=Yo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{O(rn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(O(rn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=_a(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function io(n,e){n.asyncQueue.verifyOperationInProgress(),O(rn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Yh(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function zu(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Lv(n);O(rn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Fu(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Fu(e.remoteStore,s))),n._onlineComponents=e}async function Lv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(rn,"Using user provided OfflineComponentProvider");try{await io(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===k.FAILED_PRECONDITION||s.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;$n("Error using user provided cache. Falling back to memory cache: "+t),await io(n,new Gs)}}else O(rn,"Using default OfflineComponentProvider"),await io(n,new Ov(void 0));return n._offlineComponents}async function yd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(rn,"Using user provided OnlineComponentProvider"),await zu(n,n._uninitializedComponentsProvider._online)):(O(rn,"Using default OnlineComponentProvider"),await zu(n,new Mo))),n._onlineComponents}function xv(n){return yd(n).then((e=>e.syncEngine))}async function Ed(n){const e=await yd(n),t=e.eventManager;return t.onListen=Tv.bind(null,e.syncEngine),t.onUnlisten=Av.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Iv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Rv.bind(null,e.syncEngine),t}function Fv(n,e,t={}){const r=new Rt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new _d({next:I=>{p.Nu(),a.enqueueAndForget((()=>ad(o,E)));const R=I.docs.has(u);!R&&I.fromCache?d.reject(new L(k.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&I.fromCache&&h&&h.source==="server"?d.reject(new L(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(I)},error:I=>d.reject(I)}),E=new cd(ra(u.path),p,{includeMetadataChanges:!0,qa:!0});return od(o,E)})(await Ed(n),n.asyncQueue,e,t,r))),r.promise}function Uv(n,e,t={}){const r=new Rt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const p=new _d({next:I=>{p.Nu(),a.enqueueAndForget((()=>ad(o,E))),I.fromCache&&h.source==="server"?d.reject(new L(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(I)},error:I=>d.reject(I)}),E=new cd(u,p,{includeMetadataChanges:!0,qa:!0});return od(o,E)})(await Ed(n),n.asyncQueue,e,t,r))),r.promise}function vd(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Hu=new Map;const Td="firestore.googleapis.com",Wu=!0;class Gu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new L(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Td,this.ssl=Wu}else this.host=e.host,this.ssl=e.ssl??Wu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Kh;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<_E)throw new L(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ey("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vd(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new L(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new L(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new L(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gi{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new L(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new z_;switch(r.type){case"firstParty":return new K_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new L(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Hu.get(t);r&&(O("ComponentProvider","Removing Datastore"),Hu.delete(t),r.terminate())})(this),Promise.resolve()}}function Bv(n,e,t,r={}){n=Tn(n,gi);const s=Qn(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(hl(`https://${u}`),dl("Firestore",!0)),o.host!==Td&&o.host!==u&&$n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!gn(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=Le.MOCK_USER;else{d=ep(r.mockUserToken,n._app?.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new L(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Le(E)}n._authCredentials=new H_(new oh(d,p))}}class _i{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new _i(this.firestore,e,this._query)}}class Re{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Re(this.firestore,e,this._key)}toJSON(){return{type:Re._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Kr(t,Re._jsonSchema))return new Re(e,r||null,new B(ue.fromString(t.referencePath)))}}Re._jsonSchemaVersion="firestore/documentReference/1.0",Re._jsonSchema={type:Te("string",Re._jsonSchemaVersion),referencePath:Te("string")};class Xt extends _i{constructor(e,t,r){super(e,t,ra(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Re(this.firestore,null,new B(e))}withConverter(e){return new Xt(this.firestore,e,this._path)}}function jv(n,e,...t){if(n=He(n),ah("collection","path",e),n instanceof gi){const r=ue.fromString(e,...t);return au(r),new Xt(n,null,r)}{if(!(n instanceof Re||n instanceof Xt))throw new L(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ue.fromString(e,...t));return au(r),new Xt(n.firestore,null,r)}}function Ks(n,e,...t){if(n=He(n),arguments.length===1&&(e=Yo.newId()),ah("doc","path",e),n instanceof gi){const r=ue.fromString(e,...t);return ou(r),new Re(n,null,new B(r))}{if(!(n instanceof Re||n instanceof Xt))throw new L(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ue.fromString(e,...t));return ou(r),new Re(n.firestore,n instanceof Xt?n.converter:null,new B(r))}}const Ku="AsyncQueue";class Qu{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Jh(this,"async_queue_retry"),this._c=()=>{const r=so();r&&O(Ku,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=so();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=so();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Rt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!er(e))throw e;O(Ku,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ct("INTERNAL UNHANDLED ERROR: ",Yu(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=ga.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&q(47125,{Pc:Yu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Yu(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class yi extends gi{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Qu,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Qu(e),this._firestoreClient=void 0,await e}}}function qv(n,e){const t=typeof n=="object"?n:gl(),r=typeof n=="string"?n:Fs,s=Bo(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Jf("firestore");o&&Bv(s,...o)}return s}function Ta(n){if(n._terminated)throw new L(k.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||$v(n),n._firestoreClient}function $v(n){const e=n._freezeSettings(),t=(function(s,o,a,u){return new hy(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,vd(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Mv(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class tt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new tt(De.fromBase64String(e))}catch(t){throw new L(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new tt(De.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:tt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Kr(e,tt._jsonSchema))return tt.fromBase64String(e.bytes)}}tt._jsonSchemaVersion="firestore/bytes/1.0",tt._jsonSchema={type:Te("string",tt._jsonSchemaVersion),bytes:Te("string")};class Ia{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new L(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Id{constructor(e){this._methodName=e}}class _t{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:_t._jsonSchemaVersion}}static fromJSON(e){if(Kr(e,_t._jsonSchema))return new _t(e.latitude,e.longitude)}}_t._jsonSchemaVersion="firestore/geoPoint/1.0",_t._jsonSchema={type:Te("string",_t._jsonSchemaVersion),latitude:Te("number"),longitude:Te("number")};class yt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:yt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Kr(e,yt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new yt(e.vectorValues);throw new L(k.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}yt._jsonSchemaVersion="firestore/vectorValue/1.0",yt._jsonSchema={type:Te("string",yt._jsonSchemaVersion),vectorValues:Te("object")};const zv=/^__.*__$/;class Hv{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Sn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qr(e,this.data,t,this.fieldTransforms)}}function wd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{Ac:n})}}class wa{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new wa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Qs(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(wd(this.Ac)&&zv.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Wv{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fi(e)}Cc(e,t,r,s=!1){return new wa({Ac:e,methodName:t,Dc:r,path:ke.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Gv(n){const e=n._freezeSettings(),t=fi(n._databaseId);return new Wv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kv(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);bd("Data must be an object, but it was:",a,r);const u=Rd(r,a);let h,d;if(o.merge)h=new ot(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const E of o.mergeFields){const I=Qv(e,E,t);if(!a.contains(I))throw new L(k.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);Xv(p,I)||p.push(I)}h=new ot(p),d=a.fieldTransforms.filter((E=>h.covers(E.field)))}else h=null,d=a.fieldTransforms;return new Hv(new et(u),h,d)}function Ad(n,e){if(Sd(n=He(n)))return bd("Unsupported field value:",e,n),Rd(n,e);if(n instanceof Id)return(function(r,s){if(!wd(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=Ad(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=He(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return My(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=le.fromDate(r);return{timestampValue:zs(s.serializer,o)}}if(r instanceof le){const o=new le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:zs(s.serializer,o)}}if(r instanceof _t)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof tt)return{bytesValue:jh(s.serializer,r._byteString)};if(r instanceof Re){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:aa(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof yt)return(function(a,u){return{mapValue:{fields:{[gh]:{stringValue:_h},[Us]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return sa(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Xo(r)}`)})(n,e)}function Rd(n,e){const t={};return lh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):An(n,((r,s)=>{const o=Ad(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function Sd(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof le||n instanceof _t||n instanceof tt||n instanceof Re||n instanceof Id||n instanceof yt)}function bd(n,e,t){if(!Sd(t)||!ch(t)){const r=Xo(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Qv(n,e,t){if((e=He(e))instanceof Ia)return e._internalPath;if(typeof e=="string")return Pd(n,e);throw Qs("Field path arguments must be of type string or ",n,!1,void 0,t)}const Yv=new RegExp("[~\\*/\\[\\]]");function Pd(n,e,t){if(e.search(Yv)>=0)throw Qs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ia(...e.split("."))._internalPath}catch{throw Qs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Qs(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new L(k.INVALID_ARGUMENT,u+n+h)}function Xv(n,e){return n.some((t=>t.isEqual(e)))}class Cd{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Re(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Jv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(kd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Jv extends Cd{data(){return super.data()}}function kd(n,e){return typeof e=="string"?Pd(n,e):e instanceof Ia?e._internalPath:e._delegate._internalPath}function Zv(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new L(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class eT{convertValue(e,t="none"){switch(tn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(en(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return An(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[Us].arrayValue?.values?.map((r=>Ee(r.doubleValue)));return new yt(t)}convertGeoPoint(e){return new _t(Ee(e.latitude),Ee(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=oi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Lr(e));default:return null}}convertTimestamp(e){const t=Zt(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ue.fromString(e);re(Gh(r),9688,{name:e});const s=new xr(r.get(1),r.get(3)),o=new B(r.popFirst(5));return s.isEqual(t)||Ct(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function tT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Rr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mn extends Cd{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new bs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(kd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new L(k.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=mn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}mn._jsonSchemaVersion="firestore/documentSnapshot/1.0",mn._jsonSchema={type:Te("string",mn._jsonSchemaVersion),bundleSource:Te("string","DocumentSnapshot"),bundleName:Te("string"),bundle:Te("string")};class bs extends mn{data(e={}){return super.data(e)}}class jn{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Rr(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new bs(this._firestore,this._userDataWriter,r.key,r,new Rr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new L(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new bs(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Rr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new bs(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Rr(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:nT(u.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new L(k.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=jn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Yo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function nT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:n})}}function Dd(n){n=Tn(n,Re);const e=Tn(n.firestore,yi);return Fv(Ta(e),n._key).then((t=>iT(e,n,t)))}jn._jsonSchemaVersion="firestore/querySnapshot/1.0",jn._jsonSchema={type:Te("string",jn._jsonSchemaVersion),bundleSource:Te("string","QuerySnapshot"),bundleName:Te("string"),bundle:Te("string")};class Vd extends eT{constructor(e){super(),this.firestore=e}convertBytes(e){return new tt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Re(this.firestore,null,t)}}function rT(n){n=Tn(n,_i);const e=Tn(n.firestore,yi),t=Ta(e),r=new Vd(e);return Zv(n._query),Uv(t,n._query).then((s=>new jn(e,r,n,s)))}function Lo(n,e,t){n=Tn(n,Re);const r=Tn(n.firestore,yi),s=tT(n.converter,e,t);return sT(r,[Kv(Gv(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,St.none())])}function sT(n,e){return(function(r,s){const o=new Rt;return r.asyncQueue.enqueueAndForget((async()=>Sv(await xv(r),s,o))),o.promise})(Ta(n),e)}function iT(n,e,t){const r=t.docs.get(e._key),s=new Vd(n);return new mn(n,s,e._key,r,new Rr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){Jn=s})(Yn),qn(new _n("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new yi(new W_(r.getProvider("auth-internal")),new Q_(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new L(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xr(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Qt(nu,ru,e),Qt(nu,ru,"esm2020")})();const oT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},Nd=ml(oT),Ys=q_(Nd),jr=qv(Nd),Tt=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var aT=Ve("<p> </p>"),cT=Ve(`<div class="login svelte-2v2n6f"><br/> <h2>The Good Calendar</h2> <p>Here, you can log the quality of your days and nights for posterity. Dedicated to my girlfriend and her chronic migranes.</p> <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem; "><input type="text" placeholder="Username" class="login_input svelte-2v2n6f" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input svelte-2v2n6f" style="width: 200px;"/> <button style="
          position: absolute;
          right: -45px;
          top: 50%;
          transform: translateY(-50%);
          border-radius: 10%;
          font-size: 0.75rem;
          padding: 0.1rem 0.25rem;
          white-space: nowrap;
        "> </button></div></div> <!> <div style="align-items: center"><button>Login</button> <button>Sign up</button></div></div>`);function uT(n,e){Js(e,!1),cf();let t=_e(""),r=_e(""),s=_e(""),o=_e(!0);async function a(){W(s,"");try{const U=`${P(t)}@tracker.app`,T=await Sg(Ys,U,P(r))}catch(U){console.error(U),W(s,U.message)}}async function u(){W(s,"");try{const U=`${P(t)}@tracker.app`,T=await bg(Ys,U,P(r))}catch(U){console.error(U),W(s,U.message)}}function h(U){switch(U){case"Firebase: Error (auth/invalid-credential).":return"Incorrect password or the account doesn't exist";case"Firebase: Missing password requirements: [Password must contain at least 6 characters] (auth/password-does-not-meet-requirements).":return"Password must contain at least 6 characters";case"Firebase: Error (auth/email-already-in-use).":return"This account already exists.";case"Firebase: Error (auth/invalid-email).":return"Your username cannot have any spaces";case"Firebase: Error (auth/missing-password).":return"Missing password";default:return U}}Xs();var d=cT(),p=ne(ae(d),2),E=ne(p,4),I=ae(E);co(I);var R=ne(I,2),D=ae(R);co(D);var V=ne(D,2),b=ae(V,!0);oe(V),oe(R),oe(E);var x=ne(E,2);{var F=U=>{var T=aT(),m=ae(T,!0);oe(T),Ke(y=>Xe(m,y),[()=>h(P(s))]),ge(U,T)};nt(x,U=>{P(s)&&U(F)})}var M=ne(x,2),$=ae(M),G=ne($,2);oe(M),oe(d),Ke(()=>{Wt(p,`background: url(${Tt}); no-repeat; background-size: cover; 
  -webkit-background-clip: text; -webkit-text-fill-color: transparent`),nl(D,"type",P(o)?"password":"text"),Xe(b,P(o)?"show":"hide")}),Ps(I,()=>P(t),U=>W(t,U)),Ps(D,()=>P(r),U=>W(r,U)),st("click",V,()=>W(o,!P(o))),st("click",$,u),st("click",G,a),ge(n,d),Zs()}var lT=Ve("<h3>Entry logged!</h3>"),hT=Ve('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),dT=Ve('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Check again tomorrow.</h4>',1),fT=Ve('<div class="overlay"><!> <button>Return</button></div>'),pT=Ve('<br/> <div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3></div>',1),mT=Ve('<div class="question"><h2></h2> <h3 style="margin-top: .25rem; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..."></textarea><br/> <button> </button></div>'),gT=Ve('<!> <button class="hiddencheck svelte-kkv8mu"></button>',1);function _T(n,e){Js(e,!1);let t=zt(e,"user",8),r=zt(e,"externalEntry",12,null),s=zt(e,"onSaved",8,()=>{}),o=zt(e,"invert",8),a=new Date;const u=a.getFullYear(),h=a.getMonth(),d=a.getDate();function p(K){return K.toString().padStart(2,"0")}let E=t().uid;t().email?name=t().email.replace("@tracker.app","").charAt(0).toUpperCase()+t().email.replace("@tracker.app","").slice(1):name="Temp";let I=`${u}-${p(h+1)}-${p(d)}`,R=_e(5),D=_e(""),V=_e(!1),b=_e(""),x=_e(!1),F=_e(""),M=_e(""),$=_e(!1),U=new Date().getHours()<16?"day":"night";function T(K){return o()&&(K=10-K),`hsl(${120*(K/10)}, 70%, 65%)`}function m(){return P(R)/10}async function y(){const K=Ks(jr,"users",E,"entries",I),te=await Dd(K);console.log(te.data()),te.exists()&&te.data().valueDay&&te.data().valueNight&&(W(V,!0),W(M,"Check again tomorrow"))}async function v(K){if(P(V)&&!P($))return;W(x,!0),W(V,!0);const te=Ks(jr,"users",E,"entries",K.key);K.period==="day"?(await Lo(te,{valueDay:P(R),textDay:P(D),timestamp:Date.now()},{merge:!0}),K.filledNight&&W(M,"Check again tomorrow")):(await Lo(te,{valueNight:P(R),textNight:P(D),timestamp:Date.now()},{merge:!0}),K.filledDay&&W(M,"Check again tomorrow")),console.log("Logged "+K.key+" at "+K.period),W(R,5),W(D,""),s()()}function g(){W(x,!1)}xo(y),Er(()=>Ye(r()),()=>{r()||(console.log("Selection reset to today (at "+U+")"),r({key:I,period:U,current:!0,filledDay:!1,filledNight:!1}))}),Er(()=>Ye(r()),()=>{if(r()){let K=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&K?W(V,!0):!r().current&&!K?W(V,!0):r().current&&K?W(V,!1):r().current&&!K&&W(V,!1)}}),Er(()=>(Ye(o()),P(R)),()=>{o()?W(b,P(R)<=0?"celebrate":""):W(b,P(R)>=10?"celebrate":"")}),Er(()=>(Ye(o()),P(R)),()=>{(o()||P(R))&&W(F,T(P(R)))}),tl(),Xs();var w=gT(),_=$t(w);{var ee=K=>{var te=fT(),he=ae(te);{var Qe=de=>{var pe=lT();ge(de,pe)},Ie=de=>{var pe=oo(),We=$t(pe);{var ct=$e=>{var rt=hT();wc(2),ge($e,rt)},qe=$e=>{var rt=dT();wc(2),ge($e,rt)};nt(We,$e=>{Ye(r()),ye(()=>r().period==="night"&&!r().filledDay)?$e(ct):$e(qe,!1)},!0)}ge(de,pe)};nt(he,de=>{Ye(r()),ye(()=>r().period==="day"&&!r().filledNight)?de(Qe):de(Ie,!1)})}var Ue=ne(he,2);Ue.__click=g,oe(te),ge(K,te)},se=K=>{var te=oo(),he=$t(te);{var Qe=Ue=>{var de=pT(),pe=ne($t(de),2),We=ae(pe);We.textContent=`Welcome ${name??""}!`;var ct=ne(We,2),qe=ae(ct,!0);oe(ct),oe(pe),Ke(()=>{Wt(We,`background: url(${Tt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),Xe(qe,P(M)||"Viewing past entries")}),ge(Ue,de)},Ie=Ue=>{var de=mT(),pe=ae(de);pe.textContent=`Welcome ${name??""}!`;var We=ne(pe,2),ct=ae(We);oe(We);var qe=ne(We,2);co(qe);var $e=ne(qe,2);Nf($e);var rt=ne($e,3);rt.__click=()=>v(r());var Ei=ae(rt);oe(rt),oe(de),Ke((an,Zr)=>{Wt(pe,`background: url(${Tt}); no-repeat; background-size: cover; 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0px`),Xe(ct,`Rate your ${Ye(r()),ye(()=>r().period==="day"?"day":"night")??""}`),qe.disabled=P(V)&&!P($),$f(qe,1,Bf(P(b)),"svelte-kkv8mu"),Wt(qe,`--fill-percentage: ${an??""}%; --slider-color: ${P(F)??""}`),rt.disabled=P(V)&&!P($),Xe(Ei,`Save (${Zr??""}/10)`)},[()=>ye(m),()=>(P(R),ye(()=>P(R).toFixed(1)))]),Ps(qe,()=>P(R),an=>W(R,an)),Ps($e,()=>P(D),an=>W(D,an)),ge(Ue,de)};nt(he,Ue=>{P(V)&&!P($)?Ue(Qe):Ue(Ie,!1)})}ge(K,te)};nt(_,K=>{P(x)?K(ee):K(se,!1)})}var Ne=ne(_,2);Ne.__dblclick=()=>{console.log("Activated override!"),W($,!P($))},ge(n,w),Zs()}Of(["click","dblclick"]);var yT=Ve('<div class="day svelte-dw9jm0"><div class="day-number svelte-dw9jm0"> </div> <div class="day-half top-half svelte-dw9jm0"></div> <div class="day-half bottom-half svelte-dw9jm0"></div></div>'),ET=Ve("<!> <br/> <i> </i>",1),vT=Ve("<!> <br/> <i> </i>",1),TT=Ve('<div class="entry-info svelte-dw9jm0"><strong> </strong> <!></div>'),IT=Ve('<div class="month-nav svelte-dw9jm0"><button class="nav-btn svelte-dw9jm0" aria-label="Previous month"></button> <p> </p> <button class="nav-btn svelte-dw9jm0" aria-label="Next month"></button></div> <div class="calendar svelte-dw9jm0"></div> <!>',1);function wT(n,e){Js(e,!1);let t=zt(e,"user",8),r=zt(e,"onSelectEntry",8,v=>{}),s=zt(e,"reloadTrigger",8,0),o=zt(e,"invert",8),a=t().uid,u=_e([]),h=_e(null),d=_e(new Date),p=_e("");function E(v){return v==null?"#fff":`hsl(${120*(v/10)}, 70%, 65%)`}function I(v){return v.toString().padStart(2,"0")}async function R(){console.log("Loaded calendar entries");const v=P(d).getFullYear(),g=P(d).getMonth(),w=new Date,_=new Date(v,g+1,0).getDate();W(p,P(d).toLocaleString("default",{month:"long",year:"numeric"}));const ee=jv(jr,"users",a,"entries"),se=await rT(ee),Ne={};se.forEach(he=>{Ne[he.id]=he.data()});const K=[],te=v===w.getFullYear()&&g===w.getMonth()?w.getDate():_;for(let he=1;he<=te;he++){const Qe=`${v}-${I(g+1)}-${I(he)}`,Ie=Ne[Qe];K.push({key:Qe,day:he,filledDay:Ie?.valueDay!=null,filledNight:Ie?.valueNight!=null,valueDay:Ie?.valueDay??null,valueNight:Ie?.valueNight??null,textDay:Ie?.textDay??null,textNight:Ie?.textNight??null,current:v===w.getFullYear()&&g===w.getMonth()&&he===w.getDate()})}W(u,K)}function D(v){W(h,v),r()(v),console.log("Selected "+v.key)}function V(){const v=new Date(P(d));v.setMonth(v.getMonth()-1),W(d,v),R(),W(h,null)}function b(){const v=new Date,g=new Date(P(d));g.setMonth(g.getMonth()+1),!(g.getFullYear()>v.getFullYear()||g.getFullYear()===v.getFullYear()&&g.getMonth()>v.getMonth())&&(W(d,g),R(),W(h,null))}xo(R),Er(()=>Ye(s()),()=>{s()&&R()}),tl(),Xs();var x=IT(),F=$t(x),M=ae(F),$=ne(M,2),G=ae($,!0);oe($);var U=ne($,2);oe(F);var T=ne(F,2);xf(T,5,()=>P(u),Mf,(v,g)=>{var w=yT(),_=ae(w),ee=ae(_,!0);oe(_);var se=ne(_,2),Ne=ne(se,2);oe(w),Ke((K,te)=>{Wt(w,(P(g),ye(()=>P(g).current?"border: 1.5px solid #333;":""))),Xe(ee,(P(g),ye(()=>P(g).day))),Wt(se,K),Wt(Ne,te)},[()=>(Ye(o()),P(g),Ye(Tt),ye(()=>!o()&&P(g).valueDay==10?`background: url('${Tt}'); background-size: cover;`:o()&&P(g).valueDay==0?`background: url('${Tt}'); background-size: cover;`:`background-color: ${E(P(g).valueDay!=null&&!o()?P(g).valueDay:P(g).valueDay!=null?10-P(g).valueDay:null)};`)),()=>(Ye(o()),P(g),Ye(Tt),ye(()=>!o()&&P(g).valueNight==10?`background: url('${Tt}'); background-size: cover;`:o()&&P(g).valueNight==0?`background: url('${Tt}'); background-size: cover;`:`background-color: ${E(P(g).valueNight!=null&&!o()?P(g).valueNight:P(g).valueNight!=null?10-P(g).valueNight:null)};`))]),st("click",se,()=>D({...P(g),period:"day"})),st("click",Ne,()=>D({...P(g),period:"night"})),ge(v,w)}),oe(T);var m=ne(T,2);{var y=v=>{var g=TT(),w=ae(g),_=ae(w);oe(w);var ee=ne(w,2);{var se=K=>{var te=ET(),he=$t(te);{var Qe=de=>{var pe=vc();Ke(()=>Xe(pe,` ${P(h),ye(()=>P(h).valueDay)??""}/10`)),ge(de,pe)};nt(he,de=>{P(h),ye(()=>P(h).filledDay)&&de(Qe)})}var Ie=ne(he,4),Ue=ae(Ie,!0);oe(Ie),Ke(()=>Xe(Ue,(P(h),ye(()=>P(h).textDay||"No Entry")))),ge(K,te)},Ne=K=>{var te=vT(),he=$t(te);{var Qe=de=>{var pe=vc();Ke(()=>Xe(pe,` ${P(h),ye(()=>P(h).valueNight)??""}/10`)),ge(de,pe)};nt(he,de=>{P(h),ye(()=>P(h).filledNight)&&de(Qe)})}var Ie=ne(he,4),Ue=ae(Ie,!0);oe(Ie),Ke(()=>Xe(Ue,(P(h),ye(()=>P(h).textNight||"No Entry")))),ge(K,te)};nt(ee,K=>{P(h),ye(()=>P(h).period==="day")?K(se):K(Ne,!1)})}oe(g),Ke(K=>Xe(_,`${K??""} ${P(h),ye(()=>P(h).period==="day"?"Day":"Night")??""}`),[()=>(P(h),ye(()=>new Date(new Date(P(h).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),ge(v,g)};nt(m,v=>{P(h),ye(()=>P(h)&&!(P(h).period==="day"&&!P(h).filledDay&&P(h).current||P(h).period==="night"&&!P(h).filledNight&&P(h).current))&&v(y)})}Ke(v=>{Xe(G,P(p)),U.disabled=v},[()=>(P(d),ye(()=>P(d).getFullYear()===new Date().getFullYear()&&P(d).getMonth()===new Date().getMonth()))]),st("click",M,V),st("click",U,b),ge(n,x),Zs()}const AT="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20352%20512'%3e%3c!--!Font%20Awesome%20Free%205.15.4%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202025%20Fonticons,%20Inc.--%3e%3cpath%20d='M176%2080c-52.94%200-96%2043.06-96%2096%200%208.84%207.16%2016%2016%2016s16-7.16%2016-16c0-35.3%2028.72-64%2064-64%208.84%200%2016-7.16%2016-16s-7.16-16-16-16zM96.06%20459.17c0%203.15.93%206.22%202.68%208.84l24.51%2036.84c2.97%204.46%207.97%207.14%2013.32%207.14h78.85c5.36%200%2010.36-2.68%2013.32-7.14l24.51-36.84c1.74-2.62%202.67-5.7%202.68-8.84l.05-43.18H96.02l.04%2043.18zM176%200C73.72%200%200%2082.97%200%20176c0%2044.37%2016.45%2084.85%2043.56%20115.78%2016.64%2018.99%2042.74%2058.8%2052.42%2092.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.54-23.43-31.52-53.15-31.61-84.14-.2-73.64%2059.67-128%20127.95-128%2070.58%200%20128%2057.42%20128%20128%200%2030.97-11.24%2060.85-31.65%2084.14-39.11%2044.61-56.42%2091.47-62.1%20109.46a47.507%2047.507%200%200%200-2.22%2014.3v.1h48v-.05c9.68-33.37%2035.78-73.18%2052.42-92.16C335.55%20260.85%20352%20220.37%20352%20176%20352%2078.8%20273.2%200%20176%200z'/%3e%3c/svg%3e";var RT=Ve("<button>Invert</button>"),ST=Ve('<div class="overlay"><div style="width: 65%; text-align:left"><span>Click on the top half of the current date to log an entry for <strong>today</strong>. Click on the bottom half to log an entry for <b>tonight</b>. Entries are only editable on the current day. <br/><br/>To reverse the red-green color scheme, click "Invert" in the bottom-right corner. Your preferences will be saved for the next time you login!</span></div> <br/><br/> <button>Return</button></div>'),bT=Ve(`<div style="display: flex;
  flex-direction: column;
  min-height: 100vh;"><div style="flex-grow: 1;"><!> <!></div> <div style="display: flex;
    justify-content: space-between;
    padding-left: 5%;
    padding-right: 5%;
    margin-bottom: 5%;"><div><button>Log Out</button> <button style="padding: .3rem inherit;"><img width="12px" style="transform: translateY(15%);"/></button></div> <!> <!></div></div>`);function LT(n,e){Js(e,!1);let t=_e(null),r=_e(null),s=_e(0),o=_e(null),a=_e(!1);kg(Ys,b=>{E(b),W(t,b)});async function u(){if(!P(t))return;W(o,!P(o));const b=Ks(jr,"users",P(t).uid);await Lo(b,{colorPreference:P(o),timestamp:Date.now()},{merge:!0}),console.log("Saved user profile invert="+P(o))}function h(){W(s,P(s)+1)}function d(){Dg(Ys),W(t,null),W(r,null)}function p(b){W(r,b)}async function E(b){if(!b)return;const x=Ks(jr,"users",b.uid),F=await Dd(x);F.exists()?(W(o,F.data().colorPreference),console.log("Loaded user profile invert="+P(o))):W(o,!1)}xo(E),Xs();var I=oo(),R=$t(I);{var D=b=>{uT(b,{})},V=b=>{var x=bT(),F=ae(x),M=ae(F);_T(M,{get user(){return P(t)},get externalEntry(){return P(r)},onSaved:h,get invert(){return P(o)}});var $=ne(M,2);wT($,{get user(){return P(t)},onSelectEntry:p,get reloadTrigger(){return P(s)},get invert(){return P(o)}}),oe(F);var G=ne(F,2),U=ae(G),T=ae(U),m=ne(T,2),y=ae(m);oe(m),oe(U);var v=ne(U,2);{var g=ee=>{var se=RT();let Ne;Ke(()=>Ne=Wt(se,"",Ne,{"background-color":P(o)?"hsl(0, 70%, 65%)":"hsl(120, 70%, 65%)"})),st("click",se,u),ge(ee,se)};nt(v,ee=>{P(o)!=null&&ee(g)})}var w=ne(v,2);{var _=ee=>{var se=ST(),Ne=ne(ae(se),5);oe(se),st("click",Ne,()=>{W(a,!P(a))}),ge(ee,se)};nt(w,ee=>{P(a)&&ee(_)})}oe(G),oe(x),Ke(()=>nl(y,"src",AT)),st("click",T,d),st("click",m,()=>{W(a,!P(a))}),ge(b,x)};nt(R,b=>{P(t)?b(V,!1):b(D)})}ge(n,I),Zs()}export{LT as component};
