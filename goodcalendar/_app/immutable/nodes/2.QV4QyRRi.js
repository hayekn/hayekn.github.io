import{f as ge,a as ie,t as Ao,c as Bs}from"../chunks/BysJwN_t.js";import{i as Ei}from"../chunks/BmcIUVPK.js";import{P as io,h as pt,a4 as ff,e as iu,I as pf,H as mf,t as A,U as gf,K as _f,M as yf,O as Dc,Q as oo,i as Lr,aa as vf,aF as Ef,f as Ro,s as Tf,c as Qn,aD as ou,z as If,aI as ae,af as Vc,ao as wf,r as au,p as Af,aM as Rf,aN as ao,d as cu,aO as bf,aP as Sf,ab as Pf,aQ as Cf,aC as kf,aR as Df,Y as Vf,aS as Nf,aK as Of,l as we,ag as Mf,aT as xf,A as Ti,G as $,E as Q,F as W,ap as bo,C as $e,D as Ii,W as N,aU as zr,aV as lu,B as St,v as mt,aW as Lf,aX as Ns}from"../chunks/KuIhI81p.js";import{s as ze,e as me,d as Ff}from"../chunks/BIAasXF6.js";import{i as Se,p as Pt}from"../chunks/DnMetUdW.js";import{r as tr,s as uu}from"../chunks/BtxzV7Uf.js";import{c as Uf,o as Bf}from"../chunks/YV_QUl1D.js";import"../chunks/8UtF8RsF.js";function hu(n,e){return e}function jf(n,e,t){for(var r=n.items,s=[],o=e.length,a=0;a<o;a++)Cf(e[a].e,s,!0);var l=o>0&&s.length===0&&t!==null;if(l){var h=t.parentNode;kf(h),h.append(t),r.clear(),Rt(n,e[0].prev,e[o-1].next)}Df(s,()=>{for(var d=0;d<o;d++){var p=e[d];l||(r.delete(p.k),Rt(n,p.prev,p.next)),cu(p.e,!l)}})}function du(n,e,t,r,s,o=null){var a=n,l={flags:e,items:new Map,first:null};{var h=n;a=pt?io(ff(h)):h.appendChild(iu())}pt&&pf();var d=null,p=!1,v=new Map,E=gf(()=>{var k=t();return If(k)?k:k==null?[]:ou(k)}),R,P;function V(){qf(P,R,l,v,a,s,e,r,t),o!==null&&(R.length===0?d?au(d):d=Ro(()=>o(a)):d!==null&&Af(d,()=>{d=null}))}mf(()=>{P??=Vf,R=A(E);var k=R.length;if(p&&k===0)return;p=k===0;let U=!1;if(pt){var B=_f(a)===yf;B!==(k===0)&&(a=Dc(),io(a),oo(!1),U=!0)}if(pt){for(var L=null,K,q=0;q<k;q++){if(Lr.nodeType===vf&&Lr.data===Ef){a=Lr,U=!0,oo(!1);break}var J=R[q],I=r(J,q);K=So(Lr,l,L,null,J,I,q,s,e,t),l.items.set(I,K),L=K}k>0&&io(Dc())}if(pt)k===0&&o&&(d=Ro(()=>o(a)));else if(Tf()){var m=new Set,_=Qn;for(q=0;q<k;q+=1){J=R[q],I=r(J,q);var w=l.items.get(I)??v.get(I);w?fu(w,J,q):(K=So(null,l,null,null,J,I,q,s,e,t,!0),v.set(I,K)),m.add(I)}for(const[y,T]of l.items)m.has(y)||_.skipped_effects.add(T.e);_.oncommit(V)}else V();U&&oo(!0),A(E)}),pt&&(a=Lr)}function qf(n,e,t,r,s,o,a,l,h){var d=e.length,p=t.items,v=t.first,E=v,R,P=null,V=[],k=[],U,B,L,K;for(K=0;K<d;K+=1){if(U=e[K],B=l(U,K),L=p.get(B),L===void 0){var q=r.get(B);if(q!==void 0){r.delete(B),p.set(B,q);var J=P?P.next:E;Rt(t,P,q),Rt(t,q,J),co(q,J,s),P=q}else{var I=E?E.e.nodes_start:s;P=So(I,t,P,P===null?t.first:P.next,U,B,K,o,a,h)}p.set(B,P),V=[],k=[],E=P.next;continue}if(fu(L,U,K),(L.e.f&ao)!==0&&au(L.e),L!==E){if(R!==void 0&&R.has(L)){if(V.length<k.length){var m=k[0],_;P=m.prev;var w=V[0],y=V[V.length-1];for(_=0;_<V.length;_+=1)co(V[_],m,s);for(_=0;_<k.length;_+=1)R.delete(k[_]);Rt(t,w.prev,y.next),Rt(t,P,w),Rt(t,y,m),E=m,P=y,K-=1,V=[],k=[]}else R.delete(L),co(L,E,s),Rt(t,L.prev,L.next),Rt(t,L,P===null?t.first:P.next),Rt(t,P,L),P=L;continue}for(V=[],k=[];E!==null&&E.k!==B;)(E.e.f&ao)===0&&(R??=new Set).add(E),k.push(E),E=E.next;if(E===null)continue;L=E}V.push(L),P=L,E=L.next}if(E!==null||R!==void 0){for(var T=R===void 0?[]:ou(R);E!==null;)(E.e.f&ao)===0&&T.push(E),E=E.next;var g=T.length;if(g>0){var M=d===0?s:null;jf(t,T,M)}}n.first=t.first&&t.first.e,n.last=P&&P.e;for(var se of r.values())cu(se.e);r.clear()}function fu(n,e,t,r){wf(n.v,e),n.i=t}function So(n,e,t,r,s,o,a,l,h,d,p){var v=(h&bf)!==0,E=(h&Sf)===0,R=v?E?ae(s,!1,!1):Vc(s):s,P=(h&Rf)===0?a:Vc(a),V={i:P,v:R,k:o,a:null,e:null,prev:t,next:r};try{if(n===null){var k=document.createDocumentFragment();k.append(n=iu())}return V.e=Ro(()=>l(n,R,P,d),pt),V.e.prev=t&&t.e,V.e.next=r&&r.e,t===null?p||(e.first=V):(t.next=V,t.e.next=V.e),r!==null&&(r.prev=V,r.e.prev=V.e),V}finally{}}function co(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,o=n.e.nodes_start;o!==null&&o!==r;){var a=Pf(o);s.before(o),o=a}}function Rt(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function pu(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=pu(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function $f(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=pu(n))&&(r&&(r+=" "),r+=e);return r}function zf(n){return typeof n=="object"?$f(n):n??""}function Hf(n,e,t){var r=n==null?"":""+n;return r=r?r+" "+e:e,r===""?null:r}function Wf(n,e){return n==null?null:String(n)}function Gf(n,e,t,r,s,o){var a=n.__className;if(pt||a!==t||a===void 0){var l=Hf(t,r);(!pt||l!==n.getAttribute("class"))&&(l==null?n.removeAttribute("class"):n.className=l),n.__className=t}return o}function nr(n,e,t,r){var s=n.__style;if(pt||s!==e){var o=Wf(e);(!pt||o!==n.getAttribute("style"))&&(o==null?n.removeAttribute("style"):n.style.cssText=o),n.__style=e}return r}function Vn(n,e,t=e){var r=new WeakSet;Nf(n,"input",async s=>{var o=s?n.defaultValue:n.value;if(o=lo(n)?uo(o):o,t(o),Qn!==null&&r.add(Qn),await Of(),o!==(o=e())){var a=n.selectionStart,l=n.selectionEnd,h=n.value.length;if(n.value=o??"",l!==null){var d=n.value.length;a===l&&l===h&&d>h?(n.selectionStart=d,n.selectionEnd=d):(n.selectionStart=a,n.selectionEnd=Math.min(l,d))}}}),(pt&&n.defaultValue!==n.value||we(e)==null&&n.value)&&(t(lo(n)?uo(n.value):n.value),Qn!==null&&r.add(Qn)),Mf(()=>{var s=e();if(n===document.activeElement){var o=xf??Qn;if(r.has(o))return}lo(n)&&s===uo(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function lo(n){var e=n.type;return e==="number"||e==="range"}function uo(n){return n===""?null:+n}const Kf=()=>{};var Nc={};const mu=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Qf=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],l=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},gu={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,v=(o&3)<<4|l>>4;let E=(l&15)<<2|d>>6,R=d&63;h||(R=64,a||(E=64)),r.push(t[p],t[v],t[E],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(mu(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Qf(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const v=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||l==null||d==null||v==null)throw new Yf;const E=o<<2|l>>4;if(r.push(E),d!==64){const R=l<<4&240|d>>2;if(r.push(R),v!==64){const P=d<<6&192|v;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Yf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Xf=function(n){const e=mu(n);return gu.encodeByteArray(e,!0)},Js=function(n){return Xf(n).replace(/\./g,"")},_u=function(n){try{return gu.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Jf(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Zf=()=>Jf().__FIREBASE_DEFAULTS__,ep=()=>{if(typeof process>"u"||typeof Nc>"u")return;const n=Nc.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},tp=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_u(n[1]);return e&&JSON.parse(e)},wi=()=>{try{return Kf()||Zf()||ep()||tp()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yu=n=>wi()?.emulatorHosts?.[n],np=n=>{const e=yu(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},vu=()=>wi()?.config,Eu=n=>wi()?.[`_${n}`];class rp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function mr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Tu(n){return(await fetch(n,{credentials:"include"})).ok}function sp(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Js(JSON.stringify(t)),Js(JSON.stringify(a)),""].join(".")}const Hr={};function ip(){const n={prod:[],emulator:[]};for(const e of Object.keys(Hr))Hr[e]?n.emulator.push(e):n.prod.push(e);return n}function op(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Oc=!1;function Iu(n,e){if(typeof window>"u"||typeof document>"u"||!mr(window.location.host)||Hr[n]===e||Hr[n]||Oc)return;Hr[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",o=ip().prod.length>0;function a(){const E=document.getElementById(r);E&&E.remove()}function l(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,R){E.setAttribute("width","24"),E.setAttribute("id",R),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Oc=!0,a()},E}function p(E,R){E.setAttribute("id",R),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function v(){const E=op(r),R=t("text"),P=document.getElementById(R)||document.createElement("span"),V=t("learnmore"),k=document.getElementById(V)||document.createElement("a"),U=t("preprendIcon"),B=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const L=E.element;l(L),p(k,V);const K=d();h(B,U),L.append(B,P,k,K),document.body.appendChild(L)}o?(P.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function st(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ap(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(st())}function cp(){const n=wi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function lp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function up(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function hp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dp(){const n=st();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function fp(){return!cp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pp(){try{return typeof indexedDB=="object"}catch{return!1}}function mp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const gp="FirebaseError";class Qt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=gp,Object.setPrototypeOf(this,Qt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,as.prototype.create)}}class as{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?_p(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Qt(s,l,r)}}function _p(n,e){return n.replace(yp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const yp=/\{\$([^}]+)}/g;function vp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function On(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(Mc(o)&&Mc(a)){if(!On(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Mc(n){return n!==null&&typeof n=="object"}function cs(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Fr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Ur(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Ep(n,e){const t=new Tp(n,e);return t.subscribe.bind(t)}class Tp{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Ip(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=ho),s.error===void 0&&(s.error=ho),s.complete===void 0&&(s.complete=ho);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ip(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function ho(){}function He(n){return n&&n._delegate?n._delegate:n}class Mn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const kn="[DEFAULT]";class wp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new rp;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Rp(e))try{this.getOrInitializeService({instanceIdentifier:kn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=kn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=kn){return this.instances.has(e)}getOptions(e=kn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ap(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=kn){return this.component?this.component.multipleInstances?e:kn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ap(n){return n===kn?void 0:n}function Rp(n){return n.instantiationMode==="EAGER"}class bp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Z||(Z={}));const Sp={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},Pp=Z.INFO,Cp={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},kp=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Cp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ea{constructor(e){this.name=e,this._logLevel=Pp,this._logHandler=kp,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Sp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}const Dp=(n,e)=>e.some(t=>n instanceof t);let xc,Lc;function Vp(){return xc||(xc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Np(){return Lc||(Lc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wu=new WeakMap,Po=new WeakMap,Au=new WeakMap,fo=new WeakMap,ta=new WeakMap;function Op(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(un(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&wu.set(t,n)}).catch(()=>{}),ta.set(e,n),e}function Mp(n){if(Po.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Po.set(n,e)}let Co={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Po.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Au.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return un(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function xp(n){Co=n(Co)}function Lp(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(po(this),e,...t);return Au.set(r,e.sort?e.sort():[e]),un(r)}:Np().includes(n)?function(...e){return n.apply(po(this),e),un(wu.get(this))}:function(...e){return un(n.apply(po(this),e))}}function Fp(n){return typeof n=="function"?Lp(n):(n instanceof IDBTransaction&&Mp(n),Dp(n,Vp())?new Proxy(n,Co):n)}function un(n){if(n instanceof IDBRequest)return Op(n);if(fo.has(n))return fo.get(n);const e=Fp(n);return e!==n&&(fo.set(n,e),ta.set(e,n)),e}const po=n=>ta.get(n);function Up(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),l=un(a);return r&&a.addEventListener("upgradeneeded",h=>{r(un(a.result),h.oldVersion,h.newVersion,un(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Bp=["get","getKey","getAll","getAllKeys","count"],jp=["put","add","delete","clear"],mo=new Map;function Fc(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(mo.get(e))return mo.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=jp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Bp.includes(t)))return;const o=async function(a,...l){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&h.done]))[0]};return mo.set(e,o),o}xp(n=>({...n,get:(e,t,r)=>Fc(e,t)||n.get(e,t,r),has:(e,t)=>!!Fc(e,t)||n.has(e,t)}));class qp{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if($p(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function $p(n){return n.getComponent()?.type==="VERSION"}const ko="@firebase/app",Uc="0.14.5";const zt=new ea("@firebase/app"),zp="@firebase/app-compat",Hp="@firebase/analytics-compat",Wp="@firebase/analytics",Gp="@firebase/app-check-compat",Kp="@firebase/app-check",Qp="@firebase/auth",Yp="@firebase/auth-compat",Xp="@firebase/database",Jp="@firebase/data-connect",Zp="@firebase/database-compat",em="@firebase/functions",tm="@firebase/functions-compat",nm="@firebase/installations",rm="@firebase/installations-compat",sm="@firebase/messaging",im="@firebase/messaging-compat",om="@firebase/performance",am="@firebase/performance-compat",cm="@firebase/remote-config",lm="@firebase/remote-config-compat",um="@firebase/storage",hm="@firebase/storage-compat",dm="@firebase/firestore",fm="@firebase/ai",pm="@firebase/firestore-compat",mm="firebase",gm="12.5.0";const Do="[DEFAULT]",_m={[ko]:"fire-core",[zp]:"fire-core-compat",[Wp]:"fire-analytics",[Hp]:"fire-analytics-compat",[Kp]:"fire-app-check",[Gp]:"fire-app-check-compat",[Qp]:"fire-auth",[Yp]:"fire-auth-compat",[Xp]:"fire-rtdb",[Jp]:"fire-data-connect",[Zp]:"fire-rtdb-compat",[em]:"fire-fn",[tm]:"fire-fn-compat",[nm]:"fire-iid",[rm]:"fire-iid-compat",[sm]:"fire-fcm",[im]:"fire-fcm-compat",[om]:"fire-perf",[am]:"fire-perf-compat",[cm]:"fire-rc",[lm]:"fire-rc-compat",[um]:"fire-gcs",[hm]:"fire-gcs-compat",[dm]:"fire-fst",[pm]:"fire-fst-compat",[fm]:"fire-vertex","fire-js":"fire-js",[mm]:"fire-js-all"};const Zs=new Map,ym=new Map,Vo=new Map;function Bc(n,e){try{n.container.addComponent(e)}catch(t){zt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function cr(n){const e=n.name;if(Vo.has(e))return zt.debug(`There were multiple attempts to register component ${e}.`),!1;Vo.set(e,n);for(const t of Zs.values())Bc(t,n);for(const t of ym.values())Bc(t,n);return!0}function na(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function gt(n){return n==null?!1:n.settings!==void 0}const vm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hn=new as("app","Firebase",vm);class Em{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Mn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hn.create("app-deleted",{appName:this._name})}}const gr=gm;function Ru(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Do,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw hn.create("bad-app-name",{appName:String(s)});if(t||(t=vu()),!t)throw hn.create("no-options");const o=Zs.get(s);if(o){if(On(t,o.options)&&On(r,o.config))return o;throw hn.create("duplicate-app",{appName:s})}const a=new bp(s);for(const h of Vo.values())a.addComponent(h);const l=new Em(t,r,a);return Zs.set(s,l),l}function bu(n=Do){const e=Zs.get(n);if(!e&&n===Do&&vu())return Ru();if(!e)throw hn.create("no-app",{appName:n});return e}function dn(n,e,t){let r=_m[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),zt.warn(a.join(" "));return}cr(new Mn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Tm="firebase-heartbeat-database",Im=1,Jr="firebase-heartbeat-store";let go=null;function Su(){return go||(go=Up(Tm,Im,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Jr)}catch(t){console.warn(t)}}}}).catch(n=>{throw hn.create("idb-open",{originalErrorMessage:n.message})})),go}async function wm(n){try{const t=(await Su()).transaction(Jr),r=await t.objectStore(Jr).get(Pu(n));return await t.done,r}catch(e){if(e instanceof Qt)zt.warn(e.message);else{const t=hn.create("idb-get",{originalErrorMessage:e?.message});zt.warn(t.message)}}}async function jc(n,e){try{const r=(await Su()).transaction(Jr,"readwrite");await r.objectStore(Jr).put(e,Pu(n)),await r.done}catch(t){if(t instanceof Qt)zt.warn(t.message);else{const r=hn.create("idb-set",{originalErrorMessage:t?.message});zt.warn(r.message)}}}function Pu(n){return`${n.name}!${n.options.appId}`}const Am=1024,Rm=30;class bm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=qc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Rm){const s=Cm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){zt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=qc(),{heartbeatsToSend:t,unsentEntries:r}=Sm(this._heartbeatsCache.heartbeats),s=Js(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return zt.warn(e),""}}}function qc(){return new Date().toISOString().substring(0,10)}function Sm(n,e=Am){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),$c(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),$c(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Pm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pp()?mp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await wm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return jc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return jc(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function $c(n){return Js(JSON.stringify({version:2,heartbeats:n})).length}function Cm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function km(n){cr(new Mn("platform-logger",e=>new qp(e),"PRIVATE")),cr(new Mn("heartbeat",e=>new bm(e),"PRIVATE")),dn(ko,Uc,n),dn(ko,Uc,"esm2020"),dn("fire-js","")}km("");var Dm="firebase",Vm="12.5.0";dn(Dm,Vm,"app");function Cu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nm=Cu,ku=new as("auth","Firebase",Cu());const ei=new ea("@firebase/auth");function Om(n,...e){ei.logLevel<=Z.WARN&&ei.warn(`Auth (${gr}): ${n}`,...e)}function js(n,...e){ei.logLevel<=Z.ERROR&&ei.error(`Auth (${gr}): ${n}`,...e)}function Et(n,...e){throw ra(n,...e)}function Ct(n,...e){return ra(n,...e)}function Du(n,e,t){const r={...Nm(),[e]:t};return new as("auth","Firebase",r).create(e,{appName:n.name})}function qt(n){return Du(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ra(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ku.create(n,...e)}function z(n,e,...t){if(!n)throw ra(e,...t)}function Bt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw js(e),new Error(e)}function Ht(n,e){n||Bt(e)}function No(){return typeof self<"u"&&self.location?.href||""}function Mm(){return zc()==="http:"||zc()==="https:"}function zc(){return typeof self<"u"&&self.location?.protocol||null}function xm(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mm()||up()||"connection"in navigator)?navigator.onLine:!0}function Lm(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class ls{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ht(t>e,"Short delay should be less than long delay!"),this.isMobile=ap()||hp()}get(){return xm()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function sa(n,e){Ht(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Vu{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Bt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Bt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Bt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Fm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Um=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Bm=new ls(3e4,6e4);function Tn(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function In(n,e,t,r,s={}){return Nu(n,s,async()=>{let o={},a={};r&&(e==="GET"?a=r:o={body:JSON.stringify(r)});const l=cs({key:n.config.apiKey,...a}).slice(1),h=await n._getAdditionalHeaders();h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:h,...o};return lp()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&mr(n.emulatorConfig.host)&&(d.credentials="include"),Vu.fetch()(await Ou(n,n.config.apiHost,t,l),d)})}async function Nu(n,e,t){n._canInitEmulator=!1;const r={...Fm,...e};try{const s=new qm(n),o=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await o.json();if("needConfirmation"in a)throw Os(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{const l=o.ok?a.errorMessage:a.error.message,[h,d]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Os(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Os(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Os(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Du(n,p,d);Et(n,p)}}catch(s){if(s instanceof Qt)throw s;Et(n,"network-request-failed",{message:String(s)})}}async function us(n,e,t,r,s={}){const o=await In(n,e,t,r,s);return"mfaPendingCredential"in o&&Et(n,"multi-factor-auth-required",{_serverResponse:o}),o}async function Ou(n,e,t,r){const s=`${e}${t}?${r}`,o=n,a=o.config.emulator?sa(n.config,s):`${n.config.apiScheme}://${s}`;return Um.includes(t)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a}function jm(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ct(this.auth,"network-request-failed")),Bm.get())})}}function Os(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Ct(n,e,r);return s.customData._tokenResponse=t,s}function Hc(n){return n!==void 0&&n.enterprise!==void 0}class $m{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jm(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function zm(n,e){return In(n,"GET","/v2/recaptchaConfig",Tn(n,e))}async function Hm(n,e){return In(n,"POST","/v1/accounts:delete",e)}async function ti(n,e){return In(n,"POST","/v1/accounts:lookup",e)}function Wr(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wm(n,e=!1){const t=He(n),r=await t.getIdToken(e),s=ia(r);z(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,a=o?.sign_in_provider;return{claims:s,token:r,authTime:Wr(_o(s.auth_time)),issuedAtTime:Wr(_o(s.iat)),expirationTime:Wr(_o(s.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}}function _o(n){return Number(n)*1e3}function ia(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return js("JWT malformed, contained fewer than 3 sections"),null;try{const s=_u(t);return s?JSON.parse(s):(js("Failed to decode base64 JWT payload"),null)}catch(s){return js("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Wc(n){const e=ia(n);return z(e,"internal-error"),z(typeof e.exp<"u","internal-error"),z(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Zr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Qt&&Gm(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Gm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Km{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Oo{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wr(this.lastLoginAt),this.creationTime=Wr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ni(n){const e=n.auth,t=await n.getIdToken(),r=await Zr(n,ti(e,{idToken:t}));z(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const o=s.providerUserInfo?.length?Mu(s.providerUserInfo):[],a=Ym(n.providerData,o),l=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!a?.length,d=l?h:!1,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Oo(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function Qm(n){const e=He(n);await ni(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Ym(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Mu(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function Xm(n,e){const t=await Nu(n,{},async()=>{const r=cs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=n.config,a=await Ou(n,s,"/v1/token",`key=${o}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:l,body:r};return n.emulatorConfig&&mr(n.emulatorConfig.host)&&(h.credentials="include"),Vu.fetch()(a,h)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Jm(n,e){return In(n,"POST","/v2/accounts:revokeToken",Tn(n,e))}class rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){z(e.idToken,"internal-error"),z(typeof e.idToken<"u","internal-error"),z(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Wc(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){z(e.length!==0,"internal-error");const t=Wc(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(z(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:o}=await Xm(e,t);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:o}=t,a=new rr;return r&&(z(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(z(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),o&&(z(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rr,this.toJSON())}_performRefresh(){return Bt("not implemented")}}function rn(n,e){z(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class vt{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Km(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Oo(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Zr(this,this.stsTokenManager.getToken(this.auth,e));return z(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Wm(this,e)}reload(){return Qm(this)}_assign(e){this!==e&&(z(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new vt({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){z(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ni(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(gt(this.auth.app))return Promise.reject(qt(this.auth));const e=await this.getIdToken();return await Zr(this,Hm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:v,emailVerified:E,isAnonymous:R,providerData:P,stsTokenManager:V}=t;z(v&&V,e,"internal-error");const k=rr.fromJSON(this.name,V);z(typeof v=="string",e,"internal-error"),rn(r,e.name),rn(s,e.name),z(typeof E=="boolean",e,"internal-error"),z(typeof R=="boolean",e,"internal-error"),rn(o,e.name),rn(a,e.name),rn(l,e.name),rn(h,e.name),rn(d,e.name),rn(p,e.name);const U=new vt({uid:v,auth:e,email:s,emailVerified:E,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:l,stsTokenManager:k,createdAt:d,lastLoginAt:p});return P&&Array.isArray(P)&&(U.providerData=P.map(B=>({...B}))),h&&(U._redirectEventId=h),U}static async _fromIdTokenResponse(e,t,r=!1){const s=new rr;s.updateFromServerResponse(t);const o=new vt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ni(o),o}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];z(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?Mu(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!o?.length,l=new rr;l.updateFromIdToken(r);const h=new vt({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Oo(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,d),h}}const Gc=new Map;function jt(n){Ht(n instanceof Function,"Expected a class definition");let e=Gc.get(n);return e?(Ht(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Gc.set(n,e),e)}class xu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}xu.type="NONE";const Kc=xu;function qs(n,e,t){return`firebase:${n}:${e}:${t}`}class sr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=qs(this.userKey,s.apiKey,o),this.fullPersistenceKey=qs("persistence",s.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await ti(this.auth,{idToken:e}).catch(()=>{});return t?vt._fromGetAccountInfoResponse(this.auth,t,e):null}return vt._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new sr(jt(Kc),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let o=s[0]||jt(Kc);const a=qs(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const p=await d._get(a);if(p){let v;if(typeof p=="string"){const E=await ti(e,{idToken:p}).catch(()=>{});if(!E)break;v=await vt._fromGetAccountInfoResponse(e,E,p)}else v=vt._fromJSON(e,p);d!==o&&(l=v),o=d;break}}catch{}const h=s.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new sr(o,e,r):(o=h[0],l&&await o._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==o)try{await d._remove(a)}catch{}})),new sr(o,e,r))}}function Qc(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Bu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Lu(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(qu(e))return"Blackberry";if($u(e))return"Webos";if(Fu(e))return"Safari";if((e.includes("chrome/")||Uu(e))&&!e.includes("edge/"))return"Chrome";if(ju(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Lu(n=st()){return/firefox\//i.test(n)}function Fu(n=st()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Uu(n=st()){return/crios\//i.test(n)}function Bu(n=st()){return/iemobile/i.test(n)}function ju(n=st()){return/android/i.test(n)}function qu(n=st()){return/blackberry/i.test(n)}function $u(n=st()){return/webos/i.test(n)}function oa(n=st()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Zm(n=st()){return oa(n)&&!!window.navigator?.standalone}function eg(){return dp()&&document.documentMode===10}function zu(n=st()){return oa(n)||ju(n)||$u(n)||qu(n)||/windows phone/i.test(n)||Bu(n)}function Hu(n,e=[]){let t;switch(n){case"Browser":t=Qc(st());break;case"Worker":t=`${Qc(st())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gr}/${r}`}class tg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=o=>new Promise((a,l)=>{try{const h=e(o);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function ng(n,e={}){return In(n,"GET","/v2/passwordPolicy",Tn(n,e))}const rg=6;class sg{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??rg,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class ig{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yc(this),this.idTokenSubscription=new Yc(this),this.beforeStateQueue=new tg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ku,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=jt(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await sr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await ti(this,{idToken:e}),r=await vt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(gt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return z(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ni(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Lm()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(gt(this.app))return Promise.reject(qt(this));const t=e?He(e):null;return t&&z(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&z(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return gt(this.app)?Promise.reject(qt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return gt(this.app)?Promise.reject(qt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(jt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await ng(this),t=new sg(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new as("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Jm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&jt(e)||this._popupRedirectResolver;z(t,this,"argument-error"),this.redirectPersistenceManager=await sr.create(this,[jt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const o=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(z(l,this,"internal-error"),l.then(()=>{a||o(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,s);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return z(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Hu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(gt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Om(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Bn(n){return He(n)}class Yc{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ep(t=>this.observer=t)}get next(){return z(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Ai={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function og(n){Ai=n}function Wu(n){return Ai.loadJS(n)}function ag(){return Ai.recaptchaEnterpriseScript}function cg(){return Ai.gapiScript}function lg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ug{constructor(){this.enterprise=new hg}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class hg{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const dg="recaptcha-enterprise",Gu="NO_RECAPTCHA";class fg{constructor(e){this.type=dg,this.auth=Bn(e)}async verify(e="verify",t=!1){async function r(o){if(!t){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(a,l)=>{zm(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new $m(h);return o.tenantId==null?o._agentRecaptchaConfig=d:o._tenantRecaptchaConfigs[o.tenantId]=d,a(d.siteKey)}}).catch(h=>{l(h)})})}function s(o,a,l){const h=window.grecaptcha;Hc(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(d=>{a(d)}).catch(()=>{a(Gu)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ug().execute("siteKey",{action:"verify"}):new Promise((o,a)=>{r(this.auth).then(l=>{if(!t&&Hc(window.grecaptcha))s(l,o,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let h=ag();h.length!==0&&(h+=l),Wu(h).then(()=>{s(l,o,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Xc(n,e,t,r=!1,s=!1){const o=new fg(n);let a;if(s)a=Gu;else try{a=await o.verify(t)}catch{a=await o.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const h=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const h=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Mo(n,e,t,r,s){if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Xc(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Xc(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}function pg(n,e){const t=na(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),o=t.getOptions();if(On(o,e??{}))return s;Et(s,"already-initialized")}return t.initialize({options:e})}function mg(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(jt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function gg(n,e,t){const r=Bn(n);z(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=Ku(e),{host:a,port:l}=_g(e),h=l===null?"":`:${l}`,d={url:`${o}//${a}${h}/`},p=Object.freeze({host:a,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){z(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),z(On(d,r.config.emulator)&&On(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,mr(a)?(Tu(`${o}//${a}${h}`),Iu("Auth",!0)):yg()}function Ku(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function _g(n){const e=Ku(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:Jc(r.substr(o.length+1))}}else{const[o,a]=r.split(":");return{host:o,port:Jc(a)}}}function Jc(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function yg(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class aa{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Bt("not implemented")}_getIdTokenResponse(e){return Bt("not implemented")}_linkToIdToken(e,t){return Bt("not implemented")}_getReauthenticationResolver(e){return Bt("not implemented")}}async function vg(n,e){return In(n,"POST","/v1/accounts:signUp",e)}async function Eg(n,e){return us(n,"POST","/v1/accounts:signInWithPassword",Tn(n,e))}async function Tg(n,e){return us(n,"POST","/v1/accounts:signInWithEmailLink",Tn(n,e))}async function Ig(n,e){return us(n,"POST","/v1/accounts:signInWithEmailLink",Tn(n,e))}class es extends aa{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new es(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new es(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Mo(e,t,"signInWithPassword",Eg);case"emailLink":return Tg(e,{email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Mo(e,r,"signUpPassword",vg);case"emailLink":return Ig(e,{idToken:t,email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ir(n,e){return us(n,"POST","/v1/accounts:signInWithIdp",Tn(n,e))}const wg="http://localhost";class xn extends aa{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new xn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Et("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=t;if(!r||!s)return null;const a=new xn(r,s);return a.idToken=o.idToken||void 0,a.accessToken=o.accessToken||void 0,a.secret=o.secret,a.nonce=o.nonce,a.pendingToken=o.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return ir(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ir(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ir(e,t)}buildRequest(){const e={requestUri:wg,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=cs(t)}return e}}function Ag(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Rg(n){const e=Fr(Ur(n)).link,t=e?Fr(Ur(e)).deep_link_id:null,r=Fr(Ur(n)).deep_link_id;return(r?Fr(Ur(r)).link:null)||r||t||e||n}class ca{constructor(e){const t=Fr(Ur(e)),r=t.apiKey??null,s=t.oobCode??null,o=Ag(t.mode??null);z(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Rg(e);try{return new ca(t)}catch{return null}}}class jn{constructor(){this.providerId=jn.PROVIDER_ID}static credential(e,t){return es._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ca.parseLink(t);return z(r,"argument-error"),es._fromEmailAndCode(e,r.code,r.tenantId)}}jn.PROVIDER_ID="password";jn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";jn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Qu{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class hs extends Qu{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class sn extends hs{constructor(){super("facebook.com")}static credential(e){return xn._fromParams({providerId:sn.PROVIDER_ID,signInMethod:sn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sn.credentialFromTaggedObject(e)}static credentialFromError(e){return sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sn.credential(e.oauthAccessToken)}catch{return null}}}sn.FACEBOOK_SIGN_IN_METHOD="facebook.com";sn.PROVIDER_ID="facebook.com";class on extends hs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return xn._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return on.credential(t,r)}catch{return null}}}on.GOOGLE_SIGN_IN_METHOD="google.com";on.PROVIDER_ID="google.com";class an extends hs{constructor(){super("github.com")}static credential(e){return xn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.GITHUB_SIGN_IN_METHOD="github.com";an.PROVIDER_ID="github.com";class cn extends hs{constructor(){super("twitter.com")}static credential(e,t){return xn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return cn.credential(t,r)}catch{return null}}}cn.TWITTER_SIGN_IN_METHOD="twitter.com";cn.PROVIDER_ID="twitter.com";async function bg(n,e){return us(n,"POST","/v1/accounts:signUp",Tn(n,e))}class Ln{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const o=await vt._fromIdTokenResponse(e,r,s),a=Zc(r);return new Ln({user:o,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Zc(r);return new Ln({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Zc(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class ri extends Qt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ri.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ri(e,t,r,s)}}function Yu(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?ri._fromErrorAndOperation(n,o,e,r):o})}async function Sg(n,e,t=!1){const r=await Zr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ln._forOperation(n,"link",r)}async function Xu(n,e,t=!1){const{auth:r}=n;if(gt(r.app))return Promise.reject(qt(r));const s="reauthenticate";try{const o=await Zr(n,Yu(r,s,e,n),t);z(o.idToken,r,"internal-error");const a=ia(o.idToken);z(a,r,"internal-error");const{sub:l}=a;return z(n.uid===l,r,"user-mismatch"),Ln._forOperation(n,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&Et(r,"user-mismatch"),o}}async function Ju(n,e,t=!1){if(gt(n.app))return Promise.reject(qt(n));const r="signIn",s=await Yu(n,r,e),o=await Ln._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(o.user),o}async function Pg(n,e){return Ju(Bn(n),e)}async function Cg(n,e){return Xu(He(n),e)}async function Zu(n){const e=Bn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function kg(n,e,t){if(gt(n.app))return Promise.reject(qt(n));const r=Bn(n),a=await Mo(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",bg).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&Zu(n),h}),l=await Ln._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function Dg(n,e,t){return gt(n.app)?Promise.reject(qt(n)):Pg(He(n),jn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Zu(n),r})}function Vg(n,e,t,r){return He(n).onIdTokenChanged(e,t,r)}function Ng(n,e,t){return He(n).beforeAuthStateChanged(e,t)}function Og(n,e,t,r){return He(n).onAuthStateChanged(e,t,r)}function Mg(n){return He(n).signOut()}const si="__sak";class eh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(si,"1"),this.storage.removeItem(si),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const xg=1e3,Lg=10;class th extends eh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,h)=>{this.notifyListeners(a,h)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},o=this.storage.getItem(r);eg()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Lg):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},xg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}th.type="LOCAL";const Fg=th;class nh extends eh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nh.type="SESSION";const rh=nh;function Ug(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Ri{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Ri(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:o}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,o)),h=await Ug(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ri.receivers=[];function la(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Bg{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,a;return new Promise((l,h)=>{const d=la("",20);s.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(v){const E=v;if(E.data.eventId===d)switch(E.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),l(E.data.response);break;default:clearTimeout(p),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function kt(){return window}function jg(n){kt().location.href=n}function sh(){return typeof kt().WorkerGlobalScope<"u"&&typeof kt().importScripts=="function"}async function qg(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $g(){return navigator?.serviceWorker?.controller||null}function zg(){return sh()?self:null}const ih="firebaseLocalStorageDb",Hg=1,ii="firebaseLocalStorage",oh="fbase_key";class ds{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function bi(n,e){return n.transaction([ii],e?"readwrite":"readonly").objectStore(ii)}function Wg(){const n=indexedDB.deleteDatabase(ih);return new ds(n).toPromise()}function xo(){const n=indexedDB.open(ih,Hg);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(ii,{keyPath:oh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(ii)?e(r):(r.close(),await Wg(),e(await xo()))})})}async function el(n,e,t){const r=bi(n,!0).put({[oh]:e,value:t});return new ds(r).toPromise()}async function Gg(n,e){const t=bi(n,!1).get(e),r=await new ds(t).toPromise();return r===void 0?null:r.value}function tl(n,e){const t=bi(n,!0).delete(e);return new ds(t).toPromise()}const Kg=800,Qg=3;class ah{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await xo(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Qg)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ri._getInstance(zg()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await qg(),!this.activeServiceWorker)return;this.sender=new Bg(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$g()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await xo();return await el(e,si,"1"),await tl(e,si),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>el(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Gg(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=bi(s,!1).getAll();return new ds(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Kg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ah.type="LOCAL";const Yg=ah;new ls(3e4,6e4);function Xg(n,e){return e?jt(e):(z(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class ua extends aa{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ir(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ir(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ir(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Jg(n){return Ju(n.auth,new ua(n),n.bypassAuthState)}function Zg(n){const{auth:e,user:t}=n;return z(t,e,"internal-error"),Xu(t,new ua(n),n.bypassAuthState)}async function e_(n){const{auth:e,user:t}=n;return z(t,e,"internal-error"),Sg(t,new ua(n),n.bypassAuthState)}class ch{constructor(e,t,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:o,error:a,type:l}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jg;case"linkViaPopup":case"linkViaRedirect":return e_;case"reauthViaPopup":case"reauthViaRedirect":return Zg;default:Et(this.auth,"internal-error")}}resolve(e){Ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ht(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const t_=new ls(2e3,1e4);class er extends ch{constructor(e,t,r,s,o){super(e,t,s,o),this.provider=r,this.authWindow=null,this.pollId=null,er.currentPopupAction&&er.currentPopupAction.cancel(),er.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return z(e,this.auth,"internal-error"),e}async onExecution(){Ht(this.filter.length===1,"Popup operations only handle one event");const e=la();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ct(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Ct(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,er.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ct(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,t_.get())};e()}}er.currentPopupAction=null;const n_="pendingRedirect",$s=new Map;class r_ extends ch{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=$s.get(this.auth._key());if(!e){try{const r=await s_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}$s.set(this.auth._key(),e)}return this.bypassAuthState||$s.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function s_(n,e){const t=a_(e),r=o_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function i_(n,e){$s.set(n._key(),e)}function o_(n){return jt(n._redirectPersistence)}function a_(n){return qs(n_,n.config.apiKey,n.name)}async function c_(n,e,t=!1){if(gt(n.app))return Promise.reject(qt(n));const r=Bn(n),s=Xg(r,e),a=await new r_(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const l_=600*1e3;class u_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!h_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!lh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Ct(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=l_&&this.cachedEventUids.clear(),this.cachedEventUids.has(nl(e))}saveEventToCache(e){this.cachedEventUids.add(nl(e)),this.lastProcessedEventTime=Date.now()}}function nl(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function h_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lh(n);default:return!1}}async function d_(n,e={}){return In(n,"GET","/v1/projects",e)}const f_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,p_=/^https?/;async function m_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await d_(n);for(const t of e)try{if(g_(t))return}catch{}Et(n,"unauthorized-domain")}function g_(n){const e=No(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!p_.test(t))return!1;if(f_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const __=new ls(3e4,6e4);function rl(){const n=kt().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function y_(n){return new Promise((e,t)=>{function r(){rl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{rl(),t(Ct(n,"network-request-failed"))},timeout:__.get()})}if(kt().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(kt().gapi?.load)r();else{const s=lg("iframefcb");return kt()[s]=()=>{gapi.load?r():t(Ct(n,"network-request-failed"))},Wu(`${cg()}?onload=${s}`).catch(o=>t(o))}}).catch(e=>{throw zs=null,e})}let zs=null;function v_(n){return zs=zs||y_(n),zs}const E_=new ls(5e3,15e3),T_="__/auth/iframe",I_="emulator/auth/iframe",w_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},A_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function R_(n){const e=n.config;z(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?sa(e,I_):`https://${n.config.authDomain}/${T_}`,r={apiKey:e.apiKey,appName:n.name,v:gr},s=A_.get(n.config.apiHost);s&&(r.eid=s);const o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${cs(r).slice(1)}`}async function b_(n){const e=await v_(n),t=kt().gapi;return z(t,n,"internal-error"),e.open({where:document.body,url:R_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:w_,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const a=Ct(n,"network-request-failed"),l=kt().setTimeout(()=>{o(a)},E_.get());function h(){kt().clearTimeout(l),s(r)}r.ping(h).then(h,()=>{o(a)})}))}const S_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},P_=500,C_=600,k_="_blank",D_="http://localhost";class sl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function V_(n,e,t,r=P_,s=C_){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h={...S_,width:r.toString(),height:s.toString(),top:o,left:a},d=st().toLowerCase();t&&(l=Uu(d)?k_:t),Lu(d)&&(e=e||D_,h.scrollbars="yes");const p=Object.entries(h).reduce((E,[R,P])=>`${E}${R}=${P},`,"");if(Zm(d)&&l!=="_self")return N_(e||"",l),new sl(null);const v=window.open(e||"",l,p);z(v,n,"popup-blocked");try{v.focus()}catch{}return new sl(v)}function N_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const O_="__/auth/handler",M_="emulator/auth/handler",x_=encodeURIComponent("fac");async function il(n,e,t,r,s,o){z(n.config.authDomain,n,"auth-domain-config-required"),z(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:gr,eventId:s};if(e instanceof Qu){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",vp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,v]of Object.entries({}))a[p]=v}if(e instanceof hs){const p=e.getScopes().filter(v=>v!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const h=await n._getAppCheckToken(),d=h?`#${x_}=${encodeURIComponent(h)}`:"";return`${L_(n)}?${cs(l).slice(1)}${d}`}function L_({config:n}){return n.emulator?sa(n,M_):`https://${n.authDomain}/${O_}`}const yo="webStorageSupport";class F_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rh,this._completeRedirectFn=c_,this._overrideRedirectResult=i_}async _openPopup(e,t,r,s){Ht(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await il(e,t,r,No(),s);return V_(e,o,la())}async _openRedirect(e,t,r,s){await this._originValidation(e);const o=await il(e,t,r,No(),s);return jg(o),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:o}=this.eventManagers[t];return s?Promise.resolve(s):(Ht(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await b_(e),r=new u_(e);return t.register("authEvent",s=>(z(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(yo,{type:yo},s=>{const o=s?.[0]?.[yo];o!==void 0&&t(!!o),Et(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=m_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return zu()||Fu()||oa()}}const U_=F_;var ol="@firebase/auth",al="1.11.1";class B_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){z(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function j_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function q_(n){cr(new Mn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;z(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Hu(n)},d=new ig(r,s,o,h);return mg(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),cr(new Mn("auth-internal",e=>{const t=Bn(e.getProvider("auth").getImmediate());return(r=>new B_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),dn(ol,al,j_(n)),dn(ol,al,"esm2020")}const $_=300,z_=Eu("authIdTokenMaxAge")||$_;let cl=null;const H_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>z_)return;const s=t?.token;cl!==s&&(cl=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function W_(n=bu()){const e=na(n,"auth");if(e.isInitialized())return e.getImmediate();const t=pg(n,{popupRedirectResolver:U_,persistence:[Yg,Fg,rh]}),r=Eu("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const a=H_(o.toString());Ng(t,a,()=>a(t.currentUser)),Vg(t,l=>a(l))}}const s=yu("auth");return s&&gg(t,`http://${s}`),t}function G_(){return document.getElementsByTagName("head")?.[0]??document}og({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const o=Ct("internal-error");o.customData=s,t(o)},r.type="text/javascript",r.charset="UTF-8",G_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});q_("Browser");var ll=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var fn,uh;(function(){var n;function e(I,m){function _(){}_.prototype=m.prototype,I.F=m.prototype,I.prototype=new _,I.prototype.constructor=I,I.D=function(w,y,T){for(var g=Array(arguments.length-2),M=2;M<arguments.length;M++)g[M-2]=arguments[M];return m.prototype[y].apply(w,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,m,_){_||(_=0);const w=Array(16);if(typeof m=="string")for(var y=0;y<16;++y)w[y]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(y=0;y<16;++y)w[y]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=I.g[0],_=I.g[1],y=I.g[2];let T=I.g[3],g;g=m+(T^_&(y^T))+w[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=T+(y^m&(_^y))+w[1]+3905402710&4294967295,T=m+(g<<12&4294967295|g>>>20),g=y+(_^T&(m^_))+w[2]+606105819&4294967295,y=T+(g<<17&4294967295|g>>>15),g=_+(m^y&(T^m))+w[3]+3250441966&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(T^_&(y^T))+w[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=T+(y^m&(_^y))+w[5]+1200080426&4294967295,T=m+(g<<12&4294967295|g>>>20),g=y+(_^T&(m^_))+w[6]+2821735955&4294967295,y=T+(g<<17&4294967295|g>>>15),g=_+(m^y&(T^m))+w[7]+4249261313&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(T^_&(y^T))+w[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=T+(y^m&(_^y))+w[9]+2336552879&4294967295,T=m+(g<<12&4294967295|g>>>20),g=y+(_^T&(m^_))+w[10]+4294925233&4294967295,y=T+(g<<17&4294967295|g>>>15),g=_+(m^y&(T^m))+w[11]+2304563134&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(T^_&(y^T))+w[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=T+(y^m&(_^y))+w[13]+4254626195&4294967295,T=m+(g<<12&4294967295|g>>>20),g=y+(_^T&(m^_))+w[14]+2792965006&4294967295,y=T+(g<<17&4294967295|g>>>15),g=_+(m^y&(T^m))+w[15]+1236535329&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(y^T&(_^y))+w[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=T+(_^y&(m^_))+w[6]+3225465664&4294967295,T=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(T^m))+w[11]+643717713&4294967295,y=T+(g<<14&4294967295|g>>>18),g=_+(T^m&(y^T))+w[0]+3921069994&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^T&(_^y))+w[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=T+(_^y&(m^_))+w[10]+38016083&4294967295,T=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(T^m))+w[15]+3634488961&4294967295,y=T+(g<<14&4294967295|g>>>18),g=_+(T^m&(y^T))+w[4]+3889429448&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^T&(_^y))+w[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=T+(_^y&(m^_))+w[14]+3275163606&4294967295,T=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(T^m))+w[3]+4107603335&4294967295,y=T+(g<<14&4294967295|g>>>18),g=_+(T^m&(y^T))+w[8]+1163531501&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^T&(_^y))+w[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=T+(_^y&(m^_))+w[2]+4243563512&4294967295,T=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(T^m))+w[7]+1735328473&4294967295,y=T+(g<<14&4294967295|g>>>18),g=_+(T^m&(y^T))+w[12]+2368359562&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(_^y^T)+w[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=T+(m^_^y)+w[8]+2272392833&4294967295,T=m+(g<<11&4294967295|g>>>21),g=y+(T^m^_)+w[11]+1839030562&4294967295,y=T+(g<<16&4294967295|g>>>16),g=_+(y^T^m)+w[14]+4259657740&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^T)+w[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=T+(m^_^y)+w[4]+1272893353&4294967295,T=m+(g<<11&4294967295|g>>>21),g=y+(T^m^_)+w[7]+4139469664&4294967295,y=T+(g<<16&4294967295|g>>>16),g=_+(y^T^m)+w[10]+3200236656&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^T)+w[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=T+(m^_^y)+w[0]+3936430074&4294967295,T=m+(g<<11&4294967295|g>>>21),g=y+(T^m^_)+w[3]+3572445317&4294967295,y=T+(g<<16&4294967295|g>>>16),g=_+(y^T^m)+w[6]+76029189&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^T)+w[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=T+(m^_^y)+w[12]+3873151461&4294967295,T=m+(g<<11&4294967295|g>>>21),g=y+(T^m^_)+w[15]+530742520&4294967295,y=T+(g<<16&4294967295|g>>>16),g=_+(y^T^m)+w[2]+3299628645&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(y^(_|~T))+w[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=T+(_^(m|~y))+w[7]+1126891415&4294967295,T=m+(g<<10&4294967295|g>>>22),g=y+(m^(T|~_))+w[14]+2878612391&4294967295,y=T+(g<<15&4294967295|g>>>17),g=_+(T^(y|~m))+w[5]+4237533241&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~T))+w[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=T+(_^(m|~y))+w[3]+2399980690&4294967295,T=m+(g<<10&4294967295|g>>>22),g=y+(m^(T|~_))+w[10]+4293915773&4294967295,y=T+(g<<15&4294967295|g>>>17),g=_+(T^(y|~m))+w[1]+2240044497&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~T))+w[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=T+(_^(m|~y))+w[15]+4264355552&4294967295,T=m+(g<<10&4294967295|g>>>22),g=y+(m^(T|~_))+w[6]+2734768916&4294967295,y=T+(g<<15&4294967295|g>>>17),g=_+(T^(y|~m))+w[13]+1309151649&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~T))+w[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=T+(_^(m|~y))+w[11]+3174756917&4294967295,T=m+(g<<10&4294967295|g>>>22),g=y+(m^(T|~_))+w[2]+718787259&4294967295,y=T+(g<<15&4294967295|g>>>17),g=_+(T^(y|~m))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+m&4294967295,I.g[1]=I.g[1]+(y+(g<<21&4294967295|g>>>11))&4294967295,I.g[2]=I.g[2]+y&4294967295,I.g[3]=I.g[3]+T&4294967295}r.prototype.v=function(I,m){m===void 0&&(m=I.length);const _=m-this.blockSize,w=this.C;let y=this.h,T=0;for(;T<m;){if(y==0)for(;T<=_;)s(this,I,T),T+=this.blockSize;if(typeof I=="string"){for(;T<m;)if(w[y++]=I.charCodeAt(T++),y==this.blockSize){s(this,w),y=0;break}}else for(;T<m;)if(w[y++]=I[T++],y==this.blockSize){s(this,w),y=0;break}}this.h=y,this.o+=m},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var m=1;m<I.length-8;++m)I[m]=0;m=this.o*8;for(var _=I.length-8;_<I.length;++_)I[_]=m&255,m/=256;for(this.v(I),I=Array(16),m=0,_=0;_<4;++_)for(let w=0;w<32;w+=8)I[m++]=this.g[_]>>>w&255;return I};function o(I,m){var _=l;return Object.prototype.hasOwnProperty.call(_,I)?_[I]:_[I]=m(I)}function a(I,m){this.h=m;const _=[];let w=!0;for(let y=I.length-1;y>=0;y--){const T=I[y]|0;w&&T==m||(_[y]=T,w=!1)}this.g=_}var l={};function h(I){return-128<=I&&I<128?o(I,function(m){return new a([m|0],m<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return v;if(I<0)return k(d(-I));const m=[];let _=1;for(let w=0;I>=_;w++)m[w]=I/_|0,_*=4294967296;return new a(m,0)}function p(I,m){if(I.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(I.charAt(0)=="-")return k(p(I.substring(1),m));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(m,8));let w=v;for(let T=0;T<I.length;T+=8){var y=Math.min(8,I.length-T);const g=parseInt(I.substring(T,T+y),m);y<8?(y=d(Math.pow(m,y)),w=w.j(y).add(d(g))):(w=w.j(_),w=w.add(d(g)))}return w}var v=h(0),E=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(V(this))return-k(this).m();let I=0,m=1;for(let _=0;_<this.g.length;_++){const w=this.i(_);I+=(w>=0?w:4294967296+w)*m,m*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(P(this))return"0";if(V(this))return"-"+k(this).toString(I);const m=d(Math.pow(I,6));var _=this;let w="";for(;;){const y=K(_,m).g;_=U(_,y.j(m));let T=((_.g.length>0?_.g[0]:_.h)>>>0).toString(I);if(_=y,P(_))return T+w;for(;T.length<6;)T="0"+T;w=T+w}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function P(I){if(I.h!=0)return!1;for(let m=0;m<I.g.length;m++)if(I.g[m]!=0)return!1;return!0}function V(I){return I.h==-1}n.l=function(I){return I=U(this,I),V(I)?-1:P(I)?0:1};function k(I){const m=I.g.length,_=[];for(let w=0;w<m;w++)_[w]=~I.g[w];return new a(_,~I.h).add(E)}n.abs=function(){return V(this)?k(this):this},n.add=function(I){const m=Math.max(this.g.length,I.g.length),_=[];let w=0;for(let y=0;y<=m;y++){let T=w+(this.i(y)&65535)+(I.i(y)&65535),g=(T>>>16)+(this.i(y)>>>16)+(I.i(y)>>>16);w=g>>>16,T&=65535,g&=65535,_[y]=g<<16|T}return new a(_,_[_.length-1]&-2147483648?-1:0)};function U(I,m){return I.add(k(m))}n.j=function(I){if(P(this)||P(I))return v;if(V(this))return V(I)?k(this).j(k(I)):k(k(this).j(I));if(V(I))return k(this.j(k(I)));if(this.l(R)<0&&I.l(R)<0)return d(this.m()*I.m());const m=this.g.length+I.g.length,_=[];for(var w=0;w<2*m;w++)_[w]=0;for(w=0;w<this.g.length;w++)for(let y=0;y<I.g.length;y++){const T=this.i(w)>>>16,g=this.i(w)&65535,M=I.i(y)>>>16,se=I.i(y)&65535;_[2*w+2*y]+=g*se,B(_,2*w+2*y),_[2*w+2*y+1]+=T*se,B(_,2*w+2*y+1),_[2*w+2*y+1]+=g*M,B(_,2*w+2*y+1),_[2*w+2*y+2]+=T*M,B(_,2*w+2*y+2)}for(I=0;I<m;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=m;I<2*m;I++)_[I]=0;return new a(_,0)};function B(I,m){for(;(I[m]&65535)!=I[m];)I[m+1]+=I[m]>>>16,I[m]&=65535,m++}function L(I,m){this.g=I,this.h=m}function K(I,m){if(P(m))throw Error("division by zero");if(P(I))return new L(v,v);if(V(I))return m=K(k(I),m),new L(k(m.g),k(m.h));if(V(m))return m=K(I,k(m)),new L(k(m.g),m.h);if(I.g.length>30){if(V(I)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var _=E,w=m;w.l(I)<=0;)_=q(_),w=q(w);var y=J(_,1),T=J(w,1);for(w=J(w,2),_=J(_,2);!P(w);){var g=T.add(w);g.l(I)<=0&&(y=y.add(_),T=g),w=J(w,1),_=J(_,1)}return m=U(I,y.j(m)),new L(y,m)}for(y=v;I.l(m)>=0;){for(_=Math.max(1,Math.floor(I.m()/m.m())),w=Math.ceil(Math.log(_)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),T=d(_),g=T.j(m);V(g)||g.l(I)>0;)_-=w,T=d(_),g=T.j(m);P(T)&&(T=E),y=y.add(T),I=U(I,g)}return new L(y,I)}n.B=function(I){return K(this,I).h},n.and=function(I){const m=Math.max(this.g.length,I.g.length),_=[];for(let w=0;w<m;w++)_[w]=this.i(w)&I.i(w);return new a(_,this.h&I.h)},n.or=function(I){const m=Math.max(this.g.length,I.g.length),_=[];for(let w=0;w<m;w++)_[w]=this.i(w)|I.i(w);return new a(_,this.h|I.h)},n.xor=function(I){const m=Math.max(this.g.length,I.g.length),_=[];for(let w=0;w<m;w++)_[w]=this.i(w)^I.i(w);return new a(_,this.h^I.h)};function q(I){const m=I.g.length+1,_=[];for(let w=0;w<m;w++)_[w]=I.i(w)<<1|I.i(w-1)>>>31;return new a(_,I.h)}function J(I,m){const _=m>>5;m%=32;const w=I.g.length-_,y=[];for(let T=0;T<w;T++)y[T]=m>0?I.i(T+_)>>>m|I.i(T+_+1)<<32-m:I.i(T+_);return new a(y,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,uh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,fn=a}).apply(typeof ll<"u"?ll:typeof self<"u"?self:typeof window<"u"?window:{});var Ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var hh,Br,dh,Hs,Lo,fh,ph,mh;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ms=="object"&&Ms];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var u=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var b=i[f];if(!(b in u))break e;u=u[b]}i=i[i.length-1],f=u[i],c=c(f),c!=f&&c!=null&&e(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&u.push([f,c[f]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function d(i,c,u){return d=h,d.apply(null,arguments)}function p(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function v(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(f,b,S){for(var O=Array(arguments.length-2),X=2;X<arguments.length;X++)O[X-2]=arguments[X];return c.prototype[b].apply(f,O)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function R(i){const c=i.length;if(c>0){const u=Array(c);for(let f=0;f<c;f++)u[f]=i[f];return u}return[]}function P(i,c){for(let f=1;f<arguments.length;f++){const b=arguments[f];var u=typeof b;if(u=u!="object"?u:b?Array.isArray(b)?"array":u:"null",u=="array"||u=="object"&&typeof b.length=="number"){u=i.length||0;const S=b.length||0;i.length=u+S;for(let O=0;O<S;O++)i[u+O]=b[O]}else i.push(b)}}class V{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function k(i){a.setTimeout(()=>{throw i},0)}function U(){var i=I;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class B{constructor(){this.h=this.g=null}add(c,u){const f=L.get();f.set(c,u),this.h?this.h.next=f:this.g=f,this.h=f}}var L=new V(()=>new K,i=>i.reset());class K{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let q,J=!1,I=new B,m=()=>{const i=Promise.resolve(void 0);q=()=>{i.then(_)}};function _(){for(var i;i=U();){try{i.h.call(i.g)}catch(u){k(u)}var c=L;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}J=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var T=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function M(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}v(M,y),M.prototype.init=function(i,c){const u=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var se="closure_listenable_"+(Math.random()*1e6|0),Re=0;function _e(i,c,u,f,b){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!f,this.ha=b,this.key=++Re,this.da=this.fa=!1}function oe(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function pe(i,c,u){for(const f in i)c.call(u,i[f],f,i)}function Fe(i,c){for(const u in i)c.call(void 0,i[u],u,i)}function Je(i){const c={};for(const u in i)c[u]=i[u];return c}const ye="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Te(i,c){let u,f;for(let b=1;b<arguments.length;b++){f=arguments[b];for(u in f)i[u]=f[u];for(let S=0;S<ye.length;S++)u=ye[S],Object.prototype.hasOwnProperty.call(f,u)&&(i[u]=f[u])}}function ne(i){this.src=i,this.g={},this.h=0}ne.prototype.add=function(i,c,u,f,b){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const O=ke(i,c,f,b);return O>-1?(c=i[O],u||(c.fa=!1)):(c=new _e(c,this.src,S,!!f,b),c.fa=u,i.push(c)),c};function ue(i,c){const u=c.type;if(u in i.g){var f=i.g[u],b=Array.prototype.indexOf.call(f,c,void 0),S;(S=b>=0)&&Array.prototype.splice.call(f,b,1),S&&(oe(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function ke(i,c,u,f){for(let b=0;b<i.length;++b){const S=i[b];if(!S.da&&S.listener==c&&S.capture==!!u&&S.ha==f)return b}return-1}var ut="closure_lm_"+(Math.random()*1e6|0),We={};function it(i,c,u,f,b){if(Array.isArray(c)){for(let S=0;S<c.length;S++)it(i,c[S],u,f,b);return null}return u=Ts(u),i&&i[se]?i.J(c,u,l(f)?!!f.capture:!1,b):Ue(i,c,u,!1,f,b)}function Ue(i,c,u,f,b,S){if(!c)throw Error("Invalid event type");const O=l(b)?!!b.capture:!!b;let X=Tr(i);if(X||(i[ut]=X=new ne(i)),u=X.add(c,u,f,O,S),u.proxy)return u;if(f=yt(),u.proxy=f,f.src=i,f.listener=u,i.addEventListener)T||(b=O),b===void 0&&(b=!1),i.addEventListener(c.toString(),f,b);else if(i.attachEvent)i.attachEvent(vs(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function yt(){function i(u){return c.call(i.src,i.listener,u)}const c=Es;return i}function ot(i,c,u,f,b){if(Array.isArray(c))for(var S=0;S<c.length;S++)ot(i,c[S],u,f,b);else f=l(f)?!!f.capture:!!f,u=Ts(u),i&&i[se]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],u=ke(c,u,f,b),u>-1&&(oe(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Tr(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ke(c,u,f,b)),(u=i>-1?c[i]:null)&&Yt(u))}function Yt(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[se])ue(c.i,i);else{var u=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(u,f,i.capture):c.detachEvent?c.detachEvent(vs(u),f):c.addListener&&c.removeListener&&c.removeListener(f),(u=Tr(c))?(ue(u,i),u.h==0&&(u.src=null,c[ut]=null)):oe(i)}}}function vs(i){return i in We?We[i]:We[i]="on"+i}function Es(i,c){if(i.da)i=!0;else{c=new M(c,this);const u=i.listener,f=i.ha||i.src;i.fa&&Yt(i),i=u.call(f,c)}return i}function Tr(i){return i=i[ut],i instanceof ne?i:null}var zn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ts(i){return typeof i=="function"?i:(i[zn]||(i[zn]=function(c){return i.handleEvent(c)}),i[zn])}function De(){w.call(this),this.i=new ne(this),this.M=this,this.G=null}v(De,w),De.prototype[se]=!0,De.prototype.removeEventListener=function(i,c,u,f){ot(this,i,c,u,f)};function Ge(i,c){var u,f=i.G;if(f)for(u=[];f;f=f.G)u.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var b=c;c=new y(f,i),Te(c,b)}b=!0;let S,O;if(u)for(O=u.length-1;O>=0;O--)S=c.g=u[O],b=Rn(S,f,!0,c)&&b;if(S=c.g=i,b=Rn(S,f,!0,c)&&b,b=Rn(S,f,!1,c)&&b,u)for(O=0;O<u.length;O++)S=c.g=u[O],b=Rn(S,f,!1,c)&&b}De.prototype.N=function(){if(De.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const u=i.g[c];for(let f=0;f<u.length;f++)oe(u[f]);delete i.g[c],i.h--}}this.G=null},De.prototype.J=function(i,c,u,f){return this.i.add(String(i),c,!1,u,f)},De.prototype.K=function(i,c,u,f){return this.i.add(String(i),c,!0,u,f)};function Rn(i,c,u,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let b=!0;for(let S=0;S<c.length;++S){const O=c[S];if(O&&!O.da&&O.capture==u){const X=O.listener,Me=O.ha||O.src;O.fa&&ue(i.i,O),b=X.call(Me,f)!==!1&&b}}return b&&!f.defaultPrevented}function zi(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Ir(i){i.g=zi(()=>{i.g=null,i.i&&(i.i=!1,Ir(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Ke extends w{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ir(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ie(i){w.call(this),this.h=i,this.g={}}v(Ie,w);var Ve=[];function Ze(i){pe(i.g,function(c,u){this.g.hasOwnProperty(u)&&Yt(c)},i),i.g={}}Ie.prototype.N=function(){Ie.Z.N.call(this),Ze(this)},Ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var et=a.JSON.stringify,ft=a.JSON.parse,Tt=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function It(){}function Be(){}var Ne={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Oe(){y.call(this,"d")}v(Oe,y);function Ft(){y.call(this,"c")}v(Ft,y);var Ut={},qa=null;function Is(){return qa=qa||new De}Ut.Ia="serverreachability";function $a(i){y.call(this,Ut.Ia,i)}v($a,y);function wr(i){const c=Is();Ge(c,new $a(c))}Ut.STAT_EVENT="statevent";function za(i,c){y.call(this,Ut.STAT_EVENT,i),this.stat=c}v(za,y);function at(i){const c=Is();Ge(c,new za(c,i))}Ut.Ja="timingevent";function Ha(i,c){y.call(this,Ut.Ja,i),this.size=c}v(Ha,y);function Ar(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function Rr(){this.g=!0}Rr.prototype.ua=function(){this.g=!1};function zd(i,c,u,f,b,S){i.info(function(){if(i.g)if(S){var O="",X=S.split("&");for(let le=0;le<X.length;le++){var Me=X[le].split("=");if(Me.length>1){const je=Me[0];Me=Me[1];const At=je.split("_");O=At.length>=2&&At[1]=="type"?O+(je+"="+Me+"&"):O+(je+"=redacted&")}}}else O=null;else O=S;return"XMLHTTP REQ ("+f+") [attempt "+b+"]: "+c+`
`+u+`
`+O})}function Hd(i,c,u,f,b,S,O){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+b+"]: "+c+`
`+u+`
`+S+" "+O})}function Hn(i,c,u,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Gd(i,u)+(f?" "+f:"")})}function Wd(i,c){i.info(function(){return"TIMEOUT: "+c})}Rr.prototype.info=function(){};function Gd(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var u=S[i];if(!(u.length<2)){var f=u[1];if(Array.isArray(f)&&!(f.length<1)){var b=f[0];if(b!="noop"&&b!="stop"&&b!="close")for(let O=1;O<f.length;O++)f[O]=""}}}}return et(S)}catch{return c}}var ws={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Wa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ga;function Hi(){}v(Hi,It),Hi.prototype.g=function(){return new XMLHttpRequest},Ga=new Hi;function br(i){return encodeURIComponent(String(i))}function Kd(i){var c=1;i=i.split(":");const u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function Xt(i,c,u,f){this.j=i,this.i=c,this.l=u,this.S=f||1,this.V=new Ie(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ka}function Ka(){this.i=null,this.g="",this.h=!1}var Qa={},Wi={};function Gi(i,c,u){i.M=1,i.A=Rs(wt(c)),i.u=u,i.R=!0,Ya(i,null)}function Ya(i,c){i.F=Date.now(),As(i),i.B=wt(i.A);var u=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),lc(u.i,"t",f),i.C=0,u=i.j.L,i.h=new Ka,i.g=Sc(i.j,u?c:null,!i.u),i.P>0&&(i.O=new Ke(d(i.Y,i,i.g),i.P)),c=i.V,u=i.g,f=i.ba;var b="readystatechange";Array.isArray(b)||(b&&(Ve[0]=b.toString()),b=Ve);for(let S=0;S<b.length;S++){const O=it(u,b[S],f||c.handleEvent,!1,c.h||c);if(!O)break;c.g[O.key]=O}c=i.J?Je(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),wr(),zd(i.i,i.v,i.B,i.l,i.S,i.u)}Xt.prototype.ba=function(i){i=i.target;const c=this.O;c&&en(i)==3?c.j():this.Y(i)},Xt.prototype.Y=function(i){try{if(i==this.g)e:{const X=en(this.g),Me=this.g.ya(),le=this.g.ca();if(!(X<3)&&(X!=3||this.g&&(this.h.h||this.g.la()||gc(this.g)))){this.K||X!=4||Me==7||(Me==8||le<=0?wr(3):wr(2)),Ki(this);var c=this.g.ca();this.X=c;var u=Qd(this);if(this.o=c==200,Hd(this.i,this.v,this.B,this.l,this.S,X,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,b=this.g;if((f=b.g?b.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break t}}S=null}if(i=S)Hn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Qi(this,i);else{this.o=!1,this.m=3,at(12),bn(this),Sr(this);break e}}if(this.R){i=!0;let je;for(;!this.K&&this.C<u.length;)if(je=Yd(this,u),je==Wi){X==4&&(this.m=4,at(14),i=!1),Hn(this.i,this.l,null,"[Incomplete Response]");break}else if(je==Qa){this.m=4,at(15),Hn(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else Hn(this.i,this.l,je,null),Qi(this,je);if(Xa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),X!=4||u.length!=0||this.h.h||(this.m=1,at(16),i=!1),this.o=this.o&&i,!i)Hn(this.i,this.l,u,"[Invalid Chunked Response]"),bn(this),Sr(this);else if(u.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),ro(O),O.P=!0,at(11))}}else Hn(this.i,this.l,u,null),Qi(this,u);X==4&&bn(this),this.o&&!this.K&&(X==4?wc(this.j,this):(this.o=!1,As(this)))}else hf(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,at(12)):(this.m=0,at(13)),bn(this),Sr(this)}}}catch{}finally{}};function Qd(i){if(!Xa(i))return i.g.la();const c=gc(i.g);if(c==="")return"";let u="";const f=c.length,b=en(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return bn(i),Sr(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,u+=i.h.i.decode(c[S],{stream:!(b&&S==f-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function Xa(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Yd(i,c){var u=i.C,f=c.indexOf(`
`,u);return f==-1?Wi:(u=Number(c.substring(u,f)),isNaN(u)?Qa:(f+=1,f+u>c.length?Wi:(c=c.slice(f,f+u),i.C=f+u,c)))}Xt.prototype.cancel=function(){this.K=!0,bn(this)};function As(i){i.T=Date.now()+i.H,Ja(i,i.H)}function Ja(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Ar(d(i.aa,i),c)}function Ki(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Xt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Wd(this.i,this.B),this.M!=2&&(wr(),at(17)),bn(this),this.m=2,Sr(this)):Ja(this,this.T-i)};function Sr(i){i.j.I==0||i.K||wc(i.j,i)}function bn(i){Ki(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Ze(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Qi(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||Yi(u.h,i))){if(!i.L&&Yi(u.h,i)&&u.I==3){try{var f=u.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var b=f;if(b[0]==0){e:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)ks(u),Ps(u);else break e;no(u),at(18)}}else u.xa=b[1],0<u.xa-u.K&&b[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=Ar(d(u.Va,u),6e3));tc(u.h)<=1&&u.ta&&(u.ta=void 0)}else Pn(u,11)}else if((i.L||u.g==i)&&ks(u),!g(c))for(b=u.Ba.g.parse(c),c=0;c<b.length;c++){let le=b[c];const je=le[0];if(!(je<=u.K))if(u.K=je,le=le[1],u.I==2)if(le[0]=="c"){u.M=le[1],u.ba=le[2];const At=le[3];At!=null&&(u.ka=At,u.j.info("VER="+u.ka));const Cn=le[4];Cn!=null&&(u.za=Cn,u.j.info("SVER="+u.za));const tn=le[5];tn!=null&&typeof tn=="number"&&tn>0&&(f=1.5*tn,u.O=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;const nn=i.g;if(nn){const Vs=nn.g?nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Vs){var S=f.h;S.g||Vs.indexOf("spdy")==-1&&Vs.indexOf("quic")==-1&&Vs.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Xi(S,S.h),S.h=null))}if(f.G){const so=nn.g?nn.g.getResponseHeader("X-HTTP-Session-Id"):null;so&&(f.wa=so,he(f.J,f.G,so))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),f=u;var O=i;if(f.na=bc(f,f.L?f.ba:null,f.W),O.L){nc(f.h,O);var X=O,Me=f.O;Me&&(X.H=Me),X.D&&(Ki(X),As(X)),f.g=O}else Tc(f);u.i.length>0&&Cs(u)}else le[0]!="stop"&&le[0]!="close"||Pn(u,7);else u.I==3&&(le[0]=="stop"||le[0]=="close"?le[0]=="stop"?Pn(u,7):to(u):le[0]!="noop"&&u.l&&u.l.qa(le),u.A=0)}}wr(4)}catch{}}var Xd=class{constructor(i,c){this.g=i,this.map=c}};function Za(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ec(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function tc(i){return i.h?1:i.g?i.g.size:0}function Yi(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Xi(i,c){i.g?i.g.add(c):i.h=c}function nc(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Za.prototype.cancel=function(){if(this.i=rc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function rc(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const u of i.g.values())c=c.concat(u.G);return c}return R(i.i)}var sc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jd(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){const f=i[u].indexOf("=");let b,S=null;f>=0?(b=i[u].substring(0,f),S=i[u].substring(f+1)):b=i[u],c(b,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Jt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Jt?(this.l=i.l,Pr(this,i.j),this.o=i.o,this.g=i.g,Cr(this,i.u),this.h=i.h,Ji(this,uc(i.i)),this.m=i.m):i&&(c=String(i).match(sc))?(this.l=!1,Pr(this,c[1]||"",!0),this.o=kr(c[2]||""),this.g=kr(c[3]||"",!0),Cr(this,c[4]),this.h=kr(c[5]||"",!0),Ji(this,c[6]||"",!0),this.m=kr(c[7]||"")):(this.l=!1,this.i=new Vr(null,this.l))}Jt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Dr(c,ic,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Dr(c,ic,!0),"@"),i.push(br(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(Dr(u,u.charAt(0)=="/"?tf:ef,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",Dr(u,rf)),i.join("")},Jt.prototype.resolve=function(i){const c=wt(this);let u=!!i.j;u?Pr(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var f=i.h;if(u)Cr(c,i.u);else if(u=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var b=c.h.lastIndexOf("/");b!=-1&&(f=c.h.slice(0,b+1)+f)}if(b=f,b==".."||b==".")f="";else if(b.indexOf("./")!=-1||b.indexOf("/.")!=-1){f=b.lastIndexOf("/",0)==0,b=b.split("/");const S=[];for(let O=0;O<b.length;){const X=b[O++];X=="."?f&&O==b.length&&S.push(""):X==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&O==b.length&&S.push("")):(S.push(X),f=!0)}f=S.join("/")}else f=b}return u?c.h=f:u=i.i.toString()!=="",u?Ji(c,uc(i.i)):u=!!i.m,u&&(c.m=i.m),c};function wt(i){return new Jt(i)}function Pr(i,c,u){i.j=u?kr(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function Cr(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Ji(i,c,u){c instanceof Vr?(i.i=c,sf(i.i,i.l)):(u||(c=Dr(c,nf)),i.i=new Vr(c,i.l))}function he(i,c,u){i.i.set(c,u)}function Rs(i){return he(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function kr(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Dr(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,Zd),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Zd(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var ic=/[#\/\?@]/g,ef=/[#\?:]/g,tf=/[#\?]/g,nf=/[#\?@]/g,rf=/#/g;function Vr(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Sn(i){i.g||(i.g=new Map,i.h=0,i.i&&Jd(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=Vr.prototype,n.add=function(i,c){Sn(this),this.i=null,i=Wn(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function oc(i,c){Sn(i),c=Wn(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function ac(i,c){return Sn(i),c=Wn(i,c),i.g.has(c)}n.forEach=function(i,c){Sn(this),this.g.forEach(function(u,f){u.forEach(function(b){i.call(c,b,f,this)},this)},this)};function cc(i,c){Sn(i);let u=[];if(typeof c=="string")ac(i,c)&&(u=u.concat(i.g.get(Wn(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return Sn(this),this.i=null,i=Wn(this,i),ac(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=cc(this,i),i.length>0?String(i[0]):c):c};function lc(i,c,u){oc(i,c),u.length>0&&(i.i=null,i.g.set(Wn(i,c),R(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var u=c[f];const b=br(u);u=cc(this,u);for(let S=0;S<u.length;S++){let O=b;u[S]!==""&&(O+="="+br(u[S])),i.push(O)}}return this.i=i.join("&")};function uc(i){const c=new Vr;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Wn(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function sf(i,c){c&&!i.j&&(Sn(i),i.i=null,i.g.forEach(function(u,f){const b=f.toLowerCase();f!=b&&(oc(this,f),lc(this,b,u))},i)),i.j=c}function of(i,c){const u=new Rr;if(a.Image){const f=new Image;f.onload=p(Zt,u,"TestLoadImage: loaded",!0,c,f),f.onerror=p(Zt,u,"TestLoadImage: error",!1,c,f),f.onabort=p(Zt,u,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(Zt,u,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function af(i,c){const u=new Rr,f=new AbortController,b=setTimeout(()=>{f.abort(),Zt(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(b),S.ok?Zt(u,"TestPingServer: ok",!0,c):Zt(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(b),Zt(u,"TestPingServer: error",!1,c)})}function Zt(i,c,u,f,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),f(u)}catch{}}function cf(){this.g=new Tt}function Zi(i){this.i=i.Sb||null,this.h=i.ab||!1}v(Zi,It),Zi.prototype.g=function(){return new bs(this.i,this.h)};function bs(i,c){De.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(bs,De),n=bs.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Or(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Nr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Or(this)),this.g&&(this.readyState=3,Or(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;hc(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function hc(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Nr(this):Or(this),this.readyState==3&&hc(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Nr(this))},n.Na=function(i){this.g&&(this.response=i,Nr(this))},n.ga=function(){this.g&&Nr(this)};function Nr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Or(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function Or(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(bs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function dc(i){let c="";return pe(i,function(u,f){c+=f,c+=":",c+=u,c+=`\r
`}),c}function eo(i,c,u){e:{for(f in u){var f=!1;break e}f=!0}f||(u=dc(u),typeof i=="string"?u!=null&&br(u):he(i,c,u))}function Ee(i){De.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(Ee,De);var lf=/^https?$/i,uf=["POST","PUT"];n=Ee.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ga.g(),this.g.onreadystatechange=E(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){fc(this,S);return}if(i=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var b in f)u.set(b,f[b]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())u.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(S=>S.toLowerCase()=="content-type"),b=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(uf,c,void 0)>=0)||f||b||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,O]of u)this.g.setRequestHeader(S,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){fc(this,S)}};function fc(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,pc(i),Ss(i)}function pc(i){i.A||(i.A=!0,Ge(i,"complete"),Ge(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Ge(this,"complete"),Ge(this,"abort"),Ss(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ss(this,!0)),Ee.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?mc(this):this.Xa())},n.Xa=function(){mc(this)};function mc(i){if(i.h&&typeof o<"u"){if(i.v&&en(i)==4)setTimeout(i.Ca.bind(i),0);else if(Ge(i,"readystatechange"),en(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var u;if(!(u=c)){var f;if(f=S===0){let O=String(i.D).match(sc)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),f=!lf.test(O?O.toLowerCase():"")}u=f}if(u)Ge(i,"complete"),Ge(i,"success");else{i.o=6;try{var b=en(i)>2?i.g.statusText:""}catch{b=""}i.l=b+" ["+i.ca()+"]",pc(i)}}finally{Ss(i)}}}}function Ss(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const u=i.g;i.g=null,c||Ge(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function en(i){return i.g?i.g.readyState:0}n.ca=function(){try{return en(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),ft(c)}};function gc(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function hf(i){const c={};i=(i.g&&en(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(g(i[f]))continue;var u=Kd(i[f]);const b=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const S=c[b]||[];c[b]=S,S.push(u)}Fe(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Mr(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function _c(i){this.za=0,this.i=[],this.j=new Rr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Mr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Mr("baseRetryDelayMs",5e3,i),this.Za=Mr("retryDelaySeedMs",1e4,i),this.Ta=Mr("forwardChannelMaxRetries",2,i),this.va=Mr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Za(i&&i.concurrentRequestLimit),this.Ba=new cf,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=_c.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,f){at(0),this.W=i,this.H=c||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.J=bc(this,null,this.W),Cs(this)};function to(i){if(yc(i),i.I==3){var c=i.V++,u=wt(i.J);if(he(u,"SID",i.M),he(u,"RID",c),he(u,"TYPE","terminate"),xr(i,u),c=new Xt(i,i.j,c),c.M=2,c.A=Rs(wt(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=Sc(c.j,null),c.g.ea(c.A)),c.F=Date.now(),As(c)}Rc(i)}function Ps(i){i.g&&(ro(i),i.g.cancel(),i.g=null)}function yc(i){Ps(i),i.v&&(a.clearTimeout(i.v),i.v=null),ks(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Cs(i){if(!ec(i.h)&&!i.m){i.m=!0;var c=i.Ea;q||m(),J||(q(),J=!0),I.add(c,i),i.D=0}}function df(i,c){return tc(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Ar(d(i.Ea,i,c),Ac(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const b=new Xt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=Je(S),Te(S,this.U)):S=this.U),this.u!==null||this.R||(b.J=S,S=null),this.S)e:{for(var c=0,u=0;u<this.i.length;u++){t:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=u;break e}if(c===4096||u===this.i.length-1){c=u+1;break e}}c=1e3}else c=1e3;c=Ec(this,b,c),u=wt(this.J),he(u,"RID",i),he(u,"CVER",22),this.G&&he(u,"X-HTTP-Session-Id",this.G),xr(this,u),S&&(this.R?c="headers="+br(dc(S))+"&"+c:this.u&&eo(u,this.u,S)),Xi(this.h,b),this.Ra&&he(u,"TYPE","init"),this.S?(he(u,"$req",c),he(u,"SID","null"),b.U=!0,Gi(b,u,null)):Gi(b,u,c),this.I=2}}else this.I==3&&(i?vc(this,i):this.i.length==0||ec(this.h)||vc(this))};function vc(i,c){var u;c?u=c.l:u=i.V++;const f=wt(i.J);he(f,"SID",i.M),he(f,"RID",u),he(f,"AID",i.K),xr(i,f),i.u&&i.o&&eo(f,i.u,i.o),u=new Xt(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Ec(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Xi(i.h,u),Gi(u,f,c)}function xr(i,c){i.H&&pe(i.H,function(u,f){he(c,f,u)}),i.l&&pe({},function(u,f){he(c,f,u)})}function Ec(i,c,u){u=Math.min(i.i.length,u);const f=i.l?d(i.l.Ka,i.l,i):null;e:{var b=i.i;let X=-1;for(;;){const Me=["count="+u];X==-1?u>0?(X=b[0].g,Me.push("ofs="+X)):X=0:Me.push("ofs="+X);let le=!0;for(let je=0;je<u;je++){var S=b[je].g;const At=b[je].map;if(S-=X,S<0)X=Math.max(0,b[je].g-100),le=!1;else try{S="req"+S+"_"||"";try{var O=At instanceof Map?At:Object.entries(At);for(const[Cn,tn]of O){let nn=tn;l(tn)&&(nn=et(tn)),Me.push(S+Cn+"="+encodeURIComponent(nn))}}catch(Cn){throw Me.push(S+"type="+encodeURIComponent("_badmap")),Cn}}catch{f&&f(At)}}if(le){O=Me.join("&");break e}}O=void 0}return i=i.i.splice(0,u),c.G=i,O}function Tc(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;q||m(),J||(q(),J=!0),I.add(c,i),i.A=0}}function no(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Ar(d(i.Da,i),Ac(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Ic(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Ar(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,at(10),Ps(this),Ic(this))};function ro(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Ic(i){i.g=new Xt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=wt(i.na);he(c,"RID","rpc"),he(c,"SID",i.M),he(c,"AID",i.K),he(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&he(c,"TO",i.ia),he(c,"TYPE","xmlhttp"),xr(i,c),i.u&&i.o&&eo(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=Rs(wt(c)),u.u=null,u.R=!0,Ya(u,i)}n.Va=function(){this.C!=null&&(this.C=null,Ps(this),no(this),at(19))};function ks(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function wc(i,c){var u=null;if(i.g==c){ks(i),ro(i),i.g=null;var f=2}else if(Yi(i.h,c))u=c.G,nc(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var b=i.D;f=Is(),Ge(f,new Ha(f,u)),Cs(i)}else Tc(i);else if(b=c.m,b==3||b==0&&c.X>0||!(f==1&&df(i,c)||f==2&&no(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),b){case 1:Pn(i,5);break;case 4:Pn(i,10);break;case 3:Pn(i,6);break;default:Pn(i,2)}}}function Ac(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function Pn(i,c){if(i.j.info("Error code "+c),c==2){var u=d(i.bb,i),f=i.Ua;const b=!f;f=new Jt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Pr(f,"https"),Rs(f),b?of(f.toString(),u):af(f.toString(),u)}else at(2);i.I=0,i.l&&i.l.pa(c),Rc(i),yc(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),at(2)):(this.j.info("Failed to ping google.com"),at(1))};function Rc(i){if(i.I=0,i.ja=[],i.l){const c=rc(i.h);(c.length!=0||i.i.length!=0)&&(P(i.ja,c),P(i.ja,i.i),i.h.i.length=0,R(i.i),i.i.length=0),i.l.oa()}}function bc(i,c,u){var f=u instanceof Jt?wt(u):new Jt(u);if(f.g!="")c&&(f.g=c+"."+f.g),Cr(f,f.u);else{var b=a.location;f=b.protocol,c=c?c+"."+b.hostname:b.hostname,b=+b.port;const S=new Jt(null);f&&Pr(S,f),c&&(S.g=c),b&&Cr(S,b),u&&(S.h=u),f=S}return u=i.G,c=i.wa,u&&c&&he(f,u,c),he(f,"VER",i.ka),xr(i,f),f}function Sc(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Ee(new Zi({ab:u})):new Ee(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Pc(){}n=Pc.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Ds(){}Ds.prototype.g=function(i,c){return new ht(i,c)};function ht(i,c){De.call(this),this.g=new _c(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Gn(this)}v(ht,De),ht.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ht.prototype.close=function(){to(this.g)},ht.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=et(i),i=u);c.i.push(new Xd(c.Ya++,i)),c.I==3&&Cs(c)},ht.prototype.N=function(){this.g.l=null,delete this.j,to(this.g),delete this.g,ht.Z.N.call(this)};function Cc(i){Oe.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const u in c){i=u;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}v(Cc,Oe);function kc(){Ft.call(this),this.status=1}v(kc,Ft);function Gn(i){this.g=i}v(Gn,Pc),Gn.prototype.ra=function(){Ge(this.g,"a")},Gn.prototype.qa=function(i){Ge(this.g,new Cc(i))},Gn.prototype.pa=function(i){Ge(this.g,new kc)},Gn.prototype.oa=function(){Ge(this.g,"b")},Ds.prototype.createWebChannel=Ds.prototype.g,ht.prototype.send=ht.prototype.o,ht.prototype.open=ht.prototype.m,ht.prototype.close=ht.prototype.close,mh=function(){return new Ds},ph=function(){return Is()},fh=Ut,Lo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ws.NO_ERROR=0,ws.TIMEOUT=8,ws.HTTP_ERROR=6,Hs=ws,Wa.COMPLETE="complete",dh=Wa,Be.EventType=Ne,Ne.OPEN="a",Ne.CLOSE="b",Ne.ERROR="c",Ne.MESSAGE="d",De.prototype.listen=De.prototype.J,Br=Be,Ee.prototype.listenOnce=Ee.prototype.K,Ee.prototype.getLastError=Ee.prototype.Ha,Ee.prototype.getLastErrorCode=Ee.prototype.ya,Ee.prototype.getStatus=Ee.prototype.ca,Ee.prototype.getResponseJson=Ee.prototype.La,Ee.prototype.getResponseText=Ee.prototype.la,Ee.prototype.send=Ee.prototype.ea,Ee.prototype.setWithCredentials=Ee.prototype.Fa,hh=Ee}).apply(typeof Ms<"u"?Ms:typeof self<"u"?self:typeof window<"u"?window:{});const ul="@firebase/firestore",hl="4.9.2";class nt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nt.UNAUTHENTICATED=new nt(null),nt.GOOGLE_CREDENTIALS=new nt("google-credentials-uid"),nt.FIRST_PARTY=new nt("first-party-uid"),nt.MOCK_USER=new nt("mock-user");let _r="12.3.0";const Fn=new ea("@firebase/firestore");function Yn(){return Fn.logLevel}function x(n,...e){if(Fn.logLevel<=Z.DEBUG){const t=e.map(ha);Fn.debug(`Firestore (${_r}): ${n}`,...t)}}function Wt(n,...e){if(Fn.logLevel<=Z.ERROR){const t=e.map(ha);Fn.error(`Firestore (${_r}): ${n}`,...t)}}function lr(n,...e){if(Fn.logLevel<=Z.WARN){const t=e.map(ha);Fn.warn(`Firestore (${_r}): ${n}`,...t)}}function ha(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function H(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,gh(n,r,t)}function gh(n,e,t){let r=`FIRESTORE (${_r}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Wt(r),new Error(r)}function ce(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||gh(e,s,r)}function Y(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends Qt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class $t{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class _h{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class K_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(nt.UNAUTHENTICATED)))}shutdown(){}}class Q_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Y_{constructor(e){this.t=e,this.currentUser=nt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ce(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new $t;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new $t,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new $t)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ce(typeof r.accessToken=="string",31837,{l:r}),new _h(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ce(e===null||typeof e=="string",2055,{h:e}),new nt(e)}}class X_{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=nt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class J_{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new X_(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(nt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class dl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Z_{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,gt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ce(this.o===void 0,3512);const r=o=>{o.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new dl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ce(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new dl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function ey(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class da{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=ey(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function ee(n,e){return n<e?-1:n>e?1:0}function Fo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return vo(s)===vo(o)?ee(s,o):vo(s)?1:-1}return ee(n.length,e.length)}const ty=55296,ny=57343;function vo(n){const e=n.charCodeAt(0);return e>=ty&&e<=ny}function ur(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const fl="__name__";class bt{constructor(e,t,r){t===void 0?t=0:t>e.length&&H(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&H(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return bt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof bt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=bt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return ee(e.length,t.length)}static compareSegments(e,t){const r=bt.isNumericId(e),s=bt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?bt.extractNumericId(e).compare(bt.extractNumericId(t)):Fo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fn.fromString(e.substring(4,e.length-2))}}class de extends bt{construct(e,t,r){return new de(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new F(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new de(t)}static emptyPath(){return new de([])}}const ry=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ye extends bt{construct(e,t,r){return new Ye(e,t,r)}static isValidIdentifier(e){return ry.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ye.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===fl}static keyField(){return new Ye([fl])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new F(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new F(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new F(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new F(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ye(t)}static emptyPath(){return new Ye([])}}class j{constructor(e){this.path=e}static fromPath(e){return new j(de.fromString(e))}static fromName(e){return new j(de.fromString(e).popFirst(5))}static empty(){return new j(de.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&de.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return de.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new j(new de(e.slice()))}}function yh(n,e,t){if(!t)throw new F(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function sy(n,e,t,r){if(e===!0&&r===!0)throw new F(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pl(n){if(!j.isDocumentKey(n))throw new F(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ml(n){if(j.isDocumentKey(n))throw new F(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vh(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function fa(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":H(12329,{type:typeof n})}function Gt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new F(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=fa(n);throw new F(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Pe(n,e){const t={typeString:n};return e&&(t.value=e),t}function fs(n,e){if(!vh(n))throw new F(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new F(D.INVALID_ARGUMENT,t);return!0}const gl=-62135596800,_l=1e6;class fe{static now(){return fe.fromMillis(Date.now())}static fromDate(e){return fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*_l);return new fe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<gl)throw new F(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_l}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:fe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(fs(e,fe._jsonSchema))return new fe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-gl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}fe._jsonSchemaVersion="firestore/timestamp/1.0",fe._jsonSchema={type:Pe("string",fe._jsonSchemaVersion),seconds:Pe("number"),nanoseconds:Pe("number")};class G{static fromTimestamp(e){return new G(e)}static min(){return new G(new fe(0,0))}static max(){return new G(new fe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ts=-1;function iy(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=G.fromTimestamp(r===1e9?new fe(t+1,0):new fe(t,r));return new mn(s,j.empty(),e)}function oy(n){return new mn(n.readTime,n.key,ts)}class mn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new mn(G.min(),j.empty(),ts)}static max(){return new mn(G.max(),j.empty(),ts)}}function ay(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=j.comparator(n.documentKey,e.documentKey),t!==0?t:ee(n.largestBatchId,e.largestBatchId))}const cy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ly{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function yr(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==cy)throw n;x("LocalStore","Unexpectedly lost primary lease")}class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&H(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new C(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof C?t:C.resolve(t)}catch(t){return C.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):C.reject(t)}static resolve(e){return new C(((t,r)=>{t(e)}))}static reject(e){return new C(((t,r)=>{r(e)}))}static waitFor(e){return new C(((t,r)=>{let s=0,o=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++o,a&&o===s&&t()}),(h=>r(h)))})),a=!0,o===s&&t()}))}static or(e){let t=C.resolve(!1);for(const r of e)t=t.next((s=>s?C.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,o)=>{r.push(t.call(this,s,o))})),this.waitFor(r)}static mapArray(e,t){return new C(((r,s)=>{const o=e.length,a=new Array(o);let l=0;for(let h=0;h<o;h++){const d=h;t(e[d]).next((p=>{a[d]=p,++l,l===o&&r(a)}),(p=>s(p)))}}))}static doWhile(e,t){return new C(((r,s)=>{const o=()=>{e()===!0?t().next((()=>{o()}),s):r()};o()}))}}function uy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function vr(n){return n.name==="IndexedDbTransactionError"}class Si{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Si.ce=-1;const pa=-1;function Pi(n){return n==null}function oi(n){return n===0&&1/n==-1/0}function hy(n){return typeof n=="number"&&Number.isInteger(n)&&!oi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Eh="";function dy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=yl(e)),e=fy(n.get(t),e);return yl(e)}function fy(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case Eh:t+="";break;default:t+=o}}return t}function yl(n){return n+Eh+""}function vl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function wn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Th(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ve{constructor(e,t){this.comparator=e,this.root=t||Qe.EMPTY}insert(e,t){return new ve(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qe.BLACK,null,null))}remove(e){return new ve(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xs(this.root,e,this.comparator,!1)}getReverseIterator(){return new xs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xs(this.root,e,this.comparator,!0)}}class xs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qe{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Qe.RED,this.left=s??Qe.EMPTY,this.right=o??Qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Qe(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Qe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Qe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw H(43730,{key:this.key,value:this.value});if(this.right.isRed())throw H(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw H(27949);return e+(this.isRed()?0:1)}}Qe.EMPTY=null,Qe.RED=!0,Qe.BLACK=!1;Qe.EMPTY=new class{constructor(){this.size=0}get key(){throw H(57766)}get value(){throw H(16141)}get color(){throw H(16727)}get left(){throw H(29726)}get right(){throw H(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Le{constructor(e){this.comparator=e,this.data=new ve(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new El(this.data.getIterator())}getIteratorFrom(e){return new El(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof Le)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Le(this.comparator);return t.data=e,t}}class El{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class dt{constructor(e){this.fields=e,e.sort(Ye.comparator)}static empty(){return new dt([])}unionWith(e){let t=new Le(Ye.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new dt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ur(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class Ih extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Ih("Invalid base64 string: "+o):o}})(e);return new Xe(t)}static fromUint8Array(e){const t=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(e);return new Xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xe.EMPTY_BYTE_STRING=new Xe("");const py=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gn(n){if(ce(!!n,39018),typeof n=="string"){let e=0;const t=py.exec(n);if(ce(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ae(n.seconds),nanos:Ae(n.nanos)}}function Ae(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Xe.fromBase64String(n):Xe.fromUint8Array(n)}const wh="server_timestamp",Ah="__type__",Rh="__previous_value__",bh="__local_write_time__";function ma(n){return(n?.mapValue?.fields||{})[Ah]?.stringValue===wh}function Ci(n){const e=n.mapValue.fields[Rh];return ma(e)?Ci(e):e}function ns(n){const e=gn(n.mapValue.fields[bh].timestampValue);return new fe(e.seconds,e.nanos)}class my{constructor(e,t,r,s,o,a,l,h,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const ai="(default)";class rs{constructor(e,t){this.projectId=e,this.database=t||ai}static empty(){return new rs("","")}get isDefaultDatabase(){return this.database===ai}isEqual(e){return e instanceof rs&&e.projectId===this.projectId&&e.database===this.database}}const Sh="__type__",gy="__max__",Ls={mapValue:{}},Ph="__vector__",ci="value";function yn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ma(n)?4:yy(n)?9007199254740991:_y(n)?10:11:H(28295,{value:n})}function xt(n,e){if(n===e)return!0;const t=yn(n);if(t!==yn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ns(n).isEqual(ns(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=gn(s.timestampValue),l=gn(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,o){return _n(s.bytesValue).isEqual(_n(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,o){return Ae(s.geoPointValue.latitude)===Ae(o.geoPointValue.latitude)&&Ae(s.geoPointValue.longitude)===Ae(o.geoPointValue.longitude)})(n,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return Ae(s.integerValue)===Ae(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=Ae(s.doubleValue),l=Ae(o.doubleValue);return a===l?oi(a)===oi(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return ur(n.arrayValue.values||[],e.arrayValue.values||[],xt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(vl(a)!==vl(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!xt(a[h],l[h])))return!1;return!0})(n,e);default:return H(52216,{left:n})}}function ss(n,e){return(n.values||[]).find((t=>xt(t,e)))!==void 0}function hr(n,e){if(n===e)return 0;const t=yn(n),r=yn(e);if(t!==r)return ee(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const l=Ae(o.integerValue||o.doubleValue),h=Ae(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,e);case 3:return Tl(n.timestampValue,e.timestampValue);case 4:return Tl(ns(n),ns(e));case 5:return Fo(n.stringValue,e.stringValue);case 6:return(function(o,a){const l=_n(o),h=_n(a);return l.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const l=o.split("/"),h=a.split("/");for(let d=0;d<l.length&&d<h.length;d++){const p=ee(l[d],h[d]);if(p!==0)return p}return ee(l.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const l=ee(Ae(o.latitude),Ae(a.latitude));return l!==0?l:ee(Ae(o.longitude),Ae(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Il(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const l=o.fields||{},h=a.fields||{},d=l[ci]?.arrayValue,p=h[ci]?.arrayValue,v=ee(d?.values?.length||0,p?.values?.length||0);return v!==0?v:Il(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Ls.mapValue&&a===Ls.mapValue)return 0;if(o===Ls.mapValue)return 1;if(a===Ls.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let v=0;v<h.length&&v<p.length;++v){const E=Fo(h[v],p[v]);if(E!==0)return E;const R=hr(l[h[v]],d[p[v]]);if(R!==0)return R}return ee(h.length,p.length)})(n.mapValue,e.mapValue);default:throw H(23264,{he:t})}}function Tl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ee(n,e);const t=gn(n),r=gn(e),s=ee(t.seconds,r.seconds);return s!==0?s:ee(t.nanos,r.nanos)}function Il(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=hr(t[s],r[s]);if(o)return o}return ee(t.length,r.length)}function dr(n){return Uo(n)}function Uo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=gn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _n(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return j.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=Uo(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Uo(t.fields[a])}`;return s+"}"})(n.mapValue):H(61005,{value:n})}function Ws(n){switch(yn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ci(n);return e?16+Ws(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Ws(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return wn(r.fields,((o,a)=>{s+=o.length+Ws(a)})),s})(n.mapValue);default:throw H(13486,{value:n})}}function Bo(n){return!!n&&"integerValue"in n}function ga(n){return!!n&&"arrayValue"in n}function wl(n){return!!n&&"nullValue"in n}function Al(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gs(n){return!!n&&"mapValue"in n}function _y(n){return(n?.mapValue?.fields||{})[Sh]?.stringValue===Ph}function Gr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return wn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Gr(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gr(n.arrayValue.values[t]);return e}return{...n}}function yy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===gy}class lt{constructor(e){this.value=e}static empty(){return new lt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Gs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gr(t)}setAll(e){let t=Ye.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=Gr(a):s.push(l.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Gs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Gs(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){wn(t,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new lt(Gr(this.value))}}function Ch(n){const e=[];return wn(n.fields,((t,r)=>{const s=new Ye([t]);if(Gs(r)){const o=Ch(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)})),new dt(e)}class rt{constructor(e,t,r,s,o,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new rt(e,0,G.min(),G.min(),G.min(),lt.empty(),0)}static newFoundDocument(e,t,r,s){return new rt(e,1,t,G.min(),r,s,0)}static newNoDocument(e,t){return new rt(e,2,t,G.min(),G.min(),lt.empty(),0)}static newUnknownDocument(e,t){return new rt(e,3,t,G.min(),G.min(),lt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof rt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class li{constructor(e,t){this.position=e,this.inclusive=t}}function Rl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=j.comparator(j.fromName(a.referenceValue),t.key):r=hr(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function bl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!xt(n.position[t],e.position[t]))return!1;return!0}class ui{constructor(e,t="asc"){this.field=e,this.dir=t}}function vy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class kh{}class xe extends kh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ty(e,t,r):t==="array-contains"?new Ay(e,r):t==="in"?new Ry(e,r):t==="not-in"?new by(e,r):t==="array-contains-any"?new Sy(e,r):new xe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Iy(e,r):new wy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(hr(t,this.value)):t!==null&&yn(this.value)===yn(t)&&this.matchesComparison(hr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return H(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Lt extends kh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Lt(e,t)}matches(e){return Dh(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Dh(n){return n.op==="and"}function Vh(n){return Ey(n)&&Dh(n)}function Ey(n){for(const e of n.filters)if(e instanceof Lt)return!1;return!0}function jo(n){if(n instanceof xe)return n.field.canonicalString()+n.op.toString()+dr(n.value);if(Vh(n))return n.filters.map((e=>jo(e))).join(",");{const e=n.filters.map((t=>jo(t))).join(",");return`${n.op}(${e})`}}function Nh(n,e){return n instanceof xe?(function(r,s){return s instanceof xe&&r.op===s.op&&r.field.isEqual(s.field)&&xt(r.value,s.value)})(n,e):n instanceof Lt?(function(r,s){return s instanceof Lt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,l)=>o&&Nh(a,s.filters[l])),!0):!1})(n,e):void H(19439)}function Oh(n){return n instanceof xe?(function(t){return`${t.field.canonicalString()} ${t.op} ${dr(t.value)}`})(n):n instanceof Lt?(function(t){return t.op.toString()+" {"+t.getFilters().map(Oh).join(" ,")+"}"})(n):"Filter"}class Ty extends xe{constructor(e,t,r){super(e,t,r),this.key=j.fromName(r.referenceValue)}matches(e){const t=j.comparator(e.key,this.key);return this.matchesComparison(t)}}class Iy extends xe{constructor(e,t){super(e,"in",t),this.keys=Mh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class wy extends xe{constructor(e,t){super(e,"not-in",t),this.keys=Mh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Mh(n,e){return(e.arrayValue?.values||[]).map((t=>j.fromName(t.referenceValue)))}class Ay extends xe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ga(t)&&ss(t.arrayValue,this.value)}}class Ry extends xe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ss(this.value.arrayValue,t)}}class by extends xe{constructor(e,t){super(e,"not-in",t)}matches(e){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ss(this.value.arrayValue,t)}}class Sy extends xe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ga(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>ss(this.value.arrayValue,r)))}}class Py{constructor(e,t=null,r=[],s=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function Sl(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Py(n,e,t,r,s,o,a)}function _a(n){const e=Y(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>jo(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Pi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>dr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>dr(r))).join(",")),e.Te=t}return e.Te}function ya(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!vy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Nh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!bl(n.startAt,e.startAt)&&bl(n.endAt,e.endAt)}function qo(n){return j.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ki{constructor(e,t=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Cy(n,e,t,r,s,o,a,l){return new ki(n,e,t,r,s,o,a,l)}function va(n){return new ki(n)}function Pl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ky(n){return n.collectionGroup!==null}function Kr(n){const e=Y(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Le(Ye.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new ui(o,r))})),t.has(Ye.keyField().canonicalString())||e.Ie.push(new ui(Ye.keyField(),r))}return e.Ie}function Dt(n){const e=Y(n);return e.Ee||(e.Ee=Dy(e,Kr(n))),e.Ee}function Dy(n,e){if(n.limitType==="F")return Sl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new ui(s.field,o)}));const t=n.endAt?new li(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new li(n.startAt.position,n.startAt.inclusive):null;return Sl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function $o(n,e,t){return new ki(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Di(n,e){return ya(Dt(n),Dt(e))&&n.limitType===e.limitType}function xh(n){return`${_a(Dt(n))}|lt:${n.limitType}`}function Xn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>Oh(s))).join(", ")}]`),Pi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>dr(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>dr(s))).join(",")),`Target(${r})`})(Dt(n))}; limitType=${n.limitType})`}function Vi(n,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):j.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,s){for(const o of Kr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,h){const d=Rl(a,l,h);return a.inclusive?d<=0:d<0})(r.startAt,Kr(r),s)||r.endAt&&!(function(a,l,h){const d=Rl(a,l,h);return a.inclusive?d>=0:d>0})(r.endAt,Kr(r),s))})(n,e)}function Vy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Lh(n){return(e,t)=>{let r=!1;for(const s of Kr(n)){const o=Ny(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Ny(n,e,t){const r=n.field.isKeyField()?j.comparator(e.key,t.key):(function(o,a,l){const h=a.data.field(o),d=l.data.field(o);return h!==null&&d!==null?hr(h,d):H(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return H(19790,{direction:n.dir})}}class qn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){wn(this.inner,((t,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return Th(this.inner)}size(){return this.innerSize}}const Oy=new ve(j.comparator);function Kt(){return Oy}const Fh=new ve(j.comparator);function jr(...n){let e=Fh;for(const t of n)e=e.insert(t.key,t);return e}function Uh(n){let e=Fh;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Dn(){return Qr()}function Bh(){return Qr()}function Qr(){return new qn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const My=new ve(j.comparator),xy=new Le(j.comparator);function te(...n){let e=xy;for(const t of n)e=e.add(t);return e}const Ly=new Le(ee);function Fy(){return Ly}function Ea(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oi(e)?"-0":e}}function jh(n){return{integerValue:""+n}}function Uy(n,e){return hy(e)?jh(e):Ea(n,e)}class Ni{constructor(){this._=void 0}}function By(n,e,t){return n instanceof hi?(function(s,o){const a={fields:{[Ah]:{stringValue:wh},[bh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&ma(o)&&(o=Ci(o)),o&&(a.fields[Rh]=o),{mapValue:a}})(t,e):n instanceof is?$h(n,e):n instanceof os?zh(n,e):(function(s,o){const a=qh(s,o),l=Cl(a)+Cl(s.Ae);return Bo(a)&&Bo(s.Ae)?jh(l):Ea(s.serializer,l)})(n,e)}function jy(n,e,t){return n instanceof is?$h(n,e):n instanceof os?zh(n,e):t}function qh(n,e){return n instanceof di?(function(r){return Bo(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class hi extends Ni{}class is extends Ni{constructor(e){super(),this.elements=e}}function $h(n,e){const t=Hh(e);for(const r of n.elements)t.some((s=>xt(s,r)))||t.push(r);return{arrayValue:{values:t}}}class os extends Ni{constructor(e){super(),this.elements=e}}function zh(n,e){let t=Hh(e);for(const r of n.elements)t=t.filter((s=>!xt(s,r)));return{arrayValue:{values:t}}}class di extends Ni{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Cl(n){return Ae(n.integerValue||n.doubleValue)}function Hh(n){return ga(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function qy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof is&&s instanceof is||r instanceof os&&s instanceof os?ur(r.elements,s.elements,xt):r instanceof di&&s instanceof di?xt(r.Ae,s.Ae):r instanceof hi&&s instanceof hi})(n.transform,e.transform)}class $y{constructor(e,t){this.version=e,this.transformResults=t}}class Vt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Vt}static exists(e){return new Vt(void 0,e)}static updateTime(e){return new Vt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ks(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Oi{}function Wh(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Kh(n.key,Vt.none()):new ps(n.key,n.data,Vt.none());{const t=n.data,r=lt.empty();let s=new Le(Ye.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new An(n.key,r,new dt(s.toArray()),Vt.none())}}function zy(n,e,t){n instanceof ps?(function(s,o,a){const l=s.value.clone(),h=Dl(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof An?(function(s,o,a){if(!Ks(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=Dl(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Gh(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Yr(n,e,t,r){return n instanceof ps?(function(o,a,l,h){if(!Ks(o.precondition,a))return l;const d=o.value.clone(),p=Vl(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof An?(function(o,a,l,h){if(!Ks(o.precondition,a))return l;const d=Vl(o.fieldTransforms,h,a),p=a.data;return p.setAll(Gh(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(n,e,t,r):(function(o,a,l){return Ks(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function Hy(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=qh(r.transform,s||null);o!=null&&(t===null&&(t=lt.empty()),t.set(r.field,o))}return t||null}function kl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ur(r,s,((o,a)=>qy(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ps extends Oi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class An extends Oi{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Gh(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function Dl(n,e,t){const r=new Map;ce(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,l=e.data.field(o.field);r.set(o.field,jy(a,l,t[s]))}return r}function Vl(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,By(o,a,e))}return r}class Kh extends Oi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wy extends Oi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Gy{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&zy(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Yr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Bh();return this.mutations.forEach((s=>{const o=e.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=t.has(s.key)?null:l;const h=Wh(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(G.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),te())}isEqual(e){return this.batchId===e.batchId&&ur(this.mutations,e.mutations,((t,r)=>kl(t,r)))&&ur(this.baseMutations,e.baseMutations,((t,r)=>kl(t,r)))}}class Ta{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ce(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return My})();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Ta(e,t,r,s)}}class Ky{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Qy{constructor(e,t){this.count=e,this.unchangedNames=t}}var be,re;function Yy(n){switch(n){case D.OK:return H(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return H(15467,{code:n})}}function Qh(n){if(n===void 0)return Wt("GRPC error has no .code"),D.UNKNOWN;switch(n){case be.OK:return D.OK;case be.CANCELLED:return D.CANCELLED;case be.UNKNOWN:return D.UNKNOWN;case be.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case be.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case be.INTERNAL:return D.INTERNAL;case be.UNAVAILABLE:return D.UNAVAILABLE;case be.UNAUTHENTICATED:return D.UNAUTHENTICATED;case be.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case be.NOT_FOUND:return D.NOT_FOUND;case be.ALREADY_EXISTS:return D.ALREADY_EXISTS;case be.PERMISSION_DENIED:return D.PERMISSION_DENIED;case be.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case be.ABORTED:return D.ABORTED;case be.OUT_OF_RANGE:return D.OUT_OF_RANGE;case be.UNIMPLEMENTED:return D.UNIMPLEMENTED;case be.DATA_LOSS:return D.DATA_LOSS;default:return H(39323,{code:n})}}(re=be||(be={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";function Xy(){return new TextEncoder}const Jy=new fn([4294967295,4294967295],0);function Nl(n){const e=Xy().encode(n),t=new uh;return t.update(e),new Uint8Array(t.digest())}function Ol(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new fn([t,r],0),new fn([s,o],0)]}class Ia{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new qr(`Invalid padding: ${t}`);if(r<0)throw new qr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new qr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new qr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=fn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(fn.fromNumber(r)));return s.compare(Jy)===1&&(s=new fn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Nl(e),[r,s]=Ol(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Ia(o,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=Nl(e),[r,s]=Ol(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class qr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Mi{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ms.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Mi(G.min(),s,new ve(ee),Kt(),te())}}class ms{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ms(r,t,te(),te(),te())}}class Qs{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class Yh{constructor(e,t){this.targetId=e,this.Ce=t}}class Xh{constructor(e,t,r=Xe.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Ml{constructor(){this.ve=0,this.Fe=xl(),this.Me=Xe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=te(),t=te(),r=te();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:H(38017,{changeType:o})}})),new ms(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=xl()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ce(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Zy{constructor(e){this.Ge=e,this.ze=new Map,this.je=Kt(),this.Je=Fs(),this.He=Fs(),this.Ye=new ve(ee)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:H(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(qo(o))if(r===0){const a=new j(o.path);this.et(t,a,rt.newNoDocument(a,G.min()))}else ce(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),h=l?this.ct(l,e,a):1;if(h!==0){this.it(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,l;try{a=_n(r).toUint8Array()}catch(h){if(h instanceof Ih)return lr("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Ia(a,s,o)}catch(h){return lr(h instanceof qr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.et(t,o,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const l=this.ot(a);if(l){if(o.current&&qo(l.target)){const h=new j(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,rt.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.qe())}}));let r=te();this.He.forEach(((o,a)=>{let l=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const s=new Mi(e,t,this.Ye,this.je,r);return this.je=Kt(),this.Je=Fs(),this.He=Fs(),this.Ye=new ve(ee),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ml,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Le(ee),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Le(ee),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ml),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Fs(){return new ve(j.comparator)}function xl(){return new ve(j.comparator)}const ev={asc:"ASCENDING",desc:"DESCENDING"},tv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},nv={and:"AND",or:"OR"};class rv{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function zo(n,e){return n.useProto3Json||Pi(e)?e:{value:e}}function fi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Jh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function sv(n,e){return fi(n,e.toTimestamp())}function Nt(n){return ce(!!n,49232),G.fromTimestamp((function(t){const r=gn(t);return new fe(r.seconds,r.nanos)})(n))}function wa(n,e){return Ho(n,e).canonicalString()}function Ho(n,e){const t=(function(s){return new de(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Zh(n){const e=de.fromString(n);return ce(sd(e),10190,{key:e.toString()}),e}function Wo(n,e){return wa(n.databaseId,e.path)}function Eo(n,e){const t=Zh(e);if(t.get(1)!==n.databaseId.projectId)throw new F(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new F(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new j(td(t))}function ed(n,e){return wa(n.databaseId,e)}function iv(n){const e=Zh(n);return e.length===4?de.emptyPath():td(e)}function Go(n){return new de(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function td(n){return ce(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Ll(n,e,t){return{name:Wo(n,e),fields:t.value.mapValue.fields}}function ov(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:H(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(ce(p===void 0||typeof p=="string",58123),Xe.fromBase64String(p||"")):(ce(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),Xe.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const p=d.code===void 0?D.UNKNOWN:Qh(d.code);return new F(p,d.message||"")})(a);t=new Xh(r,s,o,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Eo(n,r.document.name),o=Nt(r.document.updateTime),a=r.document.createTime?Nt(r.document.createTime):G.min(),l=new lt({mapValue:{fields:r.document.fields}}),h=rt.newFoundDocument(s,o,a,l),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Qs(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Eo(n,r.document),o=r.readTime?Nt(r.readTime):G.min(),a=rt.newNoDocument(s,o),l=r.removedTargetIds||[];t=new Qs([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Eo(n,r.document),o=r.removedTargetIds||[];t=new Qs([],o,s,null)}else{if(!("filter"in e))return H(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new Qy(s,o),l=r.targetId;t=new Yh(l,a)}}return t}function av(n,e){let t;if(e instanceof ps)t={update:Ll(n,e.key,e.value)};else if(e instanceof Kh)t={delete:Wo(n,e.key)};else if(e instanceof An)t={update:Ll(n,e.key,e.data),updateMask:gv(e.fieldMask)};else{if(!(e instanceof Wy))return H(16599,{Vt:e.type});t={verify:Wo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(o,a){const l=a.transform;if(l instanceof hi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof is)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof os)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof di)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw H(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:sv(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:H(27497)})(n,e.precondition)),t}function cv(n,e){return n&&n.length>0?(ce(e!==void 0,14353),n.map((t=>(function(s,o){let a=s.updateTime?Nt(s.updateTime):Nt(o);return a.isEqual(G.min())&&(a=Nt(o)),new $y(a,s.transformResults||[])})(t,e)))):[]}function lv(n,e){return{documents:[ed(n,e.path)]}}function uv(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ed(n,s);const o=(function(d){if(d.length!==0)return rd(Lt.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(E){return{field:Jn(E.field),direction:fv(E.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=zo(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function hv(n){let e=iv(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ce(r===1,65062);const p=t.from[0];p.allDescendants?s=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(v){const E=nd(v);return E instanceof Lt&&Vh(E)?E.getFilters():[E]})(t.where));let a=[];t.orderBy&&(a=(function(v){return v.map((E=>(function(P){return new ui(Zn(P.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(P.direction))})(E)))})(t.orderBy));let l=null;t.limit&&(l=(function(v){let E;return E=typeof v=="object"?v.value:v,Pi(E)?null:E})(t.limit));let h=null;t.startAt&&(h=(function(v){const E=!!v.before,R=v.values||[];return new li(R,E)})(t.startAt));let d=null;return t.endAt&&(d=(function(v){const E=!v.before,R=v.values||[];return new li(R,E)})(t.endAt)),Cy(e,s,a,o,l,"F",h,d)}function dv(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return H(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function nd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Zn(t.unaryFilter.field);return xe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Zn(t.unaryFilter.field);return xe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Zn(t.unaryFilter.field);return xe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Zn(t.unaryFilter.field);return xe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return H(61313);default:return H(60726)}})(n):n.fieldFilter!==void 0?(function(t){return xe.create(Zn(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return H(58110);default:return H(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Lt.create(t.compositeFilter.filters.map((r=>nd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return H(1026)}})(t.compositeFilter.op))})(n):H(30097,{filter:n})}function fv(n){return ev[n]}function pv(n){return tv[n]}function mv(n){return nv[n]}function Jn(n){return{fieldPath:n.canonicalString()}}function Zn(n){return Ye.fromServerFormat(n.fieldPath)}function rd(n){return n instanceof xe?(function(t){if(t.op==="=="){if(Al(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NAN"}};if(wl(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Al(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NOT_NAN"}};if(wl(t.value))return{unaryFilter:{field:Jn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Jn(t.field),op:pv(t.op),value:t.value}}})(n):n instanceof Lt?(function(t){const r=t.getFilters().map((s=>rd(s)));return r.length===1?r[0]:{compositeFilter:{op:mv(t.op),filters:r}}})(n):H(54877,{filter:n})}function gv(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function sd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ln{constructor(e,t,r,s,o=G.min(),a=G.min(),l=Xe.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new ln(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class _v{constructor(e){this.yt=e}}function yv(n){const e=hv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?$o(e,e.limit,"L"):e}class vv{constructor(){this.Cn=new Ev}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(mn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(mn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class Ev{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Le(de.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Le(de.comparator)).toArray()}}const Fl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},id=41943040;class ct{static withCacheSize(e){return new ct(e,ct.DEFAULT_COLLECTION_PERCENTILE,ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}ct.DEFAULT_COLLECTION_PERCENTILE=10,ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ct.DEFAULT=new ct(id,ct.DEFAULT_COLLECTION_PERCENTILE,ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ct.DISABLED=new ct(-1,0,0);class fr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new fr(0)}static cr(){return new fr(-1)}}const Ul="LruGarbageCollector",Tv=1048576;function Bl([n,e],[t,r]){const s=ee(n,t);return s===0?ee(e,r):s}class Iv{constructor(e){this.Ir=e,this.buffer=new Le(Bl),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Bl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class wv{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){x(Ul,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vr(t)?x(Ul,"Ignoring IndexedDB error during garbage collection: ",t):await yr(t)}await this.Vr(3e5)}))}}class Av{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Si.ce);const r=new Iv(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Fl)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fl):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,o,a,l,h,d;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,a=Date.now(),this.nthSequenceNumber(e,s)))).next((v=>(r=v,l=Date.now(),this.removeTargets(e,r,t)))).next((v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((v=>(d=Date.now(),Yn()<=Z.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function Rv(n,e){return new Av(n,e)}class bv{constructor(){this.changes=new qn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Sv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Pv{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&Yr(r.mutation,s,dt.empty(),fe.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,te()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=te()){const s=Dn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((o=>{let a=jr();return o.forEach(((l,h)=>{a=a.insert(l,h.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Dn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,te())))}populateOverlays(e,t,r){const s=[];return r.forEach((o=>{t.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let o=Kt();const a=Qr(),l=(function(){return Qr()})();return t.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof An)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Yr(p.mutation,d,p.mutation.getFieldMask(),fe.now())):a.set(d.key,dt.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),t.forEach(((d,p)=>l.set(d,new Sv(p,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=Qr();let s=new ve(((a,l)=>a-l)),o=te();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((h=>{const d=t.get(h);if(d===null)return;let p=r.get(h)||dt.empty();p=l.applyToLocalView(d,p),r.set(h,p);const v=(s.get(l.batchId)||te()).add(h);s=s.insert(l.batchId,v)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),d=h.key,p=h.value,v=Bh();p.forEach((E=>{if(!o.has(E)){const R=Wh(t.get(E),r.get(E));R!==null&&v.set(E,R),o=o.add(E)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,v))}return C.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return j.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ky(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):C.resolve(Dn());let l=ts,h=o;return a.next((d=>C.forEach(d,((p,v)=>(l<v.largestBatchId&&(l=v.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next((E=>{h=h.insert(p,E)}))))).next((()=>this.populateOverlays(e,d,o))).next((()=>this.computeViews(e,h,d,te()))).next((p=>({batchId:l,changes:Uh(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next((r=>{let s=jr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=jr();return this.indexManager.getCollectionParents(e,o).next((l=>C.forEach(l,(h=>{const d=(function(v,E){return new ki(E,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((p=>{p.forEach(((v,E)=>{a=a.insert(v,E)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,rt.newInvalidDocument(p)))}));let l=jr();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Yr(p.mutation,d,dt.empty(),fe.now()),Vi(t,d)&&(l=l.insert(h,d))})),l}))}}class Cv{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:Nt(s.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:yv(s.bundledQuery),readTime:Nt(s.readTime)}})(t)),C.resolve()}}class kv{constructor(){this.overlays=new ve(j.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Dn();return C.forEach(t,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,o)=>{this.St(e,t,o)})),C.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){const s=Dn(),o=t.length+1,a=new j(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return C.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new ve(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Dn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=Dn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>l.set(d,p))),!(l.size()>=s)););return C.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Ky(t,r));let o=this.qr.get(t);o===void 0&&(o=te(),this.qr.set(t,o)),this.qr.set(t,o.add(r.key))}}class Dv{constructor(){this.sessionToken=Xe.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}class Aa{constructor(){this.Qr=new Le(qe.$r),this.Ur=new Le(qe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new qe(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new qe(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new j(new de([])),r=new qe(t,e),s=new qe(t,e+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new j(new de([])),r=new qe(t,e),s=new qe(t,e+1);let o=te();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new qe(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class qe{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return j.comparator(e.key,t.key)||ee(e.Yr,t.Yr)}static Kr(e,t){return ee(e.Yr,t.Yr)||j.comparator(e.key,t.key)}}class Vv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Le(qe.$r)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Gy(o,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new qe(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),o=s<0?0:s;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?pa:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new qe(t,0),s=new qe(t,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);o.push(l)})),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Le(ee);return t.forEach((s=>{const o=new qe(s,0),a=new qe(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(l=>{r=r.add(l.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;j.isDocumentKey(o)||(o=o.child(""));const a=new qe(new j(o),0);let l=new Le(ee);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(h.Yr)),!0)}),a),C.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){ce(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(t.mutations,(s=>{const o=new qe(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new qe(t,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Nv{constructor(e){this.ri=e,this.docs=(function(){return new ve(j.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():rt.newInvalidDocument(t))}getEntries(e,t){let r=Kt();return t.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():rt.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=Kt();const a=t.path,l=new j(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ay(oy(p),r)<=0||(s.has(p.key)||Vi(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,s){H(9500)}ii(e,t){return C.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new Ov(this)}getSize(e){return C.resolve(this.size)}}class Ov extends bv{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),C.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Mv{constructor(e){this.persistence=e,this.si=new qn((t=>_a(t)),ya),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.oi=0,this._i=new Aa,this.targetCount=0,this.ai=fr.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new fr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),C.waitFor(o).next((()=>s))}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach((a=>{o.push(s.markPotentiallyOrphaned(e,a))})),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}}class od{constructor(e,t){this.ui={},this.overlays={},this.ci=new Si(0),this.li=!1,this.li=!0,this.hi=new Dv,this.referenceDelegate=e(this),this.Pi=new Mv(this),this.indexManager=new vv,this.remoteDocumentCache=(function(s){return new Nv(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new _v(t),this.Ii=new Cv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new kv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Vv(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);const s=new xv(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,t){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class xv extends ly{constructor(e){super(),this.currentSequenceNumber=e}}class Ra{constructor(e){this.persistence=e,this.Ri=new Aa,this.Vi=null}static mi(e){return new Ra(e)}get fi(){if(this.Vi)return this.Vi;throw H(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=j.fromPath(r);return this.gi(e,s).next((o=>{o||t.removeEntry(s,G.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class pi{constructor(e,t){this.persistence=e,this.pi=new qn((r=>dy(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Rv(this,t)}static mi(e,t){return new pi(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return C.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?C.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,o.removeEntry(a,G.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ws(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ba{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=te(),s=te();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new ba(e,t.fromCache,r,s)}}class Lv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Fv{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return fp()?8:uy(st())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.ys(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(e,t,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Lv;return this.Ss(e,t,a).next((l=>{if(o.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>o.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(Yn()<=Z.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Xn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(Yn()<=Z.DEBUG&&x("QueryEngine","Query:",Xn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Yn()<=Z.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Xn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Dt(t))):C.resolve())}ys(e,t){if(Pl(t))return C.resolve(null);let r=Dt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=$o(t,null,"F"),r=Dt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const a=te(...o);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((h=>{const d=this.Ds(t,l);return this.Cs(t,d,a,h.readTime)?this.ys(e,$o(t,null,"F")):this.vs(e,d,t,h)}))))})))))}ws(e,t,r,s){return Pl(t)||s.isEqual(G.min())?C.resolve(null):this.ps.getDocuments(e,r).next((o=>{const a=this.Ds(t,o);return this.Cs(t,a,r,s)?C.resolve(null):(Yn()<=Z.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Xn(t)),this.vs(e,a,t,iy(s,ts)).next((l=>l)))}))}Ds(e,t){let r=new Le(Lh(e));return t.forEach(((s,o)=>{Vi(e,o)&&(r=r.add(o))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,t,r){return Yn()<=Z.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Xn(t)),this.ps.getDocumentsMatchingQuery(e,t,mn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Sa="LocalStore",Uv=3e8;class Bv{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new ve(ee),this.xs=new qn((o=>_a(o)),ya),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Pv(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function jv(n,e,t,r){return new Bv(n,e,t,r)}async function ad(n,e){const t=Y(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],l=[];let h=te();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){l.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function qv(n,e){const t=Y(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,d,p){const v=d.batch,E=v.keys();let R=C.resolve();return E.forEach((P=>{R=R.next((()=>p.getEntry(h,P))).next((V=>{const k=d.docVersions.get(P);ce(k!==null,48541),V.version.compareTo(k)<0&&(v.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),p.addEntry(V)))}))})),R.next((()=>l.mutationQueue.removeMutationBatch(h,v)))})(t,r,e,o).next((()=>o.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=te();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(h=h.add(l.batch.mutations[d].key));return h})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function cd(n){const e=Y(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function $v(n,e){const t=Y(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((p,v)=>{const E=s.get(v);if(!E)return;l.push(t.Pi.removeMatchingKeys(o,p.removedDocuments,v).next((()=>t.Pi.addMatchingKeys(o,p.addedDocuments,v))));let R=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(v)!==null?R=R.withResumeToken(Xe.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),s=s.insert(v,R),(function(V,k,U){return V.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=Uv?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0})(E,R,p)&&l.push(t.Pi.updateTargetData(o,R))}));let h=Kt(),d=te();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),l.push(zv(o,a,e.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(G.min())){const p=t.Pi.getLastRemoteSnapshotVersion(o).next((v=>t.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(p)}return C.waitFor(l).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(t.Ms=s,o)))}function zv(n,e,t){let r=te(),s=te();return t.forEach((o=>r=r.add(o))),e.getEntries(n,r).next((o=>{let a=Kt();return t.forEach(((l,h)=>{const d=o.get(l);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(G.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):x(Sa,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function Hv(n,e){const t=Y(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=pa),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Wv(n,e){const t=Y(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((o=>o?(s=o,C.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new ln(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function Ko(n,e,t){const r=Y(n),s=r.Ms.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!vr(a))throw a;x(Sa,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function jl(n,e,t){const r=Y(n);let s=G.min(),o=te();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const v=Y(h),E=v.xs.get(p);return E!==void 0?C.resolve(v.Ms.get(E)):v.Pi.getTargetData(d,p)})(r,a,Dt(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:G.min(),t?o:te()))).next((l=>(Gv(r,Vy(e),l),{documents:l,Qs:o})))))}function Gv(n,e,t){let r=n.Os.get(e)||G.min();t.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(e,r)}class ql{constructor(){this.activeTargetIds=Fy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Kv{constructor(){this.Mo=new ql,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ql,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Qv{Oo(e){}shutdown(){}}const $l="ConnectivityMonitor";class zl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){x($l,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){x($l,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Us=null;function Qo(){return Us===null?Us=(function(){return 268435456+Math.round(2147483648*Math.random())})():Us++,"0x"+Us.toString(16)}const To="RestConnection",Yv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xv{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===ai?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,o){const a=Qo(),l=this.zo(e,t.toUriEncodedString());x(To,`Sending RPC '${e}' ${a}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(l),p=mr(d);return this.Jo(e,l,h,r,p).then((v=>(x(To,`Received RPC '${e}' ${a}: `,v),v)),(v=>{throw lr(To,`RPC '${e}' ${a} failed with error: `,v,"url: ",l,"request:",r),v}))}Ho(e,t,r,s,o,a){return this.Go(e,t,r,s,o)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+_r})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,t){const r=Yv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class Jv{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const tt="WebChannelConnection";class Zv extends Xv{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,o){const a=Qo();return new Promise(((l,h)=>{const d=new hh;d.setWithCredentials(!0),d.listenOnce(dh.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Hs.NO_ERROR:const v=d.getResponseJson();x(tt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(v)),l(v);break;case Hs.TIMEOUT:x(tt,`RPC '${e}' ${a} timed out`),h(new F(D.DEADLINE_EXCEEDED,"Request time out"));break;case Hs.HTTP_ERROR:const E=d.getStatus();if(x(tt,`RPC '${e}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const P=R?.error;if(P&&P.status&&P.message){const V=(function(U){const B=U.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(B)>=0?B:D.UNKNOWN})(P.status);h(new F(V,P.message))}else h(new F(D.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new F(D.UNAVAILABLE,"Connection failed."));break;default:H(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{x(tt,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(s);x(tt,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",p,r,15)}))}T_(e,t,r){const s=Qo(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=mh(),l=ph(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=o.join("");x(tt,`Creating RPC '${e}' stream ${s}: ${p}`,h);const v=a.createWebChannel(p,h);this.I_(v);let E=!1,R=!1;const P=new Jv({Yo:k=>{R?x(tt,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(E||(x(tt,`Opening RPC '${e}' stream ${s} transport.`),v.open(),E=!0),x(tt,`RPC '${e}' stream ${s} sending:`,k),v.send(k))},Zo:()=>v.close()}),V=(k,U,B)=>{k.listen(U,(L=>{try{B(L)}catch(K){setTimeout((()=>{throw K}),0)}}))};return V(v,Br.EventType.OPEN,(()=>{R||(x(tt,`RPC '${e}' stream ${s} transport opened.`),P.o_())})),V(v,Br.EventType.CLOSE,(()=>{R||(R=!0,x(tt,`RPC '${e}' stream ${s} transport closed`),P.a_(),this.E_(v))})),V(v,Br.EventType.ERROR,(k=>{R||(R=!0,lr(tt,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),P.a_(new F(D.UNAVAILABLE,"The operation could not be completed")))})),V(v,Br.EventType.MESSAGE,(k=>{if(!R){const U=k.data[0];ce(!!U,16349);const B=U,L=B?.error||B[0]?.error;if(L){x(tt,`RPC '${e}' stream ${s} received error:`,L);const K=L.status;let q=(function(m){const _=be[m];if(_!==void 0)return Qh(_)})(K),J=L.message;q===void 0&&(q=D.INTERNAL,J="Unknown error status: "+K+" with message "+L.message),R=!0,P.a_(new F(q,J)),v.close()}else x(tt,`RPC '${e}' stream ${s} received:`,U),P.u_(U)}})),V(l,fh.STAT_EVENT,(k=>{k.stat===Lo.PROXY?x(tt,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===Lo.NOPROXY&&x(tt,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{P.__()}),0),P}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Io(){return typeof document<"u"?document:null}function xi(n){return new rv(n,!0)}class ld{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&x("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Hl="PersistentStream";class ud{constructor(e,t,r,s,o,a,l,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ld(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Wt(t.toString()),Wt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new F(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return x(Hl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(x(Hl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class eE extends ud{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=ov(this.serializer,e),r=(function(o){if(!("targetChange"in o))return G.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?G.min():a.readTime?Nt(a.readTime):G.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Go(this.serializer),t.addTarget=(function(o,a){let l;const h=a.target;if(l=qo(h)?{documents:lv(o,h)}:{query:uv(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Jh(o,a.resumeToken);const d=zo(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(G.min())>0){l.readTime=fi(o,a.snapshotVersion.toTimestamp());const d=zo(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=dv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Go(this.serializer),t.removeTarget=e,this.q_(t)}}class tE extends ud{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ce(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ce(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ce(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=cv(e.writeResults,e.commitTime),r=Nt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Go(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>av(this.serializer,r)))};this.q_(t)}}class nE{}class rE extends nE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new F(D.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(e,Ho(t,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new F(D.UNKNOWN,o.toString())}))}Ho(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,Ho(t,r),s,a,l,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new F(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class sE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Wt(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Un="RemoteStore";class iE{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{$n(this)&&(x(Un,"Restarting streams for network reachability change."),await(async function(h){const d=Y(h);d.Ea.add(4),await gs(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Li(d)})(this))}))})),this.Ra=new sE(r,s)}}async function Li(n){if($n(n))for(const e of n.da)await e(!0)}async function gs(n){for(const e of n.da)await e(!1)}function hd(n,e){const t=Y(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Da(t)?ka(t):Er(t).O_()&&Ca(t,e))}function Pa(n,e){const t=Y(n),r=Er(t);t.Ia.delete(e),r.O_()&&dd(t,e),t.Ia.size===0&&(r.O_()?r.L_():$n(t)&&t.Ra.set("Unknown"))}function Ca(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Er(n).Y_(e)}function dd(n,e){n.Va.Ue(e),Er(n).Z_(e)}function ka(n){n.Va=new Zy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Er(n).start(),n.Ra.ua()}function Da(n){return $n(n)&&!Er(n).x_()&&n.Ia.size>0}function $n(n){return Y(n).Ea.size===0}function fd(n){n.Va=void 0}async function oE(n){n.Ra.set("Online")}async function aE(n){n.Ia.forEach(((e,t)=>{Ca(n,e)}))}async function cE(n,e){fd(n),Da(n)?(n.Ra.ha(e),ka(n)):n.Ra.set("Unknown")}async function lE(n,e,t){if(n.Ra.set("Online"),e instanceof Xh&&e.state===2&&e.cause)try{await(async function(s,o){const a=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){x(Un,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await mi(n,r)}else if(e instanceof Qs?n.Va.Ze(e):e instanceof Yh?n.Va.st(e):n.Va.tt(e),!t.isEqual(G.min()))try{const r=await cd(n.localStore);t.compareTo(r)>=0&&await(function(o,a){const l=o.Va.Tt(a);return l.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),l.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(Xe.EMPTY_BYTE_STRING,p.snapshotVersion)),dd(o,h);const v=new ln(p.target,h,d,p.sequenceNumber);Ca(o,v)})),o.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){x(Un,"Failed to raise snapshot:",r),await mi(n,r)}}async function mi(n,e,t){if(!vr(e))throw e;n.Ea.add(1),await gs(n),n.Ra.set("Offline"),t||(t=()=>cd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{x(Un,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Li(n)}))}function pd(n,e){return e().catch((t=>mi(n,t,e)))}async function Fi(n){const e=Y(n),t=vn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:pa;for(;uE(e);)try{const s=await Hv(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,hE(e,s)}catch(s){await mi(e,s)}md(e)&&gd(e)}function uE(n){return $n(n)&&n.Ta.length<10}function hE(n,e){n.Ta.push(e);const t=vn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function md(n){return $n(n)&&!vn(n).x_()&&n.Ta.length>0}function gd(n){vn(n).start()}async function dE(n){vn(n).ra()}async function fE(n){const e=vn(n);for(const t of n.Ta)e.ea(t.mutations)}async function pE(n,e,t){const r=n.Ta.shift(),s=Ta.from(r,e,t);await pd(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Fi(n)}async function mE(n,e){e&&vn(n).X_&&await(async function(r,s){if((function(a){return Yy(a)&&a!==D.ABORTED})(s.code)){const o=r.Ta.shift();vn(r).B_(),await pd(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await Fi(r)}})(n,e),md(n)&&gd(n)}async function Wl(n,e){const t=Y(n);t.asyncQueue.verifyOperationInProgress(),x(Un,"RemoteStore received new credentials");const r=$n(t);t.Ea.add(3),await gs(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Li(t)}async function gE(n,e){const t=Y(n);e?(t.Ea.delete(2),await Li(t)):e||(t.Ea.add(2),await gs(t),t.Ra.set("Unknown"))}function Er(n){return n.ma||(n.ma=(function(t,r,s){const o=Y(t);return o.sa(),new eE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:oE.bind(null,n),t_:aE.bind(null,n),r_:cE.bind(null,n),H_:lE.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),Da(n)?ka(n):n.Ra.set("Unknown")):(await n.ma.stop(),fd(n))}))),n.ma}function vn(n){return n.fa||(n.fa=(function(t,r,s){const o=Y(t);return o.sa(),new tE(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:dE.bind(null,n),r_:mE.bind(null,n),ta:fE.bind(null,n),na:pE.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await Fi(n)):(await n.fa.stop(),n.Ta.length>0&&(x(Un,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Va{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new $t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,l=new Va(e,t,a,s,o);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new F(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Na(n,e){if(Wt("AsyncQueue",`${e}: ${n}`),vr(n))return new F(D.UNAVAILABLE,`${e}: ${n}`);throw n}class or{static emptySet(e){return new or(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||j.comparator(t.key,r.key):(t,r)=>j.comparator(t.key,r.key),this.keyedMap=jr(),this.sortedSet=new ve(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof or)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new or;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Gl{constructor(){this.ga=new ve(j.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):H(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class pr{constructor(e,t,r,s,o,a,l,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new pr(e,t,or.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Di(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class _E{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class yE{constructor(){this.queries=Kl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Y(t),o=s.queries;s.queries=Kl(),o.forEach(((a,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new F(D.ABORTED,"Firestore shutting down"))}}function Kl(){return new qn((n=>xh(n)),Di)}async function _d(n,e){const t=Y(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new _E,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=Na(a,`Initialization of query '${Xn(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,o),o.Sa.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Oa(t)}async function yd(n,e){const t=Y(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function vE(n,e){const t=Y(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Oa(t)}function EE(n,e,t){const r=Y(n),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(t);r.queries.delete(e)}function Oa(n){n.Ca.forEach((e=>{e.next()}))}var Yo,Ql;(Ql=Yo||(Yo={})).Ma="default",Ql.Cache="cache";class vd{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new pr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=pr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Yo.Cache}}class Ed{constructor(e){this.key=e}}class Td{constructor(e){this.key=e}}class TE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=te(),this.mutatedKeys=te(),this.eu=Lh(e),this.tu=new or(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Gl,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((p,v)=>{const E=s.get(p),R=Vi(this.query,v)?v:null,P=!!E&&this.mutatedKeys.has(E.key),V=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let k=!1;E&&R?E.data.isEqual(R.data)?P!==V&&(r.track({type:3,doc:R}),k=!0):this.su(E,R)||(r.track({type:2,doc:R}),k=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(l=!0)):!E&&R?(r.track({type:0,doc:R}),k=!0):E&&!R&&(r.track({type:1,doc:E}),k=!0,(h||d)&&(l=!0)),k&&(R?(a=a.add(R),o=V?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:l,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,v)=>(function(R,P){const V=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return H(20277,{Rt:k})}};return V(R)-V(P)})(p.type,v.type)||this.eu(p.doc,v.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new pr(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Gl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=te(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Td(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new Ed(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=te();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ma="SyncEngine";class IE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class wE{constructor(e){this.key=e,this.hu=!1}}class AE{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new qn((l=>xh(l)),Di),this.Iu=new Map,this.Eu=new Set,this.du=new ve(j.comparator),this.Au=new Map,this.Ru=new Aa,this.Vu={},this.mu=new Map,this.fu=fr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function RE(n,e,t=!0){const r=Sd(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Id(r,e,t,!0),s}async function bE(n,e){const t=Sd(n);await Id(t,e,!0,!1)}async function Id(n,e,t,r){const s=await Wv(n.localStore,Dt(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let l;return r&&(l=await SE(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&hd(n.remoteStore,s),l}async function SE(n,e,t,r,s){n.pu=(v,E,R)=>(async function(V,k,U,B){let L=k.view.ru(U);L.Cs&&(L=await jl(V.localStore,k.query,!1).then((({documents:I})=>k.view.ru(I,L))));const K=B&&B.targetChanges.get(k.targetId),q=B&&B.targetMismatches.get(k.targetId)!=null,J=k.view.applyChanges(L,V.isPrimaryClient,K,q);return Xl(V,k.targetId,J.au),J.snapshot})(n,v,E,R);const o=await jl(n.localStore,e,!0),a=new TE(e,o.Qs),l=a.ru(o.documents),h=ms.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,h);Xl(n,t,d.au);const p=new IE(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function PE(n,e,t){const r=Y(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!Di(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ko(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Pa(r.remoteStore,s.targetId),Xo(r,s.targetId)})).catch(yr)):(Xo(r,s.targetId),await Ko(r.localStore,s.targetId,!0))}async function CE(n,e){const t=Y(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Pa(t.remoteStore,r.targetId))}async function kE(n,e,t){const r=LE(n);try{const s=await(function(a,l){const h=Y(a),d=fe.now(),p=l.reduce(((R,P)=>R.add(P.key)),te());let v,E;return h.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let P=Kt(),V=te();return h.Ns.getEntries(R,p).next((k=>{P=k,P.forEach(((U,B)=>{B.isValidDocument()||(V=V.add(U))}))})).next((()=>h.localDocuments.getOverlayedDocuments(R,P))).next((k=>{v=k;const U=[];for(const B of l){const L=Hy(B,v.get(B.key).overlayedDocument);L!=null&&U.push(new An(B.key,L,Ch(L.value.mapValue),Vt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,U,l)})).next((k=>{E=k;const U=k.applyToLocalDocumentSet(v,V);return h.documentOverlayCache.saveOverlays(R,k.batchId,U)}))})).then((()=>({batchId:E.batchId,changes:Uh(v)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new ve(ee)),d=d.insert(l,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await _s(r,s.changes),await Fi(r.remoteStore)}catch(s){const o=Na(s,"Failed to persist write");t.reject(o)}}async function wd(n,e){const t=Y(n);try{const r=await $v(t.localStore,e);e.targetChanges.forEach(((s,o)=>{const a=t.Au.get(o);a&&(ce(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?ce(a.hu,14607):s.removedDocuments.size>0&&(ce(a.hu,42227),a.hu=!1))})),await _s(t,r,e)}catch(r){await yr(r)}}function Yl(n,e,t){const r=Y(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((o,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const h=Y(a);h.onlineState=l;let d=!1;h.queries.forEach(((p,v)=>{for(const E of v.Sa)E.va(l)&&(d=!0)})),d&&Oa(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function DE(n,e,t){const r=Y(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new ve(j.comparator);a=a.insert(o,rt.newNoDocument(o,G.min()));const l=te().add(o),h=new Mi(G.min(),new Map,new ve(ee),a,l);await wd(r,h),r.du=r.du.remove(o),r.Au.delete(e),xa(r)}else await Ko(r.localStore,e,!1).then((()=>Xo(r,e,t))).catch(yr)}async function VE(n,e){const t=Y(n),r=e.batch.batchId;try{const s=await qv(t.localStore,e);Rd(t,r,null),Ad(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await _s(t,s)}catch(s){await yr(s)}}async function NE(n,e,t){const r=Y(n);try{const s=await(function(a,l){const h=Y(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,l).next((v=>(ce(v!==null,37113),p=v.keys(),h.mutationQueue.removeMutationBatch(d,v)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,e);Rd(r,e,t),Ad(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await _s(r,s)}catch(s){await yr(s)}}function Ad(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Rd(n,e,t){const r=Y(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Xo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||bd(n,r)}))}function bd(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Pa(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),xa(n))}function Xl(n,e,t){for(const r of t)r instanceof Ed?(n.Ru.addReference(r.key,e),OE(n,r)):r instanceof Td?(x(Ma,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||bd(n,r.key)):H(19791,{wu:r})}function OE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(x(Ma,"New document in limbo: "+t),n.Eu.add(r),xa(n))}function xa(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new j(de.fromString(e)),r=n.fu.next();n.Au.set(r,new wE(t)),n.du=n.du.insert(t,r),hd(n.remoteStore,new ln(Dt(va(t.path)),r,"TargetPurposeLimboResolution",Si.ce))}}async function _s(n,e,t){const r=Y(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{a.push(r.pu(h,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=ba.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=Y(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>C.forEach(d,(E=>C.forEach(E.Es,(R=>p.persistence.referenceDelegate.addReference(v,E.targetId,R))).next((()=>C.forEach(E.ds,(R=>p.persistence.referenceDelegate.removeReference(v,E.targetId,R)))))))))}catch(v){if(!vr(v))throw v;x(Sa,"Failed to update sequence numbers: "+v)}for(const v of d){const E=v.targetId;if(!v.fromCache){const R=p.Ms.get(E),P=R.snapshotVersion,V=R.withLastLimboFreeSnapshotVersion(P);p.Ms=p.Ms.insert(E,V)}}})(r.localStore,o))}async function ME(n,e){const t=Y(n);if(!t.currentUser.isEqual(e)){x(Ma,"User change. New user:",e.toKey());const r=await ad(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new F(D.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await _s(t,r.Ls)}}function xE(n,e){const t=Y(n),r=t.Au.get(e);if(r&&r.hu)return te().add(r.key);{let s=te();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Sd(n){const e=Y(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=wd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=DE.bind(null,e),e.Pu.H_=vE.bind(null,e.eventManager),e.Pu.yu=EE.bind(null,e.eventManager),e}function LE(n){const e=Y(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=VE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=NE.bind(null,e),e}class gi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=xi(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return jv(this.persistence,new Fv,e.initialUser,this.serializer)}Cu(e){return new od(Ra.mi,this.serializer)}Du(e){return new Kv}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gi.provider={build:()=>new gi};class FE extends gi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ce(this.persistence.referenceDelegate instanceof pi,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new wv(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ct.withCacheSize(this.cacheSizeBytes):ct.DEFAULT;return new od((r=>pi.mi(r,t)),this.serializer)}}class Jo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Yl(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=ME.bind(null,this.syncEngine),await gE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new yE})()}createDatastore(e){const t=xi(e.databaseInfo.databaseId),r=(function(o){return new Zv(o)})(e.databaseInfo);return(function(o,a,l,h){return new rE(o,a,l,h)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,o,a,l){return new iE(r,s,o,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>Yl(this.syncEngine,t,0)),(function(){return zl.v()?new zl:new Qv})())}createSyncEngine(e,t){return(function(s,o,a,l,h,d,p){const v=new AE(s,o,a,l,h,d);return p&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=Y(t);x(Un,"RemoteStore shutting down."),r.Ea.add(5),await gs(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Jo.provider={build:()=>new Jo};class Pd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Wt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const En="FirestoreClient";class UE{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=nt.UNAUTHENTICATED,this.clientId=da.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{x(En,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(x(En,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new $t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Na(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function wo(n,e){n.asyncQueue.verifyOperationInProgress(),x(En,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await ad(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function Jl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await BE(n);x(En,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Wl(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Wl(e.remoteStore,s))),n._onlineComponents=e}async function BE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(En,"Using user provided OfflineComponentProvider");try{await wo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;lr("Error using user provided cache. Falling back to memory cache: "+t),await wo(n,new gi)}}else x(En,"Using default OfflineComponentProvider"),await wo(n,new FE(void 0));return n._offlineComponents}async function Cd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(En,"Using user provided OnlineComponentProvider"),await Jl(n,n._uninitializedComponentsProvider._online)):(x(En,"Using default OnlineComponentProvider"),await Jl(n,new Jo))),n._onlineComponents}function jE(n){return Cd(n).then((e=>e.syncEngine))}async function kd(n){const e=await Cd(n),t=e.eventManager;return t.onListen=RE.bind(null,e.syncEngine),t.onUnlisten=PE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=bE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=CE.bind(null,e.syncEngine),t}function qE(n,e,t={}){const r=new $t;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new Pd({next:E=>{p.Nu(),a.enqueueAndForget((()=>yd(o,v)));const R=E.docs.has(l);!R&&E.fromCache?d.reject(new F(D.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&E.fromCache&&h&&h.source==="server"?d.reject(new F(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(E)},error:E=>d.reject(E)}),v=new vd(va(l.path),p,{includeMetadataChanges:!0,qa:!0});return _d(o,v)})(await kd(n),n.asyncQueue,e,t,r))),r.promise}function $E(n,e,t={}){const r=new $t;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new Pd({next:E=>{p.Nu(),a.enqueueAndForget((()=>yd(o,v))),E.fromCache&&h.source==="server"?d.reject(new F(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(E)},error:E=>d.reject(E)}),v=new vd(l,p,{includeMetadataChanges:!0,qa:!0});return _d(o,v)})(await kd(n),n.asyncQueue,e,t,r))),r.promise}function Dd(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Zl=new Map;const Vd="firestore.googleapis.com",eu=!0;class tu{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new F(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Vd,this.ssl=eu}else this.host=e.host,this.ssl=e.ssl??eu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=id;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Tv)throw new F(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}sy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Dd(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new F(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new F(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new F(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ui{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new F(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new K_;switch(r.type){case"firstParty":return new J_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new F(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Zl.get(t);r&&(x("ComponentProvider","Removing Datastore"),Zl.delete(t),r.terminate())})(this),Promise.resolve()}}function zE(n,e,t,r={}){n=Gt(n,Ui);const s=mr(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(Tu(`https://${l}`),Iu("Firestore",!0)),o.host!==Vd&&o.host!==l&&lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!On(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=nt.MOCK_USER;else{d=sp(r.mockUserToken,n._app?.options.projectId);const v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new F(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new nt(v)}n._authCredentials=new Q_(new _h(d,p))}}class Bi{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Bi(this.firestore,e,this._query)}}class Ce{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ce(this.firestore,e,this._key)}toJSON(){return{type:Ce._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(fs(t,Ce._jsonSchema))return new Ce(e,r||null,new j(de.fromString(t.referencePath)))}}Ce._jsonSchemaVersion="firestore/documentReference/1.0",Ce._jsonSchema={type:Pe("string",Ce._jsonSchemaVersion),referencePath:Pe("string")};class pn extends Bi{constructor(e,t,r){super(e,t,va(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ce(this.firestore,null,new j(e))}withConverter(e){return new pn(this.firestore,e,this._path)}}function HE(n,e,...t){if(n=He(n),yh("collection","path",e),n instanceof Ui){const r=de.fromString(e,...t);return ml(r),new pn(n,null,r)}{if(!(n instanceof Ce||n instanceof pn))throw new F(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(de.fromString(e,...t));return ml(r),new pn(n.firestore,null,r)}}function Ys(n,e,...t){if(n=He(n),arguments.length===1&&(e=da.newId()),yh("doc","path",e),n instanceof Ui){const r=de.fromString(e,...t);return pl(r),new Ce(n,null,new j(r))}{if(!(n instanceof Ce||n instanceof pn))throw new F(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(de.fromString(e,...t));return pl(r),new Ce(n.firestore,n instanceof pn?n.converter:null,new j(r))}}const nu="AsyncQueue";class ru{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ld(this,"async_queue_retry"),this._c=()=>{const r=Io();r&&x(nu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Io();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Io();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new $t;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!vr(e))throw e;x(nu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Wt("INTERNAL UNHANDLED ERROR: ",su(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Va.createAndSchedule(this,e,t,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&H(47125,{Pc:su(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function su(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class ys extends Ui{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ru,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ru(e),this._firestoreClient=void 0,await e}}}function WE(n,e){const t=typeof n=="object"?n:bu(),r=typeof n=="string"?n:ai,s=na(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=np("firestore");o&&zE(s,...o)}return s}function La(n){if(n._terminated)throw new F(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||GE(n),n._firestoreClient}function GE(n){const e=n._freezeSettings(),t=(function(s,o,a,l){return new my(s,o,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Dd(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new UE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class _t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _t(Xe.fromBase64String(e))}catch(t){throw new F(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _t(Xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:_t._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(fs(e,_t._jsonSchema))return _t.fromBase64String(e.bytes)}}_t._jsonSchemaVersion="firestore/bytes/1.0",_t._jsonSchema={type:Pe("string",_t._jsonSchemaVersion),bytes:Pe("string")};class ji{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new F(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Fa{constructor(e){this._methodName=e}}class Ot{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ot._jsonSchemaVersion}}static fromJSON(e){if(fs(e,Ot._jsonSchema))return new Ot(e.latitude,e.longitude)}}Ot._jsonSchemaVersion="firestore/geoPoint/1.0",Ot._jsonSchema={type:Pe("string",Ot._jsonSchemaVersion),latitude:Pe("number"),longitude:Pe("number")};class Mt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Mt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(fs(e,Mt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Mt(e.vectorValues);throw new F(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Mt._jsonSchemaVersion="firestore/vectorValue/1.0",Mt._jsonSchema={type:Pe("string",Mt._jsonSchemaVersion),vectorValues:Pe("object")};const KE=/^__.*__$/;class QE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new An(e,this.data,this.fieldMask,t,this.fieldTransforms):new ps(e,this.data,t,this.fieldTransforms)}}class Nd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new An(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Od(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw H(40011,{Ac:n})}}class Ua{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Ua({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return _i(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(Od(this.Ac)&&KE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class YE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||xi(e)}Cc(e,t,r,s=!1){return new Ua({Ac:e,methodName:t,Dc:r,path:Ye.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Md(n){const e=n._freezeSettings(),t=xi(n._databaseId);return new YE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function XE(n,e,t,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,e,t,s);Ba("Data must be an object, but it was:",a,r);const l=xd(r,a);let h,d;if(o.merge)h=new dt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const v of o.mergeFields){const E=Zo(e,v,t);if(!a.contains(E))throw new F(D.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Fd(p,E)||p.push(E)}h=new dt(p),d=a.fieldTransforms.filter((v=>h.covers(v.field)))}else h=null,d=a.fieldTransforms;return new QE(new lt(l),h,d)}class qi extends Fa{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof qi}}function JE(n,e,t,r){const s=n.Cc(1,e,t);Ba("Data must be an object, but it was:",s,r);const o=[],a=lt.empty();wn(r,((h,d)=>{const p=ja(e,h,t);d=He(d);const v=s.yc(p);if(d instanceof qi)o.push(p);else{const E=$i(d,v);E!=null&&(o.push(p),a.set(p,E))}}));const l=new dt(o);return new Nd(a,l,s.fieldTransforms)}function ZE(n,e,t,r,s,o){const a=n.Cc(1,e,t),l=[Zo(e,r,t)],h=[s];if(o.length%2!=0)throw new F(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<o.length;E+=2)l.push(Zo(e,o[E])),h.push(o[E+1]);const d=[],p=lt.empty();for(let E=l.length-1;E>=0;--E)if(!Fd(d,l[E])){const R=l[E];let P=h[E];P=He(P);const V=a.yc(R);if(P instanceof qi)d.push(R);else{const k=$i(P,V);k!=null&&(d.push(R),p.set(R,k))}}const v=new dt(d);return new Nd(p,v,a.fieldTransforms)}function $i(n,e){if(Ld(n=He(n)))return Ba("Unsupported field value:",e,n),xd(n,e);if(n instanceof Fa)return(function(r,s){if(!Od(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const l of r){let h=$i(l,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,s){if((r=He(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Uy(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=fe.fromDate(r);return{timestampValue:fi(s.serializer,o)}}if(r instanceof fe){const o=new fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:fi(s.serializer,o)}}if(r instanceof Ot)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _t)return{bytesValue:Jh(s.serializer,r._byteString)};if(r instanceof Ce){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:wa(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Mt)return(function(a,l){return{mapValue:{fields:{[Sh]:{stringValue:Ph},[ci]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Ea(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${fa(r)}`)})(n,e)}function xd(n,e){const t={};return Th(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wn(n,((r,s)=>{const o=$i(s,e.mc(r));o!=null&&(t[r]=o)})),{mapValue:{fields:t}}}function Ld(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof fe||n instanceof Ot||n instanceof _t||n instanceof Ce||n instanceof Fa||n instanceof Mt)}function Ba(n,e,t){if(!Ld(t)||!vh(t)){const r=fa(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Zo(n,e,t){if((e=He(e))instanceof ji)return e._internalPath;if(typeof e=="string")return ja(n,e);throw _i("Field path arguments must be of type string or ",n,!1,void 0,t)}const eT=new RegExp("[~\\*/\\[\\]]");function ja(n,e,t){if(e.search(eT)>=0)throw _i(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ji(...e.split("."))._internalPath}catch{throw _i(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function _i(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new F(D.INVALID_ARGUMENT,l+n+h)}function Fd(n,e){return n.some((t=>t.isEqual(e)))}class Ud{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ce(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Bd("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class tT extends Ud{data(){return super.data()}}function Bd(n,e){return typeof e=="string"?ja(n,e):e instanceof ji?e._internalPath:e._delegate._internalPath}function nT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new F(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rT{convertValue(e,t="none"){switch(yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw H(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return wn(e,((s,o)=>{r[s]=this.convertValue(o,t)})),r}convertVectorValue(e){const t=e.fields?.[ci].arrayValue?.values?.map((r=>Ae(r.doubleValue)));return new Mt(t)}convertGeoPoint(e){return new Ot(Ae(e.latitude),Ae(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ci(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ns(e));default:return null}}convertTimestamp(e){const t=gn(e);return new fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=de.fromString(e);ce(sd(r),9688,{name:e});const s=new rs(r.get(1),r.get(3)),o=new j(r.popFirst(5));return s.isEqual(t)||Wt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}function sT(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class $r{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nn extends Ud{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Bd("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new F(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Nn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Nn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Nn._jsonSchema={type:Pe("string",Nn._jsonSchemaVersion),bundleSource:Pe("string","DocumentSnapshot"),bundleName:Pe("string"),bundle:Pe("string")};class Xs extends Nn{data(e={}){return super.data(e)}}class ar{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new $r(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new Xs(this._firestore,this._userDataWriter,r.key,r,new $r(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const h=new Xs(s._firestore,s._userDataWriter,l.doc.key,l.doc,new $r(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new Xs(s._firestore,s._userDataWriter,l.doc.key,l.doc,new $r(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:iT(l.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new F(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ar._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=da.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function iT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return H(61501,{type:n})}}function oT(n){n=Gt(n,Ce);const e=Gt(n.firestore,ys);return qE(La(e),n._key).then((t=>lT(e,n,t)))}ar._jsonSchemaVersion="firestore/querySnapshot/1.0",ar._jsonSchema={type:Pe("string",ar._jsonSchemaVersion),bundleSource:Pe("string","QuerySnapshot"),bundleName:Pe("string"),bundle:Pe("string")};class jd extends rT{constructor(e){super(),this.firestore=e}convertBytes(e){return new _t(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ce(this.firestore,null,t)}}function aT(n){n=Gt(n,Bi);const e=Gt(n.firestore,ys),t=La(e),r=new jd(e);return nT(n._query),$E(t,n._query).then((s=>new ar(e,r,n,s)))}function yi(n,e,t){n=Gt(n,Ce);const r=Gt(n.firestore,ys),s=sT(n.converter,e,t);return qd(r,[XE(Md(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Vt.none())])}function cT(n,e,t,...r){n=Gt(n,Ce);const s=Gt(n.firestore,ys),o=Md(s);let a;return a=typeof(e=He(e))=="string"||e instanceof ji?ZE(o,"updateDoc",n._key,e,t,r):JE(o,"updateDoc",n._key,e),qd(s,[a.toMutation(n._key,Vt.exists(!0))])}function qd(n,e){return(function(r,s){const o=new $t;return r.asyncQueue.enqueueAndForget((async()=>kE(await jE(r),s,o))),o.promise})(La(n),e)}function lT(n,e,t){const r=t.docs.get(e._key),s=new jd(n);return new Nn(n,s,e._key,r,new $r(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){_r=s})(gr),cr(new Mn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new ys(new Y_(r.getProvider("auth-internal")),new Z_(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new F(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:t,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),dn(ul,hl,e),dn(ul,hl,"esm2020")})();const uT={apiKey:"AIzaSyCVOWRz48Jz9lT1in3tIqVGDosmMlEmcq0",authDomain:"tracker-92901.firebaseapp.com",projectId:"tracker-92901",storageBucket:"tracker-92901.firebasestorage.app",messagingSenderId:"222325967743",appId:"1:222325967743:web:c86334e2754db3841b684a",measurementId:"G-GM4CCLCWHQ"},$d=Ru(uT),vi=W_($d),Xr=WE($d),Kn=""+new URL("../assets/sparkles.TOf8JALk.gif",import.meta.url).href;var hT=ge('<div class="parent"><br/> <h1 class="title">Good Calendar</h1> <div style="margin-top: 2rem; position:relative"><div style="display: flex; flex-direction: column; align-items: flex-start; gap: 0.5rem;"><input type="text" placeholder="Username" class="login_input" style="width: 200px;"/> <div style="display: flex; align-items: center; position: relative;"><input placeholder="Password" class="login_input" style="width: 200px;"/> <button class="login-show-password"> </button></div></div></div> <div style="position:relative"><div style="align-items: center"><button>Login</button> <button>Sign up</button></div></div> <div class="login-hint"><!></div> <p style="text-align: center; max-width: 550px; color: var(--medium-text); font-size: 12pt">Track the quality of your days and nights using color-coded ratings and comments. Dedicated to my girlfriend and her chronic migranes.</p> <p style="text-align: center; max-width: 550px; color: var(--medium-text); font-size: 9pt">For demo, <span style="text-decoration:underline">username: goodcalendar, password: goodcalendar</span></p></div>');function dT(n,e){Ti(e,!1),Uf();let t=ae(""),r=ae(""),s=ae(""),o=ae(!0);async function a(){N(s,"");try{const m=`${A(t)}@tracker.app`,_=await kg(vi,m,A(r))}catch(m){console.error(m),N(s,m.message)}}async function l(){N(s,"");try{const m=`${A(t)}@tracker.app`,_=await Dg(vi,m,A(r))}catch(m){console.error(m),N(s,m.message)}}function h(m){switch(!0){case m.startsWith("Firebase: Error (auth/invalid-credential)."):return"Incorrect password or the account doesn't exist";case m.startsWith("Firebase: Missing password requirements:"):return"Your password must contain at least one uppercase character, lowercase character, and number. Minimum length is 6 characters.";case m.startsWith("Firebase: Error (auth/email-already-in-use)."):return"This account already exists.";case m.startsWith("Firebase: Error (auth/invalid-email)."):return"Your username cannot have any spaces";case m.startsWith("Firebase: Error (auth/missing-password)."):return"Missing password";default:return m}}Ei();var d=hT(),p=$(Q(d),4),v=Q(p),E=Q(v);tr(E);var R=$(E,2),P=Q(R);tr(P);var V=$(P,2),k=Q(V,!0);W(V),W(R),W(v),W(p);var U=$(p,2),B=Q(U),L=Q(B),K=$(L,2);W(B),W(U);var q=$(U,2),J=Q(q);{var I=m=>{var _=Ao();$e(w=>ze(_,w),[()=>h(A(s))]),ie(m,_)};Se(J,m=>{A(s)&&m(I)})}W(q),bo(4),W(d),$e(()=>{uu(P,"type",A(o)?"password":"text"),ze(k,A(o)?"show":"hide")}),Vn(E,()=>A(t),m=>N(t,m)),Vn(P,()=>A(r),m=>N(r,m)),me("click",V,()=>N(o,!A(o))),me("click",L,l),me("click",K,a),ie(n,d),Ii()}var fT=ge("<h3>Entry logged!</h3>"),pT=ge('<h3 style="margin: 0px;">Entry logged!</h3> <h4>You can still log your day.</h4>',1),mT=ge('<h3 style="margin: 0px;">Entry logged!</h3> <h4>Come back tomorrow!</h4>',1),gT=ge('<div class="overlay"><!> <button>Return</button></div>'),_T=ge('<br/> <div class="parent"><h1 class="title svelte-kkv8mu"></h1> <h3 style="margin-top: 0; font-style: italic;"> </h3></div>',1),yT=ge('<div class="parent"><h1 class="title svelte-kkv8mu"></h1> <h3 style="margin-top: 0; font-style: italic;"> </h3> <input type="range" min="0" max="10" step="0.1"/> <textarea placeholder="Optional notes..." style="margin-top:0"></textarea> <button> </button></div>'),vT=ge('<!> <button class="floating-button" style="opacity: 0; left: 2%;"></button>',1);function ET(n,e){Ti(e,!1);let t=Pt(e,"user",8),r=Pt(e,"externalEntry",8,null),s=Pt(e,"onSaved",8,()=>{}),o=Pt(e,"invert",8),a=Pt(e,"selectedCalendar",8),l=new Date;const h=l.getFullYear(),d=l.getMonth(),p=l.getDate();function v(g){return g.toString().padStart(2,"0")}let E=t().uid;t().email?name=t().email.replace("@tracker.app","").charAt(0).toUpperCase()+t().email.replace("@tracker.app","").slice(1):name="Temp",`${h}${v(d+1)}${v(p)}`;let R=ae(5),P=ae(""),V=ae(!1),k=ae(""),U=ae(!1),B=ae(""),L=ae(""),K=ae(!1);function q(g){return o()&&(g=10-g),`hsl(${120*(g/10)}, 70%, 65%)`}function J(){return A(R)/10}async function I(g){if(A(V)&&!A(K))return;N(U,!0);const M=Ys(Xr,"users",E,a(),g.key);g.period==="day"?(await yi(M,{valueDay:A(R),textDay:A(P),timestamp:Date.now()},{merge:!0}),g.filledNight&&N(L,"Come back tomorrow!")):(await yi(M,{valueNight:A(R),textNight:A(P),timestamp:Date.now()},{merge:!0}),g.filledDay&&N(L,"Come back tomorrow!")),console.log("Logged "+g.key+" at "+g.period),s()()}function m(){N(U,!1)}zr(()=>mt(r()),()=>{if(r()){let g=r().period==="day"&&r().filledDay||r().period==="night"&&r().filledNight;!r().current&&g?N(V,!0):!r().current&&!g?N(V,!0):r().current&&(N(V,!1),N(P,r().period==="day"?r().textDay:r().textNight),N(R,(r().period==="day"?r().valueDay:r().valueNight)||5))}}),zr(()=>(mt(o()),A(R)),()=>{o()?N(k,A(R)<=0?"celebrate":""):N(k,A(R)>=10?"celebrate":"")}),zr(()=>(mt(o()),A(R)),()=>{(o()||A(R))&&N(B,q(A(R)))}),lu(),Ei();var _=vT(),w=St(_);{var y=g=>{var M=Bs(),se=St(M);{var Re=oe=>{var pe=gT(),Fe=Q(pe);{var Je=ne=>{var ue=fT();ie(ne,ue)},ye=ne=>{var ue=Bs(),ke=St(ue);{var ut=it=>{var Ue=pT();bo(2),ie(it,Ue)},We=it=>{var Ue=mT();bo(2),ie(it,Ue)};Se(ke,it=>{mt(r()),we(()=>r().period==="night"&&!r().filledDay)?it(ut):it(We,!1)},!0)}ie(ne,ue)};Se(Fe,ne=>{mt(r()),we(()=>r().period==="day"&&!r().filledNight)?ne(Je):ne(ye,!1)})}var Te=$(Fe,2);Te.__click=m,W(pe),ie(oe,pe)},_e=oe=>{var pe=Bs(),Fe=St(pe);{var Je=Te=>{var ne=_T(),ue=$(St(ne),2),ke=Q(ue);ke.textContent=`Welcome ${name??""}!`;var ut=$(ke,2),We=Q(ut,!0);W(ut),W(ue),$e(()=>ze(We,A(L)||"Viewing past entries")),ie(Te,ne)},ye=Te=>{var ne=yT(),ue=Q(ne);ue.textContent=`Welcome ${name??""}!`;var ke=$(ue,2),ut=Q(ke);W(ke);var We=$(ke,2);tr(We);var it=$(We,2);Lf(it);var Ue=$(it,2);Ue.__click=()=>I(r());var yt=Q(Ue);W(Ue),W(ne),$e((ot,Yt)=>{ze(ut,`Rate your ${mt(r()),we(()=>r().period==="day"?"day":"night")??""}`),We.disabled=A(V)&&!A(K),Gf(We,1,zf(A(k)),"svelte-kkv8mu"),nr(We,`--fill-percentage: ${ot??""}%; --slider-color: ${A(B)??""}; margin-bottom: 0`),Ue.disabled=A(V)&&!A(K),ze(yt,`Save (${Yt??""}/10)`)},[()=>we(J),()=>(A(R),we(()=>A(R).toFixed(1)))]),Vn(We,()=>A(R),ot=>N(R,ot)),Vn(it,()=>A(P),ot=>N(P,ot)),ie(Te,ne)};Se(Fe,Te=>{A(V)&&!A(K)?Te(Je):Te(ye,!1)})}ie(oe,pe)};Se(se,oe=>{A(U)?oe(Re):oe(_e,!1)})}ie(g,M)};Se(w,g=>{r()&&g(y)})}var T=$(w,2);T.__dblclick=()=>{console.log("Activated override!"),N(K,!A(K))},ie(n,_),Ii()}Ff(["click","dblclick"]);var TT=ge('<div class="day"><div class="day-number"> </div>  <div class="day-half top-half"></div>  <div class="day-half bottom-half"></div></div>'),IT=ge("<!> <br/> <i> </i>",1),wT=ge("<!> <br/> <i> </i>",1),AT=ge('<div class="entry-info"><strong> </strong> <!></div>'),RT=ge('<div class="month-nav"><button class="nav-btn" aria-label="Previous month"></button> <p> </p> <button class="nav-btn" aria-label="Next month"></button></div> <div class="calendar"></div> <!>',1);function bT(n,e){Ti(e,!1);let t=Pt(e,"user",8),r=Pt(e,"onSelectEntry",8,y=>{}),s=Pt(e,"reloadTrigger",8,0),o=Pt(e,"invert",8),a=Pt(e,"selectedCalendar",8),l=t().uid,h=ae([]),d=ae(null),p=ae(new Date),v=ae("");function E(y){return y==null?"var(--V-background-white)":`hsl(${120*(y/10)}, 70%, 65%)`}function R(y){return y.toString().padStart(2,"0")}async function P(){console.log("Loaded calendar entries");const y=A(p).getFullYear(),T=A(p).getMonth(),M=new Date().getHours()<16?"day":"night",se=new Date,Re=new Date(y,T+1,0).getDate();N(v,A(p).toLocaleString("default",{month:"long",year:"numeric"}));const _e=HE(Xr,"users",l,a()),oe=await aT(_e),pe={};oe.forEach(ye=>{pe[ye.id]=ye.data()});const Fe=[],Je=y===se.getFullYear()&&T===se.getMonth()?se.getDate():Re;for(let ye=1;ye<=Je;ye++){const Te=`${y}-${R(T+1)}-${R(ye)}`,ne=pe[Te],ue=y===se.getFullYear()&&T===se.getMonth()&&ye===se.getDate(),ke={key:Te,day:ye,filledDay:ne?.valueDay!=null,filledNight:ne?.valueNight!=null,valueDay:ne?.valueDay??null,valueNight:ne?.valueNight??null,textDay:ne?.textDay??null,textNight:ne?.textNight??null,current:ue};ue&&(A(d)?.period?ke.period=A(d).period:ke.period=M,V(ke)),Fe.push(ke)}N(h,Fe)}function V(y){N(d,y),r()(y),console.log("Selected "+A(d).key+" at "+A(d).period)}function k(){const y=new Date(A(p));y.setMonth(y.getMonth()-1),N(p,y),P(),N(d,null)}function U(){const y=new Date,T=new Date(A(p));T.setMonth(T.getMonth()+1),!(T.getFullYear()>y.getFullYear()||T.getFullYear()===y.getFullYear()&&T.getMonth()>y.getMonth())&&(N(p,T),P(),N(d,null))}Bf(P),zr(()=>mt(s()),()=>{s()&&P()}),zr(()=>mt(a()),()=>{a()&&(P(),N(d,null))}),lu(),Ei();var B=RT(),L=St(B),K=Q(L),q=$(K,2),J=Q(q,!0);W(q);var I=$(q,2);W(L);var m=$(L,2);du(m,5,()=>A(h),hu,(y,T)=>{var g=TT(),M=Q(g),se=Q(M,!0);W(M);var Re=$(M,2),_e=$(Re,2);W(g),$e((oe,pe)=>{nr(g,(A(T),A(d),we(()=>(A(T).current?"border: 1.5px solid var(--V-lighter-text);":"")+(A(d)!=null&&A(d).key===A(T).key&&A(d).period==="day"?"border-top: 2.5px solid #6BCBFF;":A(d)!=null&&A(d).key===A(T).key?"border-bottom: 2.5px solid #0077BA;":"")))),ze(se,(A(T),we(()=>A(T).day))),nr(Re,oe),nr(_e,pe)},[()=>(A(T),mt(o()),mt(Kn),we(()=>(A(T).valueDay!=null?!o()&&A(T).valueDay==10?`background: url('${Kn}'); background-size: cover;`:o()&&A(T).valueDay==0?`background: url('${Kn}'); background-size: cover;`:`background-color: ${E(A(T).valueDay!=null&&!o()?A(T).valueDay:A(T).valueDay!=null?10-A(T).valueDay:null)};`:"")+"transition: background-color .3s ease-in-out")),()=>(A(T),mt(o()),mt(Kn),we(()=>(A(T).valueNight!=null?!o()&&A(T).valueNight==10?`background: url('${Kn}'); background-size: cover;`:o()&&A(T).valueNight==0?`background: url('${Kn}'); background-size: cover;`:`background-color: ${E(A(T).valueNight!=null&&!o()?A(T).valueNight:A(T).valueNight!=null?10-A(T).valueNight:null)};`:"")+"transition: background-color .3s ease-in-out"))]),me("click",Re,()=>V({...A(T),period:"day"})),me("click",_e,()=>V({...A(T),period:"night"})),ie(y,g)}),W(m);var _=$(m,2);{var w=y=>{var T=AT(),g=Q(T),M=Q(g);W(g);var se=$(g,2);{var Re=oe=>{var pe=IT(),Fe=St(pe);{var Je=ne=>{var ue=Ao();$e(()=>ze(ue,` ${A(d),we(()=>A(d).valueDay)??""}/10`)),ie(ne,ue)};Se(Fe,ne=>{A(d),we(()=>A(d).filledDay)&&ne(Je)})}var ye=$(Fe,4),Te=Q(ye,!0);W(ye),$e(()=>ze(Te,(A(d),we(()=>A(d).textDay||"No Entry")))),ie(oe,pe)},_e=oe=>{var pe=wT(),Fe=St(pe);{var Je=ne=>{var ue=Ao();$e(()=>ze(ue,` ${A(d),we(()=>A(d).valueNight)??""}/10`)),ie(ne,ue)};Se(Fe,ne=>{A(d),we(()=>A(d).filledNight)&&ne(Je)})}var ye=$(Fe,4),Te=Q(ye,!0);W(ye),$e(()=>ze(Te,(A(d),we(()=>A(d).textNight||"No Entry")))),ie(oe,pe)};Se(se,oe=>{A(d),we(()=>A(d).period==="day")?oe(Re):oe(_e,!1)})}W(T),$e(oe=>ze(M,`${oe??""} ${A(d),we(()=>A(d).period==="day"?"Day":"Night")??""}`),[()=>(A(d),we(()=>new Date(new Date(A(d).key).setHours(24,0,0,0)).toLocaleDateString("default",{month:"short",day:"numeric"})))]),ie(y,T)};Se(_,y=>{A(d),we(()=>A(d)&&!(A(d).period==="day"&&!A(d).filledDay&&A(d).current||A(d).period==="night"&&!A(d).filledNight&&A(d).current))&&y(w)})}$e(y=>{ze(J,A(v)),I.disabled=y},[()=>(A(p),we(()=>A(p).getFullYear()===new Date().getFullYear()&&A(p).getMonth()===new Date().getMonth()))]),me("click",K,k),me("click",I,U),ie(n,B),Ii()}var ST=ge("<button> </button>"),PT=ge('<div class="overlay"><span></span><br/><br/> <span style="margin-bottom: .5rem; flex-wrap: wrap; gap:.5rem;display: flex;"><button>Rename</button> <button>Delete</button> <button>New</button></span> <button>Back</button></div>'),CT=ge("<p> </p>"),kT=ge('<div class="overlay"><input type="text" class="login_input"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),DT=ge("<p> </p>"),VT=ge('<div class="overlay"><h3 style="margin-bottom: 0;"> </h3> <p><i>This action cannot be undone.</i></p><br/><br/> <input type="password" class="login_input" placeholder="Re-enter Password"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),NT=ge("<p> </p>"),OT=ge('<div class="overlay"><input type="text" class="login_input" placeholder="New Calendar"/><br/> <span><button>Back</button> <button>Confirm</button></span> <!></div>'),MT=ge('<div style="order: 1; flex-wrap: wrap; gap:.5rem;display: flex"><button style="padding: .4rem inherit; border: 2px dashed #339FFF;"><b> </b></button> <!> <!> <!> <!> <button>Invert</button></div>'),xT=ge('<div class="overlay"><div style="width: 65%; text-align:left">Welcome! <br/><br/> <span>Click on the <b>top half</b> of the current date to log an entry for today. Click on the <b>bottom half</b> to log an entry for tonight. You can save a rating (0-10) and, optionally, some text. Entries may be edited only on the current date. <br/><br/>To make a new calendar, click on <b>[current calendar]</b> in the bottom-left corner. You may add, delete, rename, and toggle between calendars to your liking. To reverse the red-green color scheme, click <b>Invert.</b> Your preferences will be saved for the next time you login!</span></div> <br/><br/> <button>Return</button></div>'),LT=ge(`<div style="display: flex;
  flex-direction: column;
  min-height: 100vh;"><div style="flex-grow: 1;"><!> <!></div> <div style="display: flex;
    justify-content: space-between;
    gap: .5rem;
    flex-wrap: wrap;
    padding-left: 5%;
    padding-right: 5%;"><div style="order: 2; flex-wrap: wrap; gap:.5rem; display: flex;"><button>Log Out</button></div> <!> <!></div></div> <div style="position: absolute; top:2%; right: clamp(40px, 5%, 7%); display: inline-block; align-items: center"><button style="background-color: rgb(0, 0, 0, 0); padding: 0; margin-right: 20px"><svg xmlns="http://www.w3.org/2000/svg" height="3vh" viewBox="0 0 352 512"><path fill="var(--V-medium-text)" d="M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"></path></svg></button> <button class="floating-button" style="background-color: rgb(0, 0, 0, 0); padding: 0"><svg xmlns="http://www.w3.org/2000/svg" height="3vh" width="3vh" viewBox="0 0 512 512"><path fill="var(--V-medium-text)" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg></button></div>`,1);function GT(n,e){Ti(e,!1);let t=ae(null),r=ae(null),s=ae(0),o=ae(null),a=ae(!1),l=ae(null),h=ae(null),d=ae(""),p=ae(""),v=ae(""),E=ae(""),R=ae(""),P=ae(!1),V=!1;Og(vi,M=>{_(M),N(t,M)});async function k(){if(!A(t))return;N(o,!A(o));const M=Ys(Xr,"users",A(t).uid);await yi(M,{colorPreference:A(o),timestamp:Date.now()},{merge:!0}),console.log("Saved user profile invert="+A(o))}function U(){V=!V,V?(document.documentElement.style.setProperty("--V-background-white","var(--background-black)"),document.documentElement.style.setProperty("--V-background-off-white","var(--background-off-black)"),document.documentElement.style.setProperty("--V-medium-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-dark-text","var(--lighter-text)"),document.documentElement.style.setProperty("--V-ligher-text","var(--dark-text)"),document.querySelectorAll(".day-number").forEach(M=>{M.style.textShadow="0px 0px 2px black"}),document.querySelectorAll(".title").forEach(M=>{M.style.backgroundPositionY="0px",M.style.backgroundPositionX="-70px",M.style.backgroundSize="150% auto"})):(document.documentElement.style.setProperty("--V-background-white","var(--background-white)"),document.documentElement.style.setProperty("--V-background-off-white","var(--background-off-white)"),document.documentElement.style.setProperty("--V-medium-text","var(--medium-text)"),document.documentElement.style.setProperty("--V-dark-text","var(--dark-text)"),document.documentElement.style.setProperty("--V-ligher-text","var(--lighter-text)"),document.querySelectorAll(".day-number").forEach(M=>{M.style.textShadow="none"}),document.querySelectorAll(".title").forEach(M=>{M.style.backgroundPositionY="-100px",M.style.backgroundPositionX="0px",M.style.backgroundSize="cover"}))}function B(){A(p)===""?N(R,"New name cannot be empty!"):Object.values(A(l)).includes(A(p))?N(R,"New name cannot be a duplicate!"):(Ns(l,A(l)[A(h)]=A(p)),q(),N(p,""),N(R,""),N(v,""))}function L(){Cg(A(t),jn.credential(A(t).email,A(E))).then(()=>{Object.keys(A(l)).length===1?(N(R,"You cannot delete your last calendar!"),N(E,"")):(delete A(l)[A(h)],N(l,{...A(l)}),N(h,Object.keys(A(l)).sort()[0]),q(),N(E,""),N(R,""),N(v,""))}).catch(M=>{N(R,"Incorrect password!")})}function K(){if(A(d)==="")N(R,"New name cannot be empty!");else if(Object.values(A(l)).includes(A(d)))N(R,"New name cannot be a duplicate!");else{const M=Date.now().toString();Ns(l,A(l)[M]=A(d)),N(l,{...A(l)}),N(h,M),q(),N(R,""),N(d,""),N(v,"")}}async function q(){if(!A(t))return;const M=Date.now(),se=Ys(Xr,"users",A(t).uid),Re=A(t).email?A(t).email.replace("@tracker.app",""):"anonymous"+M.toString();se.calendars?await cT(se,{calendars:A(l),selectedCalendar:A(h),timestamp:M}):await yi(se,{calendars:A(l),selectedCalendar:A(h),name:Re,timestamp:M}),console.log("Saved calendars to database")}function J(){N(s,A(s)+1)}function I(){Mg(vi),N(t,null),N(r,null),V=!0,U()}function m(M){N(r,M)}async function _(M){if(!M)return;const se=Ys(Xr,"users",M.uid),Re=await oT(se);if(Re.exists()){const _e=Re.data();if(_e.calendars)N(l,_e.calendars),N(h,_e.selectedCalendar),console.log("Loaded user calendars");else{N(l,{});const oe=Date.now().toString();Ns(l,A(l)[oe]="Main"),N(h,oe),await q(),console.log("Initialized user calendars")}_e.colorPreference?(N(o,_e.colorPreference),console.log("Loaded user invert="+A(o))):(N(o,!1),console.log("Initialized user invert="+A(o)))}else{N(o,!1),N(l,{});const _e=Date.now().toString();Ns(l,A(l)[_e]="Main"),N(h,_e),await q(),console.log("New user.")}}Ei();var w=Bs(),y=St(w);{var T=M=>{dT(M,{})},g=M=>{var se=LT(),Re=St(se),_e=Q(Re),oe=Q(_e);ET(oe,{get user(){return A(t)},get externalEntry(){return A(r)},onSaved:J,get invert(){return A(o)},get selectedCalendar(){return A(h)}});var pe=$(oe,2);bT(pe,{get user(){return A(t)},onSelectEntry:m,get reloadTrigger(){return A(s)},get invert(){return A(o)},get selectedCalendar(){return A(h)}}),W(_e);var Fe=$(_e,2),Je=Q(Fe),ye=Q(Je);W(Je);var Te=$(Je,2);{var ne=Ue=>{var yt=MT(),ot=Q(yt),Yt=Q(ot),vs=Q(Yt,!0);W(Yt),W(ot);var Es=$(ot,2);{var Tr=Ke=>{var Ie=PT(),Ve=Q(Ie);du(Ve,5,()=>Object.keys(A(l)).sort(),hu,(Be,Ne)=>{var Oe=ST(),Ft=Q(Oe,!0);W(Oe),$e(()=>{nr(Oe,(A(h)===A(Ne)?"border: 2px dashed #339FFF;":"border: 2px dashed #ccc;")+"margin: .5rem; font-size: 1.1rem"),ze(Ft,A(l)[A(Ne)])}),me("click",Oe,()=>{N(h,A(Ne)),q()}),ie(Be,Oe)}),W(Ve);var Ze=$(Ve,4),et=Q(Ze),ft=$(et,2),Tt=$(ft,2);W(Ze);var It=$(Ze,2);W(Ie),me("click",et,()=>{N(v,"rename")}),me("click",ft,()=>{N(v,"delete")}),me("click",Tt,()=>{N(v,"new")}),me("click",It,()=>{N(P,!A(P))}),ie(Ke,Ie)};Se(Es,Ke=>{A(P)&&Ke(Tr)})}var zn=$(Es,2);{var Ts=Ke=>{var Ie=kT(),Ve=Q(Ie);tr(Ve);var Ze=$(Ve,3),et=Q(Ze),ft=$(et,2);W(Ze);var Tt=$(Ze,2);{var It=Be=>{var Ne=CT(),Oe=Q(Ne,!0);W(Ne),$e(()=>ze(Oe,A(R))),ie(Be,Ne)};Se(Tt,Be=>{A(R)!=""&&Be(It)})}W(Ie),$e(()=>uu(Ve,"placeholder",`Renaming ${A(l)[A(h)]??""}`)),Vn(Ve,()=>A(p),Be=>N(p,Be)),me("click",et,()=>{N(v,""),N(p,"")}),me("click",ft,B),ie(Ke,Ie)};Se(zn,Ke=>{A(v)==="rename"&&Ke(Ts)})}var De=$(zn,2);{var Ge=Ke=>{var Ie=VT(),Ve=Q(Ie),Ze=Q(Ve);W(Ve);var et=$(Ve,6);tr(et);var ft=$(et,3),Tt=Q(ft),It=$(Tt,2);W(ft);var Be=$(ft,2);{var Ne=Oe=>{var Ft=DT(),Ut=Q(Ft,!0);W(Ft),$e(()=>ze(Ut,A(R))),ie(Oe,Ft)};Se(Be,Oe=>{A(R)!=""&&Oe(Ne)})}W(Ie),$e(()=>ze(Ze,`Delete ${A(l)[A(h)]??""}?`)),Vn(et,()=>A(E),Oe=>N(E,Oe)),me("click",Tt,()=>{N(v,""),N(E,""),N(R,"")}),me("click",It,L),ie(Ke,Ie)};Se(De,Ke=>{A(v)==="delete"&&Ke(Ge)})}var Rn=$(De,2);{var zi=Ke=>{var Ie=OT(),Ve=Q(Ie);tr(Ve);var Ze=$(Ve,3),et=Q(Ze),ft=$(et,2);W(Ze);var Tt=$(Ze,2);{var It=Be=>{var Ne=NT(),Oe=Q(Ne,!0);W(Ne),$e(()=>ze(Oe,A(R))),ie(Be,Ne)};Se(Tt,Be=>{A(R)!=""&&Be(It)})}W(Ie),Vn(Ve,()=>A(d),Be=>N(d,Be)),me("click",et,()=>{N(v,""),N(d,""),N(R,"")}),me("click",ft,K),ie(Ke,Ie)};Se(Rn,Ke=>{A(v)==="new"&&Ke(zi)})}var Ir=$(Rn,2);W(yt),$e(()=>{ze(vs,A(l)[A(h)]),nr(Ir,`background-color: ${A(o)?"hsl(0, 70%, 65%)":"hsl(120, 70%, 65%)"}; color: #202020`)}),me("click",ot,()=>{N(P,!A(P))}),me("click",Ir,k),ie(Ue,yt)};Se(Te,Ue=>{A(o)!=null&&Ue(ne)})}var ue=$(Te,2);{var ke=Ue=>{var yt=xT(),ot=$(Q(yt),5);W(yt),me("click",ot,()=>{N(a,!A(a))}),ie(Ue,yt)};Se(ue,Ue=>{A(a)&&Ue(ke)})}W(Fe),W(Re);var ut=$(Re,2),We=Q(ut),it=$(We,2);W(ut),me("click",ye,I),me("click",We,()=>{N(a,!A(a))}),me("click",it,U),ie(M,se)};Se(y,M=>{!A(t)||!A(h)?M(T):M(g,!1)})}ie(n,w),Ii()}export{GT as component};
