import{f as X,a as U,t as Pe,c as It}from"../chunks/CQrOAD4D.js";import{i as Xt}from"../chunks/Cvtg0JA-.js";import{o as Si}from"../chunks/CrHHU5HX.js";import{K as $e,h as ne,a1 as yi,b as $t,F as Ci,E as bi,o as k,R as vi,H as Ii,I as Pi,J as Pt,M as Ye,f as we,a8 as wi,aC as ki,e as at,s as Ti,aE as _e,aF as Ve,c as Ai,aG as Yt,aA as Jt,aH as Di,aI as De,ad as wt,an as kt,r as qt,p as Oi,aJ as Je,ag as xi,d as Qt,aK as Mi,aL as Ri,a9 as Li,aM as Ui,az as Fi,aN as Ei,V as Ni,x as Zt,B as Ce,D as z,C as q,z as Q,A as ei,q as G,k as _,y as ke,T as ye,aO as Bi,aP as Tt,aQ as At}from"../chunks/5mV-ujvK.js";import{s as ae,d as Gi}from"../chunks/D1V041pD.js";import{p as Dt,i as V}from"../chunks/CnTD8ZDF.js";import{s as ot}from"../chunks/eE171J4R.js";function qe(r,e){return e}function _i(r,e,t){for(var i=r.items,s=[],n=e.length,a=0;a<n;a++)Ui(e[a].e,s,!0);var o=n>0&&s.length===0&&t!==null;if(o){var l=t.parentNode;Fi(l),l.append(t),i.clear(),W(r,e[0].prev,e[n-1].next)}Ei(s,()=>{for(var u=0;u<n;u++){var h=e[u];o||(i.delete(h.k),W(r,h.prev,h.next)),Qt(h.e,!o)}})}function Qe(r,e,t,i,s,n=null){var a=r,o={flags:e,items:new Map,first:null},l=(e&Yt)!==0;if(l){var u=r;a=ne?$e(yi(u)):u.appendChild($t())}ne&&Ci();var h=null,S=!1,b=new Map,D=vi(()=>{var m=t();return Di(m)?m:m==null?[]:Jt(m)}),d,I;function f(){Vi(I,d,o,b,a,s,e,i,t),n!==null&&(d.length===0?h?qt(h):h=at(()=>n(a)):h!==null&&Oi(h,()=>{h=null}))}bi(()=>{I??=Ni,d=k(D);var m=d.length;if(S&&m===0)return;S=m===0;let C=!1;if(ne){var T=Ii(a)===Pi;T!==(m===0)&&(a=Pt(),$e(a),Ye(!1),C=!0)}if(ne){for(var w=null,P,c=0;c<m;c++){if(we.nodeType===wi&&we.data===ki){a=we,C=!0,Ye(!1);break}var y=d[c],g=i(y,c);P=lt(we,o,w,null,y,g,c,s,e,t),o.items.set(g,P),w=P}m>0&&$e(Pt())}if(ne)m===0&&n&&(h=at(()=>n(a)));else if(Ti()){var v=new Set,F=Ai;for(c=0;c<m;c+=1){y=d[c],g=i(y,c);var B=o.items.get(g)??b.get(g);B?(e&(_e|Ve))!==0&&ti(B,y,c,e):(P=lt(null,o,null,null,y,g,c,s,e,t,!0),b.set(g,P)),v.add(g)}for(const[L,ge]of o.items)v.has(L)||F.skipped_effects.add(ge.e);F.oncommit(f)}else f();C&&Ye(!0),k(D)}),ne&&(a=we)}function Vi(r,e,t,i,s,n,a,o,l){var u=(a&Ri)!==0,h=(a&(_e|Ve))!==0,S=e.length,b=t.items,D=t.first,d=D,I,f=null,m,C=[],T=[],w,P,c,y;if(u)for(y=0;y<S;y+=1)w=e[y],P=o(w,y),c=b.get(P),c!==void 0&&(c.a?.measure(),(m??=new Set).add(c));for(y=0;y<S;y+=1){if(w=e[y],P=o(w,y),c=b.get(P),c===void 0){var g=i.get(P);if(g!==void 0){i.delete(P),b.set(P,g);var v=f?f.next:d;W(t,f,g),W(t,g,v),Ze(g,v,s),f=g}else{var F=d?d.e.nodes_start:s;f=lt(F,t,f,f===null?t.first:f.next,w,P,y,n,a,l)}b.set(P,f),C=[],T=[],d=f.next;continue}if(h&&ti(c,w,y,a),(c.e.f&Je)!==0&&(qt(c.e),u&&(c.a?.unfix(),(m??=new Set).delete(c))),c!==d){if(I!==void 0&&I.has(c)){if(C.length<T.length){var B=T[0],L;f=B.prev;var ge=C[0],me=C[C.length-1];for(L=0;L<C.length;L+=1)Ze(C[L],B,s);for(L=0;L<T.length;L+=1)I.delete(T[L]);W(t,ge.prev,me.next),W(t,f,ge),W(t,me,B),d=B,f=me,y-=1,C=[],T=[]}else I.delete(c),Ze(c,d,s),W(t,c.prev,c.next),W(t,c,f===null?t.first:f.next),W(t,f,c),f=c;continue}for(C=[],T=[];d!==null&&d.k!==P;)(d.e.f&Je)===0&&(I??=new Set).add(d),T.push(d),d=d.next;if(d===null)continue;c=d}C.push(c),f=c,d=c.next}if(d!==null||I!==void 0){for(var Y=I===void 0?[]:Jt(I);d!==null;)(d.e.f&Je)===0&&Y.push(d),d=d.next;var Se=Y.length;if(Se>0){var gi=(a&Yt)!==0&&S===0?s:null;if(u){for(y=0;y<Se;y+=1)Y[y].a?.measure();for(y=0;y<Se;y+=1)Y[y].a?.fix()}_i(t,Y,gi)}}u&&xi(()=>{if(m!==void 0)for(c of m)c.a?.apply()}),r.first=t.first&&t.first.e,r.last=f&&f.e;for(var mi of i.values())Qt(mi.e);i.clear()}function ti(r,e,t,i){(i&_e)!==0&&kt(r.v,e),(i&Ve)!==0?kt(r.i,t):r.i=t}function lt(r,e,t,i,s,n,a,o,l,u,h){var S=(l&_e)!==0,b=(l&Mi)===0,D=S?b?De(s,!1,!1):wt(s):s,d=(l&Ve)===0?a:wt(a),I={i:d,v:D,k:n,a:null,e:null,prev:t,next:i};try{if(r===null){var f=document.createDocumentFragment();f.append(r=$t())}return I.e=at(()=>o(r,D,d,u),ne),I.e.prev=t&&t.e,I.e.next=i&&i.e,t===null?h||(e.first=I):(t.next=I,t.e.next=I.e),i!==null&&(i.prev=I,i.e.prev=I.e),I}finally{}}function Ze(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,n=r.e.nodes_start;n!==null&&n!==i;){var a=Li(n);s.before(n),n=a}}function W(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}var ze=typeof self<"u"?self:global;const xe=typeof navigator<"u",zi=xe&&typeof HTMLImageElement>"u",Fe=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),He=ze.Buffer,Me=ze.BigInt,je=!!He,Hi=r=>r;function Ee(r,e=Hi){if(Fe)try{return typeof require=="function"?Promise.resolve(e(require(r))):import(r).then(e)}catch{console.warn(`Couldn't load ${r}`)}}let pt=ze.fetch;const ji=r=>pt=r;if(!ze.fetch){const r=Ee("http",(i=>i)),e=Ee("https",(i=>i)),t=(i,{headers:s}={})=>new Promise((async(n,a)=>{let{port:o,hostname:l,pathname:u,protocol:h,search:S}=new URL(i);const b={method:"GET",hostname:l,path:encodeURI(u)+S,headers:s};o!==""&&(b.port=Number(o));const D=(h==="https:"?await e:await r).request(b,(d=>{if(d.statusCode===301||d.statusCode===302){let I=new URL(d.headers.location,i).toString();return t(I,{headers:s}).then(n).catch(a)}n({status:d.statusCode,arrayBuffer:()=>new Promise((I=>{let f=[];d.on("data",(m=>f.push(m))),d.on("end",(()=>I(Buffer.concat(f))))}))})}));D.on("error",a),D.end()}));ji(t)}function p(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}const Ne=r=>ii(r)?void 0:r,Wi=r=>r!==void 0;function ii(r){return r===void 0||(r instanceof Map?r.size===0:Object.values(r).filter(Wi).length===0)}function M(r){let e=new Error(r);throw delete e.stack,e}function oe(r){return(r=(function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e})(r).trim())===""?void 0:r}function ht(r){let e=(function(t){let i=0;return t.ifd0.enabled&&(i+=1024),t.exif.enabled&&(i+=2048),t.makerNote&&(i+=2048),t.userComment&&(i+=1024),t.gps.enabled&&(i+=512),t.interop.enabled&&(i+=100),t.ifd1.enabled&&(i+=1024),i+2048})(r);return r.jfif.enabled&&(e+=50),r.xmp.enabled&&(e+=2e4),r.iptc.enabled&&(e+=14e3),r.icc.enabled&&(e+=6e3),e}const ut=r=>String.fromCharCode.apply(null,r),Ot=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function ri(r){return Ot?Ot.decode(r):je?Buffer.from(r).toString("utf8"):decodeURIComponent(escape(ut(r)))}class N{static from(e,t){return e instanceof this&&e.le===t?e:new N(e,void 0,void 0,t)}constructor(e,t=0,i,s){if(typeof s=="boolean"&&(this.le=s),Array.isArray(e)&&(e=new Uint8Array(e)),e===0)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){i===void 0&&(i=e.byteLength-t);let n=new DataView(e,t,i);this._swapDataView(n)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof N){i===void 0&&(i=e.byteLength-t),(t+=e.byteOffset)+i>e.byteOffset+e.byteLength&&M("Creating view outside of available memory in ArrayBuffer");let n=new DataView(e.buffer,t,i);this._swapDataView(n)}else if(typeof e=="number"){let n=new DataView(new ArrayBuffer(e));this._swapDataView(n)}else M("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,i=N){return e instanceof DataView||e instanceof N?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||M("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new i(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new N(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return ri(this.getUint8Array(e,t))}getLatin1String(e=0,t=this.byteLength){let i=this.getUint8Array(e,t);return ut(i)}getUnicodeString(e=0,t=this.byteLength){const i=[];for(let s=0;s<t&&e+s<this.byteLength;s+=2)i.push(this.getUint16(e+s));return ut(i)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,i){switch(t){case 1:return this.getUint8(e,i);case 2:return this.getUint16(e,i);case 4:return this.getUint32(e,i);case 8:return this.getUint64&&this.getUint64(e,i)}}getUint(e,t,i){switch(t){case 8:return this.getUint8(e,i);case 16:return this.getUint16(e,i);case 32:return this.getUint32(e,i);case 64:return this.getUint64&&this.getUint64(e,i)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function ft(r,e){M(`${r} '${e}' was not loaded, try using full build of exifr.`)}class gt extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||ft(this.kind,e),t&&(e in t||(function(i,s){M(`Unknown ${i} '${s}'.`)})(this.kind,e),t[e].enabled||ft(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var K=new gt("file parser"),x=new gt("segment parser"),$=new gt("file reader");function Ki(r,e){return typeof r=="string"?xt(r,e):xe&&!zi&&r instanceof HTMLImageElement?xt(r.src,e):r instanceof Uint8Array||r instanceof ArrayBuffer||r instanceof DataView?new N(r):xe&&r instanceof Blob?ct(r,e,"blob",fe):void M("Invalid input argument")}function xt(r,e){return(t=r).startsWith("data:")||t.length>1e4?dt(r,e,"base64"):Fe&&r.includes("://")?ct(r,e,"url",ue):Fe?dt(r,e,"fs"):xe?ct(r,e,"url",ue):void M("Invalid input argument");var t}async function ct(r,e,t,i){return $.has(t)?dt(r,e,t):i?(async function(s,n){let a=await n(s);return new N(a)})(r,i):void M(`Parser ${t} is not loaded`)}async function dt(r,e,t){let i=new($.get(t))(r,e);return await i.read(),i}const ue=r=>pt(r).then((e=>e.arrayBuffer())),fe=r=>new Promise(((e,t)=>{let i=new FileReader;i.onloadend=()=>e(i.result||new ArrayBuffer),i.onerror=t,i.readAsArrayBuffer(r)}));class Xi extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function O(r,e,t){let i=new Xi;for(let[s,n]of t)i.set(s,n);if(Array.isArray(e))for(let s of e)r.set(s,i);else r.set(e,i);return i}function ce(r,e,t){let i,s=r.get(e);for(i of t)s.set(i[0],i[1])}const R=new Map,j=new Map,re=new Map,Z=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],ve=["jfif","xmp","icc","iptc","ihdr"],de=["tiff",...ve],A=["ifd0","ifd1","exif","gps","interop"],ee=[...de,...A],te=["makerNote","userComment"],Ie=["translateKeys","translateValues","reviveValues","multiSegment"],ie=[...Ie,"sanitize","mergeOutput","silentErrors"];class si{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Te extends si{get needed(){return this.enabled||this.deps.size>0}constructor(e,t,i,s){if(super(),p(this,"enabled",!1),p(this,"skip",new Set),p(this,"pick",new Set),p(this,"deps",new Set),p(this,"translateKeys",!1),p(this,"translateValues",!1),p(this,"reviveValues",!1),this.key=e,this.enabled=t,this.parse=this.enabled,this.applyInheritables(s),this.canBeFiltered=A.includes(e),this.canBeFiltered&&(this.dict=R.get(e)),i!==void 0)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if(typeof i=="object"){if(this.enabled=!0,this.parse=i.parse!==!1,this.canBeFiltered){let{pick:n,skip:a}=i;n&&n.length>0&&this.translateTagSet(n,this.pick),a&&a.length>0&&this.translateTagSet(a,this.skip)}this.applyInheritables(i)}else i===!0||i===!1?this.parse=this.enabled=i:M(`Invalid options argument: ${i}`)}applyInheritables(e){let t,i;for(t of Ie)i=e[t],i!==void 0&&(this[t]=i)}translateTagSet(e,t){if(this.dict){let i,s,{tagKeys:n,tagValues:a}=this.dict;for(i of e)typeof i=="string"?(s=a.indexOf(i),s===-1&&(s=n.indexOf(Number(i))),s!==-1&&t.add(Number(n[s]))):t.add(i)}else for(let i of e)t.add(i)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Be(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Be(this.pick,this.deps)}}var E={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Mt=new Map;class pe extends si{static useCached(e){let t=Mt.get(e);return t!==void 0||(t=new this(e),Mt.set(e,t)),t}constructor(e){super(),e===!0?this.setupFromTrue():e===void 0?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):typeof e=="object"?this.setupFromObject(e):M(`Invalid options argument ${e}`),this.firstChunkSize===void 0&&(this.firstChunkSize=xe?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of Z)this[e]=E[e];for(e of ie)this[e]=E[e];for(e of te)this[e]=E[e];for(e of ee)this[e]=new Te(e,E[e],void 0,this)}setupFromTrue(){let e;for(e of Z)this[e]=E[e];for(e of ie)this[e]=E[e];for(e of te)this[e]=!0;for(e of ee)this[e]=new Te(e,!0,void 0,this)}setupFromArray(e){let t;for(t of Z)this[t]=E[t];for(t of ie)this[t]=E[t];for(t of te)this[t]=E[t];for(t of ee)this[t]=new Te(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,A)}setupFromObject(e){let t;for(t of(A.ifd0=A.ifd0||A.image,A.ifd1=A.ifd1||A.thumbnail,Object.assign(this,e),Z))this[t]=et(e[t],E[t]);for(t of ie)this[t]=et(e[t],E[t]);for(t of te)this[t]=et(e[t],E[t]);for(t of de)this[t]=new Te(t,E[t],e[t],this);for(t of A)this[t]=new Te(t,E[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,A,ee),e.tiff===!0?this.batchEnableWithBool(A,!0):e.tiff===!1?this.batchEnableWithUserValue(A,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,A):typeof e.tiff=="object"&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,A)}batchEnableWithBool(e,t){for(let i of e)this[i].enabled=t}batchEnableWithUserValue(e,t){for(let i of e){let s=t[i];this[i].enabled=s!==!1&&s!==void 0}}setupGlobalFilters(e,t,i,s=i){if(e&&e.length){for(let a of s)this[a].enabled=!1;let n=Rt(e,i);for(let[a,o]of n)Be(this[a].pick,o),this[a].enabled=!0}else if(t&&t.length){let n=Rt(t,i);for(let[a,o]of n)Be(this[a].skip,o)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:i,iptc:s,icc:n}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),i.enabled||e.skip.add(700),s.enabled||e.skip.add(33723),n.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:i,interop:s}=this;s.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),i.needed&&e.deps.add(34853),this.tiff.enabled=A.some((n=>this[n].enabled===!0))||this.makerNote||this.userComment;for(let n of A)this[n].finalizeFilters()}get onlyTiff(){return!ve.map((e=>this[e].enabled)).some((e=>e===!0))&&this.tiff.enabled}checkLoadedPlugins(){for(let e of de)this[e].enabled&&!x.has(e)&&ft("segment parser",e)}}function Rt(r,e){let t,i,s,n,a=[];for(s of e){for(n of(t=R.get(s),i=[],t))(r.includes(n[0])||r.includes(n[1]))&&i.push(n[0]);i.length&&a.push([s,i])}return a}function et(r,e){return r!==void 0?r:e!==void 0?e:void 0}function Be(r,e){for(let t of e)r.add(t)}p(pe,"default",E);class se{constructor(e){p(this,"parsers",{}),p(this,"output",{}),p(this,"errors",[]),p(this,"pushToErrors",(t=>this.errors.push(t))),this.options=pe.useCached(e)}async read(e){this.file=await Ki(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[i,s]of K)if(s.canHandle(e,t))return this.fileParser=new s(this.options,this.file,this.parsers),e[i]=!0;this.file.close&&this.file.close(),M("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),Ne(e)}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map((async i=>{let s=await i.parse();i.assignToOutput(e,s)}));this.options.silentErrors&&(t=t.map((i=>i.catch(this.pushToErrors)))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,i=x.get("tiff",e);var s;if(t.tiff?s={start:0,type:"tiff"}:t.jpeg&&(s=await this.fileParser.getOrFindSegment("tiff")),s===void 0)return;let n=await this.fileParser.ensureSegmentChunk(s),a=this.parsers.tiff=new i(n,e,t),o=await a.extractThumbnail();return t.close&&t.close(),o}}async function We(r,e){let t=new se(e);return await t.read(r),t.parse()}var $i=Object.freeze({__proto__:null,parse:We,Exifr:se,fileParsers:K,segmentParsers:x,fileReaders:$,tagKeys:R,tagValues:j,tagRevivers:re,createDictionary:O,extendDictionary:ce,fetchUrlAsArrayBuffer:ue,readBlobAsArrayBuffer:fe,chunkedProps:Z,otherSegments:ve,segments:de,tiffBlocks:A,segmentsAndBlocks:ee,tiffExtractables:te,inheritables:Ie,allFormatters:ie,Options:pe});class Ke{constructor(e,t,i){p(this,"errors",[]),p(this,"ensureSegmentChunk",(async s=>{let n=s.start,a=s.size||65536;if(this.file.chunked)if(this.file.available(n,a))s.chunk=this.file.subarray(n,a);else try{s.chunk=await this.file.readChunk(n,a)}catch(o){M(`Couldn't read segment: ${JSON.stringify(s)}. ${o.message}`)}else this.file.byteLength>n+a?s.chunk=this.file.subarray(n,a):s.size===void 0?s.chunk=this.file.subarray(n):M("Segment unreachable: "+JSON.stringify(s));return s.chunk})),this.extendOptions&&this.extendOptions(e),this.options=e,this.file=t,this.parsers=i}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let i=new(x.get(e))(t,this.options,this.file);return this.parsers[e]=i}createParsers(e){for(let t of e){let{type:i,chunk:s}=t,n=this.options[i];if(n&&n.enabled){let a=this.parsers[i];a&&a.append||a||this.createParser(i,s)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}class H{static findPosition(e,t){let i=e.getUint16(t+2)+2,s=typeof this.headerLength=="function"?this.headerLength(e,t,i):this.headerLength,n=t+s,a=i-s;return{offset:t,length:i,headerLength:s,start:n,size:a,end:n+a}}static parse(e,t={}){return new this(e,new pe({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof N?e:new N(e)}constructor(e,t={},i){p(this,"errors",[]),p(this,"raw",new Map),p(this,"handleError",(s=>{if(!this.options.silentErrors)throw s;this.errors.push(s.message)})),this.chunk=this.normalizeInput(e),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=t,this.localOptions=t[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let i=re.get(t),s=j.get(t),n=R.get(t),a=this.options[t],o=a.reviveValues&&!!i,l=a.translateValues&&!!s,u=a.translateKeys&&!!n,h={};for(let[S,b]of e)o&&i.has(S)?b=i.get(S)(b):l&&s.has(S)&&(b=this.translateValue(b,s.get(S))),u&&n.has(S)&&(S=n.get(S)||S),h[S]=b;return h}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,i){if(this.globalOptions.mergeOutput)return Object.assign(e,i);e[t]?Object.assign(e[t],i):e[t]=i}}p(H,"headerLength",4),p(H,"type",void 0),p(H,"multiSegment",!1),p(H,"canHandle",(()=>!1));function Yi(r){return r===192||r===194||r===196||r===219||r===221||r===218||r===254}function Ji(r){return r>=224&&r<=239}function qi(r,e,t){for(let[i,s]of x)if(s.canHandle(r,e,t))return i}class Lt extends Ke{constructor(...e){super(...e),p(this,"appSegments",[]),p(this,"jpegSegments",[]),p(this,"unknownSegments",[])}static canHandle(e,t){return t===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){e===!0?(this.findAll=!0,this.wanted=new Set(x.keyList())):(e=e===void 0?x.keyList().filter((t=>this.options[t].enabled)):e.filter((t=>this.options[t].enabled&&x.has(t))),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:i,findAll:s,wanted:n,remaining:a}=this;if(!s&&this.file.chunked&&(s=Array.from(n).some((o=>{let l=x.get(o),u=this.options[o];return l.multiSegment&&u.multiSegment})),s&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,i.byteLength),!this.options.onlyTiff&&i.chunked){let o=!1;for(;a.size>0&&!o&&(i.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:l}=i,u=this.appSegments.some((h=>!this.file.available(h.offset||h.start,h.length||h.size)));if(o=e>l&&!u?!await i.readNextChunk(e):!await i.readNextChunk(l),(e=this.findAppSegmentsInRange(e,i.byteLength))===void 0)return}}}findAppSegmentsInRange(e,t){t-=2;let i,s,n,a,o,l,{file:u,findAll:h,wanted:S,remaining:b,options:D}=this;for(;e<t;e++)if(u.getUint8(e)===255){if(i=u.getUint8(e+1),Ji(i)){if(s=u.getUint16(e+2),n=qi(u,e,s),n&&S.has(n)&&(a=x.get(n),o=a.findPosition(u,e),l=D[n],o.type=n,this.appSegments.push(o),!h&&(a.multiSegment&&l.multiSegment?(this.unfinishedMultiSegment=o.chunkNumber<o.chunkCount,this.unfinishedMultiSegment||b.delete(n)):b.delete(n),b.size===0)))break;D.recordUnknownSegments&&(o=H.findPosition(u,e),o.marker=i,this.unknownSegments.push(o)),e+=s+1}else if(Yi(i)){if(s=u.getUint16(e+2),i===218&&D.stopAfterSos!==!1)return;D.recordJpegSegments&&this.jpegSegments.push({offset:e,length:s,marker:i}),e+=s+1}}return e}mergeMultiSegments(){if(!this.appSegments.some((t=>t.multiSegment)))return;let e=(function(t,i){let s,n,a,o=new Map;for(let l=0;l<t.length;l++)s=t[l],n=s[i],o.has(n)?a=o.get(n):o.set(n,a=[]),a.push(s);return Array.from(o)})(this.appSegments,"type");this.mergedAppSegments=e.map((([t,i])=>{let s=x.get(t,this.options);return s.handleMultiSegments?{type:t,chunk:s.handleMultiSegments(i)}:i[0]}))}getSegment(e){return this.appSegments.find((t=>t.type===e))}async getOrFindSegment(e){let t=this.getSegment(e);return t===void 0&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}p(Lt,"type","jpeg"),K.set("jpeg",Lt);const Qi=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class Zi extends H{parseHeader(){var e=this.chunk.getUint16();e===18761?this.le=!0:e===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,i=new Map){let{pick:s,skip:n}=this.options[t];s=new Set(s);let a=s.size>0,o=n.size===0,l=this.chunk.getUint16(e);e+=2;for(let u=0;u<l;u++){let h=this.chunk.getUint16(e);if(a){if(s.has(h)&&(i.set(h,this.parseTag(e,h,t)),s.delete(h),s.size===0))break}else!o&&n.has(h)||i.set(h,this.parseTag(e,h,t));e+=12}return i}parseTag(e,t,i){let{chunk:s}=this,n=s.getUint16(e+2),a=s.getUint32(e+4),o=Qi[n];if(o*a<=4?e+=8:e=s.getUint32(e+8),(n<1||n>13)&&M(`Invalid TIFF value type. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${n}, offset ${e}`),e>s.byteLength&&M(`Invalid TIFF value offset. block: ${i.toUpperCase()}, tag: ${t.toString(16)}, type: ${n}, offset ${e} is outside of chunk size ${s.byteLength}`),n===1)return s.getUint8Array(e,a);if(n===2)return oe(s.getString(e,a));if(n===7)return s.getUint8Array(e,a);if(a===1)return this.parseTagValue(n,e);{let l=new((function(h){switch(h){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}})(n))(a),u=o;for(let h=0;h<a;h++)l[h]=this.parseTagValue(n,e),e+=u;return l}}parseTagValue(e,t){let{chunk:i}=this;switch(e){case 1:return i.getUint8(t);case 3:return i.getUint16(t);case 4:return i.getUint32(t);case 5:return i.getUint32(t)/i.getUint32(t+4);case 6:return i.getInt8(t);case 8:return i.getInt16(t);case 9:return i.getInt32(t);case 10:return i.getInt32(t)/i.getInt32(t+4);case 11:return i.getFloat(t);case 12:return i.getDouble(t);case 13:return i.getUint32(t);default:M(`Invalid tiff type ${e}`)}}}class tt extends Zi{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1165519206&&e.getUint16(t+8)===0}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return t.catch!==void 0&&(t=t.catch(this.handleError)),t}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let i=new Map;return this[t]=i,this.parseTags(e,t,i),i}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&M("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&M(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,ht(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return t.size!==0?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,ht(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let i=e.get(t);i&&i.length===1&&e.set(t,i[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",Ut(...e.get(2),e.get(1))),e.set("longitude",Ut(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,i,s={};for(t of A)if(e=this[t],!ii(e))if(i=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if(t==="ifd1")continue;Object.assign(s,i)}else s[t]=i;return this.makerNote&&(s.makerNote=this.makerNote),this.userComment&&(s.userComment=this.userComment),s}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[i,s]of Object.entries(t))this.assignObjectToOutput(e,i,s)}}function Ut(r,e,t,i){var s=r+e/60+t/3600;return i!=="S"&&i!=="W"||(s*=-1),s}p(tt,"type","tiff"),p(tt,"headerLength",10),x.set("tiff",tt);var er=Object.freeze({__proto__:null,default:$i,Exifr:se,fileParsers:K,segmentParsers:x,fileReaders:$,tagKeys:R,tagValues:j,tagRevivers:re,createDictionary:O,extendDictionary:ce,fetchUrlAsArrayBuffer:ue,readBlobAsArrayBuffer:fe,chunkedProps:Z,otherSegments:ve,segments:de,tiffBlocks:A,segmentsAndBlocks:ee,tiffExtractables:te,inheritables:Ie,allFormatters:ie,Options:pe,parse:We});const mt={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},St=Object.assign({},mt,{firstChunkSize:4e4,gps:[1,2,3,4]});async function ni(r){let e=new se(St);await e.read(r);let t=await e.parse();if(t&&t.gps){let{latitude:i,longitude:s}=t.gps;return{latitude:i,longitude:s}}}const yt=Object.assign({},mt,{tiff:!1,ifd1:!0,mergeOutput:!1});async function ai(r){let e=new se(yt);await e.read(r);let t=await e.extractThumbnail();return t&&je?He.from(t):t}async function oi(r){let e=await this.thumbnail(r);if(e!==void 0){let t=new Blob([e]);return URL.createObjectURL(t)}}const Ct=Object.assign({},mt,{firstChunkSize:4e4,ifd0:[274]});async function bt(r){let e=new se(Ct);await e.read(r);let t=await e.parse();if(t&&t.ifd0)return t.ifd0[274]}const vt=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let le=!0,he=!0;if(typeof navigator=="object"){let r=navigator.userAgent;if(r.includes("iPad")||r.includes("iPhone")){let e=r.match(/OS (\d+)_(\d+)/);if(e){let[,t,i]=e;le=Number(t)+.1*Number(i)<13.4,he=!1}}else if(r.includes("OS X 10")){let[,e]=r.match(/OS X 10[_.](\d+)/);le=he=Number(e)<15}if(r.includes("Chrome/")){let[,e]=r.match(/Chrome\/(\d+)/);le=he=Number(e)<81}else if(r.includes("Firefox/")){let[,e]=r.match(/Firefox\/(\d+)/);le=he=Number(e)<77}}async function li(r){let e=await bt(r);return Object.assign({canvas:le,css:he},vt[e])}class tr extends N{constructor(...e){super(...e),p(this,"ranges",new ir),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,i){if(e===0&&this.byteLength===0&&i){let s=new DataView(i.buffer||i,i.byteOffset,i.byteLength);this._swapDataView(s)}else{let s=e+t;if(s>this.byteLength){let{dataView:n}=this._extend(s);this._swapDataView(n)}}}_extend(e){let t;t=je?He.allocUnsafe(e):new Uint8Array(e);let i=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:i}}subarray(e,t,i=!1){return t=t||this._lengthToEnd(e),i&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,i=!1){i&&this._tryExtend(t,e.byteLength,e);let s=super.set(e,t);return this.ranges.add(t,s.byteLength),s}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class ir{constructor(){p(this,"list",[])}get length(){return this.list.length}add(e,t,i=0){let s=e+t,n=this.list.filter((a=>Ft(e,a.offset,s)||Ft(e,a.end,s)));if(n.length>0){e=Math.min(e,...n.map((o=>o.offset))),s=Math.max(s,...n.map((o=>o.end))),t=s-e;let a=n.shift();a.offset=e,a.length=t,a.end=s,this.list=this.list.filter((o=>!n.includes(o)))}else this.list.push({offset:e,length:t,end:s})}available(e,t){let i=e+t;return this.list.some((s=>s.offset<=e&&i<=s.end))}}function Ft(r,e,t){return r<=e&&e<=t}class Xe extends tr{constructor(e,t){super(0),p(this,"chunksRead",0),this.input=e,this.options=t}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,i=await this.readChunk(e,t);return!!i&&i.byteLength===t}async readChunk(e,t){if(this.chunksRead++,(t=this.safeWrapAddress(e,t))!==0)return this._readChunk(e,t)}safeWrapAddress(e,t){return this.size!==void 0&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}$.set("blob",class extends Xe{async readWhole(){this.chunked=!1;let r=await fe(this.input);this._swapArrayBuffer(r)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(r,e){let t=e?r+e:void 0,i=this.input.slice(r,t),s=await fe(i);return this.set(s,r,!0)}});var rr=Object.freeze({__proto__:null,default:er,Exifr:se,fileParsers:K,segmentParsers:x,fileReaders:$,tagKeys:R,tagValues:j,tagRevivers:re,createDictionary:O,extendDictionary:ce,fetchUrlAsArrayBuffer:ue,readBlobAsArrayBuffer:fe,chunkedProps:Z,otherSegments:ve,segments:de,tiffBlocks:A,segmentsAndBlocks:ee,tiffExtractables:te,inheritables:Ie,allFormatters:ie,Options:pe,parse:We,gpsOnlyOptions:St,gps:ni,thumbnailOnlyOptions:yt,thumbnail:ai,thumbnailUrl:oi,orientationOnlyOptions:Ct,orientation:bt,rotations:vt,get rotateCanvas(){return le},get rotateCss(){return he},rotation:li});$.set("url",class extends Xe{async readWhole(){this.chunked=!1;let r=await ue(this.input);r instanceof ArrayBuffer?this._swapArrayBuffer(r):r instanceof Uint8Array&&this._swapBuffer(r)}async _readChunk(r,e){let t=e?r+e-1:void 0,i=this.options.httpHeaders||{};(r||t)&&(i.range=`bytes=${[r,t].join("-")}`);let s=await pt(this.input,{headers:i}),n=await s.arrayBuffer(),a=n.byteLength;if(s.status!==416)return a!==e&&(this.size=r+a),this.set(n,r,!0)}});N.prototype.getUint64=function(r){let e=this.getUint32(r),t=this.getUint32(r+4);return e<1048575?e<<32|t:typeof Me!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),Me(e)<<Me(32)|Me(t)):void M("Trying to read 64b value but JS can only handle 53b numbers.")};class sr extends Ke{parseBoxes(e=0){let t=[];for(;e<this.file.byteLength-4;){let i=this.parseBoxHead(e);if(t.push(i),i.length===0)break;e+=i.length}return t}parseSubBoxes(e){e.boxes=this.parseBoxes(e.start)}findBox(e,t){return e.boxes===void 0&&this.parseSubBoxes(e),e.boxes.find((i=>i.kind===t))}parseBoxHead(e){let t=this.file.getUint32(e),i=this.file.getString(e+4,4),s=e+8;return t===1&&(t=this.file.getUint64(e+8),s+=8),{offset:e,length:t,kind:i,start:s}}parseBoxFullHead(e){if(e.version!==void 0)return;let t=this.file.getUint32(e.start);e.version=t>>24,e.start+=4}}class hi extends sr{static canHandle(e,t){if(t!==0)return!1;let i=e.getUint16(2);if(i>50)return!1;let s=16,n=[];for(;s<i;)n.push(e.getString(s,4)),s+=4;return n.includes(this.type)}async parse(){let e=this.file.getUint32(0),t=this.parseBoxHead(e);for(;t.kind!=="meta";)e+=t.length,await this.file.ensureChunk(e,16),t=this.parseBoxHead(e);await this.file.ensureChunk(t.offset,t.length),this.parseBoxFullHead(t),this.parseSubBoxes(t),this.options.icc.enabled&&await this.findIcc(t),this.options.tiff.enabled&&await this.findExif(t)}async registerSegment(e,t,i){await this.file.ensureChunk(t,i);let s=this.file.subarray(t,i);this.createParser(e,s)}async findIcc(e){let t=this.findBox(e,"iprp");if(t===void 0)return;let i=this.findBox(t,"ipco");if(i===void 0)return;let s=this.findBox(i,"colr");s!==void 0&&await this.registerSegment("icc",s.offset+12,s.length)}async findExif(e){let t=this.findBox(e,"iinf");if(t===void 0)return;let i=this.findBox(e,"iloc");if(i===void 0)return;let s=this.findExifLocIdInIinf(t),n=this.findExtentInIloc(i,s);if(n===void 0)return;let[a,o]=n;await this.file.ensureChunk(a,o);let l=4+this.file.getUint32(a);a+=l,o-=l,await this.registerSegment("tiff",a,o)}findExifLocIdInIinf(e){this.parseBoxFullHead(e);let t,i,s,n,a=e.start,o=this.file.getUint16(a);for(a+=2;o--;){if(t=this.parseBoxHead(a),this.parseBoxFullHead(t),i=t.start,t.version>=2&&(s=t.version===3?4:2,n=this.file.getString(i+s+2,4),n==="Exif"))return this.file.getUintBytes(i,s);a+=t.length}}get8bits(e){let t=this.file.getUint8(e);return[t>>4,15&t]}findExtentInIloc(e,t){this.parseBoxFullHead(e);let i=e.start,[s,n]=this.get8bits(i++),[a,o]=this.get8bits(i++),l=e.version===2?4:2,u=e.version===1||e.version===2?2:0,h=o+s+n,S=e.version===2?4:2,b=this.file.getUintBytes(i,S);for(i+=S;b--;){let D=this.file.getUintBytes(i,l);i+=l+u+2+a;let d=this.file.getUint16(i);if(i+=2,D===t)return d>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(i+o,s),this.file.getUintBytes(i+o+s,n)];i+=d*h}}}class ui extends hi{}p(ui,"type","heic");class Et extends hi{}p(Et,"type","avif"),K.set("heic",ui),K.set("avif",Et),O(R,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),O(R,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),O(R,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),O(j,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Oe=O(j,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const Nt={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Oe.set(37392,Nt),Oe.set(41488,Nt);const it={0:"Normal",1:"Low",2:"High"};function Bt(r){return typeof r=="object"&&r.length!==void 0?r[0]:r}function Gt(r){let e=Array.from(r).slice(1);return e[1]>15&&(e=e.map((t=>String.fromCharCode(t)))),e[2]!=="0"&&e[2]!==0||e.pop(),e.join(".")}function rt(r){if(typeof r=="string"){var[e,t,i,s,n,a]=r.trim().split(/[-: ]/g).map(Number),o=new Date(e,t-1,i);return Number.isNaN(s)||Number.isNaN(n)||Number.isNaN(a)||(o.setHours(s),o.setMinutes(n),o.setSeconds(a)),Number.isNaN(+o)?r:o}}function Ae(r){if(typeof r=="string")return r;let e=[];if(r[1]===0&&r[r.length-1]===0)for(let t=0;t<r.length;t+=2)e.push(_t(r[t+1],r[t]));else for(let t=0;t<r.length;t+=2)e.push(_t(r[t],r[t+1]));return oe(String.fromCodePoint(...e))}function _t(r,e){return r<<8|e}Oe.set(41992,it),Oe.set(41993,it),Oe.set(41994,it),O(re,["ifd0","ifd1"],[[50827,function(r){return typeof r!="string"?ri(r):r}],[306,rt],[40091,Ae],[40092,Ae],[40093,Ae],[40094,Ae],[40095,Ae]]),O(re,"exif",[[40960,Gt],[36864,Gt],[36867,rt],[36868,rt],[40962,Bt],[40963,Bt]]),O(re,"gps",[[0,r=>Array.from(r).join(".")],[7,r=>Array.from(r).join(":")]]);class st extends H{static canHandle(e,t){return e.getUint8(t+1)===225&&e.getUint32(t+4)===1752462448&&e.getString(t+4,20)==="http://ns.adobe.com/"}static headerLength(e,t){return e.getString(t+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(e,t){let i=super.findPosition(e,t);return i.multiSegment=i.extended=i.headerLength===79,i.multiSegment?(i.chunkCount=e.getUint8(t+72),i.chunkNumber=e.getUint8(t+76),e.getUint8(t+77)!==0&&i.chunkNumber++):(i.chunkCount=1/0,i.chunkNumber=-1),i}static handleMultiSegments(e){return e.map((t=>t.chunk.getString())).join("")}normalizeInput(e){return typeof e=="string"?e:N.from(e).getString()}parse(e=this.chunk){if(!this.localOptions.parse)return e;e=(function(n){let a={},o={};for(let l of pi)a[l]=[],o[l]=0;return n.replace(lr,((l,u,h)=>{if(u==="<"){let S=++o[h];return a[h].push(S),`${l}#${S}`}return`${l}#${a[h].pop()}`}))})(e);let t=be.findAll(e,"rdf","Description");t.length===0&&t.push(new be("rdf","Description",void 0,e));let i,s={};for(let n of t)for(let a of n.properties)i=or(a.ns,s),fi(a,i);return(function(n){let a;for(let o in n)a=n[o]=Ne(n[o]),a===void 0&&delete n[o];return Ne(n)})(s)}assignToOutput(e,t){if(this.localOptions.parse)for(let[i,s]of Object.entries(t))switch(i){case"tiff":this.assignObjectToOutput(e,"ifd0",s);break;case"exif":this.assignObjectToOutput(e,"exif",s);break;case"xmlns":break;default:this.assignObjectToOutput(e,i,s)}else e.xmp=t}}p(st,"type","xmp"),p(st,"multiSegment",!0),x.set("xmp",st);class Ge{static findAll(e){return ci(e,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Ge.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],s=e[3].slice(1,-1);return s=di(s),new Ge(t,i,s)}constructor(e,t,i){this.ns=e,this.name=t,this.value=i}serialize(){return this.value}}class be{static findAll(e,t,i){if(t!==void 0||i!==void 0){t=t||"[\\w\\d-]+",i=i||"[\\w\\d-]+";var s=new RegExp(`<(${t}):(${i})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else s=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return ci(e,s).map(be.unpackMatch)}static unpackMatch(e){let t=e[1],i=e[2],s=e[4],n=e[8];return new be(t,i,s,n)}constructor(e,t,i,s){this.ns=e,this.name=t,this.attrString=i,this.innerXml=s,this.attrs=Ge.findAll(i),this.children=be.findAll(s),this.value=this.children.length===0?di(s):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:e,name:t}=this;return e==="rdf"&&(t==="Seq"||t==="Bag"||t==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return ar(this.children.map(nr));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let e={};for(let t of this.properties)fi(t,e);return this.value!==void 0&&(e.value=this.value),Ne(e)}}function fi(r,e){let t=r.serialize();t!==void 0&&(e[r.name]=t)}var nr=r=>r.serialize(),ar=r=>r.length===1?r[0]:r,or=(r,e)=>e[r]?e[r]:e[r]={};function ci(r,e){let t,i=[];if(!r)return i;for(;(t=e.exec(r))!==null;)i.push(t);return i}function di(r){if((function(i){return i==null||i==="null"||i==="undefined"||i===""||i.trim()===""})(r))return;let e=Number(r);if(!Number.isNaN(e))return e;let t=r.toLowerCase();return t==="true"||t!=="false"&&r.trim()}const pi=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],lr=new RegExp(`(<|\\/)(${pi.join("|")})`,"g");var hr=Object.freeze({__proto__:null,default:rr,Exifr:se,fileParsers:K,segmentParsers:x,fileReaders:$,tagKeys:R,tagValues:j,tagRevivers:re,createDictionary:O,extendDictionary:ce,fetchUrlAsArrayBuffer:ue,readBlobAsArrayBuffer:fe,chunkedProps:Z,otherSegments:ve,segments:de,tiffBlocks:A,segmentsAndBlocks:ee,tiffExtractables:te,inheritables:Ie,allFormatters:ie,Options:pe,parse:We,gpsOnlyOptions:St,gps:ni,thumbnailOnlyOptions:yt,thumbnail:ai,thumbnailUrl:oi,orientationOnlyOptions:Ct,orientation:bt,rotations:vt,get rotateCanvas(){return le},get rotateCss(){return he},rotation:li});let Vt=Ee("fs",(r=>r.promises));$.set("fs",class extends Xe{async readWhole(){this.chunked=!1,this.fs=await Vt;let r=await this.fs.readFile(this.input);this._swapBuffer(r)}async readChunked(){this.chunked=!0,this.fs=await Vt,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(r,e){this.fh===void 0&&await this.open(),r+e>this.size&&(e=this.size-r);var t=this.subarray(r,e,!0);return await this.fh.read(t.dataView,0,e,r),t}async close(){if(this.fh){let r=this.fh;this.fh=void 0,await r.close()}}});$.set("base64",class extends Xe{constructor(...r){super(...r),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(r,e){let t,i,s=this.input;r===void 0?(r=0,t=0,i=0):(t=4*Math.floor(r/3),i=r-t/4*3),e===void 0&&(e=this.size);let n=r+e,a=t+4*Math.ceil(n/3);s=s.slice(t,a);let o=Math.min(e,this.size-r);if(je){let l=He.from(s,"base64").slice(i,i+o);return this.set(l,r,!0)}{let l=this.subarray(r,o,!0),u=atob(s),h=l.toUint8();for(let S=0;S<o;S++)h[S]=u.charCodeAt(i+S);return l}}});class zt extends Ke{static canHandle(e,t){return t===18761||t===19789}extendOptions(e){let{ifd0:t,xmp:i,iptc:s,icc:n}=e;i.enabled&&t.deps.add(700),s.enabled&&t.deps.add(33723),n.enabled&&t.deps.add(34675),t.finalizeFilters()}async parse(){let{tiff:e,xmp:t,iptc:i,icc:s}=this.options;if(e.enabled||t.enabled||i.enabled||s.enabled){let n=Math.max(ht(this.options),this.options.chunkSize);await this.file.ensureChunk(0,n),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(e){if(this.parsers.tiff[e]){let t=this.parsers.tiff[e];this.injectSegment(e,t)}}}p(zt,"type","tiff"),K.set("tiff",zt);let ur=Ee("zlib");const fr=["ihdr","iccp","text","itxt","exif"];class Ht extends Ke{constructor(...e){super(...e),p(this,"catchError",(t=>this.errors.push(t))),p(this,"metaChunks",[]),p(this,"unknownChunks",[])}static canHandle(e,t){return t===35152&&e.getUint32(0)===2303741511&&e.getUint32(4)===218765834}async parse(){let{file:e}=this;await this.findPngChunksInRange(8,e.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(e,t){let{file:i}=this;for(;e<t;){let s=i.getUint32(e),n=i.getUint32(e+4),a=i.getString(e+4,4).toLowerCase(),o=s+4+4+4,l={type:a,offset:e,length:o,start:e+4+4,size:s,marker:n};fr.includes(a)?this.metaChunks.push(l):this.unknownChunks.push(l),e+=o}}parseTextChunks(){let e=this.metaChunks.filter((t=>t.type==="text"));for(let t of e){let[i,s]=this.file.getString(t.start,t.size).split("\0");this.injectKeyValToIhdr(i,s)}}injectKeyValToIhdr(e,t){let i=this.parsers.ihdr;i&&i.raw.set(e,t)}findIhdr(){let e=this.metaChunks.find((t=>t.type==="ihdr"));e&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",e.chunk)}async findExif(){let e=this.metaChunks.find((t=>t.type==="exif"));e&&this.injectSegment("tiff",e.chunk)}async findXmp(){let e=this.metaChunks.filter((t=>t.type==="itxt"));for(let t of e)t.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",t.chunk)}async findIcc(){let e=this.metaChunks.find((o=>o.type==="iccp"));if(!e)return;let{chunk:t}=e,i=t.getUint8Array(0,81),s=0;for(;s<80&&i[s]!==0;)s++;let n=s+2,a=t.getString(0,s);if(this.injectKeyValToIhdr("ProfileName",a),Fe){let o=await ur,l=t.getUint8Array(n);l=o.inflateSync(l),this.injectSegment("icc",l)}}}p(Ht,"type","png"),K.set("png",Ht),O(R,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),ce(R,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let jt=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];ce(R,"ifd0",jt),ce(R,"exif",jt),O(j,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class nt extends H{static canHandle(e,t){return e.getUint8(t+1)===224&&e.getUint32(t+4)===1246120262&&e.getUint8(t+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}p(nt,"type","jfif"),p(nt,"headerLength",9),x.set("jfif",nt),O(R,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class Wt extends H{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}p(Wt,"type","ihdr"),x.set("ihdr",Wt),O(R,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),O(j,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class Ue extends H{static canHandle(e,t){return e.getUint8(t+1)===226&&e.getUint32(t+4)===1229144927}static findPosition(e,t){let i=super.findPosition(e,t);return i.chunkNumber=e.getUint8(t+16),i.chunkCount=e.getUint8(t+17),i.multiSegment=i.chunkCount>1,i}static handleMultiSegments(e){return(function(t){let i=(function(s){let n=s[0].constructor,a=0;for(let u of s)a+=u.length;let o=new n(a),l=0;for(let u of s)o.set(u,l),l+=u.length;return o})(t.map((s=>s.chunk.toUint8())));return new N(i)})(e)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:e}=this;this.chunk.byteLength<84&&M("ICC header is too short");for(let[t,i]of Object.entries(cr)){t=parseInt(t,10);let s=i(this.chunk,t);s!=="\0\0\0\0"&&e.set(t,s)}}parseTags(){let e,t,i,s,n,{raw:a}=this,o=this.chunk.getUint32(128),l=132,u=this.chunk.byteLength;for(;o--;){if(e=this.chunk.getString(l,4),t=this.chunk.getUint32(l+4),i=this.chunk.getUint32(l+8),s=this.chunk.getString(t,4),t+i>u)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");n=this.parseTag(s,t,i),n!==void 0&&n!=="\0\0\0\0"&&a.set(e,n),l+=12}}parseTag(e,t,i){switch(e){case"desc":return this.parseDesc(t);case"mluc":return this.parseMluc(t);case"text":return this.parseText(t,i);case"sig ":return this.parseSig(t)}if(!(t+i>this.chunk.byteLength))return this.chunk.getUint8Array(t,i)}parseDesc(e){let t=this.chunk.getUint32(e+8)-1;return oe(this.chunk.getString(e+12,t))}parseText(e,t){return oe(this.chunk.getString(e+8,t-8))}parseSig(e){return oe(this.chunk.getString(e+8,4))}parseMluc(e){let{chunk:t}=this,i=t.getUint32(e+8),s=t.getUint32(e+12),n=e+16,a=[];for(let o=0;o<i;o++){let l=t.getString(n+0,2),u=t.getString(n+2,2),h=t.getUint32(n+4),S=t.getUint32(n+8)+e,b=oe(t.getUnicodeString(S,h));a.push({lang:l,country:u,text:b}),n+=s}return i===1?a[0].text:a}translateValue(e,t){return typeof e=="string"?t[e]||t[e.toLowerCase()]||e:t[e]||e}}p(Ue,"type","icc"),p(Ue,"multiSegment",!0),p(Ue,"headerLength",18);const cr={4:J,8:function(r,e){return[r.getUint8(e),r.getUint8(e+1)>>4,r.getUint8(e+1)%16].map((t=>t.toString(10))).join(".")},12:J,16:J,20:J,24:function(r,e){const t=r.getUint16(e),i=r.getUint16(e+2)-1,s=r.getUint16(e+4),n=r.getUint16(e+6),a=r.getUint16(e+8),o=r.getUint16(e+10);return new Date(Date.UTC(t,i,s,n,a,o))},36:J,40:J,48:J,52:J,64:(r,e)=>r.getUint32(e),80:J};function J(r,e){return oe(r.getString(e,4))}x.set("icc",Ue),O(R,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const Re={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},Kt={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};O(j,"icc",[[4,Re],[12,Kt],[40,Object.assign({},Re,Kt)],[48,Re],[80,Re],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class Le extends H{static canHandle(e,t,i){return e.getUint8(t+1)===237&&e.getString(t+4,9)==="Photoshop"&&this.containsIptc8bim(e,t,i)!==void 0}static headerLength(e,t,i){let s,n=this.containsIptc8bim(e,t,i);if(n!==void 0)return s=e.getUint8(t+n+7),s%2!=0&&(s+=1),s===0&&(s=4),n+8+s}static containsIptc8bim(e,t,i){for(let s=0;s<i;s++)if(this.isIptcSegmentHead(e,t+s))return s}static isIptcSegmentHead(e,t){return e.getUint8(t)===56&&e.getUint32(t)===943868237&&e.getUint16(t+4)===1028}parse(){let{raw:e}=this,t=this.chunk.byteLength-1,i=!1;for(let s=0;s<t;s++)if(this.chunk.getUint8(s)===28&&this.chunk.getUint8(s+1)===2){i=!0;let n=this.chunk.getUint16(s+3),a=this.chunk.getUint8(s+2),o=this.chunk.getLatin1String(s+5,n);e.set(a,this.pluralizeValue(e.get(a),o)),s+=4+n}else if(i)break;return this.translate(),this.output}pluralizeValue(e,t){return e!==void 0?e instanceof Array?(e.push(t),e):[e,t]:t}}p(Le,"type","iptc"),p(Le,"translateValues",!1),p(Le,"reviveValues",!1),x.set("iptc",Le),O(R,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),O(j,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);var dr=X("<i>No image data</i>"),pr=X('<div class="exif-overlay svelte-lrgc1k"><!> <!> <!> <!> <!> <!></div>'),gr=X('<div class="photo-container svelte-lrgc1k" color="white"><img loading="lazy" alt="gallery" class="svelte-lrgc1k"/> <!></div>');function mr(r,e){Zt(e,!1);let t=Dt(e,"imgUrl",8),i=Dt(e,"exif",8),s=t().toString();function n(h){return h?h<1?`1/${Math.round(1/h)}s`:`${h.toFixed(1)}s`:null}Xt();var a=gr(),o=Ce(a),l=z(o,2);{var u=h=>{var S=pr(),b=Ce(S);{var D=g=>{var v=Pe();Q(()=>ae(v,(G(i()),_(()=>i().Model)))),U(g,v)};V(b,g=>{G(i()),_(()=>i().Model)&&g(D)})}var d=z(b,2);{var I=g=>{var v=Pe();Q(()=>ae(v,`f/${G(i()),_(()=>i().FNumber)??""}`)),U(g,v)};V(d,g=>{G(i()),_(()=>i().FNumber)&&g(I)})}var f=z(d,2);{var m=g=>{var v=Pe();Q(F=>ae(v,F),[()=>(G(i()),_(()=>n(i().ExposureTime)))]),U(g,v)};V(f,g=>{G(i()),_(()=>i().ExposureTime)&&g(m)})}var C=z(f,2);{var T=g=>{var v=Pe();Q(()=>ae(v,`ISO${G(i()),_(()=>i().ISO)??""}`)),U(g,v)};V(C,g=>{G(i()),_(()=>i().ISO)&&g(T)})}var w=z(C,2);{var P=g=>{var v=Pe();Q(()=>ae(v,`${G(i()),_(()=>i().FocalLength)??""}mm`)),U(g,v)};V(w,g=>{G(i()),_(()=>i().FocalLength)&&g(P)})}var c=z(w,2);{var y=g=>{var v=dr();U(g,v)};V(c,g=>{G(i()),_(()=>!i().Model&&!i().FNumber&&!i().ExposureTime&&!i().ISO&&!i().FocalLength)&&g(y)})}q(S),U(h,S)};V(l,h=>{i()&&h(u)})}q(a),Q(()=>ot(o,"src",s)),U(r,a),ei()}var Sr=X('<a class="jumpto svelte-1uha8ag"> </a>'),yr=X('<div class="gallery-group svelte-1uha8ag"><h3 class="month-title svelte-1uha8ag"> </h3> <div class="gallery-row svelte-1uha8ag"></div></div>'),Cr=X('<div style="margin: 2rem;"></div> <div style="margin-left: 1.5rem;"><button class="jumpto svelte-1uha8ag" style="margin: 0; font-size: 1rem">How do I work?</button></div> <!>',1),br=X('<div style="margin: 2rem;"><i>Sorting things out...</i></div>'),vr=X('<div style="margin: 2rem;"><i>Fetching pictures...</i></div>'),Ir=X('<div style="line-height: 1.5rem; margin: 2rem;">I have a public Github repo that I populate with my pictures. When you load this page, it fetches a JSON file from the Github API (e.g. "<span style="word-break:break-all"><i>https://api.github.com/repos/your_username/repo_name/contents</i></span>") which contains information about that repo. With this, I can use regex to grab photo URLs, and, after downloading, read out the metadata from each photo. This enables the page to arrange images by month and list camera info (try hovering over an image).</div> <button class="jumpto svelte-1uha8ag" style="margin: 1.5rem; font-size: 1rem">Return</button>',1),Pr=X("<!> <!>",1);function Mr(r,e){Zt(e,!1);let t=[],i=De(!1),s=De(!1),n=De(!1);Si(async()=>{t=(await(await fetch("https://api.github.com/repos/hayekn/webpictures/contents")).json()).filter(C=>C.name.match(/\.(jpg|jpeg|png|webp|gif)$/i)),console.log("Retrieved photos"),ye(i,!0),o()});let a=De({});async function o(){const f=[];for(const m of t){const T=await(await fetch(m.download_url,{headers:{Range:"bytes=0-1000"}})).blob(),w=await hr.parse(T,["Model","FNumber","ExposureTime","ISO","FocalLength","DateTimeOriginal"]),P=w?.DateTimeOriginal?new Date(w.DateTimeOriginal):null;f.push({url:m.download_url,exif:w,date:P})}console.log("Fetched photo metadata"),console.log(f),l(f),ye(s,!0)}function l(f){ye(a,{});for(const m of f){if(!m.date)continue;const C=m.date.getFullYear(),T=String(m.date.getMonth()+2).padStart(2,"0");let w=`${C}-${T}`;w==="2011-02"&&(w="2025-07"),k(a)[w]||Bi(a,k(a)[w]=[]),k(a)[w].push(m)}ye(a,Object.fromEntries(Object.entries(k(a)).sort((m,C)=>C[0].localeCompare(m[0]))))}function u(f){const[m,C]=f.split("-");return`${new Date(`${m}-${C}-01`).toLocaleString("default",{month:"long"})} ${m}`}Xt();var h=Pr(),S=ke(h);{var b=f=>{var m=Cr(),C=ke(m);Qe(C,5,()=>Object.entries(k(a)),qe,(c,y)=>{var g=Tt(()=>At(k(y),2));let v=()=>k(g)[0];var F=Sr(),B=Ce(F,!0);q(F),Q(L=>{ot(F,"href",`#${v()??""}`),ae(B,L)},[()=>u(v())]),U(c,F)}),q(C);var T=z(C,2),w=Ce(T);w.__click=()=>{console.log(k(n)),ye(n,!k(n))},q(T);var P=z(T,2);Qe(P,1,()=>Object.entries(k(a)),qe,(c,y)=>{var g=Tt(()=>At(k(y),2));let v=()=>k(g)[0],F=()=>k(g)[1];var B=yr(),L=Ce(B),ge=Ce(L,!0);q(L);var me=z(L,2);Qe(me,5,F,qe,(Y,Se)=>{mr(Y,{get imgUrl(){return k(Se).url},get exif(){return k(Se).exif}})}),q(me),q(B),Q(Y=>{ot(L,"id",v()),ae(ge,Y)},[()=>u(v())]),U(c,B)}),U(f,m)},D=f=>{var m=It(),C=ke(m);{var T=P=>{var c=br();U(P,c)},w=P=>{var c=It(),y=ke(c);{var g=v=>{var F=vr();U(v,F)};V(y,v=>{k(n)||v(g)},!0)}U(P,c)};V(C,P=>{k(i)&&!k(n)?P(T):P(w,!1)},!0)}U(f,m)};V(S,f=>{k(i)&&k(s)&&!k(n)?f(b):f(D,!1)})}var d=z(S,2);{var I=f=>{var m=Ir(),C=z(ke(m),2);C.__click=()=>ye(n,!k(n)),U(f,m)};V(d,f=>{k(n)&&f(I)})}U(r,h),ei()}Gi(["click"]);export{Mr as component};
